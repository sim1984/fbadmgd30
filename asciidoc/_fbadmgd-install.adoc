[[fbadmdg-install]]
= Установка, обновление и запуск сервера

Скачать дистрибутивы Firebird можно на официальном сайте https://firebirdsql.org в разделе Downloads.

[[fbadmdg-install-linux]]
== Установка на ОС Linux

Firebird под Linux распространяется в двух вариантах через репозитории и в виде tar-архивов.
За репозиториями следят либо разработчики дистрибутивов Linux, либо частные лица (PPA). Tar-архивы распространяет организация Firebird Foundation.
Для официальных релизов Firebird 3.0 они выложены на странице https://firebirdsql.org/en/firebird-3-0/.
Кроме того tar-архивы автоматически собираются для снапшотов, которые вы можете найти по адресу http://web.firebirdsql.org/download/snapshot_builds/linux/fb3.0/.

[[fbadmdg-install-linux_repo]]
=== Установка из репозитория

Репозитории -- это сервера в интернете, на которых хранятся файлы пакетов приложений Linux и другая сопутствующая информация.

Практически у каждого дистрибутива Linux есть свой репозиторий, который содержит только совместимые и поддерживаемые конкретным дистрибутивом пакеты, соответственно, при установке приложений из официальных репозиториев Вы всегда устанавливаете только проверенные и стабильные версии программ.

Репозитории бывают как основные, т.е.
официально поддерживаемые, так и дополнительные, которые можно подключить в случае возникновения необходимости.
Firebird редко включён в основной репозиторий, но часто присутствует в дополнительных репозиториях или в PPA (Personal Package Archive).

[NOTE]
====
За актуальностью пакетов в репозиториях следят либо разработчики дистрибутивов (Linux), либо владельцы репозиториев, а не сообщество Firebird.
По этой причине в репозиториях может быть не самая последняя версия Firebird.
Если вас надо гарантировано установить именно последнюю версию Firebird, либо вовсе произвести обновление из снапшотов, то рекомендуем вам производить установку Firebird из <<fbadmdg-install-linux_tar,tar-архива>>. 
====

[[fbadmdg-install-linux_repo_ubuntu]]
==== Установка Firebird в Ubuntu

В качестве примера рассмотрим установку Firebird 3.0 в Ubuntu 18.04 TLS.

Стабильный пакет (версия 3.0.x) для Ubuntu TLS расположен в репозитории https://launchpad.net/%7Emapopa/+archive/firebird3.0[ppa].

Данный репозиторий может быть добавлен следующим способом:

[listing]
----
sudo add-apt-repository ppa:mapopa/firebird3.0
sudo apt-get update
----

Вы можете посмотреть пакеты связанный с Firebird 3.0 следующим образом:

[listing]
----
apt-cache search firebird3.0
----

Вы уведите следующий список пакетов:

[listing]
----
firebird-dev - Development files for Firebird
firebird3.0-common - common files for firebird 3.0 server, client and utilities
firebird3.0-common-doc - copyright, licensing and changelogs of firebird3.0
firebird3.0-doc - Documentation files for firebird database version 3.0
firebird3.0-examples - Examples for Firebird database
firebird3.0-server-core - Firebird engine core
flamerobin - graphical database administration tool for Firebird DBMS
libib-util - Firebird UDF support library
firebird3.0-server - Firebird Server - an RDBMS based on InterBase 6.0 code
firebird3.0-utils - Firebird command line utilities
libfbclient2 - Firebird client library
----

Для установки Firebird 3.0 в архитектуре SuperServer наберите следующую команду:

[listing]
----
sudo apt-get install firebird3.0-server
----

[listing]
----
The following extra packages will be installed:
  firebird3.0-common firebird3.0-common-doc firebird3.0-utils libfbclient2 libib-util
Suggested packages:
  firebird3.0-doc
The following NEW packages will be installed:
  firebird3.0-common firebird3.0-common-doc firebird3.0-server firebird3.0-utils libfbclient2 libib-util
0 upgraded, 6 newly installed, 0 to remove and 0 not upgraded.
Need to get 4,889kB of archives.
After this operation, 13.1MB of additional disk space will be used.
Do you want to continue [Y/n]?
----

В процессе установки у вас спросят о пароле для пользователя SYSDBA.

.Задание пароля SYSDBA
image::sysdba-password-ubuntu.png[]

Если вам необходимо изменить конфигурацию после установки воспользуйтесь командой:

[listing]
----
sudo dpkg-reconfigure firebird3.0-server
----

Для установки примеров и файлов для разработки наберите команду:

[listing]
----
sudo apt-get install firebird3.0-examples firebird-dev
----

База данных [path]_employee.fdb_ архивирована и находится в директории [path]_/usr/share/doc/firebird3.0-examples/examples/empbuild/_

[listing]
----
cd /usr/share/doc/firebird3.0-examples/examples/empbuild/
sudo gunzip employee.fdb.gz
sudo chown firebird.firebird employee.fdb
sudo mv employee.fdb /var/lib/firebird/3.0/data/
----


[NOTE]
====
Это описание заимствовано со следующего ресурса https://help.ubuntu.com/community/Firebird3.0.
Когда я пробовал проделать тоже самое, то по какой-то причине у меня не оказалось каталога [path]_/usr/share/doc/firebird3.0-examples/examples/empbuild/_

К счастью в папке [path]_/usr/share/doc/firebird3.0-examples/examples/_ лежал запакованный sql скрипт для создания базы данных employee.

[listing]
----
cd /usr/share/doc/firebird3.0-examples/examples/
sudo gunzip employee.sql.gz
----

Полученный файл [path]_employee.sql_ требуется немного поправить чтобы база данных создавалась в нужном месте.

[listing]
----
-- This is a generated file
set sql dialect 3;
create database '/var/lib/firebird/3.0/data/employee.fdb';
...
----

После чего можно запустить скрипт на выполнение:

[listing]
----
isql-fb -i employee.sql
----

====

Теперь можно попробовать подключится к нашей тестовой базы данных.

[listing]
----
$ isql-fb
SQL> connect localhost:/var/lib/firebird/3.0/data/employee.fdb user 'SYSDBA' password password 'Xtwe9k';
----

Если все в порядке, то вы получите сообщение о том, к какой базе данных подключен, какой пользователь и о готовности к использованию.

[listing]
----
Database: localhost:/var/lib/firebird/3.0/data/employee.fdb, User: SYSDBA
SQL>
----

Теперь проверим версию серверы и таблицы.

[listing]
----
SQL> show tables;
       COUNTRY                                CUSTOMER
       DEPARTMENT                             EMPLOYEE
       EMPLOYEE_PROJECT                       JOB
       PROJECT                                PROJ_DEPT_BUDGET
       SALARY_HISTORY                         SALES

SQL> show version;
ISQL Version: LI-V3.0.5.33100 Firebird 3.0
Server version:
Firebird/Linux/AMD/Intel/x64 (access method), version "LI-V3.0.5.33100 Firebird 3.0"
Firebird/Linux/AMD/Intel/x64 (remote server), version "LI-V3.0.5.33100 Firebird 3.0/tcp (fbserver)/P15:C"
Firebird/Linux/AMD/Intel/x64 (remote interface), version "LI-V3.0.5.33100 Firebird 3.0/tcp (fbserver)/P15:C"
on disk structure version 12.0
----

Если ваш сервер установлен с графическим окружением, то вы также можете установить GUI инструмент администрирования [app]``flamerobin`` простой командой.

[listing]
----
sudo apt-get install flamerobin
----


[[fbadmdg-install-linux_repo_ubuntu_client]]
===== Установка только клиента Firebird

Если необходимо установить только клиента Firebird без сервера, то процедура немного сокращается.

Первым делом добавьте репозиторий ppa:mapopa/firebird3.0

[listing]
----
sudo add-apt-repository ppa:mapopa/firebird3.0
sudo apt-get update
----

Теперь устанавливаем сам клиент:

[listing]
----
sudo apt-get install libfbclient2
----


[[fbadmdg-install-linux_repo_centos]]
==== Установка Firebird в CentOS

В качестве примера рассмотрим установку Firebird 3.0 в CentOS 8.0.

Для установки Firebird 3.0 необходимо подключить репозиторий epel.
Это делается следующей командой:

[listing]
----
sudo dnf install https://dl.fedoraproject.org/pub/epel/epel-release-latest-8.noarch.rpm
----

Для просмотра информации о версии Firebird доступным для установки введите команду:

[listing]
----
sudo yum info firebird
----

[listing]
----
Последняя проверка окончания срока действия метаданных: 0:01:19 назад, Ср 08 янв 2020 11:46:11.
Имеющиеся пакеты
Имя          : firebird
Версия       : 3.0.4.33054
Выпуск       : 1.el8
Архитектура  : x86_64
Размер       : 3.6 M
Источник     : firebird-3.0.4.33054-1.el8.src.rpm
Репозиторий  : epel
Краткое опис : SQL relational database management system
URL          : http://www.firebirdsql.org/
Лицензия     : Interbase
Описание     : Firebird is a relational database offering many ANSI SQL standard
             : features that runs on Linux, Windows, and a variety of Unix
             : platforms. Firebird offers excellent concurrency, high
             : performance, and powerful language support for stored procedures
             : and triggers. It has been used in production systems, under a
             : variety of names, since 1981.
----

Как видим в репозитории доступна довольно свежая версия.
Можно приступать к установке.

[listing]
----
sudo yum install firebird
----


[listing]
----
Последняя проверка окончания срока действия метаданных: 0:00:43 назад, Ср 08 янв 2020 11:51:23.
Зависимости разрешены.
================================================================================
 Пакет                 Архитектура   Версия                   Репозиторий Размер
================================================================================
Installing:
 firebird              x86_64        3.0.4.33054-1.el8        epel        3.6 M
Установка зависимостей:
 firebird-utils        x86_64        3.0.4.33054-1.el8        epel        1.1 M
 libfbclient2          x86_64        3.0.4.33054-1.el8        epel        592 k
 libib-util            x86_64        3.0.4.33054-1.el8        epel         18 k
 libtommath            x86_64        1.1.0-1.el8              epel         47 k

Результат транзакции
================================================================================
Установка  5 Пакетов

Объем загрузки: 5.4 M
Объем изменений: 23 M
Продолжить? [д/Н]: y
Загрузка пакетов:
(1/5): libfbclient2-3.0.4.33054-1.el8.x86_64.rp 372 kB/s | 592 kB     00:01    
(2/5): libib-util-3.0.4.33054-1.el8.x86_64.rpm  107 kB/s |  18 kB     00:00    
(3/5): firebird-utils-3.0.4.33054-1.el8.x86_64. 617 kB/s | 1.1 MB     00:01    
(4/5): libtommath-1.1.0-1.el8.x86_64.rpm        451 kB/s |  47 kB     00:00    
(5/5): firebird-3.0.4.33054-1.el8.x86_64.rpm    1.5 MB/s | 3.6 MB     00:02    
--------------------------------------------------------------------------------
Общий размер                                    1.3 MB/s | 5.4 MB     00:04
----

Теперь необходимо задать пароль для пользователя SYSDBA.
Я предпочитаю делать это через [app]``isql``.

[listing]
----
cd /usr/bin
sudo ./isql-fb
----

[listing]
----
Use CONNECT or CREATE DATABASE to specify a database
SQL> connect security.db user sysdba;
Database: security.db, User: SYSDBA
SQL> create user sysdba password 'xRt3sd6T';
SQL> exit;
----

[NOTE]
====
Обратите внимание, что утилита [app]``isql`` переименована в [app]``isql-fb``.
Это сделано потому, что в Linux уже есть утилита [app]``isql`` в рамках проекта unixODBC.
====

Осталось включить и запустить сервис firebird-superserver.

[listing]
----
sudo systemctl enable firebird-superserver
----

[listing]
----
Created symlink /etc/systemd/system/multi-user.target.wants/firebird-superserver.
service  → /usr/lib/systemd/system/firebird-superserver.service.
----

[listing]
----
sudo systemctl start firebird-superserver
----


[[fbadmdg-install-linux_repo_centos_client]]
===== Установка только клиента Firebird

Если необходимо установить только клиента Firebird без сервера, то процедура немного сокращается.

Первым делом добавьте репозиторий EPEL

[listing]
----
sudo dnf install https://dl.fedoraproject.org/pub/epel/epel-release-latest-8.noarch.rpm
sudo dnf update
----

Теперь устанавливаем сам клиент:

[listing]
----
sudo dnf install libfbclient2
----


[[fbadmdg-install-linux_tar]]
=== Ручная установка из tar архива

Tar-архивы распространяет организация Firebird Foundation.
Для официальных релизов Firebird 3.0 они выложены на странице https://firebirdsql.org/en/firebird-3-0/. Кроме того tar-архивы автоматически собираются для снапшотов, которые вы можете найти по адресу http://web.firebirdsql.org/download/snapshot_builds/linux/fb3.0/.

Стоит отметить что процедура установки из tar-архивов одинаковая для всех дистрибутивов Linux.
Нюансы возникают только при разрешении зависимостей от некоторых библиотек.

[NOTE]
====
При установке из tar-архива сервер будет установлен в директорию `/opt/firebird`

В отличие от установки из репозиториев утилита `isql` не переименована и расположена в `/opt/firebird/bin`.
====

[[fbadmdg-install-linux_tar_ubuntu]]
==== Установка Firebird в Ubuntu

В качестве примера рассмотрим установку Firebird 3.0 в Ubuntu 18.04.

Перед установкой Firebird необходимо установить следующие пакеты 

[listing]
----
sudo apt-get install libtommath1
----

Для библиотеки `libtommath` необходимо также создать символическую ссылку: 

[listing]
----
sudo ln -sf /usr/lib/x86_64-linux-gnu/libtommath.so /usr/lib/x86_64-linux-gnu/libtommath.so.0
----

Скачиваем и распаковываем tar-архив текущей версии Firebird

[listing]
----
wget https://github.com/FirebirdSQL/firebird/releases/download/R3_0_5/Firebird-3.0.5.33220-0.amd64.tar.gz
tar xvf Firebird-3.0.5.33220-0.amd64.tar.gz
cd Firebird-3.0.5.33220-0.amd64
----

Теперь можно запускать скрипт установки 

[listing]
----
sudo ./install.sh
----

В процессе инсталляции у вас спросят пароль для пользователя SYSDBA.

Обычно после этого служба Firebird стразу же установлена и запущена, вы можете проверить это командой: 

[listing]
----
systemctl status firebird-superserver
----

[listing]
----
systemctl status firebird-superserver
● firebird-superserver.service - Firebird Database Server ( SuperServer )
   Loaded: loaded (/lib/systemd/system/firebird-superserver.service; enabled; ve
   Active: active (running) since Sun 2020-01-26 15:18:24 UTC; 8min ago
  Process: 6921 ExecStart=/opt/firebird/bin/fbguard -pidfile /var/run/firebird/f
 Main PID: 6923 (firebird)
    Tasks: 4 (limit: 4614)
   CGroup: /system.slice/firebird-superserver.service
           ├─6922 /opt/firebird/bin/fbguard -pidfile /var/run/firebird/firebird.
           └─6923 /opt/firebird/bin/firebird

янв 26 15:18:24 dbserver systemd[1]: Starting Firebird Database Server ( SuperSe
янв 26 15:18:24 dbserver systemd[1]: firebird-superserver.service: Can't open PI
янв 26 15:18:24 dbserver systemd[1]: firebird-superserver.service: Supervising p
янв 26 15:18:24 dbserver systemd[1]: Started Firebird Database Server ( SuperSer
----

Если это не так выполните 

[listing]
----
sudo systemctl enable firebird-superserver
sudo systemctl start firebird-superserver
----


[[fbadmdg-install-linux_tar_centos]]
==== Установка Firebird в CentOS

В качестве примера рассмотрим установку Firebird 3.0 в CentOS 8.0.

Для установки Firebird 3.0 необходимо подключить репозиторий epel.
Это делается следующей командой:

[listing]
----
sudo dnf install https://dl.fedoraproject.org/pub/epel/epel-release-latest-8.noarch.rpm
----

Перед установкой Firebird необходимо установить следующие пакеты

[listing]
----
sudo dnf -y install libtommath
sudo dnf -y install libicu-devel
sudo dnf -y install libncurses*
----

Для библиотеки libtommath необходимо также создать символическую ссылку: 

----
sudo ln -sf /usr/lib64/libtommath.so.1 /usr/lib64/libtommath.so.0
----

Скачиваем и распаковываем tar-архив текущей версии Firebird

[listing]
----
wget https://github.com/FirebirdSQL/firebird/releases/download/R3_0_5/Firebird-3.0.5.33220-0.amd64.tar.gz
tar xvf Firebird-3.0.5.33220-0.amd64.tar.gz
cd Firebird-3.0.5.33220-0.amd64
----

Теперь можно запускать скрипт установки 

[listing]
----
sudo ./install.sh
----

В процессе инсталляции у вас спросят пароль для пользователя SYSDBA.

Обычно после этого служба Firebird стразу же установлена и запущена, вы можете проверить это командой: 

[listing]
----
systemctl status firebird-superserver
----

[listing]
----
● firebird-superserver.service - Firebird Database Server ( SuperServer )
   Loaded: loaded (/usr/lib/systemd/system/firebird-superserver.service; enable>
   Active: active (running) since Sun 2020-01-26 18:41:14 MSK; 2h 24min left
  Process: 1105 ExecStart=/opt/firebird/bin/fbguard -pidfile /var/run/firebird/>
 Main PID: 1143 (firebird)
    Tasks: 5 (limit: 17728)
   Memory: 18.5M
   CGroup: /system.slice/firebird-superserver.service
           ├─1132 /opt/firebird/bin/fbguard -pidfile /var/run/firebird/firebird>
           └─1143 /opt/firebird/bin/firebird

янв 26 18:41:13 localhost.localdomain systemd[1]: Starting Firebird Database Se>
янв 26 18:41:13 localhost.localdomain systemd[1]: firebird-superserver.service:>
янв 26 18:41:14 localhost.localdomain systemd[1]: firebird-superserver.service:>
янв 26 18:41:14 localhost.localdomain systemd[1]: Started Firebird Database Ser>
----

Если это не так выполните 

[listing]
----
sudo systemctl enable firebird-superserver
sudo systemctl start firebird-superserver
----


[[fbadmdg-install-linux_tar_change_mode]]
==== Изменение режима работы Firebird

При установке сервера из tar-архива Firebird по умолчанию устанавливается в архитектуре SuperServer.
Если вам необходимо изменить режим работы сервера, то сделать это можно при помощи скрипта [path]_/opt/firebird/bin/changeServerMode.sh_

[listing]
----
sudo /opt/firebird/bin/changeServerMode.sh
----

[listing]
----
Firebird server may run in 2 different modes - super and classic.
Super server provides better performance, classic - better availability.

Which option would you like to choose: (super|classic) [super] classic
Stopping currently running engine...
Starting firebird in classic server mode...
Updated /opt/firebird/firebird.conf
Done.
----

[[fbadmdg-install-linux_client]]
=== Ручная установка клиента



[[fbadmdg-install-windows]]
== Установка на ОС Windows

Firebird под Windows распространяется в двух вариантах: в виде выполняемого файла установщика с расширением exe и в виде zip или 7z архивов.
Для 32-разрядного варианта в имени файла содержится суффикс Win32, для 64-разрядного -- x64.
Отладочный вариант имеет дополнительный суффикс pdb.

[[fbadmdg-install-windows_exe]]
=== Установка из исполняемого пакета

Скачайте и запустите инсталяционный пакет разрядности, соответствующей разрядности операционной системы (Win32 может работать на 64-разрядной Windows, но это не имеет смысла). Инсталляция СУБД Firebird осуществляется с помощью стандартного мастера установки программ.
В ходе установки мастер собирает всю необходимую для установки сервера информацию, производит копирование файлов и регистрацию программных модулей в реестре Windows.

[NOTE]
====
Для установки Firebird необходимы права администратора.
====

Рекомендуется перед установкой этого пакета ДЕИНСТАЛЛИРОВАТЬ все предыдущие версии Firebird или InterBase.
Особенно важно убедиться, что файлы `fbclient.dll` и `gds32.dll` удалены из каталога `system32`.

Если вам необходимо установить Firebird 3.0 совместно с другими версиями, то это необходимо сделать из zip-архива.

Выберите язык установки.
Предусмотрена установка на русском, английском и других языках. 

.Выбор языка установки
image::select-install-lang.png[Выбор языка установки]


.Лицензионное соглашение и информация об установке
image::install-license.png[Лицензионное соглашение]

В процессе инсталляции вам будет предложено выбрать папку для установки, а также выбрать устанавливаемые компоненты. 

.Выбор компонентов для установки
image::install-select-components.png[Выбор компонентов для установки]


[[fbadmdg-install-windows_exe_servermode]]
==== Выбор архитектуры сервера

Далее будет предложено выбрать архитектуру сервера и некоторые дополнительные опции.
Доступны следующие архитектуры: 

* **Classic**: 
+
** использует отдельный процесс на каждое пользовательское соединение; 
** каждый процесс содержит в себе все что нужно для работы с базой данных: область памяти для метаданных, страничный кэш для минимизации повторных чтений из файла БД; память для сортировок; 
** если происходит сбой, другие соединения остаются работоспособными 
** поддержка мультипроцессорности: в многопроцессорных системах ОС автоматически распределяет процессы по процессорам/ядрам 
* **Superserver**:
+
** один процесс с общей областью памяти для всех пользовательских соединений (общий страничный кеш и память под сортировки); 
** используется пул потоков ОС для обработки запросов от соединений, таким образом каждое соединение работает в отдельном потоке управляемом ОС, а неактивные соединения не отъедают ресурсы потоков; 
** каждый поток со своим кэшем метаданных; 
** поддержка мультипроцессорности: потоки ОС легко распараллеливаются; 
** возможный сбой в одном процессе разорвет все подключения. 
* **SuperClassic**: 
+
** единый процесс на всех пользователей с общей памятью под сортировки;
** используется пул потоков ОС для обработки запросов от соединений, таким образом каждое соединение работает в отдельном потоке управляемом ОС, а неактивные соединения не отъедают ресурсы потоков; 
** каждый поток со своим страничным кэшем и кэшем метаданных; 
** поддержка мультипроцессорности: потоки ОС легко распараллеливаются; 
** возможный сбой в одном процессе разорвет все подключения. 


.Выбор архитектуры
image::install-select-architect.png[Выбор архитектуры]

Каждый из режимов стабилен, и нет причин полностью отдавать предпочтение какому-то одному.
Конечно, у вас могут быть свои собственные конкретные соображения.
Если Вы сомневаетесь, просто следуйте за установкой по умолчанию.
Позже вы можете изменить архитектуру через файл конфигурации `firebird.conf` (параметр `ServerMode`), что потребует перезагрузки, но не переустановки.

==== Установка Guardian

Мы собираемся отказаться от использования Firebird Guardian в будущих версиях.
Он не работает в случае архитектуры Classic Server и программа установки не предлагает его установку, если выбрана данная архитектура.
Для архитектур SuperServer и SuperClassic установка Firebird Guardian возможна, но по умолчанию не выбрана. 

==== Способ запуска сервера Firebird

Сервер может быть запущен в качестве приложения (менее предпочтительный вариант) или в качестве службы.
Для запуска в качестве приложения используется следующая команда:

[listing]
----
firebird -a
----

==== Установка gds32.dll

По умолчанию данная библиотека не копируется в системные папки Windows в процессе установки.
Мы не можем гарантировать, что необходимые библиотеки MS VC runtime будут установлены и доступны в системе.
Тем не менее, данная возможность доступна опционально в процессе установки, так же как и копирование `fbclient.dll` в системные папки Windows.
Если вы используете данную возможность, то вы должны убедиться, что библиотеки MS VC runtime версии 10.0 установлены в системе. 

==== Авторизация с предыдущих версий клиента Firebird

В Firebird 3.0 по умолчанию используется безопасная парольная аутентификация (SRP). Клиенты Firebird 2.5 и более ранние версии использовали традиционную аутентификацию (Legacy_Auth), которая отключена в Firebird 3.0 по-умолчанию, поскольку не является безопасной.

Вы можете разрешить авторизацию предыдущими версиями клиентов Firebird в процессе инсталяции.
Это можно сделать и после установки изменив параметры <<_config_param_auth,AuthServer>>, <<_config_param_usermanager,UserManager>> и <<_config_param_wirecrypt,WireCrypt>>.

==== Пароль SYSDBA

Изначально в системе существует только один пользователь – администратор сервера SYSDBA (пароль по умолчанию -- masterkey). Этот пользователь обладает полными правами на выполнение всех функций по управлению работой сервера и работе с базами данных.
В процессе инсталляции Вас попросят изменить пароль данного пользователя в целях безопасности. 

.Задание пароля SYSDBA
image::install-sysdba-password.png[Задание пароля SYSDBA]

После этого шага будет отображено окно, в котором отображаются опции, выбранные пользователем, если вас всё устраивает можно начать автоматическую установку сервера.

[[fbadmdg-install-windows_zip]]
=== Ручная установка из ZIP архива

Скачайте архив соответствующей разрядности и распакуйте его в директорию, в которой будет размещён сервер Firebird.

[[fbadmdg-install-windows_init_sysdba]]
==== Инициализация SYSDBA

Начиная с Firebird 3.0 пользователь SYSDBA не инициализирован по умолчанию (для плагина управления пользователями SRP), поэтому необходимо явно создать пользователя и указать ему пароль.
Это можно сделать двумя способами: с использованием консольного инструмента для выполнения интерактивных запросов `isql.exe` и консольного инструмента для управления базой данных безопасности `gsec.exe`.

[NOTE]
====
В зависимости от размещения Firebird эти утилиты могут потребовать запуска с привилегиями администратора.
====

[[fbadmdg-install-windows_isql]]
===== Инициализация SYSDBA с помощью ISQL

Запустите инструмент для выполнения интерактивных запросов `isql.exe`.
Соединитесь с базой данных безопасности в режиме встроенного сервера, указав при этом пользователя SYSDBA без пароля.

[NOTE]
====
Пользователя SYSDBA ещё не существует в базе данных безопасности, но в embedded режиме пользователь и его пароль не проверяется, и Firebird доверяет любому указанному имени пользователя.
====

Выполите SQL запрос для создания пользователя SYSDBA:

[listing]
----
CREATE USER SYSDBA PASSWORD '<password>';
----

Пользователь SYSDBA инициализирован, можно выходить из интерактивного режима.

.Инициализация SYSDBA через isql
[example]
====
[source]
----
c:\Firebird\3.0>isql
Use CONNECT or CREATE DATABASE to specify a database
SQL> connect security.db user SYSDBA;
Database: security.db, User: SYSDBA
SQL> CREATE USER SYSDBA PASSWORD 'm8ku234pp';
SQL> exit;

c:\Firebird\3.0>
----
====

[[fbadmdg-install-windows_gsec]]
===== Инициализация SYSDBA с помощью GSEC

Запустите `gsec.exe` указав пользователя SYSDBA и базу данных `security.db`.

Выполите команду для добавления пользователя SYSDBA:

[listing]
----
add SYSDBA -pw <password>
----

.Инициализация SYSDBA через GSEC
[example]
====
[listing]
----
c:\Firebird\3.0>gsec -user SYSDBA -database security.db
*** gsec is deprecated, will be removed soon ***

GSEC> add SYSDBA -pw m8ku234pp
GSEC> quit

c:\Firebird\3.0>
----
====

[NOTE]
====
Инструмент `gsec.exe` является устаревшим, многие возможности доступные через SQL не доступны в нём.
====

[[fbadmdg-install-windows_config]]
==== Конфигурация

[[fbadmdg-install-windows_config_mode]]
===== Режим сервера

По-умолчанию Firebird будет стартовать в режиме SuperServer.
Если вы хотите чтобы сервер запускался в другой архитектуре, то необходимо изменить значение параметра `ServerMode` в `firebird.conf`.
Разкомментируйте его (удалите решётку) и установите нужный режим: Super, SuperClassic или Classic.

[listing]
----
ServerMode = Classic
----

Подробнее о режимах севера и параметре [parameter]``ServerMode`` читайте в <<fbadmdg-install-windows_exe_servermode,Выбор архитектуры сервера>> и <<_config_param_servermode,ServerMode>>.

[[fbadmdg-install-windows_config_auth]]
===== Авторизация с предыдущих версий клиента Firebird

В Firebird 3.0 по умолчанию используется безопасная парольная аутентификация (SRP). Клиенты Firebird 2.5 и более ранние версии использовали традиционную аутентификацию (Legacy_Auth), которая отключена в Firebird 3.0 по-умолчанию, поскольку не является безопасной.

Для поддержки традиционной аутентификации необходимо изменить следующие параметры <<_config_param_auth,AuthServer>>, <<_config_param_usermanager,UserManager>> и <<_config_param_wirecrypt,WireCrypt>>.

.Включение авторизации с предыдущих версий клиента Firebird
[example]
====
[listing]
----
AuthServer = Srp256, Srp, Legacy_Auth
UserManager = Srp, Legacy_UserManager
WireCrypt = Enabled
----
====

[NOTE]
====
Если вам не нужна поддержка безопасной парольной аутентификации (SRP), удалите из `AuthServer` плагины Srp256 и Srp; из `AuthServer` -- Legacy_UserManager, а `WireCrypt` можете изменить на Disabled.
====

После вышеперечисленных манипуляций у нас будет активно два менеджера пользователей, по умолчанию активный тот что первый в списке UserManager.

[IMPORTANT]
====
Одноименные пользователи в разных менеджерах пользователей -- это разные пользователи.
====

Ранее мы уже создали SYSDBA в менеджере пользователей SRP.
В Legacy_UserManager SYSDBA уже существует, причём со стандартным паролем masterkey, который необходимо изменить.
Сделаем это c использованием инструмента isql.
В операторе `ALTER USER` необходимо обязательно указать менеджер пользователей Legacy_UserManager. 

[listing]
----
c:\Firebird\3.0>isql
Use CONNECT or CREATE DATABASE to specify a database
SQL> connect security.db user sysdba;
Database: security.db, User: SYSDBA
SQL> ALTER USER SYSDBA SET PASSWORD 'er34gfde' USING PLUGIN Legacy_UserManager;
SQL> exit;

c:\Firebird\3.0>
----


[[fbadmdg-install-windows_config_with_other]]
===== Одновременный запуск нескольких Firebird

Для одновременного запуск нескольких Firebird, необходимо развести их по разным портам tcp (если конечно слушатель запущен в режиме прослушивания TCP/IP). Для этого необходимо изменить в `firebird.conf` параметр `RemoteServicePort`.
Например, если у вас уже есть один сервер который слушает порт 3050, то необходимо установить любой другой свободный порт, например 3051.
В этом случае в строке подключения необходимо будет указывать новый порт.

[listing]
----
RemoteServicePort = 3051
----

Если необходимо обеспечить также одновременную работоспособность по локальному протоколу XNET и через именованные каналы WNET, то необходимо так же изменить параметры `IpcName` и `RemotePipeName`.
Однако стоит учесть, что эти параметры придётся изменять и на стороне клиента через DPB.

[IMPORTANT]
====
Если вы хотите запускать несколько экземпляров Firebird, то не используйте утилиту `instreg.exe`, которая записывает путь к серверу в реестр Windows.
====

[[fbadmdg-install-windows_instreg]]
==== Запись в реестре

Утилита `instreg.exe` позволяет прописывать в реестр Windows путь к корневому каталогу сервера.
Для этого необходимо запустить команду

[listing]
----
instreg install -z
----

Для удаления записи из реестра необходимо запустит следующую команду

[listing]
----
instreg remove -z
----

[IMPORTANT]
====
Если вы хотите запускать несколько экземпляров Firebird, то не используйте утилиту `instreg.exe`.
====

[NOTE]
====
Переключатель -z не является обязательным, он позволяет вывести установленную или удаленную версию Firebird.
====

[[fbadmdg-install-windows_instsvc]]
==== Установка и запуск Firebird как службы

Утилита `instsvc.exe` записывает, удаляет или меняет информацию о запуске сервера в базе сервисов операционной системы.
Кроме того, она позволяет управлять запуском и остановкой сервиса.
Если запустить её без параметров, то будет выведена справка по командам и параметрам.

[listing]
----
instsvc
----

[listing]
----
Usage:
  instsvc i[nstall]
                    [ -a[uto]* | -d[emand] ]
                    [ -g[uardian] ]
                    [ -l[ogin] username [password] ]
                    [ -n[ame] instance ]
                    [ -i[nteractive] ]

          sta[rt]   [ -b[oostpriority] ]
                    [ -n[ame] instance ]
          sto[p]    [ -n[ame] instance ]
          q[uery]
          r[emove]  [ -n[ame] instance ]


  '*' denotes the default values
  '-z' can be used with any other option, prints version
  'username' refers by default to a local account on this machine.
  Use the format 'domain\username' or 'server\username' if appropriate.
----

Для установки сервиса необходимо ввести команду

[listing]
----
instsvc install
----

В этом случае Firebird будет установлен в качестве службы с именем "`Firebird Server – DefaultInstance`".
Эта служба будет запускаться автоматически при старте ОС, под учётной записью LocalSystem, предназначенной для служб.

Если необходимо чтобы было установлено несколько экземпляров Firebird работающих как службы, то необходимо задать им разные имена с помощью переключателя `-n`

[listing]
----
instsvc install -n fb30
----

Для запуска службы воспользуйтесь командой

[listing]
----
instsvc start
----

Если служба была установлена с именем отличным от умолчательного, то необходимо воспользоваться переключателем `-n`

[listing]
----
instsvc start -n fb30
----

Для остановки службы воспользуйтесь командой

[listing]
----
instsvc stop
----

Если служба была установлена с именем отличным от умолчательного, то необходимо воспользоваться переключателем `-n`

[listing]
----
instsvc stop -n fb30
----

Для удаления сервиса необходимо ввести команду

[listing]
----
instsvc remove
----

Если служба была установлена с именем отличным от умолчательного, то необходимо воспользоваться переключателем `-n`

[listing]
----
instsvc remove -n fb30
----

Для просмотра всех служб Firebird установленных в системе воспользуйтесь командой

[listing]
----
instsvc query
----

[listing]
----
Firebird Server - fb30 IS installed.
  Status  : running
  Path    : C:\Firebird\3.0\firebird.exe -s fb30
  Startup : automatic
  Run as  : LocalSystem

Firebird Server - fb40 IS installed.
  Status  : running
  Path    : C:\Firebird\4.0\firebird.exe -s fb40
  Startup : automatic
  Run as  : LocalSystem
----

[[fbadmdg-install-windows_bat]]
==== Использование install_service.bat и uninstall_service.bat

Для упрощения процедуру установки и удаления служб в ZIP архиве в комплекте с Firebird поставляются два BAT файла: `install-service.bat` и `uninstall_service.bat`.

В этом случае процедура установки Firebird в качестве сервиса выглядит следующим образом

[listing]
----
install_service.bat
----

Если необходимо задать службе имя отличное от умолчательного, то указываем это имя в качестве аргумента

[listing]
----
install_service.bat fb30
----

В этом случае процедура удаления службы Firebird выглядит следующим образом

[listing]
----
uninstall_service.bat
----

Если служба была установлена с именем отличным от умолчательного, то указываем это имя в качестве аргумента

[listing]
----
uninstall_service.bat fb30
----

[[fbadmdg-install-windows_app]]
==== Запуск Firebird как приложения

Для запуска Firebird в качестве приложения достаточно выполнить команду

[listing]
----
firebird -a
----

[TIP]
====
Запуск Firebird как приложения удобен на компьютере разработчика.
Это особенно полезно во время отладки UDF, UDR и различных плагинов Firebird.
====

[[fbadmdg-install-windows_client]]
==== Установка клиента

Если речь идёт об установке только о клиентской части, то обязательно требуется файл `fbclient.dll`.
Клиент Firebird 3.0 обязательно требует наличие установленного Microsoft Runtime C++ 2010 соответствующей разрядности.
Если данная библиотека не установлено, то можно скопировать дополнительные библиотеки, которые поставляются в ZIP архиве под Windows `msvcp100.dll` и `msvcr100.dll`.

Желательно, чтобы рядом с `fbclient.dll` был расположен файл сообщений `firebird.msg`.
Большинство сообщений об ошибках уже содержатся в `fbclient.dll`, однако если вы собираетесь пользоваться консольными утилитами файл `firebird.msg` обязательно должен присутствовать.

Если требуется сжатие трафика при работе по TCP/IP, то потребуется так же библиотека `zlib1.dll`.

Для того чтобы клиентское приложение могло загрузить библиотеку `fbclient.dll` она должна располагаться либо рядом с приложением, либо в одной из директорий в которой производится поиск, например добавленной в `PATH` или системной директории для размещения общедоступных библиотек (`system32` или `SysWOW64`).

[IMPORTANT]
====
Размещение клиентской библиотеки в `PATH` может помешать другим приложениям, которым требуется клиентская библиотека другой версии или другого сервера.
Поэтому, если предполагается, что приложение должно работать независимо от других приложений с конкретной версией клиента, то файлы клиента требуется разместить в папке приложения, и не прописывать этот путь в `PATH`.
====

Если у вас ещё нет (и не планируется) установок сервера Firebird или его клиента, то вы можете зарегистрировать путь к корню Firebird в реестре.

[listing]
----
instreg install
----

[[fbadmdg-install-windows_client_instclient]]
===== Утилита instclient

Утилита `instclient.exe` позволяет:

* установить клиентскую часть одной командой;
* установить клиентскую часть как `fbclient.dll` и/или `gds32.dll`;
* проверить наличие установленной библиотеки `fbclient.dll` и/или `gds32.dll`;
* удалить ранее установленные `fbclient.dll` и/или `gds32.dll`.


[NOTE]
====
Утилита `instclient.exe` должна быть запущена с правами администратора.
====

Если запустить `instclient.exe` без параметров, то будет выведена краткая справка:

[listing]
----
instclient
----

[listing]
----
Usage:
  instclient i[nstall] [ -f[orce] ] library
             q[uery] library
             r[emove] library

  where library is:  f[bclient] | g[ds32]
----

Для развёртывания клиентской библиотеки Firebird в системном каталоге Windows воспользуйтесь командой

[listing]
----
instclient install fbclient
----

[listing]
----
FBCLIENT.DLL has been installed to the System directory.
----

При развёртывании библиотеки проверяется версия и инкрементируется счётчик общих библиотек.
Для отмены проверки версии вы можете воспользоваться переключателем `-force`.

Некоторые старые приложения требуют для работы клиентскую библиотеку `gds32.dll` (наследие Interbase). Кроме того, многие приложения требуют для работы не просто `gds32.dll`, но и проверяют версию этой библиотеки.
Именно поэтому простое переименовывание `fbclient.dll` в `gds32.dll` для таких программ работать не будет -- версия библиотеки окажется ниже 6.0 (т.к.
соответствует версии Firebird, у которого нумерация версий идет с 1.0). Утилита `instclient.exe` позволяет не просто установить `gds32.dll`, но и изменить её версию на корректную.

[listing]
----
instclient install gds32
----

[listing]
----
GDS32.DLL has been installed to the System directory.
----

Утилита `instclient.exe` позволяет также проверить наличие установленной клиентской библиотеки с помощью команды

[listing]
----
instclient q fbclient
----

[listing]
----
Installed FBCLIENT.DLL version : 3.0.4.33054 (shared DLL count 1)
----

[listing]
----
instclient q gds32
----

[listing]
----
Installed GDS32.DLL version : 6.3.4.33054 (shared DLL count 2)
----

Для удаления воспользуйтесь командой

[listing]
----
instclient remove fbclient
----

[listing]
----
The FBCLIENT.DLL has been removed from the System directory.
----

[listing]
----
instclient remove gds32
----

[listing]
----
The GDS32.DLL has been removed from the System directory.
----

[[fbadmdg-install-windows_update]]
==== Обновление

В данном случае речь об обновлении в рамках пойнт-релизов (третья цифра в версии сервера) или так называемых сервис-паков.
Обновление мажорной или минорной версии обычно требует гораздо больше действий, описанных в Release Note, и называется "`Миграцией`". 

[NOTE]
====
Обычно обновление в рамках пойнт-релизов не требует процедуры резервного копирования и восстановления базы данных средством `gbak`, но бывают исключения.
Такие исключения обязательно описаны в Release Note, поэтому обязательно ознакомьтесь с ним перед обновлением.
====

Примерно те же действия требуются при обновлении на текущий снапшот.
Снапшоты -- это ежедневные сборки сервера Firebird, которые включают самые последние изменения текущей версии сервера.
Это позволяет иметь самую свежую версию сервера с исправленными ошибками и улучшениями.
Однако учтите, что снапшоты не проходят полный цикл тестирования и могут содержать новые ошибки или регрессии.
Поэтому не обновляйтесь до снапшота без явной необходимости (исправленные в нём ошибки касаются вас непосредственно).

Алгоритм обновления поверх существующего сервера Firebird следующий:

. Убедится что все пользователи отключены от всех баз данных обслуживаемых обновляемым сервером Firebird. С помощью команды 
+
[listing]
----
gfix -shut -force n databasename
----
+
можно закрыть все подключения и запретить последующие. 
. Остановить сервер
. Сделать резервную копию корневого каталога сервера
. Распаковать из ZIP архива с пойнт-релизом или снапшотом файлы в корневую директорию сервера
. Заменить новые файлы конфигурации (`firebird.conf`, `databases.conf` и другие), а также файл `security3.fdb` на прежние
. Запустить обновленный сервер
. Перевести базы данных в онлайн-режим 
+
[listing]
----
gfix -online databasename
----


[[fbadmdg-install-windows_embedded]]
==== Встроенный сервер

Начиная с Firebird 3.0 встроенная (embedded) версия не распространяется отдельно.
Всё, что необходимо для развертывания Firebird Embedded, находится в том же самом ZIP архиве, что и обычная версия.

Для функционирования Firebird Embedded необходимы следующие файлы: 

* клиентская библиотека (`fbclient.dll` или `libfbclient.so`);
* движок для работы с ODS 12.0 (`engine12.dll` или `libEngine12.so`) из папки `plugins`;
* библиотека интернационализации, которая находится в каталоге `intl`; 
* файл сообщений `firebird.msg`;
* для изменения некоторых параметров могут потребоваться `firebird.conf` и/или `databases.conf`;
* в Windows обязательно необходимы файлы ICU библиотеки;
* если в Windows не установлен MS VC++ Runtime 2010, то необходимы также файлы (`msvcp100.dll` и `msvcr100.dll`);
* если вам необходимы консольные инструменты администрирования, то скопируйте также `gbak`, `gfix`, `gstat`, `isql`, `nbackup`.


[[fbadmdg-install-windows_embedded_config]]
===== Конфигурация

По умолчанию Firebird работает в режиме Super сервера, в том числе и в embedded варианте.
Это не очень удобно, поскольку Super открывает файл базы данных в монопольном режиме, что обозначает что только один процесс может работать с базой данных.
Для изменения режима запуска необходимо отредактировать (возможно раскомментировать) значение параметра `ServerMode` на Classic или SuperClassic в файле `firebird.conf`.

Поскольку в embedded варианте сетевой доступ не используется вы можете отредактировать также провайдеры `Providers`, удалив от туда лишние провайдеры Remote и Loopback.

[listing]
----
Providers = Engine12
----
