<!DOCTYPE chapter>
<chapter xmlns="http://docbook.org/ns/docbook" version="5.1" xml:id="install" xml:lang="ru">
    <info>
        <title>Установка, обновление и запуск сервера</title>
    </info>

    <para>Скачать дистрибутивы Firebird можно на официальном сайте <link
            xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://firebirdsql.org"/> в
        разделе Downloads.</para>
    
    <section xml:id="install-linux">
        <title>Установка на ОС Linux</title>
        
        <para/>
        
        <section xml:id="install-linux-repo">
            <title>Установка из репозитория</title>
            
            <para/>
        </section>
        
        <section xml:id="install-linux-tar">
            <title>Ручная установка из tar архива</title>
            
            <para/>
        </section>
        
        <section xml:id="install-linux-client">
            <title>Ручная установка клиента</title>
            
            <para/>
        </section>
    </section>

    <section xml:id="install-windows">
        <title>Установка на ОС Windows</title>

        <para>Firebird под Windows распространяется в двух вариантах: в виде выполняемого файла
            установщика с расширением exe и в виде zip архивов. Для 32-разрядного варианта в имени
            файла содержится суффикс Win32, для 64-разрядного — x64. Отладочный вариант имеет
            дополнительный суффикс pdb.</para>

        <section xml:id="install-windows-exe">
            <title>Установка из исполняемого пакета</title>

            <para>Скачайте и запустите инсталяционный пакет разрядности, соответствующей разрядности
                операционной системы (Win32 может работать на 64-разярдной Windows, но это не имеет
                смысла). Инсталляция СУБД Firebird осуществляется с помощью стандартного мастера
                установки программ. В ходе установки мастер собирает всю необходимую для установки
                сервера информацию, производит копирование файлов и регистрацию программных модулей
                в реестре Windows.</para>
            <note>
                <para>Для установки Firebird необходимы права администратора.</para>
            </note>

            <para>Рекомендуется перед установкой этого пакета ДЕИНСТАЛЛИРОВАТЬ все предыдущие версии
                Firebird или InterBase. Особенно важно убедиться, что файлы
                    <filename>fbclient.dll</filename> и <filename>gds32.dll</filename> удалены из
                каталога <filename>system32</filename>.</para>

            <para>Если вам необходимо установить Firebird 3.0 совместно с другими версиями, то это
                необходимо сделать из zip-архива.</para>

            <para>Выберите язык установки. Предусмотрена установка на русском, английском и других
                языках. <figure>
                    <title>Выбор языка установки</title>
                    <mediaobject>
                        <imageobject>
                            <imagedata fileref="images/select-install-lang.png" align="center"/>
                        </imageobject>
                        <textobject>
                            <phrase>Выбор языка установки</phrase>
                        </textobject>
                    </mediaobject>
                </figure>
                <figure>
                    <title>Лицензионное соглашение и информация об установке</title>
                    <para>
                        <inlinemediaobject>
                            <imageobject>
                                <imagedata fileref="images/install-license.png" width="45%"
                                    align="left"/>
                            </imageobject>
                            <textobject>
                                <phrase>Лицензионное соглашение</phrase>
                            </textobject>
                        </inlinemediaobject>
                        <inlinemediaobject>
                            <imageobject>
                                <imagedata fileref="images/install-info.png" width="45%"
                                    align="right"/>
                            </imageobject>
                            <textobject>
                                <phrase>Информация об установке</phrase>
                            </textobject>
                        </inlinemediaobject>
                    </para>
                </figure>
            </para>

            <para>В процессе инсталляции вам будет предложено выбрать папку для установки, а также
                выбрать устанавливаемые компоненты. <figure>
                    <title>Выбор компонентов для установки</title>
                    <mediaobject>
                        <imageobject>
                            <imagedata fileref="images/install-select-components.png" width="450"/>
                        </imageobject>
                        <textobject>
                            <phrase>Выбор компонентов для установки</phrase>
                        </textobject>
                    </mediaobject>
                </figure>
            </para>

            <simplesect xml:id="install-windows-exe-servermode">
                <title>Выбор архитектуры сервера</title>

                <para>Далее будет предложено выбрать архитектуру сервера и некоторые дополнительные
                    опции. Доступны следующие архитектуры: <itemizedlist>
                        <listitem>
                            <para><emphasis role="bold">Classic</emphasis>: <itemizedlist
                                    spacing="compact">
                                    <listitem>
                                        <para> использует отдельный процесс на каждое
                                            пользовательское соединение; </para>
                                    </listitem>
                                    <listitem>
                                        <para> каждый процесс содержит в себе все что нужно для
                                            работы с базой данных: область памяти для метаданных,
                                            страничный кэш для минимизации повторных чтений из файла
                                            БД; память для сортировок; </para>
                                    </listitem>
                                    <listitem>
                                        <para> если происходит сбой, другие соединения остаются
                                            работоспособными </para>
                                    </listitem>
                                    <listitem>
                                        <para> поддержка мультипроцессорности: в многопроцессорных
                                            системах ОС автоматически распределяет процессы по
                                            процессорам/ядрам </para>
                                    </listitem>
                                </itemizedlist></para>
                        </listitem>
                        <listitem>
                            <para>
                                <emphasis role="bold">Superserver</emphasis>:<itemizedlist
                                    spacing="compact">
                                    <listitem>
                                        <para> один процесс с общей областью памяти для всех
                                            пользовательских соединений (общий странчный кеш и
                                            память под сортировки); </para>
                                    </listitem>
                                    <listitem>
                                        <para> используется пул потоков ОС для обработки запросов от
                                            соединений, таким образом каждое соединение работает в
                                            отдельном потоке управляемом ОС, а неактивные соединения
                                            не отъедают ресурсы потоков; </para>
                                    </listitem>
                                    <listitem>
                                        <para> каждый поток со своим кэшем метаданных; </para>
                                    </listitem>
                                    <listitem>
                                        <para>поддержка мультипроцессорности: потоки ОС легко
                                            распараллеливаются; </para>
                                    </listitem>
                                    <listitem>
                                        <para> возможный сбой в одном процессе разорвет все
                                            подключения. </para>
                                    </listitem>
                                </itemizedlist></para>
                        </listitem>
                        <listitem>
                            <para>
                                <emphasis role="bold">SuperClassic</emphasis>: <itemizedlist
                                    spacing="compact">
                                    <listitem>
                                        <para>единый процесс на всех пользователей с общей памятью
                                            под сортировки;</para>
                                    </listitem>
                                    <listitem>
                                        <para> используется пул потоков ОС для обработки запросов от
                                            соединений, таким образом каждое соединение работает в
                                            отдельном потоке управляемом ОС, а неактивные соединения
                                            не отъедают ресурсы потоков; </para>
                                    </listitem>
                                    <listitem>
                                        <para> каждый поток со своим страничным кэшем и кэшем
                                            метаданных; </para>
                                    </listitem>
                                    <listitem>
                                        <para>поддержка мультипроцессорности: потоки ОС легко
                                            распараллеливаются; </para>
                                    </listitem>
                                    <listitem>
                                        <para> возможный сбой в одном процессе разорвет все
                                            подключения. </para>
                                    </listitem>
                                </itemizedlist></para>
                        </listitem>
                    </itemizedlist>
                    <figure>
                        <title>Выбор архитектуры</title>
                        <mediaobject>
                            <imageobject>
                                <imagedata fileref="images/install-select-architect.png" width="450"
                                />
                            </imageobject>
                            <textobject>
                                <phrase>Выбор архитектуры</phrase>
                            </textobject>
                        </mediaobject>
                    </figure>
                </para>
                <para>Каждый из режимов стабилен, и нет причин полностью отдавать предпочтение
                    какому то одному. Конечно, у вас могут быть свои собственные конкретные
                    соображения. Если Вы сомневаетесь, просто следуйте за установкой по умолчанию.
                    Позже вы можете изменить архитектуру через файл конфигурации
                        <filename>firebird.conf</filename> (параметр ServerMode), что потребует
                    перезагрузки, но не переустановки.</para>
            </simplesect>

            <simplesect>
                <title>Установка Guardian</title>
                <para>Мы собираемся отказаться от использования Firebird Guardian в будущих версиях.
                    Он не работает в случае архитектуры Classic Server и программа установки не
                    предлагает его установку, если выбрана данная архитектура. Для архитектур
                    SuperServer и SuperClassic установка Firebird Guardian возможна, но по умолчанию
                    не выбрана. </para>
            </simplesect>

            <simplesect>
                <title>Способ запуска сервера Firebird</title>
                <para>Сервер может быть запущен в качестве приложения (менее предпочтительный
                    вариант) или в качестве службы. Для запуска в качестве приложения используется
                    следующая команда:
                    <programlisting>
firebird -a                    
                </programlisting>
                </para>
            </simplesect>

            <simplesect>
                <title>Установка gds32.dll</title>
                <para>По умолчанию данная библиотека не копируется в системные папки Windows в
                    процессе установки. Мы не можем гарантировать, что необходимые библиотеки MS VC
                    runtime будут установлены и доступны в системе. Тем не менее, данная возможность
                    доступна опционально в процессе установки, так же как и копирование
                        <filename>fbclient.dll</filename> в системные папки Windows. Если вы
                    используете данную возможность, то вы должны убедиться, что библиотеки MS VC
                    runtime версии 10.0 установлены в системе. </para>
            </simplesect>

            <simplesect>
                <title>Авторизация с предыдущих версий клиента Firebird</title>
                <para>В Firebird 3.0 по умолчанию используется безопасная парольная аутентификация
                    (SRP). Клиенты Firebird 2.5 и более ранние версии использовали традиционную
                    аутентификацию (Legacy_Auth), которая отключена в Firebird 3.0 по-умолчанию,
                    поскольку не является безопасной.</para>
                <para>Вы можете разрешить авторизацию предыдущими версиями клиентов Firebird в
                    процессе инсталяции. Это можно сделать и после установки изменив параметры <link
                        xmlns:xlink="http://www.w3.org/1999/xlink" linkend="config-param-AuthServer"
                        >AuthServer</link>, <link xmlns:xlink="http://www.w3.org/1999/xlink"
                        linkend="config-param-UserManager">UserManager</link> и <link
                        xmlns:xlink="http://www.w3.org/1999/xlink" linkend="config-param-WireCrypt"
                        >WireCrypt</link>.</para>
            </simplesect>

            <simplesect>
                <title>Пароль SYSDBA</title>
                <para>Изначально в системе существует только один пользователь – администратор
                    сервера SYSDBA (пароль по умолчанию — masterkey). Этот пользователь обладает
                    полными правами на выполнение всех функций по управлению работой сервера и
                    работе с базами данных. В процессе инсталляции Вас попросят изменить пароль
                    данного пользователя в целях безопасности. <figure>
                        <title>Задание пароля SYSDBA</title>
                        <mediaobject>
                            <imageobject>
                                <imagedata fileref="images/install-sysdba-password.png" width="450"
                                />
                            </imageobject>
                            <textobject>
                                <phrase>Задание пароля SYSDBA</phrase>
                            </textobject>
                        </mediaobject>
                    </figure>
                </para>

                <para>После этого шага будет отображено окно, в котором отображаются опции выбранные
                    пользователем, если вас всё устраивает можно начать автоматическую установку
                    сервера.</para>
            </simplesect>
        </section>
        <section xml:id="install-windows-zip">
            <title>Ручная установка из ZIP архива</title>

            <para>Скачайте архив соответствующей разрядности и распакуйте его в директорию, в
                которой будет размещён сервер Firebird.</para>

            <section xml:id="install-windows-init-sysdba">
                <title>Инициализация SYSDBA</title>

                <para>Начиная с Firebird 3.0 пользователь SYSDBA не инициализирован по умолчанию
                    (для плагина управления пользователями SRP), поэтому необходимо явно создать
                    пользователя и указать ему пароль. Это можно сделать двумя способами: с
                    использованием консольного инструмента для выполнения интерактивных запросов
                        <application>isql.exe</application> и консольного инструмента для управления
                    базой данных безопасности <application>gsec.exe</application>.</para>

                <note>
                    <para>В зависимости от размещения Firebird эти утилиты могут потребовать запуска
                        с привилегиями администратора.</para>
                </note>

                <section xml:id="install-windows-isql">
                    <title>Инициализация SYSDBA с помощью ISQL</title>

                    <para>Запустите инструмент для выполнения интерактивных запросов
                            <application>isql.exe</application>. Соединитесь с базой данных
                        безопасности в режиме встроенного сервера, указав при этом пользователя
                        SYSDBA без пароля.</para>
                    <note>
                        <para>Пользователя SYSDBA ещё не существует в базе данных безопасности, но в
                            embedded режиме пользователь и его пароль не проверяется, и Firebird
                            доверяет любому указанному имени пользователя.</para>
                    </note>

                    <para>Выполите SQL запрос для создания пользователя SYSDBA:
                        <programlisting>
CREATE USER SYSDBA PASSWORD '<replaceable>&lt;password&gt;</replaceable>';                 
                </programlisting>
                    </para>

                    <para>Пользователь SYSDBA инициализирован, можно выходить из интерактивного
                        режима.</para>

                    <example>
                        <title>Инициализация SYSDBA через isql</title>
                        <para>
                            <programlisting>
<![CDATA[
c:\Firebird\3.0>isql
Use CONNECT or CREATE DATABASE to specify a database
SQL> connect security.db user SYSDBA;
Database: security.db, User: SYSDBA
SQL> CREATE USER SYSDBA PASSWORD 'm8ku234pp';
SQL> exit;

c:\Firebird\3.0>
]]>                            
                        </programlisting>
                        </para>
                    </example>
                </section>

                <section xml:id="install-windows-gsec">
                    <title>Инициализация SYSDBA с помощью GSEC</title>

                    <para>Запустите <application>gsec.exe</application> указав пользователя SYSDBA и
                        базу данных <filename>security.db</filename>.</para>

                    <para>Выполите команду для добавления пользователя SYSDBA:
                        <programlisting>
add SYSDBA -pw <replaceable>&lt;password&gt;</replaceable>                 
                </programlisting>
                    </para>

                    <example>
                        <title>Инициализация SYSDBA через GSEC</title>
                        <para>
                            <programlisting>
<![CDATA[
c:\Firebird\3.0>gsec -user SYSDBA -database security.db
*** gsec is deprecated, will be removed soon ***

GSEC> add SYSDBA -pw m8ku234pp
GSEC> quit

c:\Firebird\3.0>
]]>                            
                        </programlisting>
                        </para>
                    </example>
                    <note>
                        <para>Инструмент <application>gsec.exe</application> является устаревшим,
                            многие возможности доступные через SQL не доступны в нём.</para>
                    </note>
                </section>
            </section>
            <section xml:id="install-windows-config">
                <title>Конфигурация</title>

                <section xml:id="install-windows-config-mode">
                    <title>Режим сервера</title>

                    <para>По-умолчанию Firebird будет стартовать в режиме SuperServer. Если вы
                        хотите чтобы сервер запускался в другой архитектуре, то необходимо изменить
                        значение параметра <parameter>ServerMode</parameter> в
                            <filename>firebird.conf</filename>. Разкомментируйте его (удалите
                        решётку) и установите нужный режим: Super, SuperClassic или Classic.
                        <programlisting>
ServerMode = Classic                       
                        </programlisting>
                    </para>
                    <para>Подробнее о режимах севера и параметре <parameter>ServerMode</parameter>
                        читайте в <link xmlns:xlink="http://www.w3.org/1999/xlink"
                            linkend="install-windows-exe-servermode">Выбор архитектуры
                            сервера</link> и <link xmlns:xlink="http://www.w3.org/1999/xlink"
                            linkend="config-param-ServerMode">ServerMode</link>.</para>
                </section>
                <section xml:id="install-windows-config-auth">
                    <title>Авторизация с предыдущих версий клиента Firebird</title>

                    <para>В Firebird 3.0 по умолчанию используется безопасная парольная
                        аутентификация (SRP). Клиенты Firebird 2.5 и более ранние версии
                        использовали традиционную аутентификацию (Legacy_Auth), которая отключена в
                        Firebird 3.0 по-умолчанию, поскольку не является безопасной.</para>

                    <para>Для поддержки традиционной аутентификации необходимо изменить следующие
                        параметры <link xmlns:xlink="http://www.w3.org/1999/xlink"
                            linkend="config-param-AuthServer">AuthServer</link>, <link
                            xmlns:xlink="http://www.w3.org/1999/xlink"
                            linkend="config-param-UserManager">UserManager</link> и <link
                            xmlns:xlink="http://www.w3.org/1999/xlink"
                            linkend="config-param-WireCrypt">WireCrypt</link>.</para>

                    <example>
                        <title>Включение авторизации с предыдущих версий клиента Firebird</title>

                        <para>
                            <programlisting>
AuthServer = Srp256, Srp, Legacy_Auth
UserManager = Srp, Legacy_UserManager
WireCrypt = Enabled
                            </programlisting>
                        </para>
                    </example>

                    <note>
                        <para>Если вам не нужна поддержка безопасной парольной аутентификации (SRP),
                            удалите из <parameter>AuthServer</parameter> плагины Srp256 и Srp; из
                                <parameter>AuthServer</parameter> — Legacy_UserManager, а
                                <parameter>WireCrypt</parameter> можете изменить на Disabled.</para>
                    </note>

                    <para>После вышеперечисленных манипуляций у нас будет активно два менеджера
                        пользователей, по умолчанию активный тот что первый в списке
                        UserManager.</para>

                    <important>
                        <para>Одноименные пользователи в разных менеджерах пользователей — это
                            разные пользователи.</para>
                    </important>

                    <para>Ранее мы уже создали SYSDBA в менеджере пользователей SRP. В
                        Legacy_UserManager SYSDBA уже существует, причём со стандартным паролем
                        masterkey, который необходимо изменить. Сделаем это c использованием
                        инструмента isql. В операторе <code>ALTER USER</code> необходимо обязательно
                        указать менеджер пользователей Legacy_UserManager. <programlisting>
            <![CDATA[
c:\Firebird\3.0>isql
Use CONNECT or CREATE DATABASE to specify a database
SQL> connect security.db user sysdba;
Database: security.db, User: SYSDBA
SQL> ALTER USER SYSDBA SET PASSWORD 'er34gfde' USING PLUGIN Legacy_UserManager;
SQL> exit;

c:\Firebird\3.0>
            ]]>            
                    </programlisting>
                    </para>
                </section>

                <section xml:id="install-windows-config-with_other">
                    <title>Одновременный запуск нескольких Firebird</title>

                    <para>Для одновременного запуск нескольких Firebird, необходимо развести их по
                        разным портам tcp (если конечно слушатель запущен в режиме прослушивания
                        TCP/IP). Для этого необходимо изменить в <filename>firebird.conf</filename>
                        параметр <parameter>RemoteServicePort</parameter>. Например, если у вас уже
                        есть один сервер который слушает порт 3050, то необходимо установить любой
                        другой свободный порт, например 3051. В этом случае в строке подключения
                        необходимо будет указывать новый порт.
                        <programlisting>
RemoteServicePort = 3051                            
                        </programlisting>
                    </para>

                    <para>Если необходимо обеспечить также одновременную работоспособность по
                        локальному протоколу XNET и через именованные каналы WNET, то необходимо так
                        же изменить параметры <parameter>IpcName</parameter> и
                            <parameter>RemotePipeName</parameter>. Однако стоит учесть, что эти
                        параметры придётся изменять и на стороне клиента через DPB.</para>

                    <important>
                        <para>Если вы хотите запускать несколько экземпляров Firebird, то не
                            используйте утилиту <application>instreg.exe</application>, которая
                            записывает путь к серверу в реестр Windows.</para>
                    </important>
                </section>
            </section>
            <section xml:id="install-windows-instreg">
                <title>Запись в реестре</title>

                <para>Утилита утилита <application>instreg.exe</application> позволяет прописывать в
                    реестр Windows путь к корневому каталогу сервера. Для этого необходимо запустить
                    команду
                    <programlisting>
instreg install -z             
                </programlisting>
                </para>

                <para>Для удаления записи из реестра необходимо запустит следующую команду
                    <programlisting>
instreg remove -z                    
                </programlisting>
                </para>

                <important>
                    <para>Если вы хотите запускать несколько экземпляров Firebird, то не используйте
                        утилиту <application>instreg.exe</application>.</para>
                </important>

                <note>
                    <para>Переключатель -z не является обязательным, он позволяет вывести
                        установленную или удаленную версию Firebird.</para>
                </note>
            </section>
            <section xml:id="install-windows-instsvc">
                <title>Установка и запуск Firebird как службы</title>

                <para>Утилита <application>instsvc.exe</application> записывает, удаляет или меняет
                    информацию о запуске сервера в базе сервисов операционной системы. Кроме того,
                    она позволяет управлять запуском и остановкой сервиса. Если запустить её без
                    параметров, то будет выведена справка по командам и параметрам. <programlisting>                   
instsvc
</programlisting>
                    <screen>
Usage:
  instsvc i[nstall]
                    [ -a[uto]* | -d[emand] ]
                    [ -g[uardian] ]
                    [ -l[ogin] username [password] ]
                    [ -n[ame] instance ]
                    [ -i[nteractive] ]

          sta[rt]   [ -b[oostpriority] ]
                    [ -n[ame] instance ]
          sto[p]    [ -n[ame] instance ]
          q[uery]
          r[emove]  [ -n[ame] instance ]


  '*' denotes the default values
  '-z' can be used with any other option, prints version
  'username' refers by default to a local account on this machine.
  Use the format 'domain\username' or 'server\username' if appropriate.               
                </screen>
                </para>

                <para>Для установки сервиса необходимо ввести команду
                    <programlisting>
instsvc install    
</programlisting>
                </para>
                <para>В этом случае Firebird будет установлен в качестве службы с именем
                        <quote>Firebird Server – DefaultInstance</quote>. Эта служба будет
                    запускаться автоматически при старте ОС, под учётной записью LocalSystem,
                    предназначенной для служб.</para>
                <para>Если необходимо чтобы было установлено несколько экземпляров Firebird
                    работающих как службы, то необходимо задать им разные имена с помощью
                    переключателя <code>-n</code>
                    <programlisting>
instsvc install -n fb30    
</programlisting>
                </para>

                <para>Для запуска службы воспользуйтесь командой
                    <programlisting>
instsvc start                    
                </programlisting>
                </para>
                <para>Если службы была установлена с именем отличным от умолчательного, то
                    необходимо воспользоваться переключателем <code>-n</code>
                    <programlisting>
instsvc start -n fb30                    
                </programlisting>
                </para>
                <para>Для остановки службы воспользуйтесь командой
                    <programlisting>
instsvc stop                    
                </programlisting>
                </para>
                <para>Если службы была установлена с именем отличным от умолчательного, то
                    необходимо воспользоваться переключателем <code>-n</code>
                    <programlisting>
instsvc stop -n fb30                    
                </programlisting>
                </para>
                <para>Для удаления сервиса необходимо ввести команду
                    <programlisting>
instsvc remove    
</programlisting>
                </para>
                <para>Если службы была установлена с именем отличным от умолчательного, то
                    необходимо воспользоваться переключателем <code>-n</code>
                    <programlisting>
instsvc remove -n fb30                    
                </programlisting>
                </para>
                <para>Для просмотра всех служб Firebird установленных в системе воспользуйтесь
                    командой <programlisting>
instsvc query
</programlisting>
                    <screen>
Firebird Server - fb30 IS installed.
  Status  : running
  Path    : C:\Firebird\3.0\firebird.exe -s fb30
  Startup : automatic
  Run as  : LocalSystem

Firebird Server - fb40 IS installed.
  Status  : running
  Path    : C:\Firebird\4.0\firebird.exe -s fb40
  Startup : automatic
  Run as  : LocalSystem                    
                </screen>
                </para>
            </section>
            <section xml:id="install-windows-bat">
                <title>Использование install_service.bat и uninstall_service.bat</title>

                <para>Для упрощения процедуру установки и удаления служб в ZIP архиве в комплекте с
                    Firebird поставляются два BAT файла: <filename>install_service.bat</filename> и
                        <filename>uninstall_service.bat</filename>.</para>

                <para>В этом случае процедура установки Firebird в качестве сервиса выглядит
                    следующим образом
                    <programlisting>
install_service.bat                        
                    </programlisting>
                </para>
                <para>Если необходимо задать службе имя отличное от умолчательного, то указываем это
                    имя в качестве аргумента
                    <programlisting>
install_service.bat fb30                       
                    </programlisting>
                </para>


                <para>В этом случае процедура удаления службы Firebird выглядит следующим образом
                    <programlisting>
uninstall_service.bat                        
                    </programlisting>
                </para>
                <para>Если службы была установлена с именем отличным от умолчательного, то указываем
                    это имя в качестве аргумента
                    <programlisting>
uninstall_service.bat fb30                       
                    </programlisting>
                </para>
            </section>
            <section xml:id="install-windows-app">
                <title>Запуск Firebird как приложения</title>

                <para>Для запуска Firebird в качестве приложения достаточно выполнить команду
                    <programlisting>
firebird -a                       
                    </programlisting>
                </para>

                <tip>
                    <para>Запуск Firebird как приложения удобен на компьютере разработчика. Это
                        особенно полезно во время отладки UDF, UDR и различных плагинов
                        Firebird.</para>
                </tip>
            </section>
            <section xml:id="install-windows-client">
                <title>Установка клиента</title>

                <para>Если речь идёт об установке только о клиентской части, то обязательно
                    требуется файл <filename>fbclient.dll</filename>. Клиент Firebird 3.0
                    обязательно требует наличие установленного Microsoft Runtime C++ 2010
                    соответствующей разрядности. Если данная библиотека не установлено, то можно
                    скопировать дополнительные библиотеки, которые поставляются в ZIP архиве под
                    Windows <filename>msvcp100.dll</filename> и
                    <filename>msvcr100.dll</filename>.</para>

                <para>Желательно, чтобы рядом с <filename>fbclient.dll</filename> был расположен
                    файл сообщений <filename>firebird.msg</filename>. Большинство сообщений об
                    ошибках уже содержатся в <filename>fbclient.dll</filename>, однако если вы
                    собираетесь пользоваться консольными утилитами файл
                        <filename>firebird.msg</filename> обязательно должен присутствовать.</para>

                <para>Если требуется сжатие трафика при работе по TCP/IP, то потребуется так же
                    библиотека <filename>zlib1.dll</filename>.</para>

                <para>Для того чтобы клиентское приложение могло загрузить библиотеку
                        <filename>fbclient.dll</filename> она должна располагаться либо рядом с
                    приложением, либо в одной из директорий в которой производится поиск, например
                    добавленной в <filename>PATH</filename> или системной директории для размещения
                    общедоступных библиотек (<filename>system32</filename> или
                        <filename>SysWOW64</filename>).</para>

                <important>
                    <para>Размещение клиентской библиотеки в <filename>PATH</filename> может
                        помешать другим приложениям, которым требуется клиентская библиотека другой
                        версии или другого сервера. Поэтому, если предполагается, что приложение
                        должно работать независимо от других приложений с конкретной версией
                        клиента, то файлы клиента требуется разместить в папке приложения, и не
                        прописывать этот путь в <filename>PATH</filename>.</para>
                </important>

                <para>Если у вас ещё нет (и не планируется) установок сервера Firebird или его
                    клиента, то вы можете зарегистрировать путь к корню Firebird в реестре.
                    <programlisting>
instreg install                       
                    </programlisting>
                </para>

                <section xml:id="install-windows-client-instclient">
                    <title>Утилита instclient</title>

                    <para>Утилита <application>instclient.exe</application> позволяет:<itemizedlist>
                            <listitem>
                                <para>установить клиентскую часть одной командой;</para>
                            </listitem>
                            <listitem>
                                <para>установить клиентскую часть как
                                        <filename>fbclient.dll</filename> и/или
                                        <filename>gds32.dll</filename>;</para>
                            </listitem>
                            <listitem>
                                <para>проверить наличие установленной библиотеки
                                        <filename>fbclient.dll</filename> и/или
                                        <filename>gds32.dll</filename>;</para>
                            </listitem>
                            <listitem>
                                <para>удалить ранее установленные <filename>fbclient.dll</filename>
                                    и/или <filename>gds32.dll</filename>.</para>
                            </listitem>
                        </itemizedlist></para>

                    <note>
                        <para>Утилита <application>instclient.exe</application> должна быть запущена
                            с правами администратора.</para>
                    </note>

                    <para>Если запустить <application>instclient.exe</application> без параметров,
                        то будет выведена краткая справка: <programlisting>
instclient                        
                    </programlisting>
                        <screen>
Usage:
  instclient i[nstall] [ -f[orce] ] library
             q[uery] library
             r[emove] library

  where library is:  f[bclient] | g[ds32]                          
                        </screen>
                    </para>

                    <para>Для развёртывания клиентской библиотеки Firebird в системном каталоге
                        Windows воспользуйтесь командой <programlisting>
instclient install fbclient    
</programlisting>
                        <screen>
FBCLIENT.DLL has been installed to the System directory.                            
                        </screen>
                    </para>
                    <para>При развёртывании библиотеки проверяется версия и инкрементируется счётчик
                        общих библиотек. Для отмены проверки версии вы можете воспользоваться
                        переключателем <code>-force</code>.</para>

                    <para>Некоторые старые приложения требуют для работы клиентскую библиотеку
                            <filename>gds32.dll</filename> (наследие Interbase). Кроме того, многие
                        приложения требуют для работы не просто <filename>gds32.dll</filename>, но и
                        проверяют версию этой библиотеки. Именно поэтому простое переименовывание
                            <filename>fbclient.dll</filename> в <filename>gds32.dll</filename> для
                        таких программ работать не будет — версия библиотеки окажется ниже 6.0 (т.к.
                        соответствует версии Firebird, у которого нумерация версий идет с 1.0).
                        Утилита <application>instclient.exe</application> позволяет не просто
                        установить <filename>gds32.dll</filename>, но и изменить её версию на
                        корректную. <programlisting>
instclient install gds32  
</programlisting>
                        <screen>
GDS32.DLL has been installed to the System directory.                           
                        </screen>
                    </para>

                    <para>Утилита <application>instclient.exe</application> позволяет также
                        проверить наличие установленной клиентской библиотеки с помощью команды <programlisting>
instclient q fbclient 
</programlisting>
                        <screen>
Installed FBCLIENT.DLL version : 3.0.4.33054 (shared DLL count 1)                          
                        </screen>
                        <programlisting>
instclient q gds32
</programlisting>
                        <screen>
Installed GDS32.DLL version : 6.3.4.33054 (shared DLL count 2)                        
                        </screen>
                    </para>

                    <para>Для удаления воспользуйтесь командой <programlisting>
instclient remove fbclient 
</programlisting>
                        <screen>
The FBCLIENT.DLL has been removed from the System directory.                          
                        </screen>
                        <programlisting>
instclient remove gds32
</programlisting>
                        <screen>
The GDS32.DLL has been removed from the System directory.                     
                        </screen>
                    </para>
                </section>
            </section>
            <section xml:id="install-windows-update">
                <title>Обновление</title>

                <para>В данном случае речь об обновлении в рамках пойнт-релизов (третья цифра в
                    версии сервера) или так называемых сервис-паков. Обновление мажорной или
                    минорной версии обычно требует гораздо больше действий, описанных в Release
                    Note, и называется <quote>Миграцией</quote>. </para>
                <note>
                    <para>Обычно обновление в рамках пойнт-релизов не требует процедуры резервного
                        копирования и восстановления базы данных средством
                            <application>gbak</application>, но бывают исключения. Такие исключения
                        обязательно описаны в Release Note, поэтому обязательно ознакомьтесь с ним
                        перед обновлением.</para>
                </note>
                <para>Примерно те же действия требуются при обновлении на текущий снапшот. Снапшоты
                    — это ежедневные сборки сервера Firebird, которые включают самые последние
                    изменения текущей версии сервера. Это позволяет иметь самую свежую версию
                    сервера с исправленными ошибками и улучшениями. Однако учтите, что снапшоты не
                    проходят полный цикл тестирования и могут содержать новые ошибки или регрессии.
                    Поэтому не обновляйтесь до снапшота без явной необходимости (исправленные в нём
                    ошибки касаются вас непосредственно).</para>
                <para>Алгоритм обновления поверх существующего сервера Firebird следующий:<orderedlist>
                        <listitem>
                            <para>Убедится что все пользователи отключены от всех баз данных
                                обслуживаемых обновляемым сервером Firebird. С помощью команды <programlisting>
<![CDATA[
gfix -shut -force <n>
]]>                                
                            </programlisting> можно закрыть все
                                подключения и запретить последующие. </para>
                        </listitem>
                        <listitem>
                            <para>Остановить сервер</para>
                        </listitem>
                        <listitem>
                            <para>Сделать резервную копию корневого каталога сервера</para>
                        </listitem>
                        <listitem>
                            <para>Распаковать из ZIP архива с пойнт-релизом или снапшотом файлы в
                                корневую директорию сервера</para>
                        </listitem>
                        <listitem>
                            <para>Заменить новые файлы конфигурации
                                    (<filename>firebird.conf</filename>,
                                    <filename>databases.conf</filename> и другие), а также файл
                                    <filename>security3.fdb</filename> на прежние</para>
                        </listitem>
                        <listitem>
                            <para>Запустить обновленный сервер</para>
                        </listitem>
                        <listitem>
                            <para>Перевести базы данных в онлайн режим <programlisting>
                            <![CDATA[
gfix -online
]]>                         
</programlisting>
                            </para>
                        </listitem>
                    </orderedlist></para>
            </section>
            <section xml:id="install-windows-embedded">
                <title>Встроенный сервер</title>

                <para>Начиная с Firebird 3.0 встроенная (embedded) версия не распространяется
                    отдельно. Всё что необходимо для развертывания Firebird Embedded находится в том
                    же самом ZIP архиве, что и обычная версия.</para>

                <para>Для функционирования Firebird Embedded необходимы следующие файлы: <itemizedlist>
                        <listitem>
                            <para>клиентская библиотека (<filename>fbclient.dll</filename> или
                                    <filename>libfbclient.so</filename>);</para>
                        </listitem>
                        <listitem>
                            <para>движок для работы с ODS 12.0 (<filename>engine12.dll</filename>
                                или <filename>libEngine12.so</filename>) из папки
                                    <filename>plugins</filename>;</para>
                        </listitem>
                        <listitem>
                            <para>библиотека интернационализации, которая находится в каталоге
                                    <filename>intl</filename>; </para>
                        </listitem>
                        <listitem>
                            <para>файл сообщений <filename>firebird.msg</filename>;</para>
                        </listitem>
                        <listitem>
                            <para>для изменения некоторых параметров могут потребоваться
                                    <filename>firebird.conf</filename> и/или
                                    <filename>databases.conf</filename>;</para>
                        </listitem>
                        <listitem>
                            <para>в Windows обязательно необходимы файлы ICU библиотеки;</para>
                        </listitem>
                        <listitem>
                            <para>если в Windows не установлен MS VC++ Runtime 2010, то необходимы
                                также файлы (<filename>msvcp100.dll</filename> и
                                    <filename>msvcr100.dll</filename>);</para>
                        </listitem>
                        <listitem>
                            <para>если вам необходимы консольные инструменты администрирования, то
                                скопируйте также <filename>gbak</filename>,
                                    <filename>gfix</filename>, <filename>gstat</filename>,
                                    <filename>isql</filename>, <filename>nbackup</filename>.</para>
                        </listitem>
                    </itemizedlist></para>

                <section xml:id="install-windows-embedded-config">
                    <title>Конфигурация</title>

                    <para>По умолчанию Firebird работает в режиме Super сервера в том числе и в
                        embedded варианте. Это не очень удобно, поскольку Super открывает файл базы
                        данных в монопольном режиме, что обозначает что только один процесс может
                        работать с базой данных. Для изменения режима запуска необходимо
                        отредактировать (возможно раскомментировать) значение параметра
                            <parameter>ServerMode</parameter> на Classic или SuperClassic в файле
                            <filename>firebird.conf</filename>.</para>

                    <para>Поскольку в embedded варианте сетевой доступ не используется вы можете
                        отредактировать также провайдеры <parameter>Providers</parameter>, удалив от
                        туда лишние провайдеры Remote и Loopback.
                        <programlisting>
Providers = Engine12                        
                    </programlisting>
                    </para>
                </section>
            </section>
        </section>
    </section>
</chapter>
