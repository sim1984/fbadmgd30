<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Руководство администратора Firebird 3.0</title><link rel="stylesheet" type="text/css" href="docbook.css"/><link rel="stylesheet" type="text/css" href="css/firebirddocs.css"/><meta name="generator" content="DocBook XSL Stylesheets V1.79.2"/></head><body><div xml:lang="ru" class="book" id="fbadmgd"><div class="titlepage"><div><div><h1 class="title">Руководство администратора Firebird 3.0</h1></div><div><div class="authorgroup"><div class="author"><h3 class="author"><span class="firstname">Денис</span> <span class="surname">Симонов</span></h3></div><div class="author"><h3 class="author"><span class="firstname">Дмитрий</span> <span class="surname">Еманов</span></h3></div><div class="author"><h3 class="author"><span class="firstname">Дмитрий</span> <span class="surname">Кузьменко</span></h3></div><div class="author"><h3 class="author"><span class="firstname">Алексей</span> <span class="surname">Ковязин</span></h3></div><div class="author"><h3 class="author"><span class="firstname">Павел</span> <span class="surname">Зотов</span></h3></div></div></div></div><hr/></div><div class="toc"><div class="toc-title">Содержание</div><ul class="toc"><li><span class="preface"><a href="#intro">Введение</a></span></li><li><span class="part"><a href="#install-and-settings">I. Установка и настройка</a></span><ul><li><span class="chapter"><a href="#install">1. Установка, обновление и запуск сервера</a></span><ul><li><span class="section"><a href="#install-linux">Установка на ОС Linux</a></span><ul><li><span class="section"><a href="#install-linux-repo">Установка из репозитория</a></span><ul><li><span class="section"><a href="#install-linux-repo-ubuntu">Установка Firebird в Ubuntu</a></span><ul><li><span class="section"><a href="#install-linux-repo-ubuntu-client">Установка только клиента Firebird</a></span></li></ul></li><li><span class="section"><a href="#install-linux-repo-centos">Установка Firebird в CentOS</a></span><ul><li><span class="section"><a href="#install-linux-repo-centos-client">Установка только клиента Firebird</a></span></li></ul></li></ul></li><li><span class="section"><a href="#install-linux-tar">Ручная установка из tar архива</a></span><ul><li><span class="section"><a href="#install-linux-tar-ubuntu">Установка Firebird в Ubuntu</a></span></li><li><span class="section"><a href="#install-linux-tar-centos">Установка Firebird в CentOS</a></span></li><li><span class="section"><a href="#d0e380">Изменение режима работы Firebird</a></span></li></ul></li><li><span class="section"><a href="#install-linux-client">Ручная установка клиента</a></span></li></ul></li><li><span class="section"><a href="#install-windows">Установка на ОС Windows</a></span><ul><li><span class="section"><a href="#install-windows-exe">Установка из исполняемого пакета</a></span></li><li><span class="section"><a href="#install-windows-zip">Ручная установка из ZIP архива</a></span><ul><li><span class="section"><a href="#install-windows-init-sysdba">Инициализация SYSDBA</a></span><ul><li><span class="section"><a href="#install-windows-isql">Инициализация SYSDBA с помощью ISQL</a></span></li><li><span class="section"><a href="#install-windows-gsec">Инициализация SYSDBA с помощью GSEC</a></span></li></ul></li><li><span class="section"><a href="#install-windows-config">Конфигурация</a></span><ul><li><span class="section"><a href="#install-windows-config-mode">Режим сервера</a></span></li><li><span class="section"><a href="#install-windows-config-auth">Авторизация с предыдущих версий клиента Firebird</a></span></li><li><span class="section"><a href="#install-windows-config-with_other">Одновременный запуск нескольких Firebird</a></span></li></ul></li><li><span class="section"><a href="#install-windows-instreg">Запись в реестре</a></span></li><li><span class="section"><a href="#install-windows-instsvc">Установка и запуск Firebird как службы</a></span></li><li><span class="section"><a href="#install-windows-bat">Использование install_service.bat и uninstall_service.bat</a></span></li><li><span class="section"><a href="#install-windows-app">Запуск Firebird как приложения</a></span></li><li><span class="section"><a href="#install-windows-client">Установка клиента</a></span><ul><li><span class="section"><a href="#install-windows-client-instclient">Утилита instclient</a></span></li></ul></li><li><span class="section"><a href="#install-windows-update">Обновление</a></span></li><li><span class="section"><a href="#install-windows-embedded">Встроенный сервер</a></span><ul><li><span class="section"><a href="#install-windows-embedded-config">Конфигурация</a></span></li></ul></li></ul></li></ul></li></ul></li><li><span class="chapter"><a href="#files">2. Состав файлов сервера</a></span><ul><li><span class="section"><a href="#d0e1283">Файлы конфигурации</a></span></li><li><span class="section"><a href="#d0e1325">Инструменты администрирования и сервисы</a></span></li><li><span class="section"><a href="#d0e1434">Динамические библиотеки</a></span></li><li><span class="section"><a href="#d0e1528">Плагины</a></span></li><li><span class="section"><a href="#d0e1632">Включаемые файлы</a></span></li><li><span class="section"><a href="#d0e1640">Примеры</a></span></li><li><span class="section"><a href="#d0e1648">Документации</a></span></li><li><span class="section"><a href="#d0e1656">Другие файлы</a></span></li></ul></li><li><span class="chapter"><a href="#d0e1674">3. Настройка операционной системы для Firebird</a></span><ul><li><span class="section"><a href="#d0e1678">Настройка Linux</a></span><ul><li><span class="section"><a href="#d0e1682">Лимиты Linux</a></span></li><li><span class="section"><a href="#d0e1686">Необходимые права для Firebird на Linux</a></span></li><li><span class="section"><a href="#d0e1690">Рекомендуемые параметры сети</a></span></li><li><span class="section"><a href="#d0e1694">Рекомендуемые параметры памяти</a></span></li><li><span class="section"><a href="#d0e1698">Рекомендуемые параметры диска</a></span></li></ul></li><li><span class="section"><a href="#d0e1702">Настройка Windows</a></span><ul><li><span class="section"><a href="#d0e1706">Необходимые права для Firebird на Windows</a></span></li><li><span class="section"><a href="#d0e1710">Рекомендуемые параметры</a></span></li></ul></li></ul></li><li><span class="chapter"><a href="#config">4. Описание параметров конфигурации</a></span><ul><li><span class="section"><a href="#config-param-types">Типы параметров</a></span></li><li><span class="section"><a href="#config-scope">Область действия</a></span></li><li><span class="section"><a href="#config-macro">Макроподстановки</a></span></li><li><span class="section"><a href="#config-includes">Включение других файлов</a></span></li><li><span class="section"><a href="#config-perdb">Параметры уровня базы данных</a></span><ul><li><span class="section"><a href="#config-perdb-format">Формат конфигурационных записей</a></span></li><li><span class="section"><a href="#config-perdb-params">Доступные параметры</a></span></li></ul></li><li><span class="section"><a href="#config-common">Общие настройки</a></span><ul><li><span class="section"><a href="#config-param-DatabaseAccess">DatabaseAccess</a></span></li><li><span class="section"><a href="#config-param-RemoteAccess">RemoteAccess</a></span></li><li><span class="section"><a href="#config-param-ExternalFileAccess">ExternalFileAccess</a></span></li><li><span class="section"><a href="#config-param-UdfAccess">UdfAccess</a></span></li><li><span class="section"><a href="#config-param-TempDirectories">TempDirectories</a></span></li><li><span class="section"><a href="#config-param-AuditTraceConfigFile">AuditTraceConfigFile</a></span></li><li><span class="section"><a href="#config-param-MaxUserTraceLogSize">MaxUserTraceLogSize</a></span></li><li><span class="section"><a href="#config-param-DefaultDbCachePages">DefaultDbCachePages</a></span></li><li><span class="section"><a href="#config-param-DatabaseGrowthIncrement">DatabaseGrowthIncrement</a></span></li><li><span class="section"><a href="#config-param-FileSystemCacheThreshold">FileSystemCacheThreshold</a></span></li><li><span class="section"><a href="#config-param-FileSystemCacheSize">FileSystemCacheSize</a></span></li><li><span class="section"><a href="#config-param-RemoteFileOpenAbility">RemoteFileOpenAbility</a></span></li><li><span class="section"><a href="#config-param-TempBlockSize">TempBlockSize</a></span></li><li><span class="section"><a href="#config-param-TempCacheLimit">TempCacheLimit</a></span></li><li><span class="section"><a href="#config-param-Auth">AuthServer и AuthClient</a></span></li><li><span class="section"><a href="#config-param-UserManager">UserManager</a></span></li><li><span class="section"><a href="#config-param-TracePlugin">TracePlugin</a></span></li><li><span class="section"><a href="#config-param-WireCryptPlugin">WireCryptPlugin</a></span></li><li><span class="section"><a href="#config-param-KeyHolderPlugin">KeyHolderPlugin</a></span></li><li><span class="section"><a href="#config-param-AllowEncryptedSecurityDatabase">AllowEncryptedSecurityDatabase</a></span></li><li><span class="section"><a href="#config-param-Providers">Providers</a></span></li><li><span class="section"><a href="#config-param-DeadlockTimeout">DeadlockTimeout</a></span></li><li><span class="section"><a href="#config-param-MaxUnflushedWrites">MaxUnflushedWrites</a></span></li><li><span class="section"><a href="#config-param-MaxUnflushedWriteTime">MaxUnflushedWriteTime</a></span></li><li><span class="section"><a href="#config-param-BugcheckAbort">BugcheckAbort</a></span></li><li><span class="section"><a href="#config-param-RelaxedAliasChecking">RelaxedAliasChecking</a></span></li><li><span class="section"><a href="#config-param-ConnectionTimeout">ConnectionTimeout</a></span></li><li><span class="section"><a href="#config-param-WireCrypt">WireCrypt</a></span></li><li><span class="section"><a href="#config-param-WireCompression">WireCompression</a></span></li><li><span class="section"><a href="#config-param-DummyPacketInterval">DummyPacketInterval</a></span></li><li><span class="section"><a href="#config-param-RemoteServicePort">RemoteServicePort или RemoteServiceName</a></span></li><li><span class="section"><a href="#config-param-RemoteAuxPort">RemoteAuxPort</a></span></li><li><span class="section"><a href="#config-param-TcpRemoteBufferSize">TcpRemoteBufferSize</a></span></li><li><span class="section"><a href="#config-param-TcpNoNagle">TcpNoNagle</a></span></li><li><span class="section"><a href="#config-param-TcpLoopbackFastPath">TcpLoopbackFastPath</a></span></li><li><span class="section"><a href="#config-param-IPv6V6Only">IPv6V6Only</a></span></li><li><span class="section"><a href="#config-param-RemoteBindAddress">RemoteBindAddress</a></span></li><li><span class="section"><a href="#config-param-LockMemSize">LockMemSize</a></span></li><li><span class="section"><a href="#config-param-LockAcquireSpins">LockAcquireSpins</a></span></li><li><span class="section"><a href="#config-param-LockHashSlots">LockHashSlots</a></span></li><li><span class="section"><a href="#config-param-EventMemSize">EventMemSize</a></span></li></ul></li><li><span class="section"><a href="#config-engine">Настройки ядра</a></span><ul><li><span class="section"><a href="#config-param-CpuAffinityMask">CpuAffinityMask</a></span></li><li><span class="section"><a href="#config-param-GCPolicy">GCPolicy</a></span></li><li><span class="section"><a href="#config-param-SecurityDatabase">SecurityDatabase</a></span></li></ul></li><li><span class="section"><a href="#config-windows">Настройки для Windows систем</a></span><ul><li><span class="section"><a href="#config-param-GuardianOption">GuardianOption</a></span></li><li><span class="section"><a href="#config-param-ProcessPriorityLevel">ProcessPriorityLevel</a></span></li><li><span class="section"><a href="#config-param-IpcName">IpcName</a></span></li><li><span class="section"><a href="#config-param-RemotePipeName">RemotePipeName</a></span></li></ul></li><li><span class="section"><a href="#config-unix">Настройки для Unix/Linux систем</a></span><ul><li><span class="section"><a href="#config-param-Redirection">Redirection</a></span></li></ul></li><li><span class="section"><a href="#config-servermode">Настройки архитектуры</a></span><ul><li><span class="section"><a href="#config-param-ServerMode">ServerMode</a></span></li></ul></li></ul></li></ul></li><li><span class="part"><a href="#command-line-tools">II. Утилиты командной строки</a></span><ul><li><span class="chapter"><a href="#isql">5. Утилита ISQL</a></span><ul><li><span class="section"><a href="#isql-invoking">Запуск isql</a></span></li><li><span class="section"><a href="#isql-switches">Переключатели командной строки</a></span><ul><li><span class="section"><a href="#isql-switches-examples">Примеры</a></span></li></ul></li><li><span class="section"><a href="#isql-start_session">Начало сессии Isql</a></span></li><li><span class="section"><a href="#isql-end_session">Завершение сессии Isql</a></span></li><li><span class="section"><a href="#isql-help">Получение справки</a></span></li><li><span class="section"><a href="#isql-connect">Соединение с базой данных</a></span><ul><li><span class="section"><a href="#isql-connect-aliasedb">Использование псевдонимов БД</a></span></li><li><span class="section"><a href="#isql-connect-remotely">Соединение с БД на удалённом сервере</a></span></li><li><span class="section"><a href="#isql-connect-user">Имя пользователя, пароль и роль</a></span></li><li><span class="section"><a href="#isql-connect-charset">Набор символов</a></span></li><li><span class="section"><a href="#isql-connect-examples">Примеры</a></span></li></ul></li><li><span class="section"><a href="#isql-create_db">Создание базы данных</a></span></li><li><span class="section"><a href="#isql-env">Установка переменных окружения ISC_USER и ISC_PASSWORD </a></span></li><li><span class="section"><a href="#isql-sql_dialect">SQL диалект</a></span></li><li><span class="section"><a href="#isql-terminator">Символ терминатора</a></span></li><li><span class="section"><a href="#isql-prompts">Подсказки ISQL</a></span></li><li><span class="section"><a href="#isql-errors">Обработка ошибок и поддержка исключений</a></span></li><li><span class="section"><a href="#isql-transactions">Обработка транзакций</a></span></li><li><span class="section"><a href="#isql-script_handling">Обработка скрипта</a></span></li><li><span class="section"><a href="#isql-commands">ISQL команды</a></span><ul><li><span class="section"><a href="#isql-commands-blobdump">BLOBDUMP</a></span></li><li><span class="section"><a href="#isql-commands-blobview">BLOBVIEW</a></span></li><li><span class="section"><a href="#isql-commands-edit">EDIT</a></span></li><li><span class="section"><a href="#isql-commands-help">HELP</a></span></li><li><span class="section"><a href="#isql-commands-add">ADD</a></span></li><li><span class="section"><a href="#isql-commands-copy">COPY</a></span></li><li><span class="section"><a href="#isql-commands-input">INPUT</a></span></li><li><span class="section"><a href="#isql-commands-output">OUTPUT</a></span></li><li><span class="section"><a href="#isql-commands-set">SET</a></span></li><li><span class="section"><a href="#isql-commands-shell">SHELL</a></span></li><li><span class="section"><a href="#isql-commands-exit">EXIT</a></span></li><li><span class="section"><a href="#isql-commands-quit">QUIT</a></span></li></ul></li><li><span class="section"><a href="#isql-commands_set">ISQL SET команды</a></span><ul><li><span class="section"><a href="#isql-commands_set-set">SET</a></span></li><li><span class="section"><a href="#isql-commands_set-set_autoddl">SET AUTODDL</a></span></li><li><span class="section"><a href="#isql-commands_set-set_bail">SET BAIL</a></span></li><li><span class="section"><a href="#isql-commands_set-set_blob">SET BLOB</a></span></li><li><span class="section"><a href="#isql-commands_set-set_bulk_insert">SET BULK_INSERT</a></span></li><li><span class="section"><a href="#isql-commands_set-set_count">SET COUNT</a></span></li><li><span class="section"><a href="#isql-commands_set-set_echo">SET ECHO</a></span></li><li><span class="section"><a href="#isql-commands_set-set_explain">SET EXPLAIN</a></span></li><li><span class="section"><a href="#isql-commands_set-set_heading">SET HEADING</a></span></li><li><span class="section"><a href="#isql-commands_set-set_keep_tran">SET KEEP_TRAN_PARAMS</a></span></li><li><span class="section"><a href="#isql-commands_set-set_list">SET LIST</a></span></li><li><span class="section"><a href="#isql-commands_set-set_names">SET NAMES</a></span></li><li><span class="section"><a href="#isql-commands_set-set_plan">SET PLAN</a></span></li><li><span class="section"><a href="#isql-commands_set-set_planonly">SET PLANONLY</a></span></li><li><span class="section"><a href="#isql-commands_set-set_sqlda">SET SQLDA_DISPLAY</a></span></li><li><span class="section"><a href="#isql-commands_set-set_sqldialect">SET SQL DIALECT</a></span></li><li><span class="section"><a href="#isql-commands_set-set_stats">SET STATs</a></span></li><li><span class="section"><a href="#isql-commands_set-set_time">SET TIME</a></span></li><li><span class="section"><a href="#isql-commands_set-set_term">SET TERM</a></span></li><li><span class="section"><a href="#isql-commands_set-set_warnings">SET WARNINGS</a></span></li><li><span class="section"><a href="#isql-commands_set-set_width">SET WIDTH</a></span></li></ul></li><li><span class="section"><a href="#isql-commands_show">ISQL SHOW команды</a></span><ul><li><span class="section"><a href="#isql-commands_show-show_check">SHOW CHECK</a></span></li><li><span class="section"><a href="#isql-commands_show-show_collations">SHOW COLLATION</a></span></li><li><span class="section"><a href="#isql-commands_show-show_comments">SHOW COMMENTS</a></span></li><li><span class="section"><a href="#isql-commands_show-show_db">SHOW DATABASE</a></span></li><li><span class="section"><a href="#isql-commands_show-show_dependencies">SHOW DEPENDENCIES</a></span></li><li><span class="section"><a href="#isql-commands_show-show_domain">SHOW DOMAIN</a></span></li><li><span class="section"><a href="#isql-commands_show-show_exeption">SHOW EXCEPTION</a></span></li><li><span class="section"><a href="#isql-commands_show-show_filter">SHOW FILTER</a></span></li><li><span class="section"><a href="#isql-commands_show-show_function">SHOW FUNCTION</a></span></li><li><span class="section"><a href="#isql-commands_show-show_generator">SHOW GENERATOR</a></span></li><li><span class="section"><a href="#isql-commands_show-show_grants">SHOW GRANTS</a></span></li><li><span class="section"><a href="#isql-commands_show-show_indexes">SHOW INDEXES</a></span></li><li><span class="section"><a href="#isql-commands_show-show_mapping">SHOW MAPPING</a></span></li><li><span class="section"><a href="#isql-commands_show-show_package">SHOW PACKAGE</a></span></li><li><span class="section"><a href="#isql-commands_show-show_procedure">SHOW PROCEDURE</a></span></li><li><span class="section"><a href="#isql-commands_show-show_role">SHOW ROLE</a></span></li><li><span class="section"><a href="#isql-commands_show-show_secclasses">SHOW SECCLASSES</a></span></li><li><span class="section"><a href="#isql-commands_show-show_sequence">SHOW SEQUENCE</a></span></li><li><span class="section"><a href="#isql-commands_show-show_sql_dialect">SHOW SQL DIALECT</a></span></li><li><span class="section"><a href="#isql-commands_show-show_system">SHOW SYSTEM</a></span></li><li><span class="section"><a href="#isql-commands_show-show_table">SHOW TABLE</a></span></li><li><span class="section"><a href="#isql-commands_show-show_trigger">SHOW TRIGGER</a></span></li><li><span class="section"><a href="#isql-commands_show-show_users">SHOW USERS</a></span></li><li><span class="section"><a href="#isql-commands_show-show_version">SHOW VERSION</a></span></li><li><span class="section"><a href="#isql-commands_show-show_view">SHOW VIEW</a></span></li></ul></li></ul></li><li><span class="chapter"><a href="#gbak">6. GBAK</a></span></li><li><span class="chapter"><a href="#nbackup">7. Утилита NBACKUP</a></span><ul><li><span class="section"><a href="#nbackup-common">Обзор возможностей Nbackup</a></span></li><li><span class="section"><a href="#nbackup-advantage">Преимущества nbackup</a></span><ul><li><span class="section"><a href="#nbackup-limitations">Недостатки nbackup</a></span></li></ul></li><li><span class="section"><a href="#nbackup-params">Функции и параметры</a></span></li><li><span class="section"><a href="#nbackup-backup_and_restore">Создание резервных копий и восстановление</a></span><ul><li><span class="section"><a href="#nbackup-full-backup">Полные резервные копии</a></span></li><li><span class="section"><a href="#nbackup-full-restore">Восстановление полных резервных копий</a></span></li><li><span class="section"><a href="#nbackup-increment-backup">Инкрементные резервные копии</a></span></li><li><span class="section"><a href="#nbackup-increment-restore">Восстановление инкрементных бэкапов</a></span></li><li><span class="section"><a href="#nbackup-backup-raw_devices">Бэкапы баз данных на сырых устройствах (raw devices)</a></span></li><li><span class="section"><a href="#nbackup-nodbtriggers">Отключение триггеров базы данных</a></span></li><li><span class="section"><a href="#nbackup-direct_io">Кэширование ввода-вывода (Direct I/O)</a></span></li><li><span class="section"><a href="#nbackup-decompress">Распаковка сжатых копий</a></span></li><li><span class="section"><a href="#d0e10754">Информационные параметры</a></span></li><li><span class="section"><a href="#nbackup-wire">Бэкапы по сети</a></span></li><li><span class="section"><a href="#nbackup-practical">Практическое применение</a></span></li><li><span class="section"><a href="#d0e10980">Что дальше?</a></span></li></ul></li><li><span class="section"><a href="#nbackup-lock_and_unlock">Блокирование и разблокирование</a></span><ul><li><span class="section"><a href="#nbackup-lock">Блокирование базы данных и самостоятельное копирование</a></span></li><li><span class="section"><a href="#nbackup-unlock">Восстановление бэкапа после "nbackup -L"</a></span></li><li><span class="section"><a href="#nbackup-lock_unlock-how_it_works">Как это работает</a></span></li><li><span class="section"><a href="#nbackup-lock_db-raw_devices">Блокирование баз на сырых устройствах</a></span></li></ul></li><li><span class="section"><a href="#nbackup-tune_delta">Настройка дельта-файла</a></span></li><li><span class="section"><a href="#nbackup-history">Лог истории бэкапов</a></span></li><li><span class="section"><a href="#nbackup-technical_info">Техническая информация</a></span><ul><li><span class="section"><a href="#nbackup-swept">Swept флаг</a></span></li></ul></li></ul></li><li><span class="chapter"><a href="#gfix">8. Утилита GFIX</a></span><ul><li><span class="section"><a href="#gfix-shadow">Теневые копии</a></span><ul><li><span class="section"><a href="#d0e11941">Активация теневой копии</a></span></li><li><span class="section"><a href="#d0e11970">Удаление теневых копий</a></span></li></ul></li><li><span class="section"><a href="#gfix-buffers">Установка размера кэша базы данных</a></span></li><li><span class="section"><a href="#gfix-limbo">Управление limbo транзакциями</a></span><ul><li><span class="section"><a href="#gfix-limbo-list">Список limbo транзакций</a></span></li><li><span class="section"><a href="#d0e12163">Подтверждение или откат</a></span></li><li><span class="section"><a href="#d0e12207">Автоматическое двухфазное восстановление</a></span></li></ul></li><li><span class="section"><a href="#gfix-read_write_mode">Установка режима доступа для базы данных</a></span></li><li><span class="section"><a href="#gfix-dialect">Изменение SQL диалекта</a></span></li><li><span class="section"><a href="#gfix-sweep">Чистка (sweep) базы данных</a></span><ul><li><span class="section"><a href="#d0e12333">Сборка мусора и sweep</a></span><ul><li><span class="section"><a href="#d0e12389">Swept flag</a></span></li></ul></li><li><span class="section"><a href="#d0e12397">Изменение sweep interval</a></span></li><li><span class="section"><a href="#d0e12423">Отмена автоматического sweep</a></span></li><li><span class="section"><a href="#d0e12430">Выполнение ручного sweep</a></span></li><li><span class="section"><a href="#d0e12446">Отслеживание запусков sweep</a></span></li></ul></li><li><span class="section"><a href="#gfix-shutdown_online">Открытие (online) и закрытие (shutdown) базы данных</a></span><ul><li><span class="section"><a href="#gfix-shutdown">Закрытие (shutdown) базы данных</a></span><ul><li><span class="section"><a href="#d0e12568">Предотвращение новых соединений</a></span></li><li><span class="section"><a href="#d0e12583">Предотвращение новых транзакций</a></span></li><li><span class="section"><a href="#d0e12596">Принудительное закрытие базы данных</a></span></li></ul></li><li><span class="section"><a href="#gfix-online">Открытие (online) базы данных</a></span></li></ul></li><li><span class="section"><a href="#gfix-use_space">Использование пространства страниц базы данных</a></span></li><li><span class="section"><a href="#gfix-validate_recovery">Проверка и исправление базы данных</a></span><ul><li><span class="section"><a href="#gfix-validate">Проверка базы данных</a></span><ul><li><span class="section"><a href="#d0e12730">Проверка в режиме по умолчанию</a></span></li><li><span class="section"><a href="#d0e12763">Полная проверка</a></span></li><li><span class="section"><a href="#d0e12776">Проверка в режиме чтения</a></span></li><li><span class="section"><a href="#d0e12800">Игнорирование ошибок контрольных сумм</a></span></li><li><span class="section"><a href="#gfix-validate-online">Онлайн проверка</a></span><ul><li><span class="section"><a href="#d0e12834">Что может онлайн проверка</a></span></li><li><span class="section"><a href="#d0e12849">Защита во время онлайн проверки</a></span></li><li><span class="section"><a href="#d0e12876">Действие isc_action_svc_validate в API служб</a></span></li><li><span class="section"><a href="#d0e12889">Использование онлайн проверки в интерактивном режиме</a></span></li></ul></li></ul></li><li><span class="section"><a href="#d0e13098">Восстановление базы данных</a></span><ul><li><span class="section"><a href="#d0e13103">Удаление поврежденных структур данных</a></span></li><li><span class="section"><a href="#d0e13128">Сторонние инструменты и сервисы для расширенного восстановления</a></span></li></ul></li></ul></li><li><span class="section"><a href="#d0e13139">Изменение режима записи на диск</a></span></li><li><span class="section"><a href="#d0e13182">Исправление базы данных для работы с текущей версией ICU</a></span></li><li><span class="section"><a href="#d0e13200">Информация о версии</a></span></li></ul></li><li><span class="chapter"><a href="#gstat">9. Утилита GSTAT</a></span><ul><li><span class="section"><a href="#d0e13510">gstat примеры и интерпретация</a></span><ul><li><span class="section"><a href="#d0e13515">Статистика заголовочной страницы</a></span></li><li><span class="section"><a href="#d0e13754">Анализ всей базы данных</a></span></li><li><span class="section"><a href="#d0e13763">Анализ только страниц с данным</a></span></li><li><span class="section"><a href="#d0e13900">Анализ только индексов</a></span></li><li><span class="section"><a href="#d0e14068">Выбор таблиц для анализа</a></span></li><li><span class="section"><a href="#d0e14082">Включение в статистику системных таблиц и индексов</a></span></li><li><span class="section"><a href="#d0e14098">Статистика размеров записей и версий</a></span></li></ul></li></ul></li><li><span class="chapter"><a href="#d0e14246">10. FB_LOCK_PRINT</a></span></li><li><span class="chapter"><a href="#d0e14250">11. FBTRACEMGR</a></span></li><li><span class="chapter"><a href="#gsec">12. Утилита GSEC</a></span><ul><li><span class="section"><a href="#d0e14290">Опции командной строки</a></span></li><li><span class="section"><a href="#d0e14382">Команды GSEC</a></span></li><li><span class="section"><a href="#d0e14519">Интерактивный режим</a></span><ul><li><span class="section"><a href="#d0e14551">Отображение информации о пользователе</a></span></li><li><span class="section"><a href="#d0e14581">Добавление новых пользователей</a></span></li><li><span class="section"><a href="#d0e14601">Удаление существующих пользователей</a></span></li><li><span class="section"><a href="#d0e14621">Редактирование существующих пользователей</a></span></li><li><span class="section"><a href="#d0e14648">Отображение администраторов ОС</a></span></li><li><span class="section"><a href="#d0e14681">Справка</a></span></li><li><span class="section"><a href="#d0e14689">Информация о версии</a></span></li></ul></li><li><span class="section"><a href="#d0e14699">Пакетный режим</a></span><ul><li><span class="section"><a href="#d0e14736">Отображение информации о пользователе</a></span></li><li><span class="section"><a href="#d0e14755">Добавление новых пользователей</a></span></li><li><span class="section"><a href="#d0e14775">Удаление существующего пользователя</a></span></li><li><span class="section"><a href="#d0e14788">Изменение существующего пользователя</a></span></li><li><span class="section"><a href="#d0e14799">Информация о версии</a></span></li><li><span class="section"><a href="#d0e14838">Отображение администраторов ОС</a></span></li></ul></li><li><span class="section"><a href="#d0e14855">Удаленный запуск gsec</a></span></li><li><span class="section"><a href="#d0e14870">Особенности работы с GSEC</a></span><ul><li><span class="section"><a href="#d0e14881">Обычные и привилегированные пользователи</a></span></li><li><span class="section"><a href="#d0e14896">Отличия интерактивного и пакетного режимов</a></span></li><li><span class="section"><a href="#d0e14926">Коды завершения в пакетном режиме</a></span></li><li><span class="section"><a href="#d0e14942">Ошибки в пакетном режиме переводят GSEC в интерактивный режим</a></span></li></ul></li></ul></li><li><span class="chapter"><a href="#fbsvcmgr">13. Утилита FBSVCMGR</a></span><ul><li><span class="section"><a href="#d0e14964">Использование fbsvcmgr</a></span><ul><li><span class="section"><a href="#d0e14980">Параметры</a></span></li><li><span class="section"><a href="#d0e15010">Синтаксис SPB</a></span><ul><li><span class="section"><a href="#d0e15056">Особенности синтаксиса fbsvcmgr</a></span></li></ul></li></ul></li><li><span class="section"><a href="#d0e15082">Получение справки</a></span></li><li><span class="section"><a href="#d0e15101">Параметры подключения к службе</a></span><ul><li><span class="section"><a href="#d0e15185">Использование служб с базой данных безопасности не по умолчанию</a></span></li></ul></li><li><span class="section"><a href="#d0e15224">Информационные запросы</a></span></li><li><span class="section"><a href="#d0e15357">Сервисные действия</a></span><ul><li><span class="section"><a href="#d0e15360">Резервная копия (gbak)</a></span></li><li><span class="section"><a href="#d0e15364">Восстановление (gbak)</a></span></li><li><span class="section"><a href="#d0e15368">Установка свойств базы данных action_properties (gfix)</a></span></li><li><span class="section"><a href="#d0e15372">Валидация, ремонт базы данных, sweep (gfix)</a></span></li><li><span class="section"><a href="#d0e15376">Статистика базы данных (gstat)</a></span></li><li><span class="section"><a href="#d0e15380">Управление пользователями (gsec)</a></span></li><li><span class="section"><a href="#d0e15384">Резервная копия (nbackup)</a></span></li><li><span class="section"><a href="#d0e15388">Восстановление (nbackup)</a></span></li><li><span class="section"><a href="#d0e15392">Управление трассировкой</a></span></li><li><span class="section"><a href="#d0e15396">Настройка отображения администраторов на RDB$ADMIN</a></span></li><li><span class="section"><a href="#d0e15400">Онлайн валидация базы данных</a></span></li></ul></li></ul></li></ul></li><li><span class="part"><a href="#tasks">III. Практические задачи</a></span><ul><li><span class="chapter"><a href="#d0e15407">14. Типичные проблемы с установкой</a></span><ul><li><span class="section"><a href="#d0e15411">На Windows</a></span></li><li><span class="section"><a href="#d0e15415">На Linux</a></span></li></ul></li><li><span class="chapter"><a href="#d0e15419">15. Разрешение проблем с сетевыми настройками между клиентом и сервером
                Firebird</a></span></li><li><span class="chapter"><a href="#hardware">16. Конфигурирование и подбор аппаратного обеспечения</a></span><ul><li><span class="section"><a href="#hardware-theory">Немного теории</a></span><ul><li><span class="section"><a href="#hardware-theory-modules">Функциональные модули сервера</a></span></li><li><span class="section"><a href="#hardware-theory-hardware_operations">Базовые операции с hardware</a></span></li><li><span class="section"><a href="#d0e15595">Параллельность выполнения операций</a></span></li><li><span class="section"><a href="#d0e15611">Потоки данных</a></span></li><li><span class="section"><a href="#d0e15628">Резервное копирование</a></span></li></ul></li><li><span class="section"><a href="#d0e15641">Выбор подходящего железа</a></span><ul><li><span class="section"><a href="#d0e15651">CPU</a></span><ul><li><span class="section"><a href="#d0e15666">Какие запросы преобладают в приложении?</a></span></li><li><span class="section"><a href="#d0e15675">Количество активных соединений с БД в среднем и в моменты пиковой
                    нагрузки</a></span></li><li><span class="section"><a href="#d0e15696">Версия и архитектура Firebird</a></span></li></ul></li><li><span class="section"><a href="#d0e15703">RAM</a></span><ul><li><span class="section"><a href="#d0e15715">ECC RAM</a></span></li><li><span class="section"><a href="#d0e15720">Расчет необходимого объема RAM</a></span><ul><li><span class="section"><a href="#d0e15790">Формулы расчета необходимого объема RAM</a></span></li><li><span class="section"><a href="#d0e15874">Излишняя память</a></span></li></ul></li></ul></li><li><span class="section"><a href="#d0e15933">Дисковая подсистема</a></span><ul><li><span class="section"><a href="#d0e15938">Отдельные диски для всего</a></span></li><li><span class="section"><a href="#d0e15947">SSD для базы данных</a></span></li><li><span class="section"><a href="#d0e15961">Диск для временных файлов</a></span></li><li><span class="section"><a href="#d0e15996">HDD for backups</a></span></li><li><span class="section"><a href="#d0e16044">HDD для базы данных</a></span></li><li><span class="section"><a href="#d0e16053">Надежность и RAID</a></span></li><li><span class="section"><a href="#d0e16071">Настройка RAID</a></span></li><li><span class="section"><a href="#d0e16101">СХД</a></span></li></ul></li></ul></li><li><span class="section"><a href="#d0e16140">Краткие выводы и рекомендации</a></span></li></ul></li><li><span class="chapter"><a href="#d0e16193">17. Использование инструментов резервного копирования</a></span><ul><li><span class="section"><a href="#d0e16197">gbak</a></span></li><li><span class="section"><a href="#d0e16201">nbackup</a></span></li></ul></li><li><span class="chapter"><a href="#d0e16205">18. Использование инструмента валидации и починки БД gfix</a></span></li><li><span class="chapter"><a href="#d0e16209">19. Безопасность</a></span><ul><li><span class="section"><a href="#d0e16213">Плагины аутентификации и их использование</a></span></li><li><span class="section"><a href="#d0e16217">Плагины шифрования и их использование</a></span></li></ul></li><li><span class="chapter"><a href="#mon-tools">20. Использование инструментов мониторинга Firebird</a></span><ul><li><span class="section"><a href="#d0e16226">Использование fb_lock_print</a></span><ul><li><span class="section"><a href="#d0e16275">Структура заголовка лок-таблицы</a></span></li><li><span class="section"><a href="#d0e16514">Детализация лок-таблицы</a></span><ul><li><span class="section"><a href="#d0e16517">Представление ресурсов как блокировок различных видов</a></span></li><li><span class="section"><a href="#d0e16779">Особенности при работе в архитектуре SuperServer. Латчи (latches)</a></span></li><li><span class="section"><a href="#d0e16797">Данные о владельцах блокировок (OWNER BLOCK)</a></span></li><li><span class="section"><a href="#d0e16882">Данные о блокировках (LOCK BLOCK)</a></span></li><li><span class="section"><a href="#d0e16916">Быстрая диагностика наличия очередей к ресурсам</a></span></li><li><span class="section"><a href="#d0e16947">Углубленная диагностика очередей к ресурсам</a></span></li><li><span class="section"><a href="#d0e17015">Кодировка 8-байтных значений идентификаторов ресурсов</a></span></li><li><span class="section"><a href="#d0e17055">Поиск объекта БД, к которому принадлежит страница с заданным номером</a></span></li><li><span class="section"><a href="#d0e17144">Дополнительные замечания по ожиданиям страничных блокировок</a></span></li><li><span class="section"><a href="#d0e17166">Поиск ID процессов, удерживающих ресурсы</a></span></li><li><span class="section"><a href="#d0e17211">Поиск ID подключения к БД, удерживающего ресурсы</a></span></li><li><span class="section"><a href="#d0e17258">Поиск транзакции, удерживающей ресурсы</a></span></li></ul></li><li><span class="section"><a href="#d0e17326">Журналирование изменений счетчиков</a></span><ul><li><span class="section"><a href="#d0e17329">Описание интерактивного режима</a></span></li><li><span class="section"><a href="#d0e17406">Примеры запуска и вывода</a></span></li></ul></li></ul></li><li><span class="section"><a href="#using-trace">Использование Firebird Trace API</a></span><ul><li><span class="section"><a href="#d0e17555">Трассировка. Вводная информация. Зачем это нужно?</a></span></li><li><span class="section"><a href="#d0e17580">Виды отслеживаемой активности. Пользовательский трассировка и системный
                аудит</a></span></li><li><span class="section"><a href="#d0e17639">Блочное представление информации</a></span></li><li><span class="section"><a href="#d0e17666">Краткое описание работы. Типичный сценарий работы DBA</a></span></li><li><span class="section"><a href="#d0e17752">Пользовательская трассировка и аудит: настройка, запуск и остановка</a></span></li><li><span class="section"><a href="#d0e17820">Структура конфигурации. Проверка имен на соответствие шаблонам</a></span></li><li><span class="section"><a href="#d0e17896">Виды отслеживаемых событий</a></span><ul><li><span class="section"><a href="#d0e17916">Основные параметры для событий, относящихся к работе c базой данных</a></span></li><li><span class="section"><a href="#d0e18044">Дополнительные параметры для событий, относящихся к работе с базой
                    данных</a></span></li><li><span class="section"><a href="#d0e18239">Дополнительные параметры для системного аудита</a></span></li><li><span class="section"><a href="#d0e18292">События, относящиеся к сервисам Firebird</a></span></li><li><span class="section"><a href="#d0e18383">Контроль состояния пользовательской трассировки</a></span></li></ul></li><li><span class="section"><a href="#d0e18452">Примеры полезных конфигураций</a></span><ul><li><span class="section"><a href="#d0e18492">Отслеживание вызова сервисов</a></span></li></ul></li><li><span class="section"><a href="#d0e18510">Структура заголовка выводимого блока информации</a></span></li><li><span class="section"><a href="#d0e18533">Кодировка non-ascii информации</a></span></li></ul></li><li><span class="section"><a href="#d0e18547">Использование таблиц мониторинга MON$</a></span><ul><li><span class="section"><a href="#d0e18583">Отключение пользователей от базы данных</a></span></li><li><span class="section"><a href="#d0e18668">Отключение от БД подключений, которые могут привести к застреванию счетчика
                OAT</a></span></li><li><span class="section"><a href="#d0e18736">Построение стека вызовов</a></span><ul><li><span class="section"><a href="#d0e18765">Замечания о стеке вызовов</a></span></li></ul></li><li><span class="section"><a href="#d0e18812">Статистика по таблицам (mon$record_stats)</a></span></li><li><span class="section"><a href="#d0e18849">Поиск подключений, выполненных старыми версиями клиента</a></span></li><li><span class="section"><a href="#d0e18866">О причинах расхождений в статистике мониторинга и трассировки</a></span></li><li><span class="section"><a href="#d0e18900">Мониторинг и выполнение запросов</a></span><ul><li><span class="section"><a href="#d0e18903">Фаза подготовки запросов</a></span></li><li><span class="section"><a href="#d0e18910">Запросы с состоянием stalled</a></span></li></ul></li><li><span class="section"><a href="#d0e18974">Мониторинг расхода памяти</a></span></li><li><span class="section"><a href="#d0e19008">Мониторинг и nbackup</a></span><ul><li><span class="section"><a href="#d0e19011">Снятие файловой копии базы</a></span></li><li><span class="section"><a href="#d0e19041">Заливка .delta-файла обратно в базу</a></span></li></ul></li></ul></li></ul></li></ul></li><li><span class="index"><a href="#d0e19068">Алфавитный указатель</a></span></li></ul></div><section xml:lang="ru" class="preface" id="intro"><div class="titlepage"><div><div><h1 class="title">Введение</h1></div></div></div><p/></section><div class="part" id="install-and-settings"><div class="titlepage"><div><div><h1 class="title">Часть I. Установка и настройка</h1></div></div></div><section xml:lang="ru" class="chapter" id="install"><div class="titlepage"><div><div><h2 class="title">Глава 1. Установка, обновление и запуск сервера</h2></div></div></div><p>Скачать дистрибутивы Firebird можно на официальном сайте <a class="link" href="https://firebirdsql.org" target="_top">https://firebirdsql.org</a> в разделе Downloads.</p><section class="section" id="install-linux"><div class="titlepage"><div><div><h2 class="title" style="clear: both">Установка на ОС Linux</h2></div></div></div><p>Firebird под Linux распространяется в двух вариантах через репозитории и в виде
            tar-архивов. За репозиториями следят либо разработчики дистрибутивов Linux, либо частные
            лица (PPA). Tar-архивы распространяет организация Firebird Foundation. Для официальных
            релизов Firebird 3.0 они выложены на странице <a class="link" href="https://firebirdsql.org/en/firebird-3-0/" target="_top">https://firebirdsql.org/en/firebird-3-0/</a>. Кроме того tar-архивы
            автоматически собираются для снапшотов, которые вы можете найти по адресу <a class="link" href="http://web.firebirdsql.org/download/snapshot_builds/linux/fb3.0/" target="_top">http://web.firebirdsql.org/download/snapshot_builds/linux/fb3.0/</a>.</p><section class="section" id="install-linux-repo"><div class="titlepage"><div><div><h3 class="title">Установка из репозитория</h3></div></div></div><p>Репозитории — это сервера в интернете, на которых хранятся файлы пакетов
                приложений Linux и другая сопутствующая информация.</p><p>Практически у каждого дистрибутива Linux есть свой репозиторий, который содержит
                только совместимые и поддерживаемые конкретным дистрибутивом пакеты, соответственно,
                при установке приложений из официальных репозиториев Вы всегда устанавливаете только
                проверенные и стабильные версии программ.</p><p>Репозитории бывают как основные, т.е. официально поддерживаемые, так и
                дополнительные, которые можно подключить в случае возникновения необходимости.
                Firebird редко включён в основной репозиторий, но часто присутствует в
                дополнительных репозиториях или в PPA (Personal Package Archive).</p><div class="note"><h3 class="title">Примечание</h3><p>За актуальностью пакетов в репозиториях следят либо разработчики дистрибутивов
                    (Linux), либо владельцы репозиториев, а не сообщество Firebird. По этой причине
                    в репозиториях может быть не самая последняя версия Firebird. Если вас надо
                    гарантировано установить именно последнюю версию Firebird, либо вовсе произвести
                    обновление из снапшотов, то рекомендуем вам производить установку Firebird из
                        <a class="link" href="#install-linux-tar" title="Ручная установка из tar архива">tar-архива</a>. </p></div><section class="section" id="install-linux-repo-ubuntu"><div class="titlepage"><div><div><h4 class="title">Установка Firebird в Ubuntu</h4></div></div></div><p>В качестве примера рассмотрим установку Firebird 3.0 в Ubuntu 18.04
                    TLS.</p><p>Стабильный пакет (версия 3.0.x) для Ubuntu TLS расположен в репозитории <a class="link" href="https://launchpad.net/%7Emapopa/+archive/firebird3.0" target="_top">ppa</a>.</p><p>Данный репозиторий может быть добавлен следующим способом:</p><pre class="synopsis">
sudo add-apt-repository ppa:mapopa/firebird3.0
sudo apt-get update                    
                </pre><p>Вы можете посмотреть пакеты связанный с Firebird 3.0 следующим образом:</p><pre class="synopsis">
apt-cache search firebird3.0                  
                </pre><p>Вы уведите следующий список пакетов:</p><pre class="screen">
firebird-dev - Development files for Firebird
firebird3.0-common - common files for firebird 3.0 server, client and utilities
firebird3.0-common-doc - copyright, licensing and changelogs of firebird3.0
firebird3.0-doc - Documentation files for firebird database version 3.0
firebird3.0-examples - Examples for Firebird database
firebird3.0-server-core - Firebird engine core
flamerobin - graphical database administration tool for Firebird DBMS
libib-util - Firebird UDF support library
firebird3.0-server - Firebird Server - an RDBMS based on InterBase 6.0 code
firebird3.0-utils - Firebird command line utilities
libfbclient2 - Firebird client library                    
                </pre><p>Для установки Firebird 3.0 в архитектуре SuperServer наберите следующую
                    команду:</p><pre class="synopsis">
sudo apt-get install firebird3.0-server                    
                </pre><pre class="screen">
The following extra packages will be installed:
  firebird3.0-common firebird3.0-common-doc firebird3.0-utils libfbclient2 libib-util
Suggested packages:
  firebird3.0-doc
The following NEW packages will be installed:
  firebird3.0-common firebird3.0-common-doc firebird3.0-server firebird3.0-utils libfbclient2 libib-util
0 upgraded, 6 newly installed, 0 to remove and 0 not upgraded.
Need to get 4,889kB of archives.
After this operation, 13.1MB of additional disk space will be used.
Do you want to continue [Y/n]?                    
                </pre><p>В процессе установки у вас спросят о пароля для пользователя SYSDBA.</p><div class="figure" id="d0e124"><div class="figure-contents"><div class="mediaobject"><table style="border: 0; width: 450px; cellpadding: 0; cellspacing: 0;"><tr><td><img src="images/sysdba-password-ubuntu.png" width="450" alt="Задание пароля SYSDBA"/></td></tr></table></div></div><div class="figure-title">Рисунок 1.1. Задание пароля SYSDBA</div></div><br class="figure-break"/><p>Если вам необходимо изменить конфигурацию после установки воспользуйтесь
                    командой:</p><pre class="synopsis">
sudo dpkg-reconfigure firebird3.0-server                    
                </pre><p>Для установки примеров и файлов для разработки наберите команду:</p><pre class="synopsis">
sudo apt-get install firebird3.0-examples firebird-dev                    
                </pre><p>База данных <code class="filename">employee.fdb</code> архивирована и находится в
                    директории
                        <code class="filename">/usr/share/doc/firebird3.0-examples/examples/empbuild/</code>
                </p><pre class="synopsis">
cd /usr/share/doc/firebird3.0-examples/examples/empbuild/
sudo gunzip employee.fdb.gz
sudo chown firebird.firebird employee.fdb
sudo mv employee.fdb /var/lib/firebird/3.0/data/                
                </pre><div class="note"><h3 class="title">Примечание</h3><p>Это описание заимствовано со следующего ресурса <a class="link" href="https://help.ubuntu.com/community/Firebird3.0" target="_top">https://help.ubuntu.com/community/Firebird3.0</a>. Когда я
                        пробовал проделать тоже самое, то по какой-то причине у меня не оказалось
                        каталога
                            <code class="filename">/usr/share/doc/firebird3.0-examples/examples/empbuild/</code>
                    </p><p>К счастью в папке
                            <code class="filename">/usr/share/doc/firebird3.0-examples/examples/</code> лежал
                        запакованный sql скрипт для создания базы данных employee.</p><pre class="synopsis">
cd /usr/share/doc/firebird3.0-examples/examples/
sudo gunzip employee.sql.gz               
                    </pre><p>Полученный файл <code class="filename">employee.sql</code> требуется немного
                        поправить чтобы база данных создавалась в нужном месте.</p><pre class="programlisting">

-- This is a generated file
set sql dialect 3;
create database '/var/lib/firebird/3.0/data/employee.fdb';
...
                        
                    </pre><p>После чего можно запустить скрипт на выполнение:</p><pre class="synopsis">
isql-fb -i employee.sql                        
                    </pre></div><p>Теперь можно попробовать подключится к нашей тестовой базы данных.</p><pre class="programlisting">
$ isql-fb
SQL&gt; connect localhost:/var/lib/firebird/3.0/data/employee.fdb user 'SYSDBA' password password 'Xtwe9k';                    
                </pre><p>Если все в порядке, то вы получите сообщение о том, к какой базе данных
                    подключен, какой пользователь и о готовности к использованию.</p><pre class="screen">
Database: localhost:/var/lib/firebird/3.0/data/employee.fdb, User: SYSDBA
SQL&gt; 
                </pre><p>Теперь проверим версию серверы и таблицы.</p><pre class="screen">
SQL&gt; show tables;
       COUNTRY                                CUSTOMER
       DEPARTMENT                             EMPLOYEE
       EMPLOYEE_PROJECT                       JOB
       PROJECT                                PROJ_DEPT_BUDGET
       SALARY_HISTORY                         SALES

SQL&gt; show version;
ISQL Version: LI-V3.0.5.33100 Firebird 3.0
Server version:
Firebird/Linux/AMD/Intel/x64 (access method), version "LI-V3.0.5.33100 Firebird 3.0"
Firebird/Linux/AMD/Intel/x64 (remote server), version "LI-V3.0.5.33100 Firebird 3.0/tcp (fbserver)/P15:C"
Firebird/Linux/AMD/Intel/x64 (remote interface), version "LI-V3.0.5.33100 Firebird 3.0/tcp (fbserver)/P15:C"
on disk structure version 12.0
                </pre><p>Если ваш сервер установлен с графическим окружением, то вы также можете
                    установить GUI инструмент администрирования
                        <span class="application">flamerobin</span> простой командой. </p><pre class="synopsis">
sudo apt-get install flamerobin                    
                </pre><section class="section" id="install-linux-repo-ubuntu-client"><div class="titlepage"><div><div><h5 class="title">Установка только клиента Firebird</h5></div></div></div><p>Если необходимо установить только клиента Firebird без сервера, то
                        процедура немного сокращается.</p><p>Первым делом добавьте репозиторий ppa:mapopa/firebird3.0
                        </p><pre class="synopsis">
sudo add-apt-repository ppa:mapopa/firebird3.0
sudo apt-get update                    
                </pre><p>
                    </p><p>Теперь устанавливаем сам клиент:
                        </p><pre class="synopsis">
sudo apt-get install libfbclient2                   
                </pre><p>
                    </p></section></section><section class="section" id="install-linux-repo-centos"><div class="titlepage"><div><div><h4 class="title">Установка Firebird в CentOS</h4></div></div></div><p>В качестве примера рассмотрим установку Firebird 3.0 в CentOS 8.0.</p><p>Для установки Firebird 3.0 необходимо подключить репозиторий epel. Это
                    делается следующей командой:</p><pre class="synopsis">
sudo dnf install https://dl.fedoraproject.org/pub/epel/epel-release-latest-8.noarch.rpm                   
                </pre><p>Для просмотра информации о версии Firebird доступным для установки введите
                    команду:</p><pre class="synopsis">
sudo yum info firebird                  
                </pre><pre class="screen">
Последняя проверка окончания срока действия метаданных: 0:01:19 назад, Ср 08 янв 2020 11:46:11.
Имеющиеся пакеты
Имя          : firebird
Версия       : 3.0.4.33054
Выпуск       : 1.el8
Архитектура  : x86_64
Размер       : 3.6 M
Источник     : firebird-3.0.4.33054-1.el8.src.rpm
Репозиторий  : epel
Краткое опис : SQL relational database management system
URL          : http://www.firebirdsql.org/
Лицензия     : Interbase
Описание     : Firebird is a relational database offering many ANSI SQL standard
             : features that runs on Linux, Windows, and a variety of Unix
             : platforms. Firebird offers excellent concurrency, high
             : performance, and powerful language support for stored procedures
             : and triggers. It has been used in production systems, under a
             : variety of names, since 1981.                    
                </pre><p>Как видим в репозитории доступна довольно свежая версия. Можно приступать к
                    установке.</p><pre class="synopsis">
sudo yum install firebird                 
                </pre><pre class="screen">
Последняя проверка окончания срока действия метаданных: 0:00:43 назад, Ср 08 янв 2020 11:51:23.
Зависимости разрешены.
================================================================================
 Пакет                 Архитектура   Версия                   Репозиторий Размер
================================================================================
Installing:
 firebird              x86_64        3.0.4.33054-1.el8        epel        3.6 M
Установка зависимостей:
 firebird-utils        x86_64        3.0.4.33054-1.el8        epel        1.1 M
 libfbclient2          x86_64        3.0.4.33054-1.el8        epel        592 k
 libib-util            x86_64        3.0.4.33054-1.el8        epel         18 k
 libtommath            x86_64        1.1.0-1.el8              epel         47 k

Результат транзакции
================================================================================
Установка  5 Пакетов

Объем загрузки: 5.4 M
Объем изменений: 23 M
Продолжить? [д/Н]: y
Загрузка пакетов:
(1/5): libfbclient2-3.0.4.33054-1.el8.x86_64.rp 372 kB/s | 592 kB     00:01    
(2/5): libib-util-3.0.4.33054-1.el8.x86_64.rpm  107 kB/s |  18 kB     00:00    
(3/5): firebird-utils-3.0.4.33054-1.el8.x86_64. 617 kB/s | 1.1 MB     00:01    
(4/5): libtommath-1.1.0-1.el8.x86_64.rpm        451 kB/s |  47 kB     00:00    
(5/5): firebird-3.0.4.33054-1.el8.x86_64.rpm    1.5 MB/s | 3.6 MB     00:02    
--------------------------------------------------------------------------------
Общий размер                                    1.3 MB/s | 5.4 MB     00:04                     
                </pre><p>Теперь необходимо задать пароль для пользователя SYSDBA. Я предпочитаю делать
                    это через <span class="application">isql</span>.</p><pre class="synopsis">
cd /usr/bin
sudo ./isql-fb                
                </pre><pre class="screen">
Use CONNECT or CREATE DATABASE to specify a database
SQL&gt; connect security.db user sysdba;
Database: security.db, User: SYSDBA
SQL&gt; create user sysdba password 'xRt3sd6T';
SQL&gt; exit;                    
                </pre><div class="note"><h3 class="title">Примечание</h3><p>Обратите внимание, что утилита <span class="application">isql</span>
                        переименована в <span class="application">isql-fb</span>. Это сделано потому, что
                        в Linux уже есть утилита <span class="application">isql</span> в рамках проекта
                        unixODBC.</p></div><p>Осталось включить и запустить сервис firebird-superserver.</p><pre class="synopsis">
sudo systemctl enable firebird-superserver
</pre><pre class="screen">
Created symlink /etc/systemd/system/multi-user.target.wants/firebird-superserver.
service  → /usr/lib/systemd/system/firebird-superserver.service.
</pre><pre class="synopsis">
sudo systemctl start firebird-superserver               
                </pre><section class="section" id="install-linux-repo-centos-client"><div class="titlepage"><div><div><h5 class="title">Установка только клиента Firebird</h5></div></div></div><p>Если необходимо установить только клиента Firebird без сервера, то
                        процедура немного сокращается.</p><p>Первым делом добавьте репозиторий EPEL
                        </p><pre class="synopsis">
sudo dnf install https://dl.fedoraproject.org/pub/epel/epel-release-latest-8.noarch.rpm 
sudo dnf update
                </pre><p>
                    </p><p>Теперь устанавливаем сам клиент:
                        </p><pre class="synopsis">
sudo dnf install libfbclient2                   
                </pre><p>
                    </p></section></section></section><section class="section" id="install-linux-tar"><div class="titlepage"><div><div><h3 class="title">Ручная установка из tar архива</h3></div></div></div><p>Tar-архивы распространяет организация Firebird Foundation. Для официальных релизов
                Firebird 3.0 они выложены на странице https://firebirdsql.org/en/firebird-3-0/.
                Кроме того tar-архивы автоматически собираются для снапшотов, которые вы можете
                найти по адресу
                http://web.firebirdsql.org/download/snapshot_builds/linux/fb3.0/.</p><p>Стоит отметить что процедура установки из tar-архивов одинаковая для всех
                дистрибутивов Linux. Нюансы возникают только при разрешении зависимостей от
                некоторых библиотек.</p><div class="note"><h3 class="title">Примечание</h3><p>При установке из tar-архива сервер будет установлен в директорию
                        <code class="filename">/opt/firebird</code></p><p>В отличие от установке из репозиториев утилита <span class="application">isql</span>
                    не переименована и расположена в <code class="filename">/opt/firebird/bin</code>.</p></div><section class="section" id="install-linux-tar-ubuntu"><div class="titlepage"><div><div><h4 class="title">Установка Firebird в Ubuntu</h4></div></div></div><p>В качестве примера рассмотрим установку Firebird 3.0 в Ubuntu 18.04.</p><p>Перед установкой Firebird необходимо установить следующие пакеты
                    </p><pre class="synopsis">
sudo apt-get install libtommath1                 
                </pre><p>
                </p><p>Для библиотеки libtommath необходимо также создать символическую ссылку:
                    </p><pre class="synopsis">
sudo ln -sf /usr/lib/x86_64-linux-gnu/libtommath.so 
/usr/lib/x86_64-linux-gnu/libtommath.so.0              
                </pre><p>
                </p><p>Скачиваем и распаковываем tar-архив текущей версии Firebird
                    </p><pre class="synopsis">
wget https://github.com/FirebirdSQL/firebird/releases/download/R3_0_5/Firebird-
3.0.5.33220-0.amd64.tar.gz
tar xvf Firebird-3.0.5.33220-0.amd64.tar.gz
cd Firebird-3.0.5.33220-0.amd64             
                </pre><p>
                </p><p>Теперь можно запускать скрипт установки
                    </p><pre class="synopsis">
sudo ./install.sh            
                </pre><p>
                </p><p>В процессе инсталляции у вас спросят пароль для пользователя SYSDBA.</p><p>Обычно после этого служба Firebird стразу же установлена и запущена, вы можете
                    проверить это командой: </p><pre class="synopsis">
systemctl status firebird-superserver
                    </pre><p>
                    </p><pre class="screen">
systemctl status firebird-superserver
● firebird-superserver.service - Firebird Database Server ( SuperServer )
   Loaded: loaded (/lib/systemd/system/firebird-superserver.service; enabled; ve
   Active: active (running) since Sun 2020-01-26 15:18:24 UTC; 8min ago
  Process: 6921 ExecStart=/opt/firebird/bin/fbguard -pidfile /var/run/firebird/f
 Main PID: 6923 (firebird)
    Tasks: 4 (limit: 4614)
   CGroup: /system.slice/firebird-superserver.service
           ├─6922 /opt/firebird/bin/fbguard -pidfile /var/run/firebird/firebird.
           └─6923 /opt/firebird/bin/firebird

янв 26 15:18:24 dbserver systemd[1]: Starting Firebird Database Server ( SuperSe
янв 26 15:18:24 dbserver systemd[1]: firebird-superserver.service: Can't open PI
янв 26 15:18:24 dbserver systemd[1]: firebird-superserver.service: Supervising p
янв 26 15:18:24 dbserver systemd[1]: Started Firebird Database Server ( SuperSer                        
                    </pre><p>
                </p><p>Если это не так выполните
                    </p><pre class="synopsis">
sudo systemctl enable firebird-superserver  
sudo systemctl start firebird-superserver   
                </pre><p>
                </p></section><section class="section" id="install-linux-tar-centos"><div class="titlepage"><div><div><h4 class="title">Установка Firebird в CentOS</h4></div></div></div><p>В качестве примера рассмотрим установку Firebird 3.0 в CentOS 8.0.</p><p>Для установки Firebird 3.0 необходимо подключить репозиторий epel. Это
                    делается следующей командой:</p><pre class="synopsis">
sudo dnf install https://dl.fedoraproject.org/pub/epel/epel-release-latest-8.
noarch.rpm                   
                </pre><p>Перед установкой Firebird необходимо установить следующие пакеты
                    </p><pre class="synopsis">
sudo dnf -y install libtommath
sudo dnf -y install libicu-devel
sudo dnf -y install libncurses*                  
                </pre><p>
                </p><p>Для библиотеки libtommath необходимо также создать символическую ссылку:
                    </p><pre class="synopsis">
sudo ln -sf /usr/lib64/libtommath.so.1 /usr/lib64/libtommath.so.0                
                </pre><p>
                </p><p>Скачиваем и распаковываем tar-архив текущей версии Firebird
                    </p><pre class="synopsis">
wget https://github.com/FirebirdSQL/firebird/releases/download/R3_0_5/Firebird-
3.0.5.33220-0.amd64.tar.gz
tar xvf Firebird-3.0.5.33220-0.amd64.tar.gz
cd Firebird-3.0.5.33220-0.amd64             
                </pre><p>
                </p><p>Теперь можно запускать скрипт установки
                    </p><pre class="synopsis">
sudo ./install.sh            
                </pre><p>
                </p><p>В процессе инсталляции у вас спросят пароль для пользователя SYSDBA.</p><p>Обычно после этого служба Firebird стразу же установлена и запущена, вы можете
                    проверить это командой: </p><pre class="synopsis">
systemctl status firebird-superserver
                    </pre><p>
                    </p><pre class="screen">
● firebird-superserver.service - Firebird Database Server ( SuperServer )
   Loaded: loaded (/usr/lib/systemd/system/firebird-superserver.service; enable&gt;
   Active: active (running) since Sun 2020-01-26 18:41:14 MSK; 2h 24min left
  Process: 1105 ExecStart=/opt/firebird/bin/fbguard -pidfile /var/run/firebird/&gt;
 Main PID: 1143 (firebird)
    Tasks: 5 (limit: 17728)
   Memory: 18.5M
   CGroup: /system.slice/firebird-superserver.service
           ├─1132 /opt/firebird/bin/fbguard -pidfile /var/run/firebird/firebird&gt;
           └─1143 /opt/firebird/bin/firebird

янв 26 18:41:13 localhost.localdomain systemd[1]: Starting Firebird Database Se&gt;
янв 26 18:41:13 localhost.localdomain systemd[1]: firebird-superserver.service:&gt;
янв 26 18:41:14 localhost.localdomain systemd[1]: firebird-superserver.service:&gt;
янв 26 18:41:14 localhost.localdomain systemd[1]: Started Firebird Database Ser&gt;
                    </pre><p>
                </p><p>Если это не так выполните
                    </p><pre class="synopsis">
sudo systemctl enable firebird-superserver  
sudo systemctl start firebird-superserver   
                </pre><p>
                </p></section><section class="section" id="d0e380"><div class="titlepage"><div><div><h4 class="title">Изменение режима работы Firebird</h4></div></div></div><p>При установки сервера из tar-архива Firebird по умолчанию устанавливается в
                    архитектуре SuperServer. Если вам необходимо изменить режим работы сервера, то
                    сделать это можно при помощи скрита
                        <code class="filename">/opt/firebird/bin/changeServerMode.sh</code>
                    </p><pre class="synopsis">
sudo /opt/firebird/bin/changeServerMode.sh                        
                    </pre><p>
                    </p><pre class="screen">
Firebird server may run in 2 different modes - super and classic.
Super server provides better performance, classic - better availability.

Which option would you like to choose: (super|classic) [super] classic
Stopping currently running engine...
Starting firebird in classic server mode...
Updated /opt/firebird/firebird.conf
Done.                        
                    </pre><p>
                </p></section></section><section class="section" id="install-linux-client"><div class="titlepage"><div><div><h3 class="title">Ручная установка клиента</h3></div></div></div><p/></section></section><section class="section" id="install-windows"><div class="titlepage"><div><div><h2 class="title" style="clear: both">Установка на ОС Windows</h2></div></div></div><p>Firebird под Windows распространяется в двух вариантах: в виде выполняемого файла
            установщика с расширением exe и в виде zip архивов. Для 32-разрядного варианта в имени
            файла содержится суффикс Win32, для 64-разрядного — x64. Отладочный вариант имеет
            дополнительный суффикс pdb.</p><section class="section" id="install-windows-exe"><div class="titlepage"><div><div><h3 class="title">Установка из исполняемого пакета</h3></div></div></div><p>Скачайте и запустите инсталяционный пакет разрядности, соответствующей разрядности
                операционной системы (Win32 может работать на 64-разярдной Windows, но это не имеет
                смысла). Инсталляция СУБД Firebird осуществляется с помощью стандартного мастера
                установки программ. В ходе установки мастер собирает всю необходимую для установки
                сервера информацию, производит копирование файлов и регистрацию программных модулей
                в реестре Windows.</p><div class="note"><h3 class="title">Примечание</h3><p>Для установки Firebird необходимы права администратора.</p></div><p>Рекомендуется перед установкой этого пакета ДЕИНСТАЛЛИРОВАТЬ все предыдущие версии
                Firebird или InterBase. Особенно важно убедиться, что файлы
                    <code class="filename">fbclient.dll</code> и <code class="filename">gds32.dll</code> удалены из
                каталога <code class="filename">system32</code>.</p><p>Если вам необходимо установить Firebird 3.0 совместно с другими версиями, то это
                необходимо сделать из zip-архива.</p><p>Выберите язык установки. Предусмотрена установка на русском, английском и других
                языках. </p><div class="figure" id="d0e426"><div class="figure-contents"><div style="text-align: center; " class="mediaobject"><img style="text-align: middle; " src="images/select-install-lang.png" alt="Выбор языка установки"/></div></div><div class="figure-title">Рисунок 1.2. Выбор языка установки</div></div><p><br class="figure-break"/>
                </p><div class="figure" id="d0e436"><div class="figure-contents"><p>
                        <span class="inlinemediaobject"><img style="text-align: left; " src="images/install-license.png" width="45%" alt="Лицензионное соглашение"/></span>
                        <span class="inlinemediaobject"><img style="text-align: right; " src="images/install-info.png" width="45%" alt="Информация об установке"/></span>
                    </p></div><div class="figure-title">Рисунок 1.3. Лицензионное соглашение и информация об установке</div></div><p><br class="figure-break"/>
            </p><p>В процессе инсталляции вам будет предложено выбрать папку для установки, а также
                выбрать устанавливаемые компоненты. </p><div class="figure" id="d0e458"><div class="figure-contents"><div class="mediaobject"><table style="border: 0; width: 450px; cellpadding: 0; cellspacing: 0;"><tr><td><img src="images/install-select-components.png" width="450" alt="Выбор компонентов для установки"/></td></tr></table></div></div><div class="figure-title">Рисунок 1.4. Выбор компонентов для установки</div></div><p><br class="figure-break"/>
            </p><section class="simplesect" id="install-windows-exe-servermode"><div class="titlepage"><div><div><h4 class="title">Выбор архитектуры сервера</h4></div></div></div><p>Далее будет предложено выбрать архитектуру сервера и некоторые дополнительные
                    опции. Доступны следующие архитектуры: </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><span class="bold"><strong>Classic</strong></span>: </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle; "><li class="listitem"><p> использует отдельный процесс на каждое
                                            пользовательское соединение; </p></li><li class="listitem"><p> каждый процесс содержит в себе все что нужно для
                                            работы с базой данных: область памяти для метаданных,
                                            страничный кэш для минимизации повторных чтений из файла
                                            БД; память для сортировок; </p></li><li class="listitem"><p> если происходит сбой, другие соединения остаются
                                            работоспособными </p></li><li class="listitem"><p> поддержка мультипроцессорности: в многопроцессорных
                                            системах ОС автоматически распределяет процессы по
                                            процессорам/ядрам </p></li></ul></div></li><li class="listitem"><p>
                                <span class="bold"><strong>Superserver</strong></span>:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle; "><li class="listitem"><p> один процесс с общей областью памяти для всех
                                            пользовательских соединений (общий странчный кеш и
                                            память под сортировки); </p></li><li class="listitem"><p> используется пул потоков ОС для обработки запросов от
                                            соединений, таким образом каждое соединение работает в
                                            отдельном потоке управляемом ОС, а неактивные соединения
                                            не отъедают ресурсы потоков; </p></li><li class="listitem"><p> каждый поток со своим кэшем метаданных; </p></li><li class="listitem"><p>поддержка мультипроцессорности: потоки ОС легко
                                            распараллеливаются; </p></li><li class="listitem"><p> возможный сбой в одном процессе разорвет все
                                            подключения. </p></li></ul></div></li><li class="listitem"><p>
                                <span class="bold"><strong>SuperClassic</strong></span>: </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle; "><li class="listitem"><p>единый процесс на всех пользователей с общей памятью
                                            под сортировки;</p></li><li class="listitem"><p> используется пул потоков ОС для обработки запросов от
                                            соединений, таким образом каждое соединение работает в
                                            отдельном потоке управляемом ОС, а неактивные соединения
                                            не отъедают ресурсы потоков; </p></li><li class="listitem"><p> каждый поток со своим страничным кэшем и кэшем
                                            метаданных; </p></li><li class="listitem"><p>поддержка мультипроцессорности: потоки ОС легко
                                            распараллеливаются; </p></li><li class="listitem"><p> возможный сбой в одном процессе разорвет все
                                            подключения. </p></li></ul></div></li></ul></div><p>
                    </p><div class="figure" id="d0e537"><div class="figure-contents"><div class="mediaobject"><table style="border: 0; width: 450px; cellpadding: 0; cellspacing: 0;"><tr><td><img src="images/install-select-architect.png" width="450" alt="Выбор архитектуры"/></td></tr></table></div></div><div class="figure-title">Рисунок 1.5. Выбор архитектуры</div></div><p><br class="figure-break"/>
                </p><p>Каждый из режимов стабилен, и нет причин полностью отдавать предпочтение
                    какому-то одному. Конечно, у вас могут быть свои собственные конкретные
                    соображения. Если Вы сомневаетесь, просто следуйте за установкой по умолчанию.
                    Позже вы можете изменить архитектуру через файл конфигурации
                        <code class="filename">firebird.conf</code> (параметр ServerMode), что потребует
                    перезагрузки, но не переустановки.</p></section><section class="simplesect" id="d0e552"><div class="titlepage"><div><div><h4 class="title">Установка Guardian</h4></div></div></div><p>Мы собираемся отказаться от использования Firebird Guardian в будущих версиях.
                    Он не работает в случае архитектуры Classic Server и программа установки не
                    предлагает его установку, если выбрана данная архитектура. Для архитектур
                    SuperServer и SuperClassic установка Firebird Guardian возможна, но по умолчанию
                    не выбрана. </p></section><section class="simplesect" id="d0e557"><div class="titlepage"><div><div><h4 class="title">Способ запуска сервера Firebird</h4></div></div></div><p>Сервер может быть запущен в качестве приложения (менее предпочтительный
                    вариант) или в качестве службы. Для запуска в качестве приложения используется
                    следующая команда:
                    </p><pre class="programlisting">
firebird -a                    
                </pre><p>
                </p></section><section class="simplesect" id="d0e565"><div class="titlepage"><div><div><h4 class="title">Установка gds32.dll</h4></div></div></div><p>По умолчанию данная библиотека не копируется в системные папки Windows в
                    процессе установки. Мы не можем гарантировать, что необходимые библиотеки MS VC
                    runtime будут установлены и доступны в системе. Тем не менее, данная возможность
                    доступна опционально в процессе установки, так же как и копирование
                        <code class="filename">fbclient.dll</code> в системные папки Windows. Если вы
                    используете данную возможность, то вы должны убедиться, что библиотеки MS VC
                    runtime версии 10.0 установлены в системе. </p></section><section class="simplesect" id="d0e573"><div class="titlepage"><div><div><h4 class="title">Авторизация с предыдущих версий клиента Firebird</h4></div></div></div><p>В Firebird 3.0 по умолчанию используется безопасная парольная аутентификация
                    (SRP). Клиенты Firebird 2.5 и более ранние версии использовали традиционную
                    аутентификацию (Legacy_Auth), которая отключена в Firebird 3.0 по-умолчанию,
                    поскольку не является безопасной.</p><p>Вы можете разрешить авторизацию предыдущими версиями клиентов Firebird в
                    процессе инсталяции. Это можно сделать и после установки изменив параметры <a class="link" href="#config-param-Auth" title="AuthServer и AuthClient">AuthServer</a>, <a class="link" href="#config-param-UserManager" title="UserManager">UserManager</a> и <a class="link" href="#config-param-WireCrypt" title="WireCrypt">WireCrypt</a>.</p></section><section class="simplesect" id="d0e589"><div class="titlepage"><div><div><h4 class="title">Пароль SYSDBA</h4></div></div></div><p>Изначально в системе существует только один пользователь – администратор
                    сервера SYSDBA (пароль по умолчанию — masterkey). Этот пользователь обладает
                    полными правами на выполнение всех функций по управлению работой сервера и
                    работе с базами данных. В процессе инсталляции Вас попросят изменить пароль
                    данного пользователя в целях безопасности. </p><div class="figure" id="d0e594"><div class="figure-contents"><div class="mediaobject"><table style="border: 0; width: 450px; cellpadding: 0; cellspacing: 0;"><tr><td><img src="images/install-sysdba-password.png" width="450" alt="Задание пароля SYSDBA"/></td></tr></table></div></div><div class="figure-title">Рисунок 1.6. Задание пароля SYSDBA</div></div><p><br class="figure-break"/>
                </p><p>После этого шага будет отображено окно, в котором отображаются опции,
                    выбранные пользователем, если вас всё устраивает можно начать автоматическую
                    установку сервера.</p></section></section><section class="section" id="install-windows-zip"><div class="titlepage"><div><div><h3 class="title">Ручная установка из ZIP архива</h3></div></div></div><p>Скачайте архив соответствующей разрядности и распакуйте его в директорию, в
                которой будет размещён сервер Firebird.</p><section class="section" id="install-windows-init-sysdba"><div class="titlepage"><div><div><h4 class="title">Инициализация SYSDBA</h4></div></div></div><p>Начиная с Firebird 3.0 пользователь SYSDBA не инициализирован по умолчанию
                    (для плагина управления пользователями SRP), поэтому необходимо явно создать
                    пользователя и указать ему пароль. Это можно сделать двумя способами: с
                    использованием консольного инструмента для выполнения интерактивных запросов
                        <span class="application">isql.exe</span> и консольного инструмента для управления
                    базой данных безопасности <span class="application">gsec.exe</span>.</p><div class="note"><h3 class="title">Примечание</h3><p>В зависимости от размещения Firebird эти утилиты могут потребовать запуска
                        с привилегиями администратора.</p></div><section class="section" id="install-windows-isql"><div class="titlepage"><div><div><h5 class="title">Инициализация SYSDBA с помощью ISQL</h5></div></div></div><p>Запустите инструмент для выполнения интерактивных запросов
                            <span class="application">isql.exe</span>. Соединитесь с базой данных
                        безопасности в режиме встроенного сервера, указав при этом пользователя
                        SYSDBA без пароля.</p><div class="note"><h3 class="title">Примечание</h3><p>Пользователя SYSDBA ещё не существует в базе данных безопасности, но в
                            embedded режиме пользователь и его пароль не проверяется, и Firebird
                            доверяет любому указанному имени пользователя.</p></div><p>Выполите SQL запрос для создания пользователя SYSDBA:
                        </p><pre class="programlisting">
CREATE USER SYSDBA PASSWORD '<em class="replaceable"><code>&lt;password&gt;</code></em>';                 
                </pre><p>
                    </p><p>Пользователь SYSDBA инициализирован, можно выходить из интерактивного
                        режима.</p><div class="example" id="d0e646"><div class="example-title">Пример 1.1. Инициализация SYSDBA через isql</div><div class="example-contents"><p>
                            </p><pre class="programlisting">

c:\Firebird\3.0&gt;isql
Use CONNECT or CREATE DATABASE to specify a database
SQL&gt; connect security.db user SYSDBA;
Database: security.db, User: SYSDBA
SQL&gt; CREATE USER SYSDBA PASSWORD 'm8ku234pp';
SQL&gt; exit;

c:\Firebird\3.0&gt;
                            
                        </pre><p>
                        </p></div></div><br class="example-break"/></section><section class="section" id="install-windows-gsec"><div class="titlepage"><div><div><h5 class="title">Инициализация SYSDBA с помощью GSEC</h5></div></div></div><p>Запустите <span class="application">gsec.exe</span> указав пользователя SYSDBA и
                        базу данных <code class="filename">security.db</code>.</p><p>Выполите команду для добавления пользователя SYSDBA:
                        </p><pre class="programlisting">
add SYSDBA -pw <em class="replaceable"><code>&lt;password&gt;</code></em>                 
                </pre><p>
                    </p><div class="example" id="d0e673"><div class="example-title">Пример 1.2. Инициализация SYSDBA через GSEC</div><div class="example-contents"><p>
                            </p><pre class="programlisting">

c:\Firebird\3.0&gt;gsec -user SYSDBA -database security.db
*** gsec is deprecated, will be removed soon ***

GSEC&gt; add SYSDBA -pw m8ku234pp
GSEC&gt; quit

c:\Firebird\3.0&gt;
                            
                        </pre><p>
                        </p></div></div><br class="example-break"/><div class="note"><h3 class="title">Примечание</h3><p>Инструмент <span class="application">gsec.exe</span> является устаревшим,
                            многие возможности доступные через SQL не доступны в нём.</p></div></section></section><section class="section" id="install-windows-config"><div class="titlepage"><div><div><h4 class="title">Конфигурация</h4></div></div></div><section class="section" id="install-windows-config-mode"><div class="titlepage"><div><div><h5 class="title">Режим сервера</h5></div></div></div><p>По-умолчанию Firebird будет стартовать в режиме SuperServer. Если вы
                        хотите чтобы сервер запускался в другой архитектуре, то необходимо изменить
                        значение параметра <em class="parameter"><code>ServerMode</code></em> в
                            <code class="filename">firebird.conf</code>. Разкомментируйте его (удалите
                        решётку) и установите нужный режим: Super, SuperClassic или Classic.
                        </p><pre class="programlisting">
ServerMode = Classic                       
                        </pre><p>
                    </p><p>Подробнее о режимах севера и параметре <em class="parameter"><code>ServerMode</code></em>
                        читайте в <a class="link" href="#install-windows-exe-servermode" title="Выбор архитектуры сервера">Выбор архитектуры
                            сервера</a> и <a class="link" href="#config-param-ServerMode" title="ServerMode">ServerMode</a>.</p></section><section class="section" id="install-windows-config-auth"><div class="titlepage"><div><div><h5 class="title">Авторизация с предыдущих версий клиента Firebird</h5></div></div></div><p>В Firebird 3.0 по умолчанию используется безопасная парольная
                        аутентификация (SRP). Клиенты Firebird 2.5 и более ранние версии
                        использовали традиционную аутентификацию (Legacy_Auth), которая отключена в
                        Firebird 3.0 по-умолчанию, поскольку не является безопасной.</p><p>Для поддержки традиционной аутентификации необходимо изменить следующие
                        параметры <a class="link" href="#config-param-Auth" title="AuthServer и AuthClient">AuthServer</a>, <a class="link" href="#config-param-UserManager" title="UserManager">UserManager</a> и <a class="link" href="#config-param-WireCrypt" title="WireCrypt">WireCrypt</a>.</p><div class="example" id="d0e731"><div class="example-title">Пример 1.3. Включение авторизации с предыдущих версий клиента Firebird</div><div class="example-contents"><p>
                            </p><pre class="programlisting">
AuthServer = Srp256, Srp, Legacy_Auth
UserManager = Srp, Legacy_UserManager
WireCrypt = Enabled
                            </pre><p>
                        </p></div></div><br class="example-break"/><div class="note"><h3 class="title">Примечание</h3><p>Если вам не нужна поддержка безопасной парольной аутентификации (SRP),
                            удалите из <em class="parameter"><code>AuthServer</code></em> плагины Srp256 и Srp; из
                                <em class="parameter"><code>AuthServer</code></em> — Legacy_UserManager, а
                                <em class="parameter"><code>WireCrypt</code></em> можете изменить на Disabled.</p></div><p>После вышеперечисленных манипуляций у нас будет активно два менеджера
                        пользователей, по умолчанию активный тот что первый в списке
                        UserManager.</p><div class="important"><h3 class="title">Важно</h3><p>Одноименные пользователи в разных менеджерах пользователей — это
                            разные пользователи.</p></div><p>Ранее мы уже создали SYSDBA в менеджере пользователей SRP. В
                        Legacy_UserManager SYSDBA уже существует, причём со стандартным паролем
                        masterkey, который необходимо изменить. Сделаем это c использованием
                        инструмента isql. В операторе <code class="code">ALTER USER</code> необходимо обязательно
                        указать менеджер пользователей Legacy_UserManager. </p><pre class="synopsis">
            
c:\Firebird\3.0&gt;isql
Use CONNECT or CREATE DATABASE to specify a database
SQL&gt; connect security.db user sysdba;
Database: security.db, User: SYSDBA
SQL&gt; ALTER USER SYSDBA SET PASSWORD 'er34gfde' USING PLUGIN Legacy_UserManager;
SQL&gt; exit;

c:\Firebird\3.0&gt;
                        
                    </pre><p>
                    </p></section><section class="section" id="install-windows-config-with_other"><div class="titlepage"><div><div><h5 class="title">Одновременный запуск нескольких Firebird</h5></div></div></div><p>Для одновременного запуск нескольких Firebird, необходимо развести их по
                        разным портам tcp (если конечно слушатель запущен в режиме прослушивания
                        TCP/IP). Для этого необходимо изменить в <code class="filename">firebird.conf</code>
                        параметр <em class="parameter"><code>RemoteServicePort</code></em>. Например, если у вас уже
                        есть один сервер который слушает порт 3050, то необходимо установить любой
                        другой свободный порт, например 3051. В этом случае в строке подключения
                        необходимо будет указывать новый порт.
                        </p><pre class="programlisting">
RemoteServicePort = 3051                            
                        </pre><p>
                    </p><p>Если необходимо обеспечить также одновременную работоспособность по
                        локальному протоколу XNET и через именованные каналы WNET, то необходимо так
                        же изменить параметры <em class="parameter"><code>IpcName</code></em> и
                            <em class="parameter"><code>RemotePipeName</code></em>. Однако стоит учесть, что эти
                        параметры придётся изменять и на стороне клиента через DPB.</p><div class="important"><h3 class="title">Важно</h3><p>Если вы хотите запускать несколько экземпляров Firebird, то не
                            используйте утилиту <span class="application">instreg.exe</span>, которая
                            записывает путь к серверу в реестр Windows.</p></div></section></section><section class="section" id="install-windows-instreg"><div class="titlepage"><div><div><h4 class="title">Запись в реестре</h4></div></div></div><p>Утилита утилита <span class="application">instreg.exe</span> позволяет прописывать в
                    реестр Windows путь к корневому каталогу сервера. Для этого необходимо запустить
                    команду
                    </p><pre class="programlisting">
instreg install -z             
                </pre><p>
                </p><p>Для удаления записи из реестра необходимо запустит следующую команду
                    </p><pre class="programlisting">
instreg remove -z                    
                </pre><p>
                </p><div class="important"><h3 class="title">Важно</h3><p>Если вы хотите запускать несколько экземпляров Firebird, то не используйте
                        утилиту <span class="application">instreg.exe</span>.</p></div><div class="note"><h3 class="title">Примечание</h3><p>Переключатель -z не является обязательным, он позволяет вывести
                        установленную или удаленную версию Firebird.</p></div></section><section class="section" id="install-windows-instsvc"><div class="titlepage"><div><div><h4 class="title">Установка и запуск Firebird как службы</h4></div></div></div><p>Утилита <span class="application">instsvc.exe</span> записывает, удаляет или меняет
                    информацию о запуске сервера в базе сервисов операционной системы. Кроме того,
                    она позволяет управлять запуском и остановкой сервиса. Если запустить её без
                    параметров, то будет выведена справка по командам и параметрам. </p><pre class="programlisting">                   
instsvc
</pre><p>
                    </p><pre class="screen">
Usage:
  instsvc i[nstall]
                    [ -a[uto]* | -d[emand] ]
                    [ -g[uardian] ]
                    [ -l[ogin] username [password] ]
                    [ -n[ame] instance ]
                    [ -i[nteractive] ]

          sta[rt]   [ -b[oostpriority] ]
                    [ -n[ame] instance ]
          sto[p]    [ -n[ame] instance ]
          q[uery]
          r[emove]  [ -n[ame] instance ]


  '*' denotes the default values
  '-z' can be used with any other option, prints version
  'username' refers by default to a local account on this machine.
  Use the format 'domain\username' or 'server\username' if appropriate.               
                </pre><p>
                </p><p>Для установки сервиса необходимо ввести команду
                    </p><pre class="programlisting">
instsvc install    
</pre><p>
                </p><p>В этом случае Firebird будет установлен в качестве службы с именем
                        <span class="quote">«<span class="quote">Firebird Server – DefaultInstance</span>»</span>. Эта служба будет
                    запускаться автоматически при старте ОС, под учётной записью LocalSystem,
                    предназначенной для служб.</p><p>Если необходимо чтобы было установлено несколько экземпляров Firebird
                    работающих как службы, то необходимо задать им разные имена с помощью
                    переключателя <code class="code">-n</code>
                    </p><pre class="programlisting">
instsvc install -n fb30    
</pre><p>
                </p><p>Для запуска службы воспользуйтесь командой
                    </p><pre class="programlisting">
instsvc start                    
                </pre><p>
                </p><p>Если службы была установлена с именем отличным от умолчательного, то
                    необходимо воспользоваться переключателем <code class="code">-n</code>
                    </p><pre class="programlisting">
instsvc start -n fb30                    
                </pre><p>
                </p><p>Для остановки службы воспользуйтесь командой
                    </p><pre class="programlisting">
instsvc stop                    
                </pre><p>
                </p><p>Если службы была установлена с именем отличным от умолчательного, то
                    необходимо воспользоваться переключателем <code class="code">-n</code>
                    </p><pre class="programlisting">
instsvc stop -n fb30                    
                </pre><p>
                </p><p>Для удаления сервиса необходимо ввести команду
                    </p><pre class="programlisting">
instsvc remove    
</pre><p>
                </p><p>Если службы была установлена с именем отличным от умолчательного, то
                    необходимо воспользоваться переключателем <code class="code">-n</code>
                    </p><pre class="programlisting">
instsvc remove -n fb30                    
                </pre><p>
                </p><p>Для просмотра всех служб Firebird установленных в системе воспользуйтесь
                    командой </p><pre class="programlisting">
instsvc query
</pre><p>
                    </p><pre class="screen">
Firebird Server - fb30 IS installed.
  Status  : running
  Path    : C:\Firebird\3.0\firebird.exe -s fb30
  Startup : automatic
  Run as  : LocalSystem

Firebird Server - fb40 IS installed.
  Status  : running
  Path    : C:\Firebird\4.0\firebird.exe -s fb40
  Startup : automatic
  Run as  : LocalSystem                    
                </pre><p>
                </p></section><section class="section" id="install-windows-bat"><div class="titlepage"><div><div><h4 class="title">Использование install_service.bat и uninstall_service.bat</h4></div></div></div><p>Для упрощения процедуру установки и удаления служб в ZIP архиве в комплекте с
                    Firebird поставляются два BAT файла: <code class="filename">install_service.bat</code> и
                        <code class="filename">uninstall_service.bat</code>.</p><p>В этом случае процедура установки Firebird в качестве сервиса выглядит
                    следующим образом
                    </p><pre class="programlisting">
install_service.bat                        
                    </pre><p>
                </p><p>Если необходимо задать службе имя отличное от умолчательного, то указываем это
                    имя в качестве аргумента
                    </p><pre class="programlisting">
install_service.bat fb30                       
                    </pre><p>
                </p><p>В этом случае процедура удаления службы Firebird выглядит следующим образом
                    </p><pre class="programlisting">
uninstall_service.bat                        
                    </pre><p>
                </p><p>Если службы была установлена с именем отличным от умолчательного, то указываем
                    это имя в качестве аргумента
                    </p><pre class="programlisting">
uninstall_service.bat fb30                       
                    </pre><p>
                </p></section><section class="section" id="install-windows-app"><div class="titlepage"><div><div><h4 class="title">Запуск Firebird как приложения</h4></div></div></div><p>Для запуска Firebird в качестве приложения достаточно выполнить команду
                    </p><pre class="programlisting">
firebird -a                       
                    </pre><p>
                </p><div class="tip"><h3 class="title">Подсказка</h3><p>Запуск Firebird как приложения удобен на компьютере разработчика. Это
                        особенно полезно во время отладки UDF, UDR и различных плагинов
                        Firebird.</p></div></section><section class="section" id="install-windows-client"><div class="titlepage"><div><div><h4 class="title">Установка клиента</h4></div></div></div><p>Если речь идёт об установке только о клиентской части, то обязательно
                    требуется файл <code class="filename">fbclient.dll</code>. Клиент Firebird 3.0
                    обязательно требует наличие установленного Microsoft Runtime C++ 2010
                    соответствующей разрядности. Если данная библиотека не установлено, то можно
                    скопировать дополнительные библиотеки, которые поставляются в ZIP архиве под
                    Windows <code class="filename">msvcp100.dll</code> и
                    <code class="filename">msvcr100.dll</code>.</p><p>Желательно, чтобы рядом с <code class="filename">fbclient.dll</code> был расположен
                    файл сообщений <code class="filename">firebird.msg</code>. Большинство сообщений об
                    ошибках уже содержатся в <code class="filename">fbclient.dll</code>, однако если вы
                    собираетесь пользоваться консольными утилитами файл
                        <code class="filename">firebird.msg</code> обязательно должен присутствовать.</p><p>Если требуется сжатие трафика при работе по TCP/IP, то потребуется так же
                    библиотека <code class="filename">zlib1.dll</code>.</p><p>Для того чтобы клиентское приложение могло загрузить библиотеку
                        <code class="filename">fbclient.dll</code> она должна располагаться либо рядом с
                    приложением, либо в одной из директорий в которой производится поиск, например
                    добавленной в <code class="filename">PATH</code> или системной директории для размещения
                    общедоступных библиотек (<code class="filename">system32</code> или
                        <code class="filename">SysWOW64</code>).</p><div class="important"><h3 class="title">Важно</h3><p>Размещение клиентской библиотеки в <code class="filename">PATH</code> может
                        помешать другим приложениям, которым требуется клиентская библиотека другой
                        версии или другого сервера. Поэтому, если предполагается, что приложение
                        должно работать независимо от других приложений с конкретной версией
                        клиента, то файлы клиента требуется разместить в папке приложения, и не
                        прописывать этот путь в <code class="filename">PATH</code>.</p></div><p>Если у вас ещё нет (и не планируется) установок сервера Firebird или его
                    клиента, то вы можете зарегистрировать путь к корню Firebird в реестре.
                    </p><pre class="programlisting">
instreg install                       
                    </pre><p>
                </p><section class="section" id="install-windows-client-instclient"><div class="titlepage"><div><div><h5 class="title">Утилита instclient</h5></div></div></div><p>Утилита <span class="application">instclient.exe</span> позволяет:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>установить клиентскую часть одной командой;</p></li><li class="listitem"><p>установить клиентскую часть как
                                        <code class="filename">fbclient.dll</code> и/или
                                        <code class="filename">gds32.dll</code>;</p></li><li class="listitem"><p>проверить наличие установленной библиотеки
                                        <code class="filename">fbclient.dll</code> и/или
                                        <code class="filename">gds32.dll</code>;</p></li><li class="listitem"><p>удалить ранее установленные <code class="filename">fbclient.dll</code>
                                    и/или <code class="filename">gds32.dll</code>.</p></li></ul></div><div class="note"><h3 class="title">Примечание</h3><p>Утилита <span class="application">instclient.exe</span> должна быть запущена
                            с правами администратора.</p></div><p>Если запустить <span class="application">instclient.exe</span> без параметров,
                        то будет выведена краткая справка: </p><pre class="programlisting">
instclient                        
                    </pre><p>
                        </p><pre class="screen">
Usage:
  instclient i[nstall] [ -f[orce] ] library
             q[uery] library
             r[emove] library

  where library is:  f[bclient] | g[ds32]                          
                        </pre><p>
                    </p><p>Для развёртывания клиентской библиотеки Firebird в системном каталоге
                        Windows воспользуйтесь командой </p><pre class="programlisting">
instclient install fbclient    
</pre><p>
                        </p><pre class="screen">
FBCLIENT.DLL has been installed to the System directory.                            
                        </pre><p>
                    </p><p>При развёртывании библиотеки проверяется версия и инкрементируется счётчик
                        общих библиотек. Для отмены проверки версии вы можете воспользоваться
                        переключателем <code class="code">-force</code>.</p><p>Некоторые старые приложения требуют для работы клиентскую библиотеку
                            <code class="filename">gds32.dll</code> (наследие Interbase). Кроме того, многие
                        приложения требуют для работы не просто <code class="filename">gds32.dll</code>, но и
                        проверяют версию этой библиотеки. Именно поэтому простое переименовывание
                            <code class="filename">fbclient.dll</code> в <code class="filename">gds32.dll</code> для
                        таких программ работать не будет — версия библиотеки окажется ниже 6.0 (т.к.
                        соответствует версии Firebird, у которого нумерация версий идет с 1.0).
                        Утилита <span class="application">instclient.exe</span> позволяет не просто
                        установить <code class="filename">gds32.dll</code>, но и изменить её версию на
                        корректную. </p><pre class="programlisting">
instclient install gds32  
</pre><p>
                        </p><pre class="screen">
GDS32.DLL has been installed to the System directory.                           
                        </pre><p>
                    </p><p>Утилита <span class="application">instclient.exe</span> позволяет также
                        проверить наличие установленной клиентской библиотеки с помощью команды </p><pre class="programlisting">
instclient q fbclient 
</pre><p>
                        </p><pre class="screen">
Installed FBCLIENT.DLL version : 3.0.4.33054 (shared DLL count 1)                          
                        </pre><p>
                        </p><pre class="programlisting">
instclient q gds32
</pre><p>
                        </p><pre class="screen">
Installed GDS32.DLL version : 6.3.4.33054 (shared DLL count 2)                        
                        </pre><p>
                    </p><p>Для удаления воспользуйтесь командой </p><pre class="programlisting">
instclient remove fbclient 
</pre><p>
                        </p><pre class="screen">
The FBCLIENT.DLL has been removed from the System directory.                          
                        </pre><p>
                        </p><pre class="programlisting">
instclient remove gds32
</pre><p>
                        </p><pre class="screen">
The GDS32.DLL has been removed from the System directory.                     
                        </pre><p>
                    </p></section></section><section class="section" id="install-windows-update"><div class="titlepage"><div><div><h4 class="title">Обновление</h4></div></div></div><p>В данном случае речь об обновлении в рамках пойнт-релизов (третья цифра в
                    версии сервера) или так называемых сервис-паков. Обновление мажорной или
                    минорной версии обычно требует гораздо больше действий, описанных в Release
                    Note, и называется <span class="quote">«<span class="quote">Миграцией</span>»</span>. </p><div class="note"><h3 class="title">Примечание</h3><p>Обычно обновление в рамках пойнт-релизов не требует процедуры резервного
                        копирования и восстановления базы данных средством
                            <span class="application">gbak</span>, но бывают исключения. Такие исключения
                        обязательно описаны в Release Note, поэтому обязательно ознакомьтесь с ним
                        перед обновлением.</p></div><p>Примерно те же действия требуются при обновлении на текущий снапшот. Снапшоты
                    — это ежедневные сборки сервера Firebird, которые включают самые последние
                    изменения текущей версии сервера. Это позволяет иметь самую свежую версию
                    сервера с исправленными ошибками и улучшениями. Однако учтите, что снапшоты не
                    проходят полный цикл тестирования и могут содержать новые ошибки или регрессии.
                    Поэтому не обновляйтесь до снапшота без явной необходимости (исправленные в нём
                    ошибки касаются вас непосредственно).</p><p>Алгоритм обновления поверх существующего сервера Firebird следующий:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Убедится что все пользователи отключены от всех баз данных
                                обслуживаемых обновляемым сервером Firebird. С помощью команды </p><pre class="programlisting">

gfix -shut -force &lt;n&gt;
                                
                            </pre><p> можно закрыть все
                                подключения и запретить последующие. </p></li><li class="listitem"><p>Остановить сервер</p></li><li class="listitem"><p>Сделать резервную копию корневого каталога сервера</p></li><li class="listitem"><p>Распаковать из ZIP архива с пойнт-релизом или снапшотом файлы в
                                корневую директорию сервера</p></li><li class="listitem"><p>Заменить новые файлы конфигурации
                                    (<code class="filename">firebird.conf</code>,
                                    <code class="filename">databases.conf</code> и другие), а также файл
                                    <code class="filename">security3.fdb</code> на прежние</p></li><li class="listitem"><p>Запустить обновленный сервер</p></li><li class="listitem"><p>Перевести базы данных в онлайн режим </p><pre class="programlisting">
                            
gfix -online
                         
</pre><p>
                            </p></li></ol></div></section><section class="section" id="install-windows-embedded"><div class="titlepage"><div><div><h4 class="title">Встроенный сервер</h4></div></div></div><p>Начиная с Firebird 3.0 встроенная (embedded) версия не распространяется
                    отдельно. Всё что необходимо для развертывания Firebird Embedded находится в том
                    же самом ZIP архиве, что и обычная версия.</p><p>Для функционирования Firebird Embedded необходимы следующие файлы: </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>клиентская библиотека (<code class="filename">fbclient.dll</code> или
                                    <code class="filename">libfbclient.so</code>);</p></li><li class="listitem"><p>движок для работы с ODS 12.0 (<code class="filename">engine12.dll</code>
                                или <code class="filename">libEngine12.so</code>) из папки
                                    <code class="filename">plugins</code>;</p></li><li class="listitem"><p>библиотека интернационализации, которая находится в каталоге
                                    <code class="filename">intl</code>; </p></li><li class="listitem"><p>файл сообщений <code class="filename">firebird.msg</code>;</p></li><li class="listitem"><p>для изменения некоторых параметров могут потребоваться
                                    <code class="filename">firebird.conf</code> и/или
                                    <code class="filename">databases.conf</code>;</p></li><li class="listitem"><p>в Windows обязательно необходимы файлы ICU библиотеки;</p></li><li class="listitem"><p>если в Windows не установлен MS VC++ Runtime 2010, то необходимы
                                также файлы (<code class="filename">msvcp100.dll</code> и
                                    <code class="filename">msvcr100.dll</code>);</p></li><li class="listitem"><p>если вам необходимы консольные инструменты администрирования, то
                                скопируйте также <code class="filename">gbak</code>,
                                    <code class="filename">gfix</code>, <code class="filename">gstat</code>,
                                    <code class="filename">isql</code>, <code class="filename">nbackup</code>.</p></li></ul></div><section class="section" id="install-windows-embedded-config"><div class="titlepage"><div><div><h5 class="title">Конфигурация</h5></div></div></div><p>По умолчанию Firebird работает в режиме Super сервера в том числе и в
                        embedded варианте. Это не очень удобно, поскольку Super открывает файл базы
                        данных в монопольном режиме, что обозначает что только один процесс может
                        работать с базой данных. Для изменения режима запуска необходимо
                        отредактировать (возможно раскомментировать) значение параметра
                            <em class="parameter"><code>ServerMode</code></em> на Classic или SuperClassic в файле
                            <code class="filename">firebird.conf</code>.</p><p>Поскольку в embedded варианте сетевой доступ не используется вы можете
                        отредактировать также провайдеры <em class="parameter"><code>Providers</code></em>, удалив от
                        туда лишние провайдеры Remote и Loopback.
                        </p><pre class="programlisting">
Providers = Engine12                        
                    </pre><p>
                    </p></section></section></section></section></section><section xml:lang="ru" class="chapter" id="files"><div class="titlepage"><div><div><h2 class="title">Глава 2. Состав файлов сервера</h2></div></div></div><section class="section" id="d0e1283"><div class="titlepage"><div><div><h2 class="title" style="clear: both">Файлы конфигурации</h2></div></div></div><section class="simplesect" id="d0e1286"><div class="titlepage"><div><div><h3 class="title">databases.conf</h3></div></div></div><p> В этом текстовом файле можно сопоставить конкретный путь к БД и псевдоним, чтобы
                затем в прикладных кодах использовать более короткий и удобный псевдоним для
                обращения к нужной базе данных. Также здесь указываются индивидуальные настройки для
                каждой конкретной базы данных. Если под управлением сервера Firebird находится более
                1 базы данных, то рекомендуем все настройки уровня базы данных делать в этом
                файле.</p></section><section class="simplesect" id="d0e1291"><div class="titlepage"><div><div><h3 class="title">fbtrace.conf</h3></div></div></div><p>Файл с шаблоном настроек <code class="filename">fbtrace.conf</code> находится в корневом
                каталоге и содержит список отслеживаемых событий и указывает размещение логов
                трассировки для каждого события. Это позволяет достаточно гибко настроить параметры
                аудита различных событий для любой базы данных, при этом логирование будет
                осуществляться в отдельные файлы.</p></section><section class="simplesect" id="d0e1299"><div class="titlepage"><div><div><h3 class="title">firebird.conf</h3></div></div></div><p>Файл содержит параметры конфигурации сервера.</p></section><section class="simplesect" id="d0e1304"><div class="titlepage"><div><div><h3 class="title">plugins.conf</h3></div></div></div><p>Файл используется для настройки различных плагинов. Если в файле не указана
                конфигурация для плагина, то для него будут действовать настройки по
                умолчанию.</p></section><section class="simplesect" id="d0e1309"><div class="titlepage"><div><div><h3 class="title">udr_engine.conf</h3></div></div></div><p>Файл используется для настройки плагина UDR Engine — движок для подключения
                внешних процедур, функций и триггеров. Файл располагается в директории
                    <code class="filename">plugins</code>.</p></section><section class="simplesect" id="d0e1317"><div class="titlepage"><div><div><h3 class="title">fbintl.conf</h3></div></div></div><p>Файл конфигурации для библиотеки интернационализации. Файл располагается в
                директории <code class="filename">intl</code>.</p></section></section><section class="section" id="d0e1325"><div class="titlepage"><div><div><h2 class="title" style="clear: both">Инструменты администрирования и сервисы</h2></div></div></div><p>В Windows исполняемые файлы имеют расширение <code class="filename">.exe</code>, в других
            операционных системах могут использоваться другие расширения или вовсе не
            использоваться.</p><section class="simplesect" id="d0e1333"><div class="titlepage"><div><div><h3 class="title">fb_lock_print</h3></div></div></div><p>Эта утилита формирует статистические данные файла блокировок, который
                поддерживается в Firebird для управления последовательностью изменений базы данных
                несколькими транзакциями. Она может быть полезным инструментом анализа проблем
                взаимной блокировки.</p></section><section class="simplesect" id="d0e1338"><div class="titlepage"><div><div><h3 class="title">fbguard</h3></div></div></div><p>Исполняемый файл приложения Guardian. Он контролирует процесс сервера. Если сервер
                упал по какой-либо причине, Guardian автоматически перезапускает его.</p><div class="note"><h3 class="title">Примечание</h3><p>В современных версиях Windows не требуется. Дело в том, что у служб можно
                    установить свойство автоматического перезапуска в случае падения. Однако данная
                    утилита может быть полезна, если Firebird запускается в качестве
                    приложения.</p></div></section><section class="simplesect" id="d0e1346"><div class="titlepage"><div><div><h3 class="title">fbsvcmgr</h3></div></div></div><p>Утилита предоставляет интерфейс командной строки для Services API, обеспечивая
                доступ к любой службе, которая реализуется в СУБД.</p></section><section class="simplesect" id="d0e1351"><div class="titlepage"><div><div><h3 class="title">fbtracemgr</h3></div></div></div><p>Утилита для работы в интерактивном режиме с трассировкой.</p></section><section class="simplesect" id="d0e1356"><div class="titlepage"><div><div><h3 class="title">firebird</h3></div></div></div><p>Исполняемый файл сервера (слушатель).</p></section><section class="simplesect" id="d0e1361"><div class="titlepage"><div><div><h3 class="title">gbak</h3></div></div></div><p>Эта утилита предназначена для резервного копирования и восстановления баз данных.
                Она также обнаруживает разрушения базы данных, освобождает дисковое пространство,
                появившееся в результате удалений, разрешает незавершенные транзакции, позволяет
                разделять базы данных на несколько файлов. Она также используется для создания
                переносимой копии с целью восстановления вашей базы данных на другой аппаратной
                платформе.</p></section><section class="simplesect" id="d0e1366"><div class="titlepage"><div><div><h3 class="title">gfix</h3></div></div></div><p>Это набор общих вспомогательных утилит для изменения свойств баз данных,
                устранения небольших повреждений базы данных, выполнения различных задач чистки и т.
                д. Утилита также предоставляет средство администратора для отключения конкретных баз
                данных до завершения работы сервера. Она может быть использована вместе с утилитой
                gbak для восстановления некоторых типов нарушений в базе данных.</p></section><section class="simplesect" id="d0e1371"><div class="titlepage"><div><div><h3 class="title">gpre</h3></div></div></div><p>Это препроцессор, который конвертирует исходный код, написанный на некоторых
                языках и содержащий встроенный псевдокод SQL, в корректный отформатированный вызов
                функций Firebird API.</p></section><section class="simplesect" id="d0e1376"><div class="titlepage"><div><div><h3 class="title">gsec</h3></div></div></div><p>Этот инструмент поддержки списка пользователей и их паролей является интерфейсом
                командной строки для базы данных security3.fdb; он управляет записями пользователей
                на сервере.</p></section><section class="simplesect" id="d0e1381"><div class="titlepage"><div><div><h3 class="title">gsplit</h3></div></div></div><p>Это фильтр, который позволяет преодолевать ограничения на максимальный размер
                файла, существующие в некоторых операционных системах, при создании резервной копии
                очень большой базы данных. Эта утилита поставляется только для ОС Windows и, к
                сожалению, кажется она не работает. К счастью, gbak позволяет разбивать файлы
                резервной копии на несколько частей, так что gsplit не требуется. В системах ОС Unix
                существует подходящие утилиты из операционной системы, которые могут быть
                использованы вместо gsplit, если это необходимо.</p></section><section class="simplesect" id="d0e1386"><div class="titlepage"><div><div><h3 class="title">gstat</h3></div></div></div><p>Этот инструмент получения статистики. Он собирает и отображает статистические
                сведения по индексам и данным базы данных.</p></section><section class="simplesect" id="d0e1391"><div class="titlepage"><div><div><h3 class="title">instclient</h3></div></div></div><p>Назначение утилиты instclient состоит в том, что она:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>позволяет установить клиентскую часть Firebird одной командой;</p></li><li class="listitem"><p> позволяет установить клиентскую часть как fbclient.dll, либо как
                            gds32.dll; </p></li><li class="listitem"><p> позволяет проверить наличие установленной библиотеки fbclient или
                            gds32; </p></li><li class="listitem"><p> позволяет удалить уже установленный в системе fbclient или gds32.
                        </p></li></ul></div></section><section class="simplesect" id="d0e1409"><div class="titlepage"><div><div><h3 class="title">instreg</h3></div></div></div><p>Эта утилита прописывает необходимую информацию в реестр Windows, указывая
                умолчательное расположение файлов сервера.</p></section><section class="simplesect" id="d0e1414"><div class="titlepage"><div><div><h3 class="title">instsvc</h3></div></div></div><p>Утилита instsvc записывает, удаляет или меняет информацию о запуске сервера в базе
                сервисов операционной системы Windows.</p></section><section class="simplesect" id="d0e1419"><div class="titlepage"><div><div><h3 class="title">isql</h3></div></div></div><p>Интерактивный инструмент, который позволяет выполнять запросы к базе
                данных.</p></section><section class="simplesect" id="d0e1424"><div class="titlepage"><div><div><h3 class="title">nbackup</h3></div></div></div><p>Утилита позволяет создавать резервные копии и восстанавливать из резервных копий
                также, как gbak, и дополнительно позволяет создавать инкрементные копии и
                восстанавливать из них БД.</p></section><section class="simplesect" id="d0e1429"><div class="titlepage"><div><div><h3 class="title">qli</h3></div></div></div><p>Это Query Language Interpreter (интерпретатор языка запросов), интерактивный
                клиентский инструмент запросов. Он может обрабатывать операторы DDL и DML из SQL и
                GDML. Хотя уже есть isql и другие инструменты графического интерфейса сторонних
                разработчиков, qli все еще имеет значение по причине его способности осуществлять
                некоторые операции, до сих пор не реализованные в SQL Firebird. В отличие от isql,
                qli может одновременно соединяться более чем с одной базой данных и может
                симулировать обращение к нескольким базам данных в одном запросе.</p></section></section><section class="section" id="d0e1434"><div class="titlepage"><div><div><h2 class="title" style="clear: both">Динамические библиотеки</h2></div></div></div><p>В Windows динамические библиотеки имеют расширение <code class="filename">.dll</code>, в Linux
            — <code class="filename">.so</code>, в Mac OS — <code class="filename">.dylib</code>.</p><section class="simplesect" id="d0e1448"><div class="titlepage"><div><div><h3 class="title">fbclient</h3></div></div></div><p>Клиентская библиотека. Предоставляет интерфейс прикладного программирования (API)
                с функциями для подключения к сервисам, работы с базами данных и их созданию.
                Библиотека также выполняет роль y-valve для подключения и сопряжения различных
                плагинов.</p><p>В Windows имеет имя <code class="filename">fbclient.dll</code>, в Unix —
                    <code class="filename">libfbclient.so</code>.</p></section><section class="simplesect" id="d0e1461"><div class="titlepage"><div><div><h3 class="title">ib_util</h3></div></div></div><p>Библиотека утилиты памяти.</p><p>В Windows имеет имя <code class="filename">ib_util.dll</code>, в Unix —
                    <code class="filename">libib_util.so</code>.</p></section><section class="simplesect" id="d0e1474"><div class="titlepage"><div><div><h3 class="title">ICU</h3></div></div></div><p>ICU — International Components for Unicode — библиотеки поддержки юникода.</p><p>В Windows используется библиотека поставляемая в комплекте Firebird, в Unix —
                используется системная библиотека. В Windows в комплекте с Firebird поставляются
                следующие файлы: <code class="filename">icudt52l.dat</code>,
                <code class="filename">icudt52.dll</code>, <code class="filename">icuin52.dll</code>,
                    <code class="filename">icuuc52.dll</code>.</p></section><section class="simplesect" id="d0e1493"><div class="titlepage"><div><div><h3 class="title">Microsoft VC++ Runtime</h3></div></div></div><p>Microsoft VC++ Runtime 2010 требуется только в Windows. Поставляется в комплекте с
                Firebird на случай, если библиотека соответствующей версии не установлена в системе.
                В комплекте Firebird под Windows входят файлы: <code class="filename">msvcp100.dll</code>,
                    <code class="filename">msvcr100.dll</code>.</p></section><section class="simplesect" id="d0e1504"><div class="titlepage"><div><div><h3 class="title">zlib1.dll</h3></div></div></div><p>Библиотека <code class="filename">zlib1.dll</code> используется для сжатия сетевого трафика
                в Windows, в UNIX используется системная библиотека.</p></section><section class="simplesect" id="d0e1512"><div class="titlepage"><div><div><h3 class="title">fbintl</h3></div></div></div><p>Библиотека для поддержки интернационализации, кодировок и порядка сортировок.
                Располагается в директории <code class="filename">intl</code> относительно корневой
                директории сервера.</p><p>В Windows имеет имя <code class="filename">fbintl.dll</code>, в Unix —
                    <code class="filename">fbintl</code>.</p></section></section><section class="section" id="d0e1528"><div class="titlepage"><div><div><h2 class="title" style="clear: both">Плагины</h2></div></div></div><p>Модули плагинов размещаются в динамических библиотеках. В Firebird для модулей
            плагинов выделена папка <code class="filename">plugins</code>, которая находится в корневой
            директории сервера.</p><section class="simplesect" id="d0e1536"><div class="titlepage"><div><div><h3 class="title">Engine12</h3></div></div></div><p>Поставщик (ядро) для работы с ODS 12.</p><p>В Windows имеет имя <code class="filename">engine12.dll</code>, в Unix —
                    <code class="filename">libEngine12.so</code>, в MacOS —
                    <code class="filename">libEngine12.dylib</code>.</p></section><section class="simplesect" id="d0e1552"><div class="titlepage"><div><div><h3 class="title">fbtrace</h3></div></div></div><p>Плагин трассировки.</p><p>В Windows имеет имя <code class="filename">fbtrace.dll</code>, в Unix —
                    <code class="filename">libfbtrace.so</code>, в MacOS —
                    <code class="filename">libfbtrace.dylib</code>.</p></section><section class="simplesect" id="d0e1568"><div class="titlepage"><div><div><h3 class="title">legacy_auth</h3></div></div></div><p>Плагин для поддержки традиционной аутентификации (использовалась в Firebird 2.5 и
                в более ранних версиях).</p><p>В Windows имеет имя <code class="filename">legacy_auth.dll</code>, в Unix —
                    <code class="filename">libLegacy_Auth.so</code>, в MacOS —
                    <code class="filename">libLegacy_Auth.dylib</code>.</p></section><section class="simplesect" id="d0e1584"><div class="titlepage"><div><div><h3 class="title">legacy_usermanager</h3></div></div></div><p>Менеджер пользователей, который используется в традиционной аутентификации.</p><p>В Windows имеет имя <code class="filename">legacy_usermanager.dll</code>, в Unix —
                    <code class="filename">libLegacy_UserManager.so</code>, в MacOS —
                    <code class="filename">libLegacy_UserManager.dylib</code>.</p></section><section class="simplesect" id="d0e1600"><div class="titlepage"><div><div><h3 class="title">srp</h3></div></div></div><p>Плагин аутентификации методом SRP — Secure remote Password.</p><p>В Windows имеет имя <code class="filename">srp.dll</code>, в Unix —
                    <code class="filename">libSrp.so</code>, в MacOS —
                <code class="filename">libSrp.dylib</code>.</p></section><section class="simplesect" id="d0e1616"><div class="titlepage"><div><div><h3 class="title">udr_engine</h3></div></div></div><p>Внешний движок для подключения UDR написанных на компилируемых языках C, C++,
                Pascal.</p><p>В Windows имеет имя <code class="filename">udr_engine.dll</code>, в Unix —
                    <code class="filename">libudr_engine.so</code>, в MacOS —
                    <code class="filename">libudr_engine.dylib</code>.</p></section></section><section class="section" id="d0e1632"><div class="titlepage"><div><div><h2 class="title" style="clear: both">Включаемые файлы</h2></div></div></div><p>В директории <code class="filename">include</code> расположены заголовочные C файлы с
            функциями, константами, структурами и интерфейсами API Firebird.</p></section><section class="section" id="d0e1640"><div class="titlepage"><div><div><h2 class="title" style="clear: both">Примеры</h2></div></div></div><p>В директории <code class="filename">examples</code> расположены примеры работы с Firebird API,
            написания плагинов, UDF и UDR.</p></section><section class="section" id="d0e1648"><div class="titlepage"><div><div><h2 class="title" style="clear: both">Документации</h2></div></div></div><p>В директории <code class="filename">doc</code> расположены файлы документации.</p></section><section class="section" id="d0e1656"><div class="titlepage"><div><div><h2 class="title" style="clear: both">Другие файлы</h2></div></div></div><section class="simplesect" id="d0e1659"><div class="titlepage"><div><div><h3 class="title">security3.fdb</h3></div></div></div><p>База данных безопасности. В этой базе хранятся параметры пользователей системы,
                политики доступа, глобальные роли.</p></section><section class="simplesect" id="d0e1664"><div class="titlepage"><div><div><h3 class="title">firebird.log</h3></div></div></div><p>Лог-файл сервера.</p></section><section class="simplesect" id="d0e1669"><div class="titlepage"><div><div><h3 class="title">firebird.msg</h3></div></div></div><p>Файл с сообщениями сервера (в основном об ошибках)</p></section></section></section><section class="chapter" id="d0e1674"><div class="titlepage"><div><div><h2 class="title">Глава 3. Настройка операционной системы для Firebird</h2></div></div></div><p/><section class="section" id="d0e1678"><div class="titlepage"><div><div><h2 class="title" style="clear: both">Настройка Linux</h2></div></div></div><p/><section class="section" id="d0e1682"><div class="titlepage"><div><div><h3 class="title">Лимиты Linux</h3></div></div></div><p/></section><section class="section" id="d0e1686"><div class="titlepage"><div><div><h3 class="title">Необходимые права для Firebird на Linux</h3></div></div></div><p/></section><section class="section" id="d0e1690"><div class="titlepage"><div><div><h3 class="title">Рекомендуемые параметры сети</h3></div></div></div><p/></section><section class="section" id="d0e1694"><div class="titlepage"><div><div><h3 class="title">Рекомендуемые параметры памяти</h3></div></div></div><p/></section><section class="section" id="d0e1698"><div class="titlepage"><div><div><h3 class="title">Рекомендуемые параметры диска</h3></div></div></div><p/></section></section><section class="section" id="d0e1702"><div class="titlepage"><div><div><h2 class="title" style="clear: both">Настройка Windows</h2></div></div></div><p/><section class="section" id="d0e1706"><div class="titlepage"><div><div><h3 class="title">Необходимые права для Firebird на Windows</h3></div></div></div><p/></section><section class="section" id="d0e1710"><div class="titlepage"><div><div><h3 class="title">Рекомендуемые параметры</h3></div></div></div><p/></section></section></section><section xml:lang="ru" class="chapter" id="config"><div class="titlepage"><div><div><h2 class="title">Глава 4. Описание параметров конфигурации</h2></div></div></div><p>Для настройки сервера Firebird используется файл <code class="filename">firebird.conf</code>.
        Настройки считываются из файла один раз при старте сервера, если архитектура SuperSever или
        SuperClassic, и при каждом соединении с базой, если архитектура сервера Classic.</p><p>По умолчанию все параметры в файле конфигурации закомментированы. Для обозначения
        комментариев используется символ <span class="symbol">#</span>. Текст, следующий после символа
            <span class="symbol">#</span>, до конца строки является комментарием, например:
        </p><pre class="programlisting">
#комментарий
DefaultDbCachePages = 2048 #комментарий    
    </pre><p>
    </p><p>Максимальная длина строки в файле конфигурации сервера равна 80 символов.</p><p>Первое слово в строке, начинающейся не с символа комментария, считается названием
        параметра. Справа от имени параметра, после символа <span class="symbol">=</span>, указывается значение
        параметра.</p><section class="section" id="config-param-types"><div class="titlepage"><div><div><h2 class="title" style="clear: both">Типы параметров</h2></div></div></div><p>В файле конфигурации присутствуют параметры трех типов: </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>целочисленный (Integer);</p></li><li class="listitem"><p>строковый (String);</p></li><li class="listitem"><p>логический (Boolean).</p></li></ul></div><section class="simplesect" id="config-param-types-integer"><div class="titlepage"><div><div><h3 class="title">Целочисленные параметры</h3></div></div></div><p>Целочисленные как ясно из названия могут содержать только целые числа. Они могут
                быть записаны со множителями k, m и g.</p><div class="example" id="d0e1761"><div class="example-title">Пример 4.1. Целочисленные параметры</div><div class="example-contents"><p>
                    </p><pre class="programlisting">
MaxUnflushedWrites = 100                        
DefaultDbCachePages = 8K        # 8 * 1024 = 8192
DatabaseGrowthIncrement = 128M  # 128 * 1024 * 1024
                    </pre><p>
                </p></div></div><br class="example-break"/><div class="note"><h3 class="title">Примечание</h3><p> Значения параметров, определяющих объем памяти, указываются в байтах. В конце
                    таких значений можно ставить сокращения k, m и g, соответствующие килобайтам,
                    мегабайтам и гигабайтам. </p></div></section><section class="simplesect" id="config-param-types-boolean"><div class="titlepage"><div><div><h3 class="title">Логические параметры</h3></div></div></div><p>Логическое значение выражается в виде целочисленных значений, где 0 (ноль)
                означает <code class="constant">false</code>, а ненулевое значение означает
                    <code class="constant">true</code>. Для согласованности мы рекомендуем использовать
                только 0/1. Также строки 'y', 'yes' и 'true' означают <code class="constant">true</code>, а
                'n', 'no' и 'false' — <code class="constant">false</code>.</p><div class="example" id="d0e1789"><div class="example-title">Пример 4.2. Логические параметры</div><div class="example-contents"><p>
                    </p><pre class="programlisting">
RemoteAccess = true       # true
RemoteFileOpenAbility = 0 # false
                    </pre><p>
                </p></div></div><br class="example-break"/></section><section class="simplesect" id="config-param-types-string"><div class="titlepage"><div><div><h3 class="title">Строковые параметры</h3></div></div></div><p>Строковые как ясно из названия представляют собой строки.</p><div class="example" id="d0e1802"><div class="example-title">Пример 4.3. Строковые параметры</div><div class="example-contents"><p>
                    </p><pre class="programlisting">
RemoteServiceName = gds_db
RemotePipeName = pipe47
                    </pre><p>
                </p></div></div><br class="example-break"/></section></section><section class="section" id="config-scope"><div class="titlepage"><div><div><h2 class="title" style="clear: both">Область действия</h2></div></div></div><p>Параметры конфигурации могут быть применены к экземпляру сервера (Per-server),
            отдельной базе данных (Per-database) или отдельному соединению (Per-connection).</p><p>Параметры которые могут быть применены к отдельной базе данных можно указывать в файле
                <code class="filename">databases.conf</code>. В этом случае они перекроют значение
            одноимённого параметра указанного в <code class="filename">firebird.conf</code>.</p><p>Параметры, которые могут быть применены к отдельному соединению, предназначены для
            использования на стороне клиента. Они устанавливаются с помощью
                <em class="parameter"><code>isc_dpb_config</code></em> параметра в DPB (Database parameters buffer)
                (<em class="parameter"><code>isc_spb_config</code></em> для служб).</p><div class="note"><h3 class="title">Примечание</h3><p>Параметры уровня базы данных могут быть установлены используя DPB при первом
                соединении с базой данных, если используется встроенный режим сервера.</p></div><p>Параметры, которые могут быть применены к отдельному соединению, могут быть прочитаны
            из файлов <code class="filename">firebird.conf</code> и <code class="filename">databases.conf</code>
            расположенных в том же каталоге что и клиентская библиотека fbclient. Эти параметры
            будут перекрыты установками через DPB.</p></section><section class="section" id="config-macro"><div class="titlepage"><div><div><h2 class="title" style="clear: both">Макроподстановки</h2></div></div></div><p>Существует ряд предопределенных макроподстановок, которые могут быть использованы в
            файлах конфигурации, где требуется имя каталога. Они используют следующий синтаксис:
            </p><pre class="programlisting">
$(<em class="replaceable"><code>&lt;name&gt;</code></em>)        
        </pre><p>
        </p><p>Полный список таких макроподстановок представлен ниже: </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>root — корневой каталог экземпляра сервера;</p></li><li class="listitem"><p>install — директория в которую установлен Firebird. Изначально $(root) и
                        $(install) одинаковые. $(root) может быть переопредедна установкой или
                        изменением переменной окружения FIREBIRD. В таком случае эта подстановка
                        отлична от $(install);</p></li><li class="listitem"><p>this — каталог, в котором находится текущий файл конфигурации;</p></li><li class="listitem"><p>dir_conf — каталог, в котором расположены файлы конфигурации
                            <code class="filename">firebird.conf</code> и
                        <code class="filename">databases.conf</code>;</p></li><li class="listitem"><p>dir_secDb — директория, в которой расположены база данных безопасности по
                        умолчанию;</p></li><li class="listitem"><p>dir_plugins — директория, в которой расположены плагины;</p></li><li class="listitem"><p>dir_udf — директория, предназначенная для размещения UDF функций
                        по-умолчанию;</p></li><li class="listitem"><p>dir_sample — каталог с примерами (<code class="filename">examples</code>);</p></li><li class="listitem"><p>dir_sampleDb — директория, где лежит пример базы данных
                            (<code class="filename">examples/empbuild</code>);</p></li><li class="listitem"><p>dir_intl — директория, в которой расположены библиотеки
                        интернационализации;</p></li><li class="listitem"><p>dir_msg — каталог, в котором расположен файл с сообщениями сервера
                            <code class="filename">firebird.msg</code>. Обычно он совпадает с $(root), но
                        может быть переопределён переменной окружения FIREBIRD_MSG.</p></li></ul></div><div class="note"><h3 class="title">Примечание</h3><p>Внутренние макроподстановки не чувствительны к регистру. Большие буквы
                используются исключительно для повышения читабильности.</p></div><div class="example" id="d0e1907"><div class="example-title">Пример 4.4. Пример использования макроподстановки в файле databases.conf</div><div class="example-contents"><p>
                </p><pre class="programlisting">
  employee = $(dir_sampleDb)/employee.fdb          
            </pre><p>
            </p></div></div><br class="example-break"/></section><section class="section" id="config-includes"><div class="titlepage"><div><div><h2 class="title" style="clear: both">Включение других файлов</h2></div></div></div><p>Один файл конфигурации может включать другой с помощью директивы include:
            </p><pre class="programlisting">
include some_file.conf          
            </pre><p>
        </p><p>Относительный путь представляет собой путь по отношению к текущему файлу конфигурации.
            Так, в примере выше файл <code class="filename">/opt/config/master.conf</code> ссылается на файл
            расположенный по пути <code class="filename">/opt/config/some_file.conf</code>.</p><p>Директива include поддерживает групповые символы <code class="code">*</code> и <code class="code">?</code>. Все
            совпадающие с шаблоном файлы будут подключены, порядок включения не определён.</p><div class="example" id="d0e1939"><div class="example-title">Пример 4.5. Использование групповых символов с директивой include</div><div class="example-contents"><p>
                </p><pre class="programlisting">
include $(dir_plugins)/config/*.conf          
            </pre><p>
            </p></div></div><br class="example-break"/></section><section class="section" id="config-perdb"><div class="titlepage"><div><div><h2 class="title" style="clear: both">Параметры уровня базы данных</h2></div></div></div><p>Настройка конфигурации на уровне базы данных осуществляется с помощью формальных
            записей в файле <code class="filename">databases.conf</code>. Такие параметры помечены как
            Per-database.</p><section class="section" id="config-perdb-format"><div class="titlepage"><div><div><h3 class="title">Формат конфигурационных записей</h3></div></div></div><p>Если вы не добавляете каких либо специфичных для базы данных директив конфигурации
                для псевдонима, то формат будет такой же как он был в
                    <code class="filename">aliases.conf</code> (Firebird 2.5 и ранее):
                </p><pre class="programlisting">
emp = c:\Program Files\examples\empbuild\employee.fdb
# или
emp = /opt/firebird/examples/empbuild/employee.fdb
# или
emp = $(dir_sampleDb)/employee.fdb
            </pre><p>
            </p><p>Несколько более сложный формат используется для случаев, когда определенные
                неглобальные параметры должны быть нацелены на отдельные базы данных. Запись для
                базы данных определяется объявлением псевдонима, как и ранее. Директивы, относящиеся
                к базе данных, перечислены ниже в фигурных скобках.
                </p><pre class="programlisting">
# Directives for MYBIGDB
MYBIGDB = opt/databases/mybigdb.fdb
{
    LockMemSize = 32M           # We know that MYBIGDB needs a lot of locks
    LockHashSlots = 19927       # and a hash table large enough for them
}
            </pre><p>
            </p></section><section class="section" id="config-perdb-params"><div class="titlepage"><div><div><h3 class="title">Доступные параметры</h3></div></div></div><p>Следующие параметры можно скопировать/вставить в файл
                    <code class="filename">database.conf</code> и использовать в качестве переопределений для
                конкретных баз данных. </p><div class="table" id="d0e1979"><div class="table-title">Таблица 4.1. Параметры доступные в databases.conf</div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="c1"/><col class="c2"/><col class="c3"/></colgroup><tbody><tr><td style="border-bottom: 1px solid ; " colspan="3"><span class="bold"><strong>Связанные с
                                        ядром сервера</strong></span></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><a class="link" href="#config-param-DatabaseGrowthIncrement" title="DatabaseGrowthIncrement">DatabaseGrowthIncrement</a></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><a class="link" href="#config-param-DeadlockTimeout" title="DeadlockTimeout">DeadlockTimeout</a></td><td style="border-bottom: 1px solid ; "><a class="link" href="#config-param-DefaultDbCachePages" title="DefaultDbCachePages">DefaultDbCachePages</a></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><a class="link" href="#config-param-EventMemSize" title="EventMemSize">EventMemSize</a></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><a class="link" href="#config-param-FileSystemCacheThreshold" title="FileSystemCacheThreshold">FileSystemCacheThreshold</a></td><td style="border-bottom: 1px solid ; "><a class="link" href="#config-param-ExternalFileAccess" title="ExternalFileAccess">ExternalFileAccess</a></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><a class="link" href="#config-param-GCPolicy" title="GCPolicy">GCPolicy</a></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><a class="link" href="#config-param-LockAcquireSpins" title="LockAcquireSpins">LockAcquireSpins</a></td><td style="border-bottom: 1px solid ; "><a class="link" href="#config-param-LockHashSlots" title="LockHashSlots">LockHashSlots</a></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><a class="link" href="#config-param-LockMemSize" title="LockMemSize">LockMemSize</a></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><a class="link" href="#config-param-MaxUnflushedWrites" title="MaxUnflushedWrites">MaxUnflushedWrites</a></td><td style="border-bottom: 1px solid ; "><a class="link" href="#config-param-MaxUnflushedWriteTime" title="MaxUnflushedWriteTime">MaxUnflushedWriteTime</a></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><a class="link" href="#config-param-SecurityDatabase" title="SecurityDatabase">SecurityDatabase</a></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><a class="link" href="#config-param-UserManager" title="UserManager">UserManager</a></td><td style="border-bottom: 1px solid ; "> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><a class="link" href="#config-param-WireCompression" title="WireCompression">WireCompression</a></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><a class="link" href="#config-param-WireCrypt" title="WireCrypt">WireCrypt</a></td><td style="border-bottom: 1px solid ; "><a class="link" href="#config-param-WireCryptPlugin" title="WireCryptPlugin">WireCryptPlugin</a></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><span class="bold"><strong>Связанные с клиентом</strong></span></td><td style="border-bottom: 1px solid ; " colspan="2">Некоторые параметры могут быть
                                    настроены в клиентском соединении через DPB/SPB, в качестве
                                    альтернативы их настройке в <code class="filename">database.conf</code>.
                                    Подробнее смотри в <a class="link" href="#config-scope" title="Область действия">Область
                                        действия</a>.</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><a class="link" href="#config-param-Auth" title="AuthServer и AuthClient">AuthClient</a></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><a class="link" href="#config-param-Providers" title="Providers">Providers</a></td><td style="border-bottom: 1px solid ; "> </td></tr><tr><td style="border-bottom: 1px solid ; " colspan="3">Следующие параметры могут быть
                                    настроены на стороне клиента только через DPB/SPB.</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><a class="link" href="#config-param-ConnectionTimeout" title="ConnectionTimeout">ConnectionTimeout</a></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><a class="link" href="#config-param-DummyPacketInterval" title="DummyPacketInterval">DummyPacketInterval</a></td><td style="border-bottom: 1px solid ; "><a class="link" href="#config-param-IpcName" title="IpcName">IpcName</a></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><a class="link" href="#config-param-RemoteAuxPort" title="RemoteAuxPort">RemoteAuxPort</a></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><a class="link" href="#config-param-RemotePipeName" title="RemotePipeName">RemotePipeName</a></td><td style="border-bottom: 1px solid ; "><a class="link" href="#config-param-RemoteServicePort" title="RemoteServicePort или RemoteServiceName">RemoteServiceName</a></td></tr><tr><td style="border-right: 1px solid ; "><a class="link" href="#config-param-RemoteServicePort" title="RemoteServicePort или RemoteServiceName">RemoteServicePort</a></td><td style="border-right: 1px solid ; "><a class="link" href="#config-param-TcpNoNagle" title="TcpNoNagle">TCPNoNagle</a></td><td> </td></tr></tbody></table></div></div><p><br class="table-break"/></p></section></section><section class="section" id="config-common"><div class="titlepage"><div><div><h2 class="title" style="clear: both">Общие настройки</h2></div></div></div><section class="section" id="config-param-DatabaseAccess"><div class="titlepage"><div><div><h3 class="title">DatabaseAccess</h3></div></div></div><a id="d0e2106" class="indexterm"/><p><span class="formalpara-title">Область действия: </span>Per-server.</p><p><span class="formalpara-title">Тип параметра: </span>String (специальный формат).</p><p><span class="formalpara-title">Синтаксис: </span>
                    </p><pre class="programlisting">
DatabaseAccess = None | Full | { Restrict &lt;<em class="replaceable"><code>dir_1</code></em>&gt;[;&lt;<em class="replaceable"><code>dir_2</code></em>&gt;[...;&lt;<em class="replaceable"><code>dir_N</code></em>&gt;] }
                     </pre><p>
                </p><p>Параметр <em class="parameter"><code>DatabaseAccess</code></em> позволяет обеспечить управление
                безопасностью при доступе к файлам базы данных. Доступ к файлам базы данных на
                сервере может быть полным (<code class="literal">Full</code>), ограниченным
                    (<code class="literal">Restrict</code>) или запрещённым (<code class="literal">None</code>).</p><p>Параметр <em class="parameter"><code>DatabaseAccess</code></em> имеет строковый тип; по умолчанию
                значение параметра равно <code class="literal">Full</code> — полный доступ. Для ограничения
                доступа используется параметр <code class="literal">Restrict</code>. В этом случае после слова
                    <code class="literal">Restrict</code> указываются директории, в которых могут быть
                сохранены файлы базы данных.</p><p>При указании списка каталогов могут быть использованы как абсолютные, так и
                относительные пути. Относительные пути считаются от корневого каталога сервера
                Firebird. В качестве разделителя каталогов используется символ
                <span class="quote">«<span class="quote">;</span>»</span>.</p><p>Если параметр <em class="parameter"><code>DatabaseAccess</code></em> установлен в значение
                    <code class="literal">None</code>, то позволено соединяться только с базами данных,
                перечисленными в файле <code class="filename">databases.conf</code>.</p><div class="example" id="d0e2182"><div class="example-title">Пример 4.6. Значения параметра DatabaseAccess</div><div class="example-contents"><p>
                    </p><pre class="programlisting">
DatabaseAccess = None
DatabaseAccess = Restrict C:\DataBase
DatabaseAccess = Restrict C:\DataBase;D:\Mirror
DatabaseAccess = Restrict /db
DatabaseAccess = Restrict /db;/mnt/mirrordb
DatabaseAccess = Full              
                </pre><p>
                </p></div></div><br class="example-break"/><div class="warning"><h3 class="title">Предупреждение</h3><p>Неконтролируемый доступ к файлам баз данных может поставить под угрозу
                    безопасность вашей системы. Поэтому настоятельно рекомендуем ограничивать
                    директории для размещения баз данных.</p></div></section><section class="section" id="config-param-RemoteAccess"><div class="titlepage"><div><div><h3 class="title">RemoteAccess</h3></div></div></div><a id="d0e2196" class="indexterm"/><p><span class="formalpara-title">Область действия: </span>Per-database.</p><p><span class="formalpara-title">Тип параметра: </span>Boolean.</p><p>Параметр предоставляет или отменяет удалённый доступ к базам данных.
                </p><pre class="programlisting">
RemoteAccess = true             
                </pre><p>
            </p><p>По-умолчанию <em class="parameter"><code>RemoteAccess</code></em> включен для всех баз данных, за
                исключением базы данных безопасности. Если вы намереваетесь использовать больше
                одной специализированной базы безопасности. то рекомендуем отключить удалённый
                доступ к ним в файле <code class="filename">databases.conf</code>.</p><p>Для повышения безопасности можно отключить <em class="parameter"><code>RemoteAccess</code></em>
                глобально в файле <code class="filename">firebird.conf</code> и включить его для отдельных
                баз данных в <code class="filename">databases.conf</code>.</p><p>Параметр имеет тип Boolean и может принимать значения
                    <code class="literal">true</code>/<code class="literal">false</code>,
                    <code class="literal">1</code>/<code class="literal">0</code> или
                    <code class="literal">yes</code>/<code class="literal">no</code>.</p></section><section class="section" id="config-param-ExternalFileAccess"><div class="titlepage"><div><div><h3 class="title">ExternalFileAccess</h3></div></div></div><a id="d0e2258" class="indexterm"/><p><span class="formalpara-title">Область действия: </span>Per-database.</p><p><span class="formalpara-title">Тип параметра: </span>Строка (специальный формат).</p><p><span class="formalpara-title">Синтаксис: </span>
                    </p><pre class="programlisting">
ExternalFileAccess = None | Full | { Restrict &lt;<em class="replaceable"><code>dir_1</code></em>&gt;[;&lt;<em class="replaceable"><code>dir_2</code></em>&gt;[...;&lt;<em class="replaceable"><code>dir_N</code></em>&gt;] }
                     </pre><p>
                </p><p>Параметр <em class="parameter"><code>ExternalFileAccess</code></em> позволяет управлять правами
                размещения файлов внешних таблиц. Разрешение на доступ к внешним файлам может быть
                полным (<code class="literal">Full</code>), ограниченным (Restrict) или запрещённым (None). </p><p>Параметр <em class="parameter"><code>ExternalFileAccess</code></em> имеет строковый тип; значение
                по умолчанию равно None — запрет на создание внешних таблиц. Для того, чтобы
                разрешить создание и доступ к внешним файлам, следует выставить значение параметра
                равным Full. Для ограничения доступа используется значение Restrict. В этом случае
                после слова Restrict указываются директории, в которых могут быть сохранены файлы
                внешних таблиц. При указании каталогов могут быть использованы как абсолютные, так и
                относительные пути. Относительные пути берутся от корневого каталога Firebird. В
                качестве разделителя директорий используется символ <span class="quote">«<span class="quote">;</span>»</span>.</p><div class="example" id="d0e2306"><div class="example-title">Пример 4.7. Примеры задания значения параметра ExternalFileAccess</div><div class="example-contents"><p>
                    </p><pre class="programlisting">
ExternalFileAccess = None
ExternalFileAccess = Restrict C:\DataBase
ExternalFileAccess = Restrict C:\DataBase;D:\Mirror
ExternalFileAccess = Restrict /db;/mnt/mirrordb
ExternalFileAccess = Full              
                </pre><p>
                </p></div></div><br class="example-break"/><div class="warning"><h3 class="title">Предупреждение</h3><p>Неконтролируемая возможность использования внешних таблиц может поставить под
                    угрозу безопасность вашего сервера. Поэтому настоятельно рекомендуется
                    использовать этот параметр для ограничения директорий размещения внешних
                    таблиц.</p></div></section><section class="section" id="config-param-UdfAccess"><div class="titlepage"><div><div><h3 class="title">UdfAccess</h3></div></div></div><a id="d0e2320" class="indexterm"/><p><span class="formalpara-title">Область действия: </span>Per-server.</p><p><span class="formalpara-title">Тип параметра: </span>String (специальный формат).</p><p><span class="formalpara-title">Синтаксис: </span>
                    </p><pre class="programlisting">
UdfAccess = None | Full | { Restrict &lt;<em class="replaceable"><code>dir_1</code></em>&gt;[;&lt;<em class="replaceable"><code>dir_2</code></em>&gt;[...;&lt;<em class="replaceable"><code>dir_N</code></em>&gt;] }
                     </pre><p>
                </p><p>Параметр <em class="parameter"><code>UdfAccess</code></em> предназначен для определения директорий,
                в которых могут быть сохранены библиотеки UDF. Разрешение на доступ к библиотекам
                внешних функций может быть полным (Full), ограниченным (Restrict) или запрещённым
                (None).</p><p>Параметр <em class="parameter"><code>UdfAccess</code></em> имеет строковый тип; значение по
                умолчанию равно Restrict UDF — udf-библиотеки ищутся только в корневом каталоге
                сервера в папке <code class="filename">udf</code>. Для того, чтобы запретить использование
                udf, нужно выставить значение параметра равным None.</p><p>При указании каталогов могут быть использованы как абсолютные, так и относительные
                пути. Относительные пути берутся от корневого каталога сервера Firebird. В качестве
                разделителя директорий используется символ <span class="quote">«<span class="quote">;</span>»</span>.
                </p><pre class="programlisting">
UdfAccess = Restrict UDF           
                </pre><p>
            </p><div class="warning"><h3 class="title">Предупреждение</h3><p>Неконтролируемая возможность использования внешних функций может быть
                    использована для того, чтобы поставить под угрозу безопасность как баз данных,
                    так и всей системы. Поэтому настоятельно рекомендуется использовать данный
                    параметр для ограничения директорий размещения udf-библиотек.</p></div><div class="note"><h3 class="title">Примечание</h3><p>Этот параметр никак не влияет на правила размещения нового типа внешних
                    библиотек UDR.</p></div></section><section class="section" id="config-param-TempDirectories"><div class="titlepage"><div><div><h3 class="title">TempDirectories</h3></div></div></div><a id="d0e2382" class="indexterm"/><p><span class="formalpara-title">Область действия: </span>Per-server.</p><p><span class="formalpara-title">Тип параметра: </span>String (специальный формат).</p><p>С помощью параметра <em class="parameter"><code>TempDirectories</code></em> можно задать временный
                каталог сервера Firebird. Временный каталог необходим для выгрузки данных во время
                сортировки (и в некоторых других случаях), когда исчерпывается выделенная
                оперативная память.</p><p>Параметр <em class="parameter"><code>TempDirectories</code></em> имеет строковый тип; значение по
                умолчанию равно пустой строке. Если параметр <em class="parameter"><code>TempDirectories</code></em>
                не активен, то путь к временному каталогу определяется исходя из значения переменных
                окружения <code class="envar">FIREBIRD_TMP</code>, <code class="envar">TEMP</code>, <code class="envar">TMP</code>. Если
                никакая из вышеперечисленных переменных не задана, то значением для POSIX будет
                каталог <code class="filename">/tmp</code>, а для Windows —
                <code class="filename">C:\TEMP</code>.</p><p>В качестве значения параметра может быть задан путь к одному или нескольким
                каталогам. В этом случае выгрузка временных данных при сортировке будет
                осуществляться в указанные каталоги. Для папок допускаются как абсолютные, так и
                относительные пути. Относительные пути берутся от корневого каталога инсталляции
                сервера Firebird. Если требуется определить несколько временных каталогов, то в
                качестве разделителя используется символ <span class="quote">«<span class="quote">;</span>»</span>.</p><p>Если указана одна или несколько директорий, то выгрузка временных данных при
                сортировке будет осуществляться в указанные каталоги по очереди (если в текущей
                временной директории не осталось места, то временные файлы будут сохраняться в
                следующую по списку).</p><div class="example" id="d0e2432"><div class="example-title">Пример 4.8. Примеры задания значения параметра TempDirectories</div><div class="example-contents"><p>
                    </p><pre class="programlisting">
TempDirectories = c:\temp
TempDirectories = c:\temp;d:\temp            
                </pre><p>
                </p></div></div><br class="example-break"/><p>Количество ресурсов, выделяемых под <em class="parameter"><code>TempDirectories</code></em>,
                следует увеличивать, если планируется восстановление базы (restore), имеющей большие
                индексы. Иначе могут возникнуть проблемы с нехваткой места для
                    <code class="filename">fb_sort*</code> файлов, создаваемых СУБД в процессе построения
                индексов (СУБД не будет запрашивать у операционной системы новое место в этом
                случае).</p><div class="note"><h3 class="title">Замечания</h3><div class="itemizedlist"><ul style="list-style-type: disc; " class="itemizedlist"><li class="listitem"><p>Данные GTT (глобальных временных таблиц) хранятся в файлах с маской
                                <code class="filename">fb_table*</code>, создаваемых в каталогах, заданных
                            переменными <code class="envar">FIREBIRD_TMP</code> (затем — <code class="envar">TMP</code>; при
                            отсутствии их обоих GTT-данные будут сохраняться — для POSIX — в
                            каталоге <code class="filename">/tmp</code>). СУБД при определении места, где
                            надо хранить GTT-данные, не учитывает значение параметра
                                <em class="parameter"><code>TempDirectories</code></em>. Поэтому правильным методом
                            является назначение переменной <code class="envar">FIREBIRD_TMP</code> того же
                            каталога, что указан в <em class="parameter"><code>TempDirectories</code></em>.</p></li><li class="listitem"><p>В POSIX временные файлы, создаваемые СУБД
                                (<code class="filename">fb_table*</code>, <code class="filename">fb_sort*</code>,
                                <code class="filename">fb_recbuf*</code>, <code class="filename">fb_blob*</code>,
                                <code class="filename">fb_merge*</code>), сразу маркируются как
                                <span class="quote">«<span class="quote">deleted</span>»</span> и не видны при обычном просмотре каталога.
                            Для получения их списка воспользуйтесь, например, пакетом
                                <span class="application">lsof</span> с указанием в качестве аргумента PID
                            процесса Firebird (если он работает как SuperServer или
                            SuperClassic).</p></li><li class="listitem"><p>В следующем примере процесс firebird имеет PID = 9447, и для получения
                            открытых им временных файлов следует ввести команду:</p><pre class="synopsis">
#lsof -p 9447 | grep "/fb_table\|/fb_sort\|/fb_recbuf\|/fb_blob\|/fb_merge"                            
                        </pre><p>Пример вывода:</p><pre class="screen">
firebird 9447 firebird  296u REG  253,0    147456  2490547 /tmp/fb_table_5aNN2s 
  (deleted)
firebird 9447 firebird 1503u REG  253,0    147456  2490573 /tmp/fb_table_0Jwjo3 
  (deleted)
firebird 9447 firebird  623u REG   0,16  75497472 25189649 /tmp/fb_sort_kv21Av 
  (deleted)
firebird 9447 firebird  296u REG  253,0    147456  2490547 /tmp/fb_table_5aNN2s 
  (deleted)
                        </pre></li><li class="listitem"><p>В Windows временные файлы видны, но их равен нулю до тех пор, пока
                            остается свободная память, заданные параметром
                                <em class="parameter"><code>TempCacheLimit</code></em>.</p></li></ul></div></div></section><section class="section" id="config-param-AuditTraceConfigFile"><div class="titlepage"><div><div><h3 class="title">AuditTraceConfigFile</h3></div></div></div><a id="d0e2518" class="indexterm"/><p><span class="formalpara-title">Область действия: </span>Per-server.</p><p><span class="formalpara-title">Тип параметра: </span>String.</p><p>Параметр <em class="parameter"><code>AuditTraceConfigFile</code></em> в файле конфигурации
                    <code class="filename">firebird.conf</code> задает имя и расположение файла с настройками
                системного аудита. Этот параметр имеет строковый тип и по умолчанию имеет пустое
                значение. Пустое значение параметра означает, что системный аудит выключен.</p><p>Указанный файл конфигурации должен иметь ту же структуру, что и
                    <code class="filename">fbtrace.conf</code>.</p><div class="example" id="d0e2546"><div class="example-title">Пример 4.9. Примеры задания значения параметра AuditTraceConfigFile</div><div class="example-contents"><p>
                    </p><pre class="programlisting">
AuditTraceConfigFile = fbtrace.conf         
                </pre><p>
                </p></div></div><br class="example-break"/></section><section class="section" id="config-param-MaxUserTraceLogSize"><div class="titlepage"><div><div><h3 class="title">MaxUserTraceLogSize</h3></div></div></div><a id="d0e2557" class="indexterm"/><p><span class="formalpara-title">Область действия: </span>Per-server.</p><p><span class="formalpara-title">Тип параметра: </span>Integer.</p><p>Задает максимальный суммарный размер (в мегабайтах) временных файлов, создаваемых
                сессией пользовательской трассировки. После прочтения временного файла приложением
                он автоматически удаляется. Параметр имеет целочисленный тип. Единица измерения —
                мегабайты. По умолчанию максимальный размер файла вывода ограничен 10 МБ. Если
                значения ограничения <em class="parameter"><code>MaxUserTraceLogSize</code></em> достигнуто, то
                сервер автоматически приостанавливает сессию слежения.</p><div class="example" id="d0e2577"><div class="example-title">Пример 4.10. Примеры задания значения параметра MaxUserTraceLogSize</div><div class="example-contents"><p>
                    </p><pre class="programlisting">
MaxUserTraceLogSize = 10         
                </pre><p>
                </p></div></div><br class="example-break"/><div class="note"><h3 class="title">Примечание</h3><p>Количество пользовательских сессий трассировки, которые можно запускать на
                    одном сервере, ничем не ограничено. Указанный параметр лимитирует размер файлов
                    для каждой отдельной сессии трассировки, а не для всех сеансов. Поэтому общий
                    размер временных файлов может превышать 10 Мб.</p></div></section><section class="section" id="config-param-DefaultDbCachePages"><div class="titlepage"><div><div><h3 class="title">DefaultDbCachePages</h3></div></div></div><a id="d0e2591" class="indexterm"/><p><span class="formalpara-title">Область действия: </span>Per-database.</p><p><span class="formalpara-title">Тип параметра: </span>Integer.</p><p>Параметр <em class="parameter"><code>DefaultDbCachePages</code></em> используется для настройки
                количества страниц одной базы данных, находящихся в кеш-памяти одновременно.
                SuperServer использует единый страничный кеш (2048 страниц по умолчанию) для всех
                подключений. Classic и SuperClassic создает отдельный страничный кеш (по умолчанию
                256 страниц) для каждого соединения.</p><p>Параметр имеет целочисленный тип. Допустимо использовать множители (k, m, g).
                Максимальное значение 2147483647 страниц.</p><p>Этот параметр может быть установлен для каждой базы данных индивидуально в файле
                    <code class="filename">databases.conf</code>. Это особенно удобно если на вашем сервере
                находятся несколько разных баз данных под управлением одного экземпляра
                Firebird.</p><p>Размер страничного кеша может быть установлен на странице заголовков файла базы
                данных с помощью утилиты gfix.
                </p><pre class="programlisting">
gfix -b[uffers] <em class="replaceable"><code>&lt;page-count&gt;</code></em> <em class="replaceable"><code>&lt;database&gt;</code></em>                   
                </pre><p>
            </p><p>В этом случае размер страничного кеша устанавливается для каждой базы
                одновременно. На наш взгляд предпочтительно делать это в файле
                    <code class="filename">databases.conf</code>, где вы можете установить и другие параметры
                индивидуальные для вашей базы данных.</p><p>Обратите внимание, размер страничного кеша установленный на уровне заголовка базы
                данных перекрывает значение установленное в <code class="filename">firebird.conf</code> и
                    <code class="filename">databases.conf</code>.</p><div class="tip"><h3 class="title">Подсказка</h3><p>Чтобы проверить установлен ли размер страничного кеша на уровне заголовка базы
                    данных вы можете воспользоваться утилитой gstat </p><pre class="programlisting">
d:\fb\fb30&gt;gstat -u sysdba -p masterkey -h testdb               
                </pre><p>
                    </p><pre class="screen">
Database "d:\fb\fb30\data\testdb.fdb"
Gstat execution time Wed Jul 17 12:59:26 2019

Database header page information:
        Flags                   0
        Generation              2180
        System Change Number    0
        Page size               16384
        ODS version             12.0
        Oldest transaction      2037
        Oldest active           2038
        Oldest snapshot         2038
        Next transaction        2038
        Sequence number         0
        Next attachment ID      391
        Implementation          HW=AMD/Intel/x64 little-endian OS=Windows CC=MSV
C
        Shadow count            0
        Page buffers            0
        Next header page        0
        Database dialect        1
        Creation date           Jun 28, 2016 18:04:35
        Attributes              force write

    Variable header data:
        Sweep interval:         20000
        *END*
Gstat completion time Wed Jul 17 12:59:26 2019                     
                    </pre><p>
                </p><p>Page buffers — размер кэша базы данных. Если это значение равно 0, то будет
                    использоваться значние параметра <em class="parameter"><code>DefaultDbCachePages</code></em> в
                        <code class="filename">firebird.conf</code> или
                    <code class="filename">databases.conf</code>.</p></div><p>При изменении данного параметра стоит учитывать архитектуру сервера, максимальное
                количество соединений с базой данных (Classic, SuperClassic), количество доступной
                оперативной памяти, а также некоторые другие настройки сервера.</p><p>В архитектуре Classic количество страниц может управляться отдельным подключением
                (то есть оно само может сказать, сколько ему сейчас нужно страниц). Размер
                страничного кеша может быть увеличен только после рестарта Firebird (для архитектуры
                SuperServer) или переподключения (для Classic).</p><p>В архитектуре SuperServer (предоставляющей для всех подключений общий страничный
                кеш) рекомендуется назначать страничный кеш как можно большим, но также есть
                рекомендация не делать его размер более, чем половина от физического размера ОЗУ.
                Для очень больших БД достаточно выделить такой размер кеша, чтобы в него помещалась
                активная часть БД. Достаточность кеша обычно проверяют соотношением read/fetch.
                Хорошим соотношением для FB является <code class="code">read/fetch &lt; 0.005</code>.</p><div class="example" id="d0e2671"><div class="example-title">Пример 4.11. Установка параметра DefaultDbCachePages в firebird.conf</div><div class="example-contents"><p>
                    </p><pre class="programlisting">
DefaultDbCachePages = 2048   
                    </pre><p>
                </p></div></div><br class="example-break"/><div class="example" id="d0e2679"><div class="example-title">Пример 4.12. Установка параметра DefaultDbCachePages в databases.conf для базы данных
                    testdb</div><div class="example-contents"><p>
                    </p><pre class="programlisting">
testdb = d:\fb\fb30\data\testdb.fdb
{
    DefaultDbCachePages = 8K
}   
                    </pre><p>
                </p></div></div><br class="example-break"/><p>Кроме того, следует обращать внимание на значение параметра
                    <em class="parameter"><code>FileSystemCacheThreshold</code></em>. Если размер страничного кеша
                превышает значение параметра <em class="parameter"><code>FileSystemCacheThreshold</code></em>, то
                системный файловый кеш будет отключен. </p><p><span class="formalpara-title">Смотри также: </span><a class="link" href="#config-param-FileSystemCacheThreshold" title="FileSystemCacheThreshold">FileSystemCacheThreshold</a></p></section><section class="section" id="config-param-DatabaseGrowthIncrement"><div class="titlepage"><div><div><h3 class="title">DatabaseGrowthIncrement</h3></div></div></div><a id="d0e2704" class="indexterm"/><p><span class="formalpara-title">Область действия: </span>Per-database.</p><p><span class="formalpara-title">Тип параметра: </span>Integer.</p><p>Параметр позволяет указать объем дискового пространства, которое может быть
                предварительно выделено под базу данных. Дисковое пространство резервируется в
                системе, что позволяет в дальнейшем снизить физическую фрагментацию файла (-ов) базы
                данных и дает возможность продолжить работу в условиях недостатка места на диске.
                Если режим резервирования включен, то сервер резервирует 1/16 часть от уже
                используемого дискового пространства для одного соединения, но не меньше 128 KB и не
                больше, чем значение, заданное параметром
                    <em class="parameter"><code>DatabaseGrowthIncrement</code></em> (по умолчанию 128 MB).</p><p>Для отключения резервирования дискового пространства необходимо выставить значение
                    <em class="parameter"><code>DatabaseGrowthIncrement</code></em> равным 0.</p><div class="example" id="d0e2729"><div class="example-title">Пример 4.13. Установка параметра DatabaseGrowthIncrement</div><div class="example-contents"><p>
                    </p><pre class="programlisting">
DatabaseGrowthIncrement = 128M   
                    </pre><p>
                </p></div></div><br class="example-break"/><div class="note"><h3 class="title">Примечание</h3><p>Пространство под теневые копии баз данных не резервируется.</p></div></section><section class="section" id="config-param-FileSystemCacheThreshold"><div class="titlepage"><div><div><h3 class="title">FileSystemCacheThreshold</h3></div></div></div><a id="d0e2743" class="indexterm"/><p><span class="formalpara-title">Область действия: </span>Per-database.</p><p><span class="formalpara-title">Тип параметра: </span>Integer.</p><p>Параметр <em class="parameter"><code>FileSystemCacheThreshold</code></em> устанавливает порог
                использования системного файлового кэша сервером Firebird. Системный файловый кэш
                используется, если размер страничного кэша (установленного явно в заголовке базы
                данных или через параметр конфигурации <em class="parameter"><code>DefaultDbCachePages</code></em>)
                меньше чем значение <em class="parameter"><code>FileSystemCacheThreshold</code></em>.</p><p>Параметр имеет целочисленный тип. Единица измерения – страница базы данных. По
                умолчанию параметр имеет значение — 65536 страниц. Максимально допустимое значение
                параметра — 2147483647. Минимальное значение параметра — 0. Если значение параметра
                FileSystemCacheThreshold равно 0, то сервер не будет использовать системный файловый
                кэш. </p><div class="example" id="d0e2771"><div class="example-title">Пример 4.14. Установка параметра FileSystemCacheThreshold</div><div class="example-contents"><p>
                    </p><pre class="programlisting">
FileSystemCacheThreshold = 128K  
                    </pre><p>
                </p></div></div><br class="example-break"/><div class="note"><h3 class="title">Примечание</h3><p>Системный файловый кэш имеет смысл отключать только при достаточно большом
                    размере страничного кэша базы данных. Это позволяет избегать двойного
                    кэширования и снизить потребление оперативной памяти. Это может быть полезным
                    для баз, работающих в режиме read-only на архитектуре SuperServer. Для баз
                    данных, работающих в режиме OLTP-нагрузки, отказ от кеширования файловой
                    системой почти всегда приводит к крайне сильной просадке производительности.
                    Одна из причин — отсутствие в СУБД Firebird возможности упреждающего чтения и
                    отложенной записи, которые есть в операционной системе. Для таких баз всегда
                    должно соблюдаться правило: <code class="code">DefaultDbCachePages &lt;
                        FileSystemCacheThreshold</code>.</p></div><p><span class="formalpara-title">Смотри также: </span><a class="link" href="#config-param-DefaultDbCachePages" title="DefaultDbCachePages">DefaultDbCachePages</a></p></section><section class="section" id="config-param-FileSystemCacheSize"><div class="titlepage"><div><div><h3 class="title">FileSystemCacheSize</h3></div></div></div><a id="d0e2794" class="indexterm"/><p><span class="formalpara-title">Область действия: </span>Per-server.</p><p><span class="formalpara-title">Тип параметра: </span>Integer, измеряется в процентах от объёма доступной оперативной памяти.</p><p>Параметр <em class="parameter"><code>FileSystemCacheSize</code></em> устанавливает максимальный
                размер оперативной памяти, используемый системным файловым кешем 64-битными Windows
                XP или Windows Server 2003 с Service Pack 1 или выше. Этот параметр не оказывает
                никакого эффекта в Unix-подобных операционных системах.</p><p>Параметр содержит целое число, представляющее собой количество (в процентах)
                оперативной памяти, которое может быть использовано под файловый кеш. Значение может
                быть от 10 до 95%.</p><p>Значение считывается при старте сервера и не может быть изменено. Требуется
                перезагрузка операционной системы для вступления изменений в силу. </p><p>Если задать значение 0, операционная система сама будет определять размер
                файлового кеша (обычно это 30%). Это и есть значение по умолчанию. </p><div class="example" id="d0e2820"><div class="example-title">Пример 4.15. Установка параметра FileSystemCacheSize</div><div class="example-contents"><p>
                    </p><pre class="programlisting">
FileSystemCacheSize = 25  
                    </pre><p>
                </p></div></div><br class="example-break"/><div class="note"><h3 class="title">Примечание</h3><p>Windows требует обладания привилегией SeIncreaseQuotaPrivilege для управления
                    настройками файлового кеша. Эта привилегия доступна по умолчанию администраторам
                    и службам, а также выдается учетной записи Firebird при установке из
                    дистрибутива Windows Installer.</p><p>Если Firebird запущен как приложение или в режиме Embedded или установлен не
                    из официального дистрибутива, учетная запись может не иметь данной привилегии.
                    Процесс не выдаст ошибку при запуске, а просто запишет соответствующее сообщение
                    в файл <code class="filename">firebird.log</code> и будет работать с настройками
                    операционной системы.</p></div></section><section class="section" id="config-param-RemoteFileOpenAbility"><div class="titlepage"><div><div><h3 class="title">RemoteFileOpenAbility</h3></div></div></div><a id="d0e2839" class="indexterm"/><p><span class="formalpara-title">Область действия: </span>Per-server.</p><p><span class="formalpara-title">Тип параметра: </span>Boolean.</p><p>Параметр <em class="parameter"><code>RemoteFileOpenAbility</code></em> отключает защиту от открытия
                баз данных на смонтированных томах NFS в Linux/Unix и SMB/CIFS в Windows.</p><div class="warning"><h3 class="title">Предупреждение</h3><p>Эта опция удаляет важную функцию безопасности Firebird и может привести к
                    неисправимому повреждению базы данных. Не используйте эту опцию, если вы не
                    понимаете риски и не готовы принять потерю содержимого вашей базы данных.</p></div><p>Параметр имеет логический тип. По умолчанию его значение равно 0. В этом случае
                Firebird может открыть базу данных, только если она хранится на диске, физически
                подключенном к локальному компьютеру, на котором установлена ​​эта копия Firebird.
                Запросы на подключение к базам данных, хранящимся на смонтированных дисках NFS,
                перенаправляются на сервер Firebird, работающий на компьютере, который
                    <span class="quote">«<span class="quote">владеет</span>»</span> диском.</p><div class="example" id="d0e2867"><div class="example-title">Пример 4.16. Установка параметра RemoteFileOpenAbility</div><div class="example-contents"><p>
                    </p><pre class="programlisting">
RemoteFileOpenAbility = 0  
                    </pre><p>
                </p></div></div><br class="example-break"/><p>Это ограничение не позволяет двум разным копиям Firebird открывать одну и ту же
                базу данных без координации их действий. Несогласованный доступ нескольких копий
                Firebird приведет к повреждению базы данных. В локальной системе блокировка файлов
                на уровне системы предотвращает несогласованный доступ к файлу базы данных.</p><p>NFS не обеспечивает надежный способ обнаружения доступа нескольких пользователей к
                файлу на смонтированном диске NFS. Если вторая копия Firebird подключится к базе
                данных на смонтированном диске NFS, она повредит базу данных. В некоторых случаях
                запуск сервера Firebird на компьютере, который владеет томами, смонтированными в
                NFS, неудобен или невозможен. Приложения, которые используют embedded вариант
                Firebird и никогда не разделяющие доступ к базе данных, могут использовать эту
                опцию, чтобы разрешить прямой доступ к базам данных на смонтированных томах
                NFS.</p><p>Ситуация для SMB / CIFS очень похожа на NFS, поскольку не все конфигурации
                предоставляют механизмы блокировки файлов, необходимые для безопасной работы.
                Использование механизма SuperServer с базой данных на файловом сервере NT может
                считаться относительно безопасным, поскольку блокировка файлов защищает базу данных
                от использования несколькими механизмами. Сетевой стек по-прежнему может изменять
                порядок записи, поэтому вы можете получить поврежденную базу данных в случае сетевых
                ошибок или отключения питания. </p><p>Относительно полезный и безопасный случай — это работа с общей базой данных,
                помеченной только для чтения. </p></section><section class="section" id="config-param-TempBlockSize"><div class="titlepage"><div><div><h3 class="title">TempBlockSize</h3></div></div></div><a id="d0e2886" class="indexterm"/><p><span class="formalpara-title">Область действия: </span>Per-server.</p><p><span class="formalpara-title">Тип параметра: </span>Integer.</p><p>Параметр <em class="parameter"><code>TempBlockSize</code></em> используется для управления
                временным пространством. Временное хранилище используются большими сортировками, или
                для промежуточного хранения набора данных. Параметр
                    <em class="parameter"><code>TempBlockSize</code></em> определяет размер блока, выделяемого для
                временного хранилища. Это значение отражает гранулярность выделения
                пространства.</p><p>Параметр имеет целочисленный тип. Единица измерения — байты. По умолчанию параметр
                имеет значение 1 Мбайт. Максимально допустимое значение 2 Гбайт. Минимальное
                значение параметра — 0.</p><div class="example" id="d0e2911"><div class="example-title">Пример 4.17. Установка параметра TempBlockSize</div><div class="example-contents"><p>
                    </p><pre class="programlisting">
TempBlockSize = 2M  
                    </pre><p>
                </p></div></div><br class="example-break"/><p>Оптимальное значение этого параметра (хотя и трудно определяемое) — средний размер
                памяти, отводимой на операцию сортировки.</p><p>Предельный размер всей области оперативной памяти, выделяемой для временных
                файлов, задается параметром <em class="parameter"><code>TempCacheLimit</code></em>. Блоки, которые
                ранее выделялись, хранится в нём как линейный список, поиск в котором выполняется
                методом половинного деления (бисекции). Если <em class="parameter"><code>TempCacheLimit</code></em>
                задан слишком большого размера, например, 16 Гб, то даже при его заполненности на
                50% (т.е. 8Гб) для поиска блока размером 1 Мб потребуется 13 шагов. В этом случае
                лучше увеличить размер <em class="parameter"><code>TempBlockSize</code></em> до 3-4М, что приведет к
                уменьшению числа шагов бисекции до 6-8. В то же время, рекомендуется ставить
                    <em class="parameter"><code>TempBlockSize</code></em> в значение, НЕ превышающее 5% от
                    <em class="parameter"><code>TempCacheLimit</code></em>, а также оно должно быть НЕ меньше 1
                Мб.</p><p><span class="formalpara-title">Смотри также: </span><a class="link" href="#config-param-TempCacheLimit" title="TempCacheLimit">TempCacheLimit</a></p></section><section class="section" id="config-param-TempCacheLimit"><div class="titlepage"><div><div><h3 class="title">TempCacheLimit</h3></div></div></div><a id="d0e2947" class="indexterm"/><p><span class="formalpara-title">Область действия: </span>Per-server.</p><p><span class="formalpara-title">Тип параметра: </span>Int64.</p><p>Параметр <em class="parameter"><code>TempCacheLimit</code></em> определяет максимальный объём
                оперативной памяти, который используется для кэширования временного
                пространства.</p><p>Параметр имеет целочисленный тип. Единица измерения — байты. Минимальное значение
                равно 0, максимальное — (2<sup>64</sup> - 1) байт. Значение по
                умолчанию для классического сервера равно 8 Мбайт, для архитектур SuperClassic и
                SuperServer — 64 Мбайт.</p><div class="important"><h3 class="title">Важно</h3><p>Для классического сервера это ограничение распространяется для каждого
                    соединения с базой данных, для SuperServer и SuperClassic — для каждого
                    запущенного экземпляра сервера Firebird.</p></div><div class="example" id="d0e2975"><div class="example-title">Пример 4.18. Установка параметра TempCacheLimit</div><div class="example-contents"><p>
                    </p><pre class="programlisting">
TempCacheLimit = 256M  
                    </pre><p>
                </p></div></div><br class="example-break"/><div class="note"><h3 class="title">Примечание</h3><div class="itemizedlist"><ul style="list-style-type: disc; " class="itemizedlist"><li class="listitem"><p>Firebird 3.0 и выше позволяет указывать значения этого параметра
                            больше, чем 4 Гб.</p></li><li class="listitem"><p>Когда какому-то соединению память перестает быть нужной, она
                            возвращается операционной системе. Другими словами, задание
                                <code class="code">TempCacheLimit = 4096M</code> не означает, что 4 Гб памяти
                            будут сразу и безвозвратно зарезервированы процессом Firebird.</p></li><li class="listitem"><p>Увеличение <em class="parameter"><code>TempCacheLimit</code></em> даёт лучший эффект
                            чем назначение для временных файлов каталога на tmpfs (см. параметр
                                <em class="parameter"><code>TempDirectories</code></em>), так как при этом не
                            возникает дополнительных расходов на обмен данными с ядром операционной
                            системы.</p></li><li class="listitem"><p>Значение <em class="parameter"><code>TempCacheLimit</code></em> гарантирует, что данные
                            этого размера будут находиться в оперативной памяти. Когда память,
                            отведенная для временного хранения данных, будет исчерпана, очередной
                            запрос от Firebird на получение блока размером
                                <em class="parameter"><code>TempBlockSize</code></em> байт приведет к тому, что новая
                            память может быть уже выделена на диске в swap-области.</p></li><li class="listitem"><p>В Firebird 3.0 в области <em class="parameter"><code>TempCacheLimit</code></em>
                            размещаются данные при выполнении hash-соединений.</p></li></ul></div></div><div class="warning"><h3 class="title">Предупреждение</h3><p>Будьте осторожны с назначением этого параметра при работе СУБД в режиме
                    Classic Server. Общий лимит памяти, которую Firebird будет запрашивать у
                    операционной системы для временных файлов, определяется при этом как результат
                    умножения <em class="parameter"><code>TempCacheLimit</code></em> на количество
                    подключений.</p></div><p><span class="formalpara-title">Смотри также: </span><a class="link" href="#config-param-TempBlockSize" title="TempBlockSize">TempBlockSize</a></p></section><section class="section" id="config-param-Auth"><div class="titlepage"><div><div><h3 class="title">AuthServer и AuthClient</h3></div></div></div><a id="d0e3033" class="indexterm"/><a id="d0e3038" class="indexterm"/><p><span class="formalpara-title">Область действия: </span>Per-database.</p><p><span class="formalpara-title">Тип параметра: </span>String.</p><p>Параметр <em class="parameter"><code>AuthServer</code></em> — набор методов аутентификации,
                разрешенных на сервере (определяется в файле конфигурации сервера).</p><p>Параметр <em class="parameter"><code>AuthClient</code></em> — набор методов аутентификации,
                поддерживаемых клиентом (определяется в файле конфигурации на клиенте).</p><p>Включенные методы перечислены в виде строковых символов, разделенных запятыми,
                точками с запятой или пробелами. Если проверить подлинность с помощью первого метода
                не удалось, то сервер переходит к следующему и т.д. Если ни один метод не подтвердил
                подлинность, то пользователь получает сообщение об ошибке.</p><p>Firebird поддерживает следующие методы аутентификации:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Безопасная парольная аутентификация (Srp). Протокол SRP (Secure Remote
                            Password) позволяет пользователю, не передавая своего пароля,
                            подтвердить серверу тот факт, что он знает свой пароль;</p></li><li class="listitem"><p>Традиционная (Legacy_Auth) аутентификация, использовалась в качестве
                            основного метода аутентификации в Firebird версии 2.5 и ниже;</p></li><li class="listitem"><p>Доверительная (Win_Sspi) аутентификация для ОС Windows.</p></li></ul></div><p>По умолчанию на стороне сервера используется метод Secure remote passwords
                (Srp256), представленный соответствующей ОС плагином (libSrp.so | Srp.dll |
                Srp.dylib).
                </p><pre class="programlisting">
AuthServer = Srp256            
            </pre><p>
            </p><div class="note"><h3 class="title">Примечание</h3><p>Первоначально Firebird 3.0 использовал по умолчанию плагин Srp, который
                    использовал SHA-1 для генерации ключа шифрования, начиная с Firebird 3.0.4
                    введён усовершенствованный метод аутентификации Srp256, который использует
                    SHA-256.</p></div><p>Список AuthServer по умолчанию содержит только один элемент (Srp). Это значит, что
                к такому серверу возможно подключение только тех приложений, которые используют
                клиента версии 3 и старше. Если ваш сервер должен принимать подключения от клиентов
                версий до 2.5 включительно, необходимо добавить в этот список элемент
                Legacy_Auth.</p><div class="note"><h3 class="title">Примечание</h3><p>Традиционная (Legacy_Auth) не умеет работать с новым менеджером пользователей
                    Srp. Поэтому если вы хотите соединяться с Firebird 3.0 клиентами fbclient
                    версией 2.5 и ниже, то необходимо также включить в список плагинов управления
                    пользователями (параметр UserManager) плагин Legacy_UserManager.</p></div><p>Если вы хотите использовать плагины аутентификации, которые не предоставляют ключа
                шифрования (Win_Sspi, Legacy_Auth), то следует отключить обязательное (Required)
                шифрование каналов передачи данных (параметр <em class="parameter"><code>WireCrypt</code></em>),
                кроме случаев, когда вы работаете с протоколом XNET, который никогда не использует
                шифрование.</p><p>На клиентской стороне по умолчанию используется следующий список методов
                аутентификации:
                </p><pre class="programlisting">
AuthClient = Srp256, Srp, Win_Sspi, Legacy_Auth  # для Windows клиентов     
AuthClient = Srp256, Srp, Legacy_Auth            # для не Windows клиентов 
            </pre><p>
            </p><p>Под клиентом следует понимать как обычное подключение от пользователя, так и
                запрос от сервера-1, к которому ранее уже было подключение, к серверу-2, через
                механизм external datasource. В этом случае клиентом выступает сервер-1.</p><p>Плагин Legacy_Auth присутствует в списке AuthClient по умолчанию для того, чтобы к
                клиенты версии 3.0 и выше могли подключаться к серверам более старых версий. </p><p>Чтобы отключить какой-нибудь из методов, раскомментируйте строку и удалите
                нежелательный метод из списка.</p><div class="tip"><h3 class="title">Подсказка</h3><p>Поскольку плагины аутентификации пробуются в порядке их перечисления, то для
                    наилучшей производительности переместите наиболее часто используемый метод
                    аутентификации на первое место.</p></div><p>Оба параметра могут быть использованы в <code class="filename">databases.conf</code>. Они
                могут использоваться как в DPB, так и в SPB для конкретных настроек
                соединения.</p><p><span class="formalpara-title">Смотри также: </span><a class="link" href="#config-param-UserManager" title="UserManager">UserManager</a>, <a class="link" href="#config-param-WireCrypt" title="WireCrypt">WireCrypt</a>.</p></section><section class="section" id="config-param-UserManager"><div class="titlepage"><div><div><h3 class="title">UserManager</h3></div></div></div><a id="d0e3127" class="indexterm"/><p><span class="formalpara-title">Область действия: </span>Per-database.</p><p><span class="formalpara-title">Тип параметра: </span>String.</p><p>Устанавливает плагин, который будет работать в базе данных безопасности. Это может
                быть список с пробелами, запятыми или точками с запятой в качестве разделителей.
                По-умолчанию используется первый подключаемый плагин из списка. Firebird
                поддерживает следующие плагины управления пользователями: </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Srp;</p></li><li class="listitem"><p>Legacy_UserManager.</p></li></ul></div><p>Для поддержки старой базы данных безопасности и управления пользователями в ней,
                следует установить значение параметра Legacy_UserManager.</p><div class="example" id="d0e3153"><div class="example-title">Пример 4.19. Установка параметра UserManager</div><div class="example-contents"><p>
                    </p><pre class="programlisting">
UserManager = Srp  
                    </pre><p>
                </p></div></div><br class="example-break"/><p>В SQL операторах управления пользователями можно явно указать какой плагин будет
                использоваться с помощью ключевого слова USING.</p><div class="note"><h3 class="title">Примечание</h3><p>Одноименные пользователи, созданные с помощью разных плагинов управления
                    пользователями — это разные пользователи.</p></div><p>Параметр <em class="parameter"><code>UserManager</code></em> можно использовать в
                    <code class="filename">database.conf</code> для переопределения в конкретной базе
                данных.</p></section><section class="section" id="config-param-TracePlugin"><div class="titlepage"><div><div><h3 class="title">TracePlugin</h3></div></div></div><a id="d0e3177" class="indexterm"/><p><span class="formalpara-title">Область действия: </span>Per-server.</p><p><span class="formalpara-title">Тип параметра: </span>String.</p><p>Задает плагин, используемый функцией трассировки Firebird для отправки данных
                трассировки в приложение клиента или данных аудита в лог файл.</p><div class="example" id="d0e3194"><div class="example-title">Пример 4.20. Установка параметра TracePlugin</div><div class="example-contents"><p>
                    </p><pre class="programlisting">
TracePlugin = fbtrace  
                    </pre><p>
                </p></div></div><br class="example-break"/></section><section class="section" id="config-param-WireCryptPlugin"><div class="titlepage"><div><div><h3 class="title">WireCryptPlugin</h3></div></div></div><a id="d0e3205" class="indexterm"/><p><span class="formalpara-title">Область действия: </span>Per-connection.</p><p><span class="formalpara-title">Тип параметра: </span>String.</p><p>Плагин поточного шифра используется для шифрования и дешифрования данных,
                передаваемых по сети. </p><p>По-умолчанию устанавливается значение параметра Arc4, что означает использование
                плагина потокового шифра Alleged RC4. Сконфигурированный плагин, который требует
                ключ, сгенерированный настроенным подключаемым модулем аутентификации, может быть
                переопределен в API для конкретного соединения через DPB или SPB.</p><div class="example" id="d0e3224"><div class="example-title">Пример 4.21. Установка параметра WireCryptPlugin</div><div class="example-contents"><p>
                    </p><pre class="programlisting">
WireCryptPlugin = Arc4  
                    </pre><p>
                </p></div></div><br class="example-break"/><p><span class="formalpara-title">Смотри также: </span><a class="link" href="#config-param-WireCrypt" title="WireCrypt">WireCrypt</a>.</p></section><section class="section" id="config-param-KeyHolderPlugin"><div class="titlepage"><div><div><h3 class="title">KeyHolderPlugin</h3></div></div></div><a id="d0e3242" class="indexterm"/><p><span class="formalpara-title">Область действия: </span>Per-server.</p><p><span class="formalpara-title">Тип параметра: </span>String.</p><p>Этот параметр представляет собой некоторую форму временного хранилища для ключей
                шифрования базы данных.</p><p>Реализованного плагина по-умолчанию нет, но пример для Linux под названием
                    <code class="filename">libCryptKeyHolder_example.so</code> можно найти в папке
                    <code class="filename">/plugins/</code>.</p></section><section class="section" id="config-param-AllowEncryptedSecurityDatabase"><div class="titlepage"><div><div><h3 class="title">AllowEncryptedSecurityDatabase</h3></div></div></div><a id="d0e3270" class="indexterm"/><p><span class="formalpara-title">Область действия: </span>Per-database.</p><p><span class="formalpara-title">Тип параметра: </span>Boolean.</p><p>Задает возможность использования зашифрованной базы данных с учетными записями
                пользователей и паролями.</p><p>Передача по зашифрованному сетевому каналу с ключем шифрования, который создается
                плагином аутентификации (Srp) для передачи далее по сети ключа шифрования БД, может
                рассматриваться как замкнутый круг. Чтобы послать ключ шифрования БД по сети
                безопасным способом, передаваемые части ключа уже должны быть зашифрованными. Но это
                требует наличия ключа шифрования от плагина аутентификации, которому нужно открыть
                базу безопасности для валидации хеша от пароля, а это, в свою очередь, требует ключа
                шифрования БД.</p><p>К счастью, в большинстве случаев нет необходимости шифровать базу данных
                безопасности — она ​​достаточно хорошо защищает себя, если вы используете пароли
                надлежащего качества. Но в некоторых случаях желательно иметь зашифрованную базу
                безопасности, например, если нужно, чтобы зашифрованная база с пользовательскими
                данными, также служила базой безопасности. В этом случае особое внимание следует
                уделить шифрованию ключа перед передачей его на сервер с помощью обратного
                вызова.</p><p>Убедитесь, что ваши ключи хорошо зашифрованы перед тем, как разрешать шифрование
                базы безопасности. Примите по внимание, что при AllowEncryptedSecurityDatabase=TRUE
                возможна передача ключа, который не зашифрован протоколом Firebird, даже при не
                зашифрованной базе безопасности.</p><p>Указанное свойство не поддерживается унаследованным (Legacy) плагином проверки
                пользователей. Если вам нужна безопасность, пожалуйста, никогда не используйте
                унаследованную аутентификацию.</p><div class="warning"><h3 class="title">Предупреждение</h3><p>Eбедитесь в том, что понимаете свои действия, прежде чем менять этот параметр
                    на True.</p></div></section><section class="section" id="config-param-Providers"><div class="titlepage"><div><div><h3 class="title">Providers</h3></div></div></div><a id="d0e3301" class="indexterm"/><p><span class="formalpara-title">Область действия: </span>Per-database и per-connection.</p><p><span class="formalpara-title">Тип параметра: </span>String.</p><p>Провайдеры — это практически то, что мы подразумеваем под способами, используемыми
                для соединения клиента с сервером, т.е. через интернет; на том же компьютере через
                'localhost'; или через прямое соединение в локальной сети (старый
                    <code class="filename">libfbembed.so</code> для POSIX сейчас реализован как библиотека
                    <code class="filename">libEngine12.so</code>; для Windows —
                    <code class="filename">engine12.dll</code>; для MacOSX —
                    <code class="filename">engine12.dylib</code>).</p><p>В <code class="filename">firebird.conf</code> доступны по-умолчанию следующие провайдеры:
                </p><pre class="programlisting">
Providers = Remote,Engine12,Loopback            
            </pre><p>
            </p><p>В <code class="filename">databases.conf</code> один или несколько провайдеров могут быть
                заблокированы, если вставить и раскомментировать строку из
                    <code class="filename">firebird.conf</code> и удалить нежелательные провайдеры.</p><p>Архитектура провайдеров (известная как Open Systems Relational Interface, OSRI)
                очень эффективна для поддержки сочетания старых и новых форматов базы данных (с
                разными ODS) на одном сервере, имеющих смешанные подключения к локальным и удаленным
                базам данных.</p><p>Провайдеры реализованные в Firebird, позволяют поддерживать все эти режимы
                (удаленные соединения, базы данных с разными ODS), а также цепочки провайдеров.
                Цепочка — это термин для ситуации, когда провайдер использует обратный вызов
                стандартного API для выполнения операции над базой данных.</p><p>Главным элементом архитектуры провайдеров является <span class="bold"><strong>y-valve</strong></span>. На начальном этапе соединения с базой данных или её
                создания <span class="bold"><strong>y-valve</strong></span> просматривает список известных
                провайдеров и вызывает их по одному, пока один из них не завершит запрошенную
                операцию успешно. Для соединения, которое уже установлено, соответствующий провайдер
                вызывается сразу с почти нулевыми накладными расходами.</p><p>Рассмотрим пример работы <span class="bold"><strong>y-valve</strong></span>, когда он
                выбирает подходящего провайдера при подключении к базе данных. Конфигурация
                по-умолчанию содержит три провайдера:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><span class="bold"><strong>Remote</strong></span> (используется для сетевого
                            соединения);</p></li><li class="listitem"><p><span class="bold"><strong>Engine12</strong></span> (ядро для работы с ODS
                            12);</p></li><li class="listitem"><p><span class="bold"><strong>Loopback</strong></span> (принудительное соединение с
                            локальным сервером, когда задано только имя базы данных без явного
                            указания протокола).</p></li></ul></div><p>Типичная конфигурация клиента работает таким образом: при подключении к базе
                данных с именем RemoteHost:dbname (синтаксис TCP/IP) или \\RemoteHost\dbname
                (NetBios) или в URI-подобном синтаксисе с протоколами inet и wnet, провайдер Remote
                обнаруживает явный синтаксис сетевого протокола и перенаправляет вызов
                RemoteHost.</p><p>Когда <em class="replaceable"><code>&lt;database name&gt;</code></em> не содержит сетевого
                протокола, а только имя базы данных, провайдер Remote отклоняет его, а провайдер
                Engine12 выходит на первый план и пытается открыть файл с именованной базой данных.
                Если это проходит успешно, создается подключение к базе данных.</p><p>Но что происходит, если СУБД возвращает ошибку при попытке подключения к базе
                данных? </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Если файл базы данных, к которому нужно подключиться, не существует,
                            то это не интересно всем.</p></li><li class="listitem"><p>Встроенное соединение может не работать, если пользователь,
                            подключившийся к нему, не имеет достаточных прав для открытия файла базы
                            данных. Это было бы обычной ситуацией, если бы база данных не была
                            создана этим пользователем во встроенном режиме или если ему явно не
                            были предоставлены права ОС на встроенный доступ к базам данных.</p><div class="note"><h3 class="title">Примечание</h3><p>Это также может происходить, если выбран режим SuperServer и уже
                                существует соединение с базой данных, поскольку SuperServer требует
                                эксклюзивного доступа к файлу базы данных.</p></div></li><li class="listitem"><p>После отказа провайдера Engine12 в получении доступа к базе данных,
                            пытается подключиться провайдер Loopback. Он не очень отличается от
                            Remote, за исключением того, что он пытается получить доступ к
                            именованной базе данных <em class="replaceable"><code>&lt;dbname&gt;</code></em> на
                            сервере c сетевым интерфейсом <span class="quote">«<span class="quote">внутренней петли</span>»</span> (loopback)
                            в сетевом протоколе TCP/IP.</p><p>В Windows XNET пробуется первым, затем TCP/IP loopback
                                (localhost:<em class="replaceable"><code>&lt;dbname&gt;</code></em>), затем Named
                            Pipes (NetBEUI) loopback. Сервер может быть запущен с отключенным XNET
                            (или любым другим протоколом), поэтому перебираются все варианты. В
                            POSIX поддерживается только TCP/IP протокол, остальные варианты не
                            доступны.</p></li></ul></div><div class="note"><h3 class="title">Примечание</h3><p>Если вы хотите добиться поведения, аналогичного Firebird 2.5 и ниже, когда при
                    наличии запущенного сервера и указании в строке соединения только алиаса базы
                    данных или пути до неё, устанавливалось соединение по локальному проколу, то
                    необходимо поменять провайдеры Engine12 и Loopback местами.</p><p>Для подключения по локальному протоколу рекомендуем использовать URI-подобную
                    строку подключения с явным указанием префикса протокола
                        <code class="filename">xnet://</code>.</p></div><p>Провайдеры не ограничены тремя вышеперечисленными. Версия 3.0 не поддерживает pre-
                ODS 12 провайдер. Тем не менее, архитектура провайдеров делает возможным доступ к
                старым базам данных при переходе на более высокую версию Firebird.</p><div class="note"><h3 class="title">Примечание</h3><p>Firebird 4.0 для работы с ODS 13 реализован провайдер Engine13, тем не менее
                    вы можете работать с базой данных ODS 12, через провайдер Engine12 из Firebird
                    3.0.</p></div></section><section class="section" id="config-param-DeadlockTimeout"><div class="titlepage"><div><div><h3 class="title">DeadlockTimeout</h3></div></div></div><a id="d0e3428" class="indexterm"/><p><span class="formalpara-title">Область действия: </span>Per-database.</p><p><span class="formalpara-title">Тип параметра: </span>Integer.</p><p>Параметр <em class="parameter"><code>DeadlockTimeout</code></em> определяет количество секунд, в
                течение которых диспетчер блокировок будет ожидать после возникновения конфликта,
                прежде чем очистить блокировки от мертвых процессов и выполнить дополнительный цикл
                сканирования взаимоблокировок. Firebird обнаруживает взаимные блокировки мгновенно
                во всех обычных случаях, поэтому это значение влияет на ситуации, когда что-то идет
                не так. </p><p>Параметр имеет целочисленный тип. Единица измерения — секунды. Значение по
                умолчанию равно 10 секунд. Минимально допустимое значение параметра равно 0.
                Максимально допустимое значение равно 2147483647.</p><div class="example" id="d0e3450"><div class="example-title">Пример 4.22. Установка параметра DeadlockTimeout</div><div class="example-contents"><p>
                    </p><pre class="programlisting">
DeadlockTimeout = 10 
                    </pre><p>
                </p></div></div><br class="example-break"/><div class="warning"><h3 class="title">Предупреждение</h3><p>Слишком низкое значение может снизить производительность системы.</p></div></section><section class="section" id="config-param-MaxUnflushedWrites"><div class="titlepage"><div><div><h3 class="title">MaxUnflushedWrites</h3></div></div></div><a id="d0e3464" class="indexterm"/><p><span class="formalpara-title">Область действия: </span>Per-database.</p><p><span class="formalpara-title">Тип параметра: </span>Integer.</p><p>Параметр <em class="parameter"><code>MaxUnflushedWrites</code></em> определяет, как часто страницы
                из кэш памяти будут выгружаться на жесткий диск (активен только при значении
                параметра ForcedWrites=Off).</p><p>Значение параметра <em class="parameter"><code>MaxUnflushedWrites</code></em> определяет
                максимальное количество накопленных страниц не сброшенных на диск, ожидающих сброса
                при подтверждения транзакции.</p><p>Параметр имеет целочисленный тип и измеряется в страницах. Значение по умолчанию
                равно 100 страниц. Для не Win32 систем значение по умолчанию является -1(Отключено).
                Максимально допустимое значение равно 2147483647.</p><div class="example" id="d0e3491"><div class="example-title">Пример 4.23. Установка параметра MaxUnflushedWrites</div><div class="example-contents"><p>
                    </p><pre class="programlisting">
MaxUnflushedWrites = 100  
                    </pre><p>
                </p></div></div><br class="example-break"/><div class="warning"><h3 class="title">Предупреждение</h3><p>Чем больше значение параметра, тем выше вероятность потери данных при
                    возникновении аппаратного сбоя в системе.</p></div><p><span class="formalpara-title">Смотри также: </span><a class="link" href="#config-param-MaxUnflushedWriteTime" title="MaxUnflushedWriteTime">MaxUnflushedWriteTime</a></p></section><section class="section" id="config-param-MaxUnflushedWriteTime"><div class="titlepage"><div><div><h3 class="title">MaxUnflushedWriteTime</h3></div></div></div><a id="d0e3511" class="indexterm"/><p><span class="formalpara-title">Область действия: </span>Per-database.</p><p><span class="formalpara-title">Тип параметра: </span>Integer.</p><p>Параметр <em class="parameter"><code>MaxUnflushedWriteTime</code></em> определяет, как часто
                страницы из кэш памяти будут выгружаться на жесткий диск (активен только при
                значении параметра ForcedWrites=Off).</p><p>Значение параметра <em class="parameter"><code>MaxUnflushedWriteTime</code></em> определяет время,
                по истечении которого страницы данных, ожидающие сброса на диск при подтверждении
                транзакции, будут выгружены на диск.</p><p>Параметр имеет целочисленный тип и измеряется в секундах. Значение по умолчанию
                равно 5 секунд. Для не Win32 систем значение по умолчанию является -1(Отключено).
                Максимально допустимое значение равно 2147483647.</p><div class="example" id="d0e3538"><div class="example-title">Пример 4.24. Установка параметра MaxUnflushedWriteTime</div><div class="example-contents"><p>
                    </p><pre class="programlisting">
MaxUnflushedWriteTime = 5  
                    </pre><p>
                </p></div></div><br class="example-break"/><div class="warning"><h3 class="title">Предупреждение</h3><p>Чем больше значение параметра, тем выше вероятность потери данных при
                    возникновении аппаратного сбоя в системе.</p></div><p><span class="formalpara-title">Смотри также: </span><a class="link" href="#config-param-MaxUnflushedWrites" title="MaxUnflushedWrites">MaxUnflushedWrites</a></p></section><section class="section" id="config-param-BugcheckAbort"><div class="titlepage"><div><div><h3 class="title">BugcheckAbort</h3></div></div></div><a id="d0e3558" class="indexterm"/><p><span class="formalpara-title">Область действия: </span>Per-server.</p><p><span class="formalpara-title">Тип параметра: </span>Boolean.</p><p>Опция <em class="parameter"><code>BugcheckAbort</code></em> определяет, прерывать ли работу сервера
                при возникновении внутренней ошибки или снимать дамп ядра для последующего анализа.
                Если опция отключена, то ядро пытается минимизировать ущерб и продолжить
                работу.</p><p>Параметр имеет логический тип. Возможные значения 0 и 1. Значение по умолчанию
                равно 0, в этом случае механизм снятия дампов отключен. Для отладочных сборок
                (DEV_BUILD) значение по умолчанию равно 1.</p><div class="example" id="d0e3580"><div class="example-title">Пример 4.25. Установка параметра BugcheckAbort</div><div class="example-contents"><p>
                    </p><pre class="programlisting">
BugcheckAbort = 0  
                    </pre><p>
                </p></div></div><br class="example-break"/><div class="note"><h3 class="title">Примечание</h3><p>Обратите внимание, что установка этой опции в 1 заставляет движок производить
                    трассируемые дампы, когда внутри UDF происходит что-то неприятное, например
                    SIGSEGV. В Windows включение этой опции заставляет ядро вызывать средства
                    отладки JIT при возникновении ошибок.</p><p>В POSIX при <code class="code">BugCheckBort = 1</code> сервер Firebird будет устанавливать
                    soft-лимит для размера файлов равным hard-лимиту, и делать запись в каталог,
                    доступный для записи, как правило это <code class="filename">/tmp</code>.</p></div></section><section class="section" id="config-param-RelaxedAliasChecking"><div class="titlepage"><div><div><h3 class="title">RelaxedAliasChecking</h3></div></div></div><a id="d0e3602" class="indexterm"/><p><span class="formalpara-title">Область действия: </span>Per-server.</p><p><span class="formalpara-title">Тип параметра: </span>Boolean.</p><p>Параметр <em class="parameter"><code>RelaxedAliasChecking</code></em> позволяет снять ограничение
                на обязательное использование псевдонимов имен таблиц в запросах. Если опция
                включена, то Firebird позволяет выполнять подобные запросы:
                </p><pre class="programlisting">
SELECT MY_TABLE.X FROM MY_TABLE A
            </pre><p>
            </p><p>Параметр имеет логический тип. Значение по умолчанию равно 0. Если значение
                параметра равно 1, то ограничение на обязательное использование псевдонимов таблиц в
                запросах снимается.</p><div class="example" id="d0e3627"><div class="example-title">Пример 4.26. Установка параметра RelaxedAliasChecking</div><div class="example-contents"><p>
                    </p><pre class="programlisting">
RelaxedAliasChecking = 0  
                    </pre><p>
                </p></div></div><br class="example-break"/><p>Не рекомендуется включать этот параметр. Его следует рассматривать как временный
                обходной путь для портирования неаккуратного устаревшего кода до тех пор, пока не
                удастся пересмотреть такой код.</p><div class="caution"><h3 class="title">Внимание</h3><p>Нет никаких гарантий что данная установка будет доступна в следующих версиях
                    Firebird.</p></div><div class="example" id="d0e3640"><div class="example-title">Пример 4.27. Установка параметра RelaxedAliasChecking</div><div class="example-contents"><p>
                    </p><pre class="programlisting">
RelaxedAliasChecking = 0  
                    </pre><p>
                </p></div></div><br class="example-break"/></section><section class="section" id="config-param-ConnectionTimeout"><div class="titlepage"><div><div><h3 class="title">ConnectionTimeout</h3></div></div></div><a id="d0e3651" class="indexterm"/><p><span class="formalpara-title">Область действия: </span>Per-connection.</p><p><span class="formalpara-title">Тип параметра: </span>Integer.</p><p>С помощью параметра <em class="parameter"><code>ConnectionTimeout</code></em> устанавливается
                ограничение на время ожидания соединения. После того как порог, установленный
                значением параметра, будет превышен, попытка соединения будет признана
                неудачной.</p><p>Параметр <em class="parameter"><code>ConnectionTimeout</code></em> имеет целочисленный тип и
                измеряется в секундах. Значение по умолчанию равно 180 секунд. Минимальное значение
                равно 0. Максимально допустимое значение равно 2147483647.</p><div class="example" id="d0e3676"><div class="example-title">Пример 4.28. Установка параметра ConnectionTimeout</div><div class="example-contents"><p>
                    </p><pre class="programlisting">
ConnectionTimeout = 180  
                    </pre><p>
                </p></div></div><br class="example-break"/></section><section class="section" id="config-param-WireCrypt"><div class="titlepage"><div><div><h3 class="title">WireCrypt</h3></div></div></div><a id="d0e3687" class="indexterm"/><p><span class="formalpara-title">Область действия: </span>Per-connection.</p><p><span class="formalpara-title">Тип параметра: </span>String (предопределённые значения).</p><p>Параметр устанавливает, следует ли шифровать сетевое соединение. Он может
                принимать три возможных значения: <code class="literal">Required</code>,
                    <code class="literal">Enabled</code>, <code class="literal">Disabled</code>. По-умолчанию
                установлено, что шифрование является обязательным (<code class="literal">Required</code>) для
                подключений, поступающих на сервер и включенным (<code class="literal">Enabled</code>) для
                подключений, исходящих с клиента.</p><div class="example" id="d0e3719"><div class="example-title">Пример 4.29. Установка параметра WireCrypt</div><div class="example-contents"><p>
                    </p><pre class="programlisting">
WireCrypt = Enabled # для клиента  
                    </pre><p>
                    </p><pre class="programlisting">
WireCrypt = Required # для сервера 
                    </pre><p>
                </p></div></div><br class="example-break"/><p>Чтобы получить доступ к серверу с использованием традиционной
                    (<code class="literal">Legacy_Auth</code>) аутентификации, параметр
                    <em class="parameter"><code>WireCrypt</code></em> в файле конфигурации сервера должен быть
                включен (<code class="literal">Enabled</code>) или выключен
                (<code class="literal">Disabled</code>).</p><p>Правила очень просты: если на одной стороне стоит значение <code class="code">WireCrypt =
                    Required</code>, а на другой установлено значение <code class="literal">Disabled</code>,
                то первая сторона отклоняет соединение и оно не устанавливается. Если на одной
                стороне стоит значение <code class="code">WireCrypt = Enabled</code>, то на другой шифрования
                может и не быть вовсе.</p><p>Отсутствующий подключаемый модуль <em class="parameter"><code>WireCryptPlugin</code></em> или ключ
                шифрования в случаях, когда канал должен быть зашифрован, также препятствует
                соединению.</p><p>Во всех остальных случаях соединение устанавливается без шифрования, если хотя бы
                одна сторона имеет <code class="code">WireCrypt = Disabled</code>. В других случаях
                устанавливается шифрованное соединение. </p><div class="table" id="d0e3765"><div class="table-title">Таблица 4.2. Совместимость параметров WireCrypt на клиенте и на сервере</div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="c1"/><col class="c2"/><col class="c3"/><col class="c4"/></colgroup><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">Disabled</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">Enabled</td><td style="border-bottom: 1px solid ; ">Required</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">Disabled</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">Шифрование отключено</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">Шифрование отключено</td><td style="border-bottom: 1px solid ; ">Ошибка соединения</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">Enabled</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">Шифрование отключено</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">Шифрование включено, если плагин аутентификации предоставляет
                                    ключ шифрования. Иначе шифрования нет.</td><td style="border-bottom: 1px solid ; ">Шифрование включено, если плагин аутентификации предоставляет
                                    ключ шифрования. Иначе ошибка подключения.</td></tr><tr><td style="border-right: 1px solid ; ">Required</td><td style="border-right: 1px solid ; ">Ошибка соединения</td><td style="border-right: 1px solid ; ">Шифрование включено, если плагин аутентификации предоставляет
                                    ключ шифрования. Иначе ошибка подключения.</td><td>Шифрование включено, если плагин аутентификации предоставляет
                                    ключ шифрования. Иначе ошибка подключения.</td></tr></tbody></table></div></div><p><br class="table-break"/></p><p><span class="formalpara-title">Смотри также: </span><a class="link" href="#config-param-Auth" title="AuthServer и AuthClient">AuthServer и AuthClient</a>, <a class="link" href="#config-param-WireCryptPlugin" title="WireCryptPlugin">WireCryptPlugin</a>.</p></section><section class="section" id="config-param-WireCompression"><div class="titlepage"><div><div><h3 class="title">WireCompression</h3></div></div></div><a id="d0e3823" class="indexterm"/><p><span class="formalpara-title">Область действия: </span>Per-connection.</p><p><span class="formalpara-title">Тип параметра: </span>Boolean.</p><p>Параметр может быть задействован и в <code class="filename">firebird.conf</code> и в
                    <code class="filename">databases.conf</code>; он включает или отключает сжатие данных,
                передающихся по сети.</p><p>По-умолчанию сжатие отключено.</p><div class="example" id="d0e3848"><div class="example-title">Пример 4.30. Установка параметра WireCompression</div><div class="example-contents"><p>
                    </p><pre class="programlisting">
WireCompression = false  
                    </pre><p>
                </p></div></div><br class="example-break"/><p>Для правильной работы параметра требуется корректная настройка как на сервере, так
                и на клиенте:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Чтобы включить <em class="parameter"><code>WireCompression</code></em> на стороне
                            сервера, поставьте параметр в значение <code class="literal">true</code> в файле
                                <code class="filename">firebird.conf</code> или
                                <code class="filename">database.conf</code>.</p></li><li class="listitem"><p>Для того, чтобы активировать <em class="parameter"><code>WireCompression</code></em> на
                            стороне клиента, передайте соответствующий тег в вызов DPB и SPB:
                            </p><pre class="programlisting">
isc_dbp_config <em class="replaceable"><code>&lt;string-length&gt;</code></em> "WireCompression=true"
isc_sbp_config <em class="replaceable"><code>&lt;string-length&gt;</code></em> "WireCompression=true" 
                        </pre><p>
                        </p></li><li class="listitem"><p>Клиент и сервер должны использовать протокол &gt;= 13 (Firebird 3.0 и
                            старше).</p></li></ul></div></section><section class="section" id="config-param-DummyPacketInterval"><div class="titlepage"><div><div><h3 class="title">DummyPacketInterval</h3></div></div></div><a id="d0e3895" class="indexterm"/><p><span class="formalpara-title">Область действия: </span>Per-connection.</p><p><span class="formalpara-title">Тип параметра: </span>Integer.</p><p> Параметр <em class="parameter"><code>DummyPacketInterval</code></em> используется для того, чтобы
                установить число секунд ожидания в <span class="quote">«<span class="quote">тихом</span>»</span> режиме, прежде чем сервер
                начнет посылать пустые пакеты для подтверждения соединения.</p><p> Параметр имеет целочисленный тип и измеряется в секундах. Значение по умолчанию
                равно 0 секунд. Максимально допустимое значение равно 2147483647 секунд. </p><div class="warning"><h3 class="title">Предупреждение</h3><p>Эта опция может привести к зависанию или сбоям Windows NT4 или Windows 2000
                    pre SP3 на стороне клиента, как описано в <a class="link" href="https://support.microsoft.com/ru-ru/help/296265/windows-2000-non-paged-pool-is-exhausted-by-afd-sys" target="_top">296265</a>, или не может предотвратить возможное отключение неактивного
                    клиента для других ОС.</p></div><p>Обычно Firebird использует опцию сокета SO_KEEPALIVE, чтобы следить за активными
                подключениями по TCP/IP протоколу. Если вас не устраивает заданное по умолчанию
                2-часовое время ожидания (keepalive), то следует изменить параметры настройки своей
                операционной системы соответственно:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>в Unix-подобных ОС необходимо изменить содержимое
                                <code class="filename">/proc/sys/net/ipv4/tcp_keepalive_*</code>;</p></li><li class="listitem"><p>в Windows необходимо вносить изменения в ветку реестра
                                <code class="filename">HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters\</code>
                            ключи (KeepAliveTime, KeepAliveInterva,
                            TcpMaxDataRetransmissions).</p></li></ul></div><p>
            </p></section><section class="section" id="config-param-RemoteServicePort"><div class="titlepage"><div><div><h3 class="title">RemoteServicePort или RemoteServiceName</h3></div></div></div><a id="d0e3945" class="indexterm"/><a id="d0e3950" class="indexterm"/><p><span class="formalpara-title">Область действия: </span>Per-connection.</p><p><span class="formalpara-title">Тип параметра: </span>Integer или String.</p><p>Параметры <em class="parameter"><code>RemoteServiceName</code></em> и
                    <em class="parameter"><code>RemoteServicePort</code></em> используются для установки номера порта
                или имени сервиса, которые будут использоваться для клиентских соединений с базами
                данных.</p><p>Параметр <em class="parameter"><code>RemoteServiceName</code></em> имеет строковый тип. Значение по
                умолчанию равно <code class="literal">gds_db</code>.</p><p>Параметр <em class="parameter"><code>RemoteServicePort</code></em> имеет целочисленный тип.
                Значение по умолчанию равно <code class="literal">3050</code>.</p><div class="example" id="d0e3989"><div class="example-title">Пример 4.31. Установка параметра RemoteServiceName</div><div class="example-contents"><p>
                    </p><pre class="programlisting">
RemoteServiceName = gds_db 
                    </pre><p>
                </p></div></div><br class="example-break"/><div class="example" id="d0e3997"><div class="example-title">Пример 4.32. Установка параметра RemoteServicePort</div><div class="example-contents"><p>
                    </p><pre class="programlisting">
RemoteServicePort = 3050 
                    </pre><p>
                </p></div></div><br class="example-break"/><div class="important"><h3 class="title">Важно</h3><p>Изменять следует только один из этих параметров, не оба сразу. Сервер ищет
                    номер порта для клиентских соединений в следующем порядке — сначала
                        <em class="parameter"><code>RemoteServiceName</code></em> (соответствующая значению параметра
                    запись ищется в файле <code class="filename">services</code>), затем
                        <em class="parameter"><code>RemoteServicePort</code></em>.</p></div><div class="note"><h3 class="title">Примечание</h3><p>Обычно один из этих параметров (чаще всего
                        <em class="parameter"><code>RemoteServicePort</code></em>) меняют только на стороне севера в
                        <code class="filename">firebird.conf</code>, поскольку на клиентской стороне имя
                    сервиса или номер порта можно указать в строке подключения.</p></div></section><section class="section" id="config-param-RemoteAuxPort"><div class="titlepage"><div><div><h3 class="title">RemoteAuxPort</h3></div></div></div><a id="d0e4029" class="indexterm"/><p><span class="formalpara-title">Область действия: </span>Per-connection.</p><p><span class="formalpara-title">Тип параметра: </span>Integer.</p><p>Параметр <em class="parameter"><code>RemoteAuxPort</code></em> определяет номер TCP-порта, который
                будет использоваться для передачи уведомлений о событиях сервера.</p><p>Параметр <em class="parameter"><code>RemoteAuxPort</code></em> имеет целочисленный тип. Значение по
                умолчанию равно 0. В этом случае номер порта будет выбираться случайно.</p><div class="example" id="d0e4054"><div class="example-title">Пример 4.33. Установка параметра RemoteAuxPort</div><div class="example-contents"><p>
                    </p><pre class="programlisting">
RemoteAuxPort = 0 
                    </pre><p>
                </p></div></div><br class="example-break"/></section><section class="section" id="config-param-TcpRemoteBufferSize"><div class="titlepage"><div><div><h3 class="title">TcpRemoteBufferSize</h3></div></div></div><a id="d0e4065" class="indexterm"/><p><span class="formalpara-title">Область действия: </span>Per-connection.</p><p><span class="formalpara-title">Тип параметра: </span>Integer.</p><p>Параметр <em class="parameter"><code>TcpRemoteBufferSize</code></em> определяет размер TCP/IP
                буфера для обмена сообщениями между сервером и клиентом. Firebird может делать
                упреждающее чтение клиентом и может отправлять несколько строк за один сетевой
                пакет. Чем больше размер пакета, тем больше данных будет передаваться за одну
                передачу.</p><p>Параметр имеет целочисленный тип и измеряется в байтах. Значение по умолчанию
                равно 8192. Минимально допустимое значение равно 1448. Максимальное значение равно
                32767.</p><div class="example" id="d0e4087"><div class="example-title">Пример 4.34. Установка параметра TcpRemoteBufferSize</div><div class="example-contents"><p>
                    </p><pre class="programlisting">
TcpRemoteBufferSize = 8192 
                    </pre><p>
                </p></div></div><br class="example-break"/></section><section class="section" id="config-param-TcpNoNagle"><div class="titlepage"><div><div><h3 class="title">TcpNoNagle</h3></div></div></div><a id="d0e4098" class="indexterm"/><p><span class="formalpara-title">Область действия: </span>Per-connection.</p><p><span class="formalpara-title">Тип параметра: </span>Boolean.</p><p>Параметр <em class="parameter"><code>TcpNoNagle</code></em> включает или отключает использование
                Nagle алгоритма (опция TCP_NODELAY для сокета) в TCP/IP соединениях.</p><p>В Linux по умолчанию библиотека сокетов минимизирует количество физических записей
                путем буферизации записей перед фактической передачей данных. Для этого используется
                встроенный алгоритм, известный как Nagle's Algorithm. Он был разработан, для того,
                чтобы избежать проблем с маленькими пакетами в медленных сетях.</p><p>Параметр имеет логический тип. По умолчанию значение параметра равно 1 (истина). В
                этом случае буферизация не используется. На медленных сетях в Linux это позволяет
                увеличить скорость передачи.</p><div class="example" id="d0e4122"><div class="example-title">Пример 4.35. Установка параметра TcpNoNagle</div><div class="example-contents"><p>
                    </p><pre class="programlisting">
TcpNoNagle = 1 
                    </pre><p>
                </p></div></div><br class="example-break"/></section><section class="section" id="config-param-TcpLoopbackFastPath"><div class="titlepage"><div><div><h3 class="title">TcpLoopbackFastPath</h3></div></div></div><a id="d0e4133" class="indexterm"/><p><span class="formalpara-title">Тип параметра: </span>Boolean.</p><p>Параметр <em class="parameter"><code>TcpLoopbackFastPath</code></em> включает или отключает
                использование функции <span class="quote">«<span class="quote">TCP Loopback Fast Path</span>»</span>
                (SIO_LOOPBACK_FAST_PATH).</p><p>Применим только в Windows (версия 8/2012 и выше). Параметр доступен начиная с
                Firebird 3.0.5.</p><p>Параметр имеет логический тип. По умолчанию значение параметра равно 1
                (истина).</p><div class="example" id="d0e4155"><div class="example-title">Пример 4.36. Установка параметра TcpLoopbackFastPath</div><div class="example-contents"><p>
                    </p><pre class="programlisting">
TcpLoopbackFastPath = 1 
                    </pre><p>
                </p></div></div><br class="example-break"/></section><section class="section" id="config-param-IPv6V6Only"><div class="titlepage"><div><div><h3 class="title">IPv6V6Only</h3></div></div></div><a id="d0e4166" class="indexterm"/><p><span class="formalpara-title">Область действия: </span>Per-server.</p><p><span class="formalpara-title">Тип параметра: </span>Boolean.</p><p>Этот параметр можно устанавливать только в <code class="filename">firebird.conf</code>.
                Firebird поддерживает <span class="bold"><strong>IPv6</strong></span> подключение на стороне
                сервера и клиента. Параметр может принимать значения
                    <code class="literal">true</code>/<code class="literal">false</code>,
                    <code class="literal">1</code>/<code class="literal">0</code> или
                    <code class="literal">Yes</code>/<code class="literal">No</code>. Значение по умолчанию равно
                    <code class="literal">false</code>.</p><div class="note"><h3 class="title">Примечание</h3><p>В Windows эта опция поддерживается, начиная с Windows Vista, в более ранних
                    версиях значение параметра всегда равно <code class="literal">true</code>.</p></div><div class="example" id="d0e4216"><div class="example-title">Пример 4.37. Установка параметра IPv6V6Only</div><div class="example-contents"><p>
                    </p><pre class="programlisting">
IPv6V6Only = 0 
                    </pre><p>
                </p></div></div><br class="example-break"/><section class="simplesect" id="d0e4224"><div class="titlepage"><div><div><h4 class="title">Сервер</h4></div></div></div><p>По-умолчанию, сервер прослушивает пустой <span class="bold"><strong>IPv6</strong></span>
                    адрес (<code class="literal">::</code>) и принимает все входящие подключения, будь то
                        <span class="bold"><strong>IPv4</strong></span> или <span class="bold"><strong>IPv6</strong></span> (<code class="code">IPv6V6Only = false</code>). Если параметр установлен
                    в <code class="literal">true</code>, сервер, прослушивая явно или неявно пустой IPv6
                    адрес, принимает только IPv6 подключения.</p></section><section class="simplesect" id="d0e4247"><div class="titlepage"><div><div><h4 class="title">Клиент</h4></div></div></div><p>Адреса <span class="bold"><strong>IPv6</strong></span> отображаются как восемь
                    четырёхзначных шестнадцатеричных чисел (то есть групп по четыре символа),
                    разделённых двоеточием. В строке подключения необходимо заключать <span class="bold"><strong>IPv6</strong></span> адрес в квадратные скобки, чтобы разрешить
                    неоднозначность с использованием двоеточия в качестве разделителя между IP
                    адресом хоста и путем к базе данных. К примеру:
                    </p><pre class="programlisting">
connect '[2014:1234::5]:test';
connect '[2014:1234::5]/3049:/srv/firebird/test.fdb';                
                </pre><p>
                </p></section></section><section class="section" id="config-param-RemoteBindAddress"><div class="titlepage"><div><div><h3 class="title">RemoteBindAddress</h3></div></div></div><a id="d0e4264" class="indexterm"/><p><span class="formalpara-title">Область действия: </span>Per-server.</p><p><span class="formalpara-title">Тип параметра: </span>String.</p><p>Параметр <em class="parameter"><code>RemoteBindAddress</code></em> позволяет привязать входящие
                соединения к IP адресу определенной сетевой карты. При этом все входящие соединения
                через другие сетевые интерфейсы будут запрещены. По умолчанию подключения из любого
                доступного сетевого интерфейса разрешены. Если вы используете классический сервер,
                этот параметр предназначен только для Windows. В Linux, BSD или Mac OS X с сервером
                Classic используйте конфигурационный файл xinetd или launchd (параметр
                    <em class="parameter"><code>bind</code></em>).</p><p>Параметр имеет строковый тип. По умолчанию его значение равно пустой строке
                (разрешены соединения с любого IP адреса).</p><div class="example" id="d0e4289"><div class="example-title">Пример 4.38. Установка параметра RemoteBindAddress</div><div class="example-contents"><p>
                    </p><pre class="programlisting">
RemoteBindAddress =  
                    </pre><p>
                </p></div></div><br class="example-break"/></section><section class="section" id="config-param-LockMemSize"><div class="titlepage"><div><div><h3 class="title">LockMemSize</h3></div></div></div><a id="d0e4300" class="indexterm"/><p><span class="formalpara-title">Область действия: </span>Per-database.</p><p><span class="formalpara-title">Тип параметра: </span>Integer.</p><p>Значение параметра <em class="parameter"><code>LockMemSize</code></em> определяет объем памяти,
                которая будет выделена менеджеру блокировок. В архитектуре Classic и SuperClassic
                данный параметр используется для начального распределения, далее таблица расширяется
                динамически до предела памяти. В архитектуре Super значение параметра определяет
                начальное распределение и предел выделяемой памяти.</p><p>Параметр имеет целочисленный тип. Единица измерения — байты. Значение по умолчанию
                равно 1 Мбайт. Минимальное значение равно 0. максимальное — 2 Гбайта.</p><div class="example" id="d0e4322"><div class="example-title">Пример 4.39. Установка параметра LockMemSize</div><div class="example-contents"><p>
                    </p><pre class="programlisting">
LockMemSize = 1M 
                    </pre><p>
                </p></div></div><br class="example-break"/><p>На размер таблицы блокировок влияют: </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>В архитектурах Classic и SuperClassic размер страничного кэша (Super
                            сервер для блокировки страниц использует лёгковесные защёлки). Страница,
                            помещенная в кэш, блокируется, как минимум, один раз, страницы, которые
                            читаются несколькими клиентами, могут блокироваться несколько
                            раз.</p></li><li class="listitem"><p>Число одновременных транзакций. Каждая транзакция имеет блокировку.
                            Блокировка используется для синхронизации транзакций.</p></li><li class="listitem"><p>События. Механизм оповещения о событиях использует блокировки. Число
                            событий и число клиентов, ожидающих эти события, влияют на размер
                            таблицы блокировок.</p></li></ol></div></section><section class="section" id="config-param-LockAcquireSpins"><div class="titlepage"><div><div><h3 class="title">LockAcquireSpins</h3></div></div></div><a id="d0e4345" class="indexterm"/><p><span class="formalpara-title">Область действия: </span>Per-database.</p><p><span class="formalpara-title">Тип параметра: </span>Integer.</p><p>В архитектуре сервера Classic только одно клиентское соединение может обратиться к
                таблице блокировки в одно и то же время. Доступ к таблице блокировки управляется с
                помощью mutex(а). Mutex может быть затребован в условном, либо безусловном режиме.
                Если mutex затребован в условном режиме, то ожидание является отказом, и запрос
                должен повториться. В безусловном режиме mutex будет ожидаться до тех пор, пока не
                будет получен.</p><p>Параметр <em class="parameter"><code>LockAcquireSpins</code></em> имеет целочисленный тип. Его
                значение устанавливает количество попыток, которые будут сделаны в условном режиме.
                По умолчанию значение параметра равно 0, в этом случае будет использоваться
                безусловный режим.</p><div class="note"><h3 class="title">Примечание</h3><p> Параметр имеет эффект только на SMP (симметричных мультипроцессорных)
                    системах. </p></div><div class="example" id="d0e4370"><div class="example-title">Пример 4.40. Установка параметра LockAcquireSpins</div><div class="example-contents"><p>
                    </p><pre class="programlisting">
LockAcquireSpins = 2 
                    </pre><p>
                </p></div></div><br class="example-break"/><div class="note"><h3 class="title">Примечание</h3><p>В залоговке лок-таблицы этот параметр отображается как <span class="quote">«<span class="quote">Spin
                        count</span>»</span> в строке вида:</p><pre class="screen">
Acquires:   2150, Acquire blocks:     14, Spin count:   0                    
                </pre></div></section><section class="section" id="config-param-LockHashSlots"><div class="titlepage"><div><div><h3 class="title">LockHashSlots</h3></div></div></div><a id="d0e4389" class="indexterm"/><p><span class="formalpara-title">Область действия: </span>Per-database.</p><p><span class="formalpara-title">Тип параметра: </span>Integer.</p><p>Параметр <em class="parameter"><code>LockHashSlots</code></em> используется для настройки числа
                слотов хэш таблицы блокировок. Чем больше слотов используется, тем короче получаются
                хэш цепочки, что увеличивает производительность при повышенной нагрузке.</p><p>Параметр имеет целочисленный тип. Максимально допустимое значение этого параметра
                равно 65521 (значения больше этого порога игнорируются и используется всё равно
                именно этот порог: 65521).  </p><p>Значение по умолчанию (8191) можно считать подходящим для работы 100 пользователей
                и умалчиваемом размере страничного кеша (256).</p><p>В качестве значения рекомендуется указывать простое число, чтобы хэш-алгоритм
                производил хорошее распределение. </p><div class="example" id="d0e4415"><div class="example-title">Пример 4.41. Установка параметра LockHashSlots</div><div class="example-contents"><p>
                    </p><pre class="programlisting">
LockHashSlots = 30011 
                    </pre><p>
                </p></div></div><br class="example-break"/><p>Увеличение значения данного параметра необходимо только при высокой загрузке
                (одновременно с ним следует увеличить и параметр <em class="parameter"><code>LockMemSize</code></em>
                на тот же процент). Он вычисляется с использованием утилиты Lock Print по следующему
                принципу.</p><p>Запускаем утилиту
                </p><pre class="programlisting">
fb_lock_print -d <em class="replaceable"><code>&lt;database&gt;</code></em> | <em class="replaceable"><code>&lt;alias&gt;</code></em>            
            </pre><p>
            </p><p>В группе заголовка блока (<span class="bold"><strong>LOCK_HEADER BLOCK</strong></span>),
                которая описывает основную конфигурацию и состояние таблицы блокировок, смотрим
                значение элемента <span class="bold"><strong>Hash lengths</strong></span> (длина хэш цепочки).
                Этот элемент сообщает минимальную, среднюю и максимальную длину цепочки слотов. Чем
                длиннее будут цепочки, тем медленнее будет работать менеджер блокировок. Если
                среднее значение больше 3 или максимальное больше 10, то это означает, что слотов
                недостаточно. Поэтому следует увеличить параметр
                    <em class="parameter"><code>LockHashSlots</code></em> в 2-3 раза (при этом взять простое
                число).</p><div class="note"><h3 class="title">Примечание</h3><p>Для применения параметра необходимо, чтобы сервер пересоздал таблицу
                    блокировок (при этом в системе не должно остаться подключений и старой таблицы
                    блокировок).</p></div></section><section class="section" id="config-param-EventMemSize"><div class="titlepage"><div><div><h3 class="title">EventMemSize</h3></div></div></div><a id="d0e4456" class="indexterm"/><p><span class="formalpara-title">Область действия: </span>Per-database.</p><p><span class="formalpara-title">Тип параметра: </span>Integer.</p><p>Значение параметра <em class="parameter"><code>EventMemSize</code></em> определяет объем
                разделяемой памяти, которая будет выделена менеджеру событий.</p><p>Параметр <em class="parameter"><code>EventMemSize</code></em> имеет целочисленный тип. Единица
                измерения — байты. Значение по умолчанию равно 64 Кбайта. Минимально допустимое
                значение равно 0. Максимальное значение равно 2 Гбайта.</p><div class="example" id="d0e4481"><div class="example-title">Пример 4.42. Установка параметра EventMemSize</div><div class="example-contents"><p>
                    </p><pre class="programlisting">
EventMemSize = 64K
                    </pre><p>
                </p></div></div><br class="example-break"/></section></section><section class="section" id="config-engine"><div class="titlepage"><div><div><h2 class="title" style="clear: both">Настройки ядра</h2></div></div></div><section class="section" id="config-param-CpuAffinityMask"><div class="titlepage"><div><div><h3 class="title">CpuAffinityMask</h3></div></div></div><a id="d0e4495" class="indexterm"/><p><span class="formalpara-title">Область действия: </span>Per-server.</p><p><span class="formalpara-title">Тип параметра: </span>Integer.</p><p>Параметр <em class="parameter"><code>CpuAffinityMask</code></em> позволяет указать, какие
                процессоры (ядра) будут использоваться сервером (только для ОС Windows в архитектуре
                Super сервер).</p><div class="note"><h3 class="title">Примечание</h3><p>Параметр имеет эффект только в SMP (симметричных мультипроцессорных)
                    системах.</p></div><p>Параметр имеет целочисленный тип. Значение параметра соответствует элементам
                битового массива, в котором каждый бит представляет центральный процессор. Таким
                образом, чтобы использовать только первый процессор, значение параметра должно быть
                равно 1. Чтобы использовать и центральный процессор 1, и центральный процессор 2 —
                3. Чтобы использовать центральный процессор 2, и центральный процессор 3 — 6.
                Значение по умолчанию равно 0 (могут быть использованы все доступные
                процессоры).</p><div class="example" id="d0e4520"><div class="example-title">Пример 4.43. Установка параметра CpuAffinityMask</div><div class="example-contents"><p>
                    </p><pre class="programlisting">
CpuAffinityMask = 64K
                    </pre><p>
                </p></div></div><br class="example-break"/></section><section class="section" id="config-param-GCPolicy"><div class="titlepage"><div><div><h3 class="title">GCPolicy</h3></div></div></div><a id="d0e4531" class="indexterm"/><p><span class="formalpara-title">Область действия: </span>Per-database.</p><p><span class="formalpara-title">Тип параметра: </span>String.</p><p>Параметр <em class="parameter"><code>GCPolicy</code></em> используется для управления работой
                    <span class="quote">«<span class="quote">сборщика мусора</span>»</span>. Параметр имеет строковый тип. Возможные значения параметра:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">background</code> — сборщик мусора работает как фоновый,
                            собирая мусор в отдельном потоке;</p></li><li class="listitem"><p><code class="literal">cooperative</code> — сборщик мусора работает в оперативном
                            режиме, собирая мусор немедлен- но при чтении <span class="quote">«<span class="quote">мусорных</span>»</span>
                            версий;</p></li><li class="listitem"><p><code class="literal">combined</code> — сборщик мусора работает в оперативном
                            режиме, но если мусор собрать не удается, то о
                                <span class="quote">«<span class="quote">замусоренных</span>»</span> страницах сигнализируется фоновому
                            сборщику мусора.</p></li></ul></div><p>По умолчанию в архитектуре Super сервера <span class="quote">«<span class="quote">сборщик мусора</span>»</span> работает в
                комбинированном режиме. В архитектурах Classic и SuperClassic этот параметр
                игнорируется, а <span class="quote">«<span class="quote">сборщик мусора</span>»</span> всегда работает в оперативном
                режиме.</p><div class="example" id="d0e4584"><div class="example-title">Пример 4.44. Установка параметра GCPolicy</div><div class="example-contents"><p>
                    </p><pre class="programlisting">
GCPolicy = combined
                    </pre><p>
                </p></div></div><br class="example-break"/></section><section class="section" id="config-param-SecurityDatabase"><div class="titlepage"><div><div><h3 class="title">SecurityDatabase</h3></div></div></div><a id="d0e4595" class="indexterm"/><p><span class="formalpara-title">Область действия: </span>Per-database.</p><p><span class="formalpara-title">Тип параметра: </span>String (путь к базе данных или алиас).</p><p>Определяет имя и расположение базы данных безопасности, в которой хранятся имена
                пользователей и пароли, используемые сервером для проверки удаленных
                подключений.</p><p>По-умолчанию в <code class="filename">firebird.conf</code>:
                </p><pre class="programlisting">
SecurityDatabase = $(dir_secDb)/security3.fdb            
            </pre><p>
            </p><p>Параметр может быть переопределен для определенной базы данных в файле
                    <code class="filename">databases.conf</code>. Любая база данных может быть базой данных
                безопасности, в том числе и для самой себя.</p></section></section><section class="section" id="config-windows"><div class="titlepage"><div><div><h2 class="title" style="clear: both">Настройки для Windows систем</h2></div></div></div><section class="section" id="config-param-GuardianOption"><div class="titlepage"><div><div><h3 class="title">GuardianOption</h3></div></div></div><a id="d0e4631" class="indexterm"/><p><span class="formalpara-title">Область действия: </span>Per-server.</p><p><span class="formalpara-title">Тип параметра: </span>Boolean.</p><p>Параметр определяет должен ли сторож (Guardian) запускать сервер после того, как
                его работа была завершена некорректно.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>0 — сервер стартует единожды;</p></li><li class="listitem"><p>1 — сервер стартует каждый раз после некорректного завершения.</p></li></ul></div><p>Параметр имеет логический тип. Значение по умолчанию равно 1 (истина).</p><div class="example" id="d0e4657"><div class="example-title">Пример 4.45. Установка параметра GuardianOption</div><div class="example-contents"><p>
                    </p><pre class="programlisting">
GuardianOption = 1
                    </pre><p>
                </p></div></div><br class="example-break"/><div class="note"><h3 class="title">Примечание</h3><p>В современных версиях Windows службы могут перезапускаться при аварийном
                    завершении, если указаны соответствующие настройки. Это делает сторож (Guardian)
                    не нужным при установке Firebird в качестве службы. Однако он всё ещё может быть
                    полезным, если Firebird стартует в режиме приложения.</p></div></section><section class="section" id="config-param-ProcessPriorityLevel"><div class="titlepage"><div><div><h3 class="title">ProcessPriorityLevel</h3></div></div></div><a id="d0e4671" class="indexterm"/><p><span class="formalpara-title">Область действия: </span>Per-server.</p><p><span class="formalpara-title">Тип параметра: </span>Integer.</p><p>Параметр определяет уровень приоритетов процессов сервера Firebird. Параметр имеет
                целочисленный тип и может принимать значения:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>0 — нормальный приоритет (значение по умолчанию);</p></li><li class="listitem"><p>положительное значение — повышенный приоритет (тоже самое что опция -B
                            в командной строке);</p></li><li class="listitem"><p>отрицательное значение — пониженный приоритет.</p></li></ul></div><div class="important"><h3 class="title">Важно</h3><p>Все изменения данного параметра должны быть тщательно проверены, чтобы
                    гарантировать, что сервер продолжает обрабатывать запросы.</p></div><div class="example" id="d0e4701"><div class="example-title">Пример 4.46. Установка параметра ProcessPriorityLevel</div><div class="example-contents"><p>
                    </p><pre class="programlisting">
ProcessPriorityLevel = 0
                    </pre><p>
                </p></div></div><br class="example-break"/></section><section class="section" id="config-param-IpcName"><div class="titlepage"><div><div><h3 class="title">IpcName</h3></div></div></div><a id="d0e4712" class="indexterm"/><p><span class="formalpara-title">Область действия: </span>Per-connection.</p><p><span class="formalpara-title">Тип параметра: </span>String.</p><p>Параметр <em class="parameter"><code>IpcName</code></em> определяет имя области разделяемой памяти
                используемой в качестве транспортного канала в локальном протоколе. Параметр имеет
                строковый тип. Значение по умолчанию равно <code class="literal">FIREBIRD</code>.</p><div class="note"><h3 class="title">Примечание</h3><p>Локальный протокол не совместим с Firebird версия которого меньше 2.0.</p></div><div class="example" id="d0e4738"><div class="example-title">Пример 4.47. Установка параметра IpcName</div><div class="example-contents"><p>
                    </p><pre class="programlisting">
IpcName = FIREBIRD
                    </pre><p>
                </p></div></div><br class="example-break"/><div class="note"><h3 class="title">Примечание</h3><div class="itemizedlist"><ul style="list-style-type: disc; " class="itemizedlist"><li class="listitem"><p>Сервер может регистрировать объекты в пространстве имен Global, только
                            если он выполняется под учетной записью с привилегией
                            SE_CREATE_GLOBAL_NAME. Это означает, что, если вы работаете под
                            ограниченной учетной записью в Vista, XP SP2 или 2000 SP4, возможность
                            использования локального протокола для других сеансов будет
                            недоступна.</p></li><li class="listitem"><p>Если на одном сервере установлено несколько экземпляров Firebird, и
                            все они содержат одно и то же значение параметра IpcName (явно заданное
                            или умалчиваемое), то firebird.log всех запускаемых экземпляров, начиная
                            со второго, будет при каждом (ре-)старте пополняться сообщением
                            вида:</p><pre class="screen">
XNET error: XNET server initialization failed. Probably another instance 
of server is already running. 
operating system directive CreateMutex failed
Невозможно создать файл, так как он уже существует.                            
                        </pre><p>Для каждого подключения к СУБД может быть назначено индивидуальное
                            значение этого параметра.</p></li></ul></div></div></section><section class="section" id="config-param-RemotePipeName"><div class="titlepage"><div><div><h3 class="title">RemotePipeName</h3></div></div></div><a id="d0e4761" class="indexterm"/><p><span class="formalpara-title">Область действия: </span>Per-connection.</p><p><span class="formalpara-title">Тип параметра: </span>String.</p><p>Параметр <em class="parameter"><code>RemotePipeName</code></em> определяет название канала (Pipe),
                используемого как транспортный канал в протоколе NetBEUI. Название канала в
                протоколе NetBEUI имеет то же самое значение, что и номер порта для протокола
                TCP/IP.</p><p>Параметр имеет строковый тип. Значение по умолчанию равно
                    <code class="literal">interbas</code> и совместимо с InterBase/Firebird 1.0.</p><div class="example" id="d0e4786"><div class="example-title">Пример 4.48. Установка параметра RemotePipeName</div><div class="example-contents"><p>
                    </p><pre class="programlisting">
RemotePipeName = interbas
                    </pre><p>
                </p></div></div><br class="example-break"/></section></section><section class="section" id="config-unix"><div class="titlepage"><div><div><h2 class="title" style="clear: both">Настройки для Unix/Linux систем</h2></div></div></div><section class="section" id="config-param-Redirection"><div class="titlepage"><div><div><h3 class="title">Redirection</h3></div></div></div><a id="d0e4800" class="indexterm"/><p><span class="formalpara-title">Область действия: </span>Per-server.</p><p><span class="formalpara-title">Тип параметра: </span>Boolean.</p><p>Параметр <em class="parameter"><code>Redirection</code></em> используется для отключения защиты от
                переадресации запросов на другие сервера. Возможность переадресации запросов на
                другие серверы изначально присутствовала в InterBase. Но она была исключена
                корпорацией Borland в InterBase 6.0 после доработки добавившей SQL-диалекты.
                Возможность перенаправления запросов была восстановлена в Firebird 2.0.</p><div class="warning"><h3 class="title">Предупреждение</h3><p>На сегодняшний день использование этой возможности (прокси сервер)
                    представляет угрозу безопасности. Например, вы используете защищенный сервер
                    Firebird, доступ к которому осуществляется из глобальной сети. В этом случае,
                    если у сервера есть доступ к локальной сети, то он будет исполнять роль шлюза
                    для входящих запросов типа:
                    </p><pre class="programlisting">
firebird.your.domain.com:internal_server:/private/database.fdb
            </pre><p>
                </p><p>При этом злоумышленнику достаточно знать имя или IP-адрес хоста вашей
                    локальной сети, потому что для соединения не требуется знать логин и пароль на
                    внешнем сервере. Такой шлюз позволяет обойти систему сетевой защиты,
                    установленную в вашей локальной сети.</p></div><p>Параметр имеет логический тип. Значение по умолчанию равно 0
                    (<code class="literal">false</code>). В этом случае возможность перенаправления запросов
                отключена. Для включения этой опции следует значение параметра выставить равным 1
                    (<code class="literal">true</code>).</p><div class="example" id="d0e4836"><div class="example-title">Пример 4.49. Установка параметра Redirection</div><div class="example-contents"><p>
                    </p><pre class="programlisting">
Redirection = 0
                    </pre><p>
                </p></div></div><br class="example-break"/><div class="warning"><h3 class="title">Предупреждение</h3><p>Не включайте эту опцию если вы не уверены, что именно она делает.</p></div></section></section><section class="section" id="config-servermode"><div class="titlepage"><div><div><h2 class="title" style="clear: both">Настройки архитектуры</h2></div></div></div><section class="section" id="config-param-ServerMode"><div class="titlepage"><div><div><h3 class="title">ServerMode</h3></div></div></div><a id="d0e4853" class="indexterm"/><p><span class="formalpara-title">Область действия: </span>Per-server.</p><p><span class="formalpara-title">Тип параметра: </span>String.</p><p>Параметр <em class="parameter"><code>ServerMode</code></em> определяет архитектуру сервера.
                Существует 3 варианта архитектуры: </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">Super</code> (или <code class="literal">ThreadedDedicated</code>) —
                            база данных открывается эксклюзивно одним серверным процессом, им же
                            обслуживаются все соединения с базой данных. Подключения обрабатываются
                            потоками из общего пула; используется общий страничный кэш на каждую
                            базу данных для всех соединений и общий кэш для временного пространства
                            (сортировок).</p></li><li class="listitem"><p><code class="literal">SuperClassic</code> (или
                            <code class="literal">ThreadedShared</code>) — базы данных открываются одним
                            серверным процессом, но доступ не исключительный — embedded процессы
                            могут открыть одновременно одну ту же базу. Подключения обрабатываются
                            потоками из общего пула; используется собственный страничный кэш для
                            каждого соединения и общий кэш для временного пространства
                            (сортировок).</p></li><li class="listitem"><p><code class="literal">Classic</code> (или <code class="literal">MultiProcess</code>) —
                            создаётся отдельный процесс на каждое соединение с базой данных. Каждая
                            база данных может быть открыта несколькими процессами (включая локальные
                            для embedded доступа); используется отдельный кеш страниц на каждое
                            соединение и отдельный кэш для временного пространства
                            (сортировок).</p></li></ul></div></section></section></section></div><div class="part" id="command-line-tools"><div class="titlepage"><div><div><h1 class="title">Часть II. Утилиты командной строки</h1></div></div></div><section xml:lang="ru" class="chapter" id="isql"><div class="titlepage"><div><div><h2 class="title">Глава 5. Утилита ISQL</h2></div></div></div><a id="d0e4906" class="indexterm"/><p>В этой главе содержится описание консольной утилиты Firebird Interactive SQL Utility
            (<span class="application">isql</span>) и инструкции по его использованию для выполнения задач
        в базе данных.</p><p>Утилита ISQL расположена в корневом каталоге установки Firebird. Она предоставляет
        интерфейс командной строки для интерактивного доступа к базе данных Firebird. ISQL принимает
        операторы DSQL вместе с группой команд SET и SHOW для запросов и взаимодействия с базой
        данных Firebird. Некоторые команды SET могут быть включены в сценарии DDL для выполнения
        пакетных операций в <span class="application">isql</span>. Она также обрабатывает команды DDL, DML
        и консоли.</p><p>Утилита <span class="application">isql</span> может использоваться в трех режимах: в качестве
        интерактивного сеанса; прямо из командной строки; и как неинтерактивный сеанс, используя
        сценарий оболочки или пакетный файл. В каждом из режимов могут выполняться разные задачи,
        как показано ниже: </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>В интерактивном режиме пользователь последовательно вводит команды для работы
                    с базами данных и тут же получает результат их выполнения. При этом одна команда
                    может быть разбита на несколько строк. После завершения обработки каждой команды
                    и вывода всех результатов её работы пользователь получает приглашение ввести
                    следующую команду до тех пор, пока не будет введена команда выхода из
                    интерактивного режима QUIT или EXIT. Isql можно использовать в интерактивном
                    режиме для:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle; "><li class="listitem"><p>Создания, редактирования, удаления или просмотра данных и
                                метаданных;</p></li><li class="listitem"><p>Ввода файла сценария содержащего пакет SQL запросов;</p></li><li class="listitem"><p>Добавлять и модифицировать данные;</p></li><li class="listitem"><p>Предоставлять разрешение пользователю и отбирать их;</p></li><li class="listitem"><p>Управлять учётными записями;</p></li><li class="listitem"><p>Выполнять административные функции базы данных.</p></li></ul></div></li><li class="listitem"><p>Непосредственно из командной строки, с отдельными параметрами и без запуска
                    интерактивного сеанса. Команды выполняются и по завершении возвращают управление
                    автоматически операционной системе.</p></li><li class="listitem"><p>В неинтерактивном сеансе пользователь использует сценарий оболочки или
                    пакетный файл для выполнения функций базы данных.</p></li></ul></div><div class="note"><h3 class="title">Примечание</h3><p>Поскольку другие приложения в среде Linux, например, mySQL, также используют isql в
            качестве имени утилиты, рекомендуется запускать утилиту Firebird из ее собственного
            каталога или указывать абсолютный путь к файлу, если у вас есть другая реляционная база
            данных, кроме Firebird, установленная на вашей машине.</p></div><div class="note"><h3 class="title">Примечание</h3><p>Некоторые из затронутых дистрибутивов, такие как Mint Linux — на основе Ubuntu —
            переименовали Firebird в isql в isql-fb. Аналогичные изменения могут быть и в других
            дистрибутивах.</p><p>Кроме того, не все дистрибутивы устанавливают Firebird в одно и то же место. Например,
            OpenSuse устанавливает практически все в <code class="filename">/opt/firebird/3.0</code>, но
            Ubuntu и его производные устанавливают его в различные места, но утилиты находятся в
                <code class="filename">/usr/bin</code>.</p><p>Далее предполагается что утилита называется isql.</p></div><section class="section" id="isql-invoking"><div class="titlepage"><div><div><h2 class="title" style="clear: both">Запуск isql</h2></div></div></div><p>Перейдите в корневой каталог установки сервера Firebird и введите в командной строке
                <code class="filename">isql</code> (Windows) или <code class="filename">./isql</code> (Linux). Если
            каталог с isql добавлен в PATH, то нет необходимости переходить в него. </p><p>Синтаксис запуска isql следующий:
            </p><pre class="programlisting">
isql [<em class="replaceable"><code>&lt;options&gt;</code></em>] [<em class="replaceable"><code>&lt;database&gt;</code></em>]  
                
<em class="replaceable"><code>&lt;database&gt;</code></em> ::= [<em class="replaceable"><code>&lt;server spec&gt;</code></em>] {<em class="replaceable"><code>&lt;db_filename&gt;</code></em> | <em class="replaceable"><code>&lt;db_alias&gt;</code></em>}  
                
<em class="replaceable"><code>&lt;server spec&gt;</code></em> ::= 
    <em class="replaceable"><code>&lt;host&gt;</code></em>[\{<em class="replaceable"><code>&lt;port&gt;</code></em> | <em class="replaceable"><code>&lt;service&gt;</code></em>}]:       
  | \\<em class="replaceable"><code>&lt;host&gt;</code></em>[@{<em class="replaceable"><code>&lt;port&gt;</code></em> | <em class="replaceable"><code>&lt;service&gt;</code></em>}]\     
  | <em class="replaceable"><code>&lt;protocol&gt;</code></em>://[<em class="replaceable"><code>&lt;host&gt;</code></em>[:{<em class="replaceable"><code>&lt;port&gt;</code></em> | <em class="replaceable"><code>&lt;service&gt;</code></em>}]/]  
                
<em class="replaceable"><code>&lt;protocol&gt;</code></em> ::= inet | inet4 | inet6 | wnet | xnet                
        </pre><p>
        </p><p>Если параметры <em class="replaceable"><code>&lt;options&gt;</code></em> не указаны,
                <span class="application">isql</span> запускает интерактивный сеанс. Если база данных не
            указана, то необходимо подключиться к существующей базе данных или создать новую. Если
            база данных была указана, <span class="application">isql</span> запускает интерактивный сеанс,
            подключаясь к указанной базе данных.</p><p>Если указаны параметры, <span class="application">isql</span> запускается в интерактивном
            или не интерактивном режиме, в зависимости от параметров. Например, чтение входного
            файла и запись в выходной файл являются не интерактивными задачами, поэтому параметры
            -input или -output не запускают интерактивный сеанс. Дополнительные не интерактивные
            параметры включают -a, -database, -extract и -x, которые используются при извлечении
            операторов DDL.</p><p>Когда вы запускаете интерактивный сеанс isql, появляется следующее приглашение:
            </p><pre class="screen">
SQL&gt;            
        </pre><p>
        </p><p>Вы должны завершить каждую команду символом-терминатором. Терминатором по умолчанию
            является точка с запятой (;). Вы можете изменить терминатор на любой символ или группу
            символов с помощью команды SET TERMINATOR или с помощью параметра командной строки
            -terminator. Если вы опустите терминатор, появится приглашение для продолжения ввода
            (CON&gt;).</p><p>Ниже приведен самый простой способ запуска isql. После перехода в интерактивный режим
            вы должны начать с создания новой базы данных или подключения к ней. Сообщение, выданное
            isql, является подсказкой относительно того, что вы должны делать дальше. </p><pre class="programlisting">
            
c:\Firebird\3.0&gt;isql

Use CONNECT or CREATE DATABASE to specify a database
SQL&gt; CONNECT "inet://localhost:3053/employee"
CON&gt; user "SYSDBA" password 'masterkey';
Database: "inet://localhost:3053/employee", User: SYSDBA
SQL&gt;    

        </pre><p>
        </p><p>В следующем примере показано, как передать имя базы данных и учетные данные
            пользователя в командной строке. </p><pre class="programlisting">
            
c:\Firebird\3.0&gt;isql -user sysdba -password masterkey "inet://localhost:3053/employee"

Database: inet://localhost:3053/employee, User: SYSDBA
SQL&gt;

        </pre><p>
        </p><p>В этом примере мы использовали псевдоним для базы данных employee. Этот пример
            предопределен в файле <code class="filename">databases.conf</code>, который обычно находится в
            каталоге, в котором установлен Firebird, но некоторые дистрибутивы Linux помещают его в
                <code class="filename">/etc/firebird/n.n</code>, где n.n - версия сервера базы данных
            Firebird. Ниже приведена дополнительная информация о подключении к базам данных с
            использованием полных путей или псевдонимов.</p></section><section class="section" id="isql-switches"><div class="titlepage"><div><div><h2 class="title" style="clear: both">Переключатели командной строки</h2></div></div></div><p>Переключатели командной строки — это аргументы, которые начинаются с символа
            минус/дефис (-). Ниже приведен пример того, что происходит, когда вы пытаетесь запустить
            isql с недопустимым переключателем — он отображает список допустимых ключей с кратким
            описанием каждого из них. </p><pre class="programlisting">

c:\Firebird\3.0&gt;isql -help
Unknown switch: -help
usage:    isql [options] [&lt;database&gt;]
        -a(ll)                  extract metadata incl. legacy non-SQL tables
        -b(ail)                 bail on errors (set bail on)
        -c(ache) &lt;num&gt;          number of cache buffers
        -ch(arset) &lt;charset&gt;    connection charset (set names)
        -d(atabase) &lt;database&gt;  database name to put in script creation
        -e(cho)                 echo commands (set echo on)
        -ex(tract)              extract metadata
        -f(etch_password)       fetch password from file
        -i(nput) &lt;file&gt;         input file (set input)
        -m(erge)                merge standard error
        -m2                     merge diagnostic
        -n(oautocommit)         no autocommit DDL (set autoddl off)
        -nod(btriggers)         do not run database triggers
        -now(arnings)           do not show warnings
        -o(utput) &lt;file&gt;        output file (set output)
        -pag(elength) &lt;size&gt;    page length
        -p(assword) &lt;password&gt;  connection password
        -q(uiet)                do not show the message "Use CONNECT..."
        -r(ole) &lt;role&gt;          role name
        -r2 &lt;role&gt;              role (uses quoted identifier)
        -s(qldialect) &lt;dialect&gt; SQL dialect (set sql dialect)
        -t(erminator) &lt;term&gt;    command terminator (set term)
        -tr(usted)              use trusted authentication
        -u(ser) &lt;user&gt;          user name
        -x                      extract metadata
        -z                      show program and server version
                        
        </pre><p>
        </p><div class="note"><h3 class="title">Примечание</h3><p>Требуются только начальные символы в опции. Вы можете ввести любую часть текста,
                заключенную в скобки, включая полное имя опции. Например, указание -n, -no или
                -noauto имеет тот же эффект.</p></div><p>
            </p><div class="table" id="d0e5093"><div class="table-title">Таблица 5.1. Переключатели командной строки</div><div class="table-contents"><table style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; "><colgroup><col class="c1"/><col class="c2"/></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">Опция</th><th style="border-bottom: 1px solid ; ">Описание</th></tr></thead><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">-a(ll)</td><td style="border-bottom: 1px solid ; "><p>Извлечение всех метаданных, включая не-SQL объекты.
                                    Используется совместно с командой extract</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">-b(ail)</td><td style="border-bottom: 1px solid ; "><p>Этот переключатель указывает утилите передать ошибку в ОС,
                                    но только в пакетном режиме (<code class="code">SET BAIL ON</code>). Он был
                                    добавлен, чтобы предотвратить выполнение сценариев isql после
                                    обнаружения ошибки. Дальнейшие операторы не будут выполняться, и
                                    isql вернет код ошибки в ОС.</p>
                                <p>Пользователям по-прежнему необходимо использовать
                                    переключатель — e(cho) для вывода команд в выходной файл, чтобы
                                    выделить точный оператор, вызвавший ошибку.</p>
                                <p>Когда сервер предоставляет информацию о строках и столбцах,
                                    пользователи могут найти точную строку в DML скрипте, вызвавшую
                                    проблему. Когда сервер указывает только ошибку, то пользователи
                                    могут увидеть только первую строку оператора, вызвавшего сбой по
                                    отношению ко сему сценарию.</p>
                                <p>Эта функция также поддерживается во вложенных скриптах.
                                    Например, сценарий A включает в себя сценарий B, а сценарий B
                                    вызывает ошибку, номер строки связан со сценарием B. Когда
                                    сценарий B полностью прочитан, <span class="application">isql</span>
                                    продолжает считать строки, относящиеся к сценарию A, поскольку
                                    каждый файл получает отдельный счетчик строк. Сценарий A
                                    включает сценарий B, когда сценарий A использует команду
                                        <code class="code">INPUT</code> для загрузки сценария B.</p>
                            </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">-c(ache) <em class="replaceable"><code>&lt;num&gt;</code></em></td><td style="border-bottom: 1px solid ; ">Задаёт количество страниц, которые будут кэшированы при
                                соединении с БД.</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">-ch(arset) <em class="replaceable"><code>&lt;charset&gt;</code></em></td><td style="border-bottom: 1px solid ; ">Задаёт кодировку для текущего соединения. Это же можно сделать с
                                использовании команды <code class="code">SET NAMES</code></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">-d(atabase) <em class="replaceable"><code>&lt;database&gt;</code></em></td><td style="border-bottom: 1px solid ; "><p>Используется совместно с переключателем -x или -ex.
                                    Изменяет оператор CREATE DATABASE, который извлекается в файл:</p><div class="itemizedlist"><ul style="list-style-type: disc; " class="itemizedlist"><li class="listitem"><p>Без переключателя -d оператор CREATE DATABASE
                                                извлекается в скрипт как комментарий в стиле C, и
                                                использует имя базы данных указанное в командной
                                                строке isql</p></li><li class="listitem"><p>С переключателем -d оператор CREATE DATABASE
                                                извлекается не закомментированным, и подставляет имя
                                                базы данных указанное в переключателе</p></li></ul></div></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">-e(cho) </td><td style="border-bottom: 1px solid ; ">Включает дублирование команд на указанное устройство вывода
                                (монитор, в файл, и т. д.) Это можно сделать и с использованием
                                команды <code class="code">SET ECHO ON</code></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">-ex(tract)</td><td style="border-bottom: 1px solid ; ">Извлечение метаданных из базы данных. Его можно использовать
                                вместе с ключом -o(utput) для извлечения информации в указанный
                                выходной файл.</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">-f(etch_password) </td><td style="border-bottom: 1px solid ; ">Извлечение пароля из файла</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">-i(nput) <em class="replaceable"><code>&lt;file&gt;</code></em>
                            </td><td style="border-bottom: 1px solid ; ">Задаёт файл с SQL-скриптом для выполнения. Файлы скриптов могут
                                содержать команду <code class="code">SET INPUT</code> для включения других
                                файлов.</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">-m(erge_stderr) </td><td style="border-bottom: 1px solid ; ">Перенаправление ошибок (stderr) на поток стандартного вывода.
                                Ключ командной строки -m(erge) может использоваться для включения
                                сообщений об ошибках в выходные файлы.</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">-m2 </td><td style="border-bottom: 1px solid ; ">Отправлять информацию о статистике и планах в выходной файл,
                                который указан в переключателе -o(utput). Ключ командной строки -m2
                                гарантирует, что статистика и информация о плане, полученные из
                                команд <code class="code">SET STATS</code>, <code class="code">SET PLAN</code> и <code class="code">SET
                                    PLANONLY</code>, также отправляются в выходной файл, а не просто
                                возвращаются в консоль.</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">-n(oautocommit)</td><td style="border-bottom: 1px solid ; ">Отключить автоматическое подтверждение DDL-операций. По умолчанию
                                операторы DDL фиксируются автоматически в отдельной транзакции.
                                Может быть изменено командой <code class="code">SET AUTODDL OFF</code></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">-nod(btriggers)</td><td style="border-bottom: 1px solid ; ">Не запускать триггеры базы данных.</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">-now(arnings)</td><td style="border-bottom: 1px solid ; ">Не показывать предупреждения.</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">-o(utput) <em class="replaceable"><code>&lt;file&gt;</code></em></td><td style="border-bottom: 1px solid ; ">Задаёт файл для вывода результата выполнения запросов. Без
                                аргументов перенаправляет вывод на стандартное устройство вывода
                                (монитор). Может быть изменён так же командой <code class="code">SET
                                    OUTPUT</code></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">-pag(elength) <em class="replaceable"><code>&lt;size&gt;</code></em></td><td style="border-bottom: 1px solid ; ">Размер страницы. Печатает заголовки столбцов каждые
                                    <em class="replaceable"><code>&lt;size&gt;</code></em> строк вместо значений по
                                умолчанию 20.</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">-p(assword) <em class="replaceable"><code>&lt;password&gt;</code></em></td><td style="border-bottom: 1px solid ; ">Пароль пользователя при подключении к базе данных.</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">-q(uiet)</td><td style="border-bottom: 1px solid ; ">Не показывать сообщение "Use CONNECT...".</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">-r(ole) <em class="replaceable"><code>&lt;role&gt;</code></em></td><td style="border-bottom: 1px solid ; ">Имя роли при подключении к базе данных.</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">-r2 <em class="replaceable"><code>&lt;role&gt;</code></em></td><td style="border-bottom: 1px solid ; "><p>Имя роли (с использованием квотированных идентификаторов).
                                    Этот переключатель можно использовать для указания имени роли с
                                    учетом регистра. </p>
                                <p>По умолчанию для передачи роли используется переключатель
                                    -r(ole). В этом случае роль, представленная в командной строке,
                                    пишется в верхнем регистре. Если используется переключатель -r2,
                                    то роль передаются в движок в точности так, как это указано в
                                    командной строке.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">-s(qldialect) <em class="replaceable"><code>&lt;dialect&gt;</code></em></td><td style="border-bottom: 1px solid ; ">Устанавливает SQL диалект к котором интерпретируются последующие
                                команды до конца сеанса или до тех пор, пока диалект не будет
                                изменён с помощью инструкции <code class="code">SET SQL DIALECT</code>.</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">-t(erminator) <em class="replaceable"><code>&lt;term&gt;</code></em></td><td style="border-bottom: 1px solid ; ">Изменяет символ конца оператора (терминатора) с точки с запятой
                                    <span class="quote">«<span class="quote">;</span>»</span> по умолчанию на
                                    <em class="replaceable"><code>&lt;term&gt;</code></em>, где
                                    <em class="replaceable"><code>&lt;term&gt;</code></em> — любой символ или
                                последовательность символов. Тоже самое можно сделать использую
                                команду <code class="code">SET TERM</code>.</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">-tr(usted)</td><td style="border-bottom: 1px solid ; ">Использовать доверительную аутентификацию.</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">-u(ser) <em class="replaceable"><code>&lt;user&gt;</code></em></td><td style="border-bottom: 1px solid ; ">Имя пользователя для подключения к базе данных.</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">-x</td><td style="border-bottom: 1px solid ; ">Извлечение метаданных из базы данных. Его можно использовать
                                вместе с ключом -o(utput) для извлечения информации в указанный
                                выходной файл.</td></tr><tr><td style="border-right: 1px solid ; ">-z</td><td>Показать версии утилиты и сервера.</td></tr></tbody></table></div></div><p><br class="table-break"/>
        </p><section class="section" id="isql-switches-examples"><div class="titlepage"><div><div><h3 class="title">Примеры</h3></div></div></div><p>
                </p><div class="example" id="d0e5338"><div class="example-title">Пример 5.1. Выполнение скрипта создания базы данных</div><div class="example-contents"><p>
                        </p><pre class="programlisting">
isql -input createdb.sql                            
                        </pre><p>
                    </p></div></div><p><br class="example-break"/>
                </p><div class="example" id="d0e5347"><div class="example-title">Пример 5.2. Запуск интерактивного сеанса с подключением к удалённой базе
                        данных</div><div class="example-contents"><p>В следующем примере начинается интерактивное соединение с удаленной базой
                        данных. Удаленный сервер jupiter, принимает указанную комбинацию
                        пользователя и пароля с привилегиями, назначенными роли STAFF:
                        </p><pre class="programlisting">
isql -user sales -password mycode -role staff 'jupiter:/usr/customer.fdb'                            
                        </pre><p>
                    </p></div></div><p><br class="example-break"/>
                </p><div class="example" id="d0e5356"><div class="example-title">Пример 5.3. Запуск интерактивного сеанса без подключения к базе данных</div><div class="example-contents"><p>Следующий пример запускает интерактивный сеанс, но не подключается к базе
                        данных. Все введенные команды <span class="application">isql</span> выводятся на
                        печать, а результаты запроса печатают заголовки столбцов каждые 30 строк:
                        </p><pre class="programlisting">
isql -echo -page 30                            
                        </pre><p>
                    </p></div></div><p><br class="example-break"/>
            </p></section></section><section class="section" id="isql-start_session"><div class="titlepage"><div><div><h2 class="title" style="clear: both">Начало сессии Isql</h2></div></div></div><p>Чтобы начать сеанс <span class="application">isql</span>, введите параметры командной строки
            и имя базы данных в оболочке Linux/Unix или командной консоли Windows. Например:
            </p><pre class="programlisting">
isql [<em class="replaceable"><code>&lt;options&gt;</code></em>] [<em class="replaceable"><code>&lt;database&gt;</code></em>]                          
                        </pre><p>
        </p><div class="note"><h3 class="title">Примечание</h3><p>При подключении к удаленной базе данных вам нужно будет включить соответствующие
                параметры -user и -password в свои параметры, если только пользователи не объявили
                ISC_USER и ISC_PASSWORD в качестве переменных операционной системы. Например:
                </p><pre class="programlisting">
isql -user SYSDBA -password masterkey inet4://localhost/mydatabase                            
                        </pre><p>
            </p><p>При подключении к локальной базе данных в embedded варианте достаточно указать
                только имя пользователя (пароль будет проигнорирован):
                </p><pre class="programlisting">
isql -user SYSDBA employee.db                           
                        </pre><p>
            </p><p>В Windows вы можете использовать доверительную аутентификацию, при условии что она
                настроена в <code class="filename">firebird.conf</code> или
                    <code class="filename">databases.conf</code>:
                </p><pre class="programlisting">
isql -trusted inet4://localhost/mydatabase                            
                        </pre><p>
            </p></div><p>Если параметры <em class="replaceable"><code>&lt;options&gt;</code></em> не указаны,
                <span class="application">isql</span> запускает интерактивный сеанс. Если база данных не
            указана, то необходимо подключиться к существующей базе данных или создать новую. Если
            база данных была указана, <span class="application">isql</span> запускает интерактивный сеанс,
            подключаясь к указанной базе данных.</p><p>Чтение входного файла и запись в выходной файл не считаются интерактивными задачами,
            поэтому параметры командной строки -input или -output не инициируют интерактивный сеанс.
            Опции, используемые для извлечения операторов DDL, такие как -a и -x, также инициируют
            только неинтерактивный сеанс.</p><p>Isql может быть запущен с локального или удаленного клиента:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>При подключении с использованием локального клиента вы можете установить
                        переменные среды ISC_USER и ISC_PASSWORD.</p></li><li class="listitem"><p>При подключении с удаленного клиента вам потребуется указать
                        действительные имя и пароль.</p></li></ul></div></section><section class="section" id="isql-end_session"><div class="titlepage"><div><div><h2 class="title" style="clear: both">Завершение сессии Isql</h2></div></div></div><a id="d0e5432" class="indexterm"/><a id="d0e5437" class="indexterm"/><p>Существует два способа выхода из isql:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Если вы хотите откатить всю неподтвержденную работу и выйти из isql,
                        введите в командной строке следующую команду:
                        </p><pre class="programlisting">
SQL&gt; QUIT;                        
                    </pre><p>
                    </p></li><li class="listitem"><p>Если вы хотите зафиксировать всю свою работу перед выходом из isql,
                        введите следующую команду:
                        </p><pre class="programlisting">
SQL&gt; EXIT;                      
                    </pre><p>
                    </p></li></ul></div></section><section class="section" id="isql-help"><div class="titlepage"><div><div><h2 class="title" style="clear: both">Получение справки</h2></div></div></div><a id="d0e5460" class="indexterm"/><p>Isql поставляется с командой HELP. Это дает краткую информацию о большинстве доступных
            команд. Команда HELP также позволяет перейти к более подробной информации. Чтобы
            активировать справочную систему, просто введите HELP в командной строке, как показано
            ниже: </p><pre class="programlisting">
SQL&gt; HELP;                      
                    </pre><p>
            </p><pre class="screen">

Frontend commands:
BLOBDUMP &lt;blobid&gt; &lt;file&gt;   -- dump BLOB to a file
BLOBVIEW &lt;blobid&gt;          -- view BLOB in text editor
EDIT     [&lt;filename&gt;]      -- edit SQL script file and execute
EDIT                       -- edit current command buffer and execute
HELP                       -- display this menu
INput    &lt;filename&gt;        -- take input from the named SQL file
OUTput   [&lt;filename&gt;]      -- write output to named file
OUTput                     -- return output to stdout
SET      &lt;option&gt;          -- (Use HELP SET for complete list)
SHELL    &lt;command&gt;         -- execute Operating System command in sub-shell
SHOW     &lt;object&gt; [&lt;name&gt;] -- display system information
    &lt;object&gt; = CHECK, COLLATION, DATABASE, DOMAIN, EXCEPTION, FILTER, FUNCTION,
               GENERATOR, GRANT, INDEX, PACKAGE, PROCEDURE, ROLE, SQL DIALECT,
               SYSTEM, TABLE, TRIGGER, VERSION, USERS, VIEW
EXIT                       -- exit and commit changes
QUIT                       -- exit and roll back changes

All commands may be abbreviated to letters in CAPitals
                
            </pre><p>
        </p><a id="d0e5473" class="indexterm"/><p>Большинство из этих команд не имеют дальнейших уровней детализации, в то время как
            команда SET имеет. Чтобы углубиться в эти дополнительные уровни, выполните следующие
            действия: </p><pre class="programlisting">
SQL&gt; HELP SET;                      
                    </pre><p>
            </p><pre class="screen">

Set commands:
    SET                    -- display current SET options
    SET AUTOddl            -- toggle autocommit of DDL statements
    SET BAIL               -- toggle bailing out on errors in non-interactive mode
    SET BLOB [ALL|&lt;n&gt;]     -- display BLOBS of subtype &lt;n&gt; or ALL
    SET BLOB               -- turn off BLOB display
    SET COUNT              -- toggle count of selected rows on/off
    SET MAXROWS [&lt;n&gt;]      -- limit select stmt to &lt;n&gt; rows, zero is no limit
    SET ECHO               -- toggle command echo on/off
    SET EXPLAIN            -- toggle display of query access plan in the explained form
    SET HEADING            -- toggle display of query column titles
    SET LIST               -- toggle column or table display format
    SET NAMES &lt;csname&gt;     -- set name of runtime character set
    SET PLAN               -- toggle display of query access plan
    SET PLANONLY           -- toggle display of query plan without executing
    SET SQL DIALECT &lt;n&gt;    -- set sql dialect to &lt;n&gt;
    SET STATs              -- toggle display of performance statistics
    SET TIME               -- toggle display of timestamp with DATE values
    SET TERM &lt;string&gt;      -- change statement terminator string
    SET WIDTH &lt;col&gt; [&lt;n&gt;]  -- set/unset print width to &lt;n&gt; for column &lt;col&gt;

All commands may be abbreviated to letters in CAPitals
                
            </pre><p>
        </p><p>Если вы попытаетесь углубиться в какую-либо другую команду, эффект будет точно таким
            же, как при выполнении только команды HELP.</p><div class="note"><h3 class="title">Примечание</h3><p>Команда HELP SET даёт справку только по собственным командам isql. Для управляющих
                SQL операторов, таких как SET TRANSACTION или SET ROLE подсказка не будет
                выведена.</p></div></section><section class="section" id="isql-connect"><div class="titlepage"><div><div><h2 class="title" style="clear: both">Соединение с базой данных</h2></div></div></div><a id="d0e5496" class="indexterm"/><p>Если при запуске isql вы не указали спецификацию для подключения к базе данных, то
            будет выдана подсказка о том что необходимо соединиться с базой данных с помощью
            оператора CONNECT или создать новую базу данных с помощью оператора CREATE
            DATABASE.</p><p>Оператор CONNECT не является частью DSQL и доступен только внутри ISQL, а потому не
            описан в <span class="quote">«<span class="quote">Руководство по языку SQL Firebird</span>»</span>. Рассмотрим его
            синтаксис.</p><p><span class="formalpara-title">Синтаксис: </span>
                </p><pre class="programlisting"> 
CONNECT <em class="replaceable"><code>&lt;database&gt;</code></em> 
[USER <em class="replaceable"><code>&lt;username&gt;</code></em> [PASSWORD <em class="replaceable"><code>&lt;password&gt;</code></em>]]
[CACHE <em class="replaceable"><code>&lt;cache size&gt;</code></em>] 
[ROLE <em class="replaceable"><code>&lt;rolename&gt;</code></em>]                    
                    
<em class="replaceable"><code>&lt;database&gt;</code></em> ::= [<em class="replaceable"><code>&lt;server spec&gt;</code></em>] {<em class="replaceable"><code>&lt;db_filename&gt;</code></em> | <em class="replaceable"><code>&lt;db_alias&gt;</code></em>}  
                
<em class="replaceable"><code>&lt;server spec&gt;</code></em> ::= 
    <em class="replaceable"><code>&lt;host&gt;</code></em>[\{<em class="replaceable"><code>&lt;port&gt;</code></em> | <em class="replaceable"><code>&lt;service&gt;</code></em>}]:       
  | \\<em class="replaceable"><code>&lt;host&gt;</code></em>[@{<em class="replaceable"><code>&lt;port&gt;</code></em> | <em class="replaceable"><code>&lt;service&gt;</code></em>}]\     
  | <em class="replaceable"><code>&lt;protocol&gt;</code></em>://[<em class="replaceable"><code>&lt;host&gt;</code></em>[:{<em class="replaceable"><code>&lt;port&gt;</code></em> | <em class="replaceable"><code>&lt;service&gt;</code></em>}]/]  
                
<em class="replaceable"><code>&lt;protocol&gt;</code></em> ::= inet | inet4 | inet6 | wnet | xnet                         
                    </pre><p>
            </p><p>
            </p><div class="table" id="d0e5581"><div class="table-title">Таблица 5.2. Параметры оператора CONNECT</div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col style="text-align: left; " class="colArgument"/><col style="text-align: left; " class="colDesc"/></colgroup><thead><tr valign="middle"><th style="text-align: center; vertical-align: middle; border-right: 1px solid ; border-bottom: 1px solid ; ">Параметр</th><th style="text-align: center; vertical-align: middle; border-bottom: 1px solid ; ">Описание</th></tr></thead><tbody><tr><td style="text-align: left; border-right: 1px solid ; border-bottom: 1px solid ; "><em class="replaceable"><code>database</code></em></td><td style="text-align: left; border-bottom: 1px solid ; ">Спецификация базы данных.</td></tr><tr><td style="text-align: left; border-right: 1px solid ; border-bottom: 1px solid ; "><em class="replaceable"><code>username</code></em></td><td style="text-align: left; border-bottom: 1px solid ; ">Имя пользователя для соединения с базой данных. Может быть
                                заключено в одинарные или двойные кавычки. Если имя пользователя
                                заключено в двойные кавычки, то оно чувствительно к
                                регистру.</td></tr><tr><td style="text-align: left; border-right: 1px solid ; border-bottom: 1px solid ; "><em class="replaceable"><code>password</code></em></td><td style="text-align: left; border-bottom: 1px solid ; ">Пароль пользователя для соединения с базой данных. Чувствительно
                                к регистру. Должен быть заключён в одинарный кавычки.</td></tr><tr><td style="text-align: left; border-right: 1px solid ; border-bottom: 1px solid ; "><em class="replaceable"><code>cache size</code></em></td><td style="text-align: left; border-bottom: 1px solid ; ">Размер страничного кеша.</td></tr><tr><td style="text-align: left; border-right: 1px solid ; border-bottom: 1px solid ; "><em class="replaceable"><code>rolename</code></em></td><td style="text-align: left; border-bottom: 1px solid ; ">Имя роли для соединения с базой данных. Может быть заключено в
                                одинарные или двойные кавычки. Если имя роли заключено в двойные
                                кавычки, то оно чувствительно к регистру.</td></tr><tr><td style="text-align: left; border-right: 1px solid ; border-bottom: 1px solid ; "><em class="replaceable"><code>server spec</code></em></td><td style="text-align: left; border-bottom: 1px solid ; ">Спецификация удалённого сервера. Включает в себя имя сервера и
                                протокол.</td></tr><tr><td style="text-align: left; border-right: 1px solid ; border-bottom: 1px solid ; "><em class="replaceable"><code>db_filename</code></em></td><td style="text-align: left; border-bottom: 1px solid ; ">Полный путь и имя файла базы данных, включая расширение. Имя
                                файла должно быть задано в соответствии со спецификой используемой
                                платформы.</td></tr><tr><td style="text-align: left; border-right: 1px solid ; border-bottom: 1px solid ; "><em class="replaceable"><code>db_alias</code></em></td><td style="text-align: left; border-bottom: 1px solid ; ">Псевдоним (alias) базы данных, присутствующий в файле
                                    <code class="filename">databases.conf</code></td></tr><tr><td style="text-align: left; border-right: 1px solid ; border-bottom: 1px solid ; "><em class="replaceable"><code>host</code></em></td><td style="text-align: left; border-bottom: 1px solid ; ">Имя сервера или IP адрес, на котором расположена база
                                данных.</td></tr><tr><td style="text-align: left; border-right: 1px solid ; border-bottom: 1px solid ; "><em class="replaceable"><code>port</code></em></td><td style="text-align: left; border-bottom: 1px solid ; ">Номер порта, который слушает удалённый сервер (параметр
                                    <em class="parameter"><code>RemoteServicePort</code></em> файла
                                    <code class="filename">firebird.conf</code>).</td></tr><tr><td style="text-align: left; border-right: 1px solid ; border-bottom: 1px solid ; "><em class="replaceable"><code>service</code></em></td><td style="text-align: left; border-bottom: 1px solid ; ">Имя сервиса. Должно совпадать со значением параметра
                                    <em class="parameter"><code>RemoteServiceName</code></em> файла
                                    <code class="filename">firebird.conf</code></td></tr><tr><td style="text-align: left; border-right: 1px solid ; "><em class="replaceable"><code>protocol</code></em></td><td style="text-align: left; ">Наименование протокола.</td></tr></tbody></table></div></div><p><br class="table-break"/>
        </p><p>База данных может состоять из одного или нескольких файлов. Первый, основной, файл
            называется первичным, остальные файлы — вторичными. При подключении к базе данных
            необходимо указывать только путь до первичного файла базы данных.</p><p>Спецификация первичного файла — имя файла базы данных и его расширение с указанием к
            нему полного пути в соответствии с правилами используемой операционной системы. </p><section class="section" id="isql-connect-aliasedb"><div class="titlepage"><div><div><h3 class="title">Использование псевдонимов БД</h3></div></div></div><p>Вместо полного пути к первичному файлу базы можно использовать псевдонимы
                (aliases). Псевдонимы описываются в файле <code class="filename">databases.conf</code> в
                формате:
                </p><pre class="programlisting">  
<em class="replaceable"><code>alias</code></em> = <em class="replaceable"><code>filepath</code></em>                    
                </pre><p>
            </p><div class="note"><h3 class="title">Примечание</h3><p>Помимо указания псевдонимов для базы данных в этом файле можно задать
                    параметры уровня базы данных для каждой описываемой базы данных. Эти параметры
                    задаются в фигурных скобках сразу после объявления псевдонима. Подробнее читайте
                    в <a class="link" href="#config-perdb" title="Параметры уровня базы данных">Параметры уровня базы данных</a></p></div></section><section class="section" id="isql-connect-remotely"><div class="titlepage"><div><div><h3 class="title">Соединение с БД на удалённом сервере</h3></div></div></div><p>При соединении с базой данных на удалённом сервере необходимо указать спецификацию
                удалённого сервера. Спецификация удалённого сервера зависит от используемого
                протокола. </p><p>Если вы при соединении с базой данных используете протокол TCP/IP, то спецификация
                первичного файла должна выглядеть следующим образом:
                </p><pre class="programlisting">  
<em class="replaceable"><code>host</code></em>[/<em class="replaceable"><code>port</code></em> | <em class="replaceable"><code>service</code></em>]:{<em class="replaceable"><code>filepath</code></em> | <em class="replaceable"><code>db_alias</code></em>}                   
                </pre><p>
            </p><p>Если вы при соединении с базой данных используете протокол под названием
                именованные каналы (Name Pipes), то спецификация первичного файла должна выглядеть
                следующим образом.
                </p><pre class="programlisting">  
\\<em class="replaceable"><code>host</code></em>[@<em class="replaceable"><code>port</code></em> | <em class="replaceable"><code>service</code></em>]\{<em class="replaceable"><code>filepath</code></em> | <em class="replaceable"><code>db_alias</code></em>}                   
                </pre><p>
            </p><p>Существует также унифицированный URL-подобный синтаксис спецификации удалённого
                сервера. В этом синтаксисе первым параметром указывается наименование протокола,
                далее указывается имя сервера или IP адрес, номер порта и путь к первичному файлу
                базы данных или псевдоним. В качестве протокола можно указать следующие значения:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>INET — TCP/IP (сначала пробует подключится по протоколу TCP/IP v6,
                            если не получилось, то TCP/IP v4);</p></li><li class="listitem"><p>INET4 — TCP/IP v4 (начиная с 3.0.1);</p></li><li class="listitem"><p>INET6 — TCP/IP v6 (начиная с 3.0.1);</p></li><li class="listitem"><p>WNET — NetBEUI или протокол именованных каналов;</p></li><li class="listitem"><p>XNET — локальный протокол.</p></li></ul></div><p>
                </p><pre class="programlisting">  
<em class="replaceable"><code>protocol</code></em>://[<em class="replaceable"><code>host</code></em>[:<em class="replaceable"><code>port</code></em> | <em class="replaceable"><code>service</code></em>]/]{<em class="replaceable"><code>filepath</code></em> | <em class="replaceable"><code>db_alias</code></em>}                   
                </pre><p>
            </p></section><section class="section" id="isql-connect-user"><div class="titlepage"><div><div><h3 class="title">Имя пользователя, пароль и роль</h3></div></div></div><p>Необязательные предложения <span class="database">USER</span> и
                    <span class="database">PASSWORD</span> задают, соответственно, имя и пароль пользователя
                присутствующего в базе данных безопасности (<code class="filename">security3.fdb</code> или
                той, что указана в параметре <em class="parameter"><code>SecurityDatabase</code></em>). Пользователя
                и пароль можно не указывать, если установлены переменные окружения
                    <code class="envar">ISC_USER</code> и <code class="envar">ISC_PASSWORD</code>. Их также можно не
                указывать при использовании доверительной аутентификации.</p><p>Если подключение происходит к embedded версии сервера, то достаточно указать
                только имя пользователя (проверка пароля не производится).</p><p>Необязательное предложение ROLE задаёт имя роли, права которой будут учитываться
                при подключении базы данных. Роль должна быть назначена пользователю в
                соответствующей базе данных безопасности. </p></section><section class="section" id="isql-connect-charset"><div class="titlepage"><div><div><h3 class="title">Набор символов</h3></div></div></div><p>Команда CONNECT не позволяет указать набор символов для подключения, однако вы
                можете это сделать с помощью команды SET NAMES, которую необходимо ввести до
                использования CONNECT.</p></section><section class="section" id="isql-connect-examples"><div class="titlepage"><div><div><h3 class="title">Примеры</h3></div></div></div><div class="example" id="d0e5827"><div class="example-title">Пример 5.4. Подключение к локальной (embedded) базе данных</div><div class="example-contents"><p>В следующем примере происходит подключение к базе данных в embedded варианте с
                    использованием имени пользователя из переменной среды <code class="envar">ISC_USER</code>.
                    </p><pre class="programlisting">
SQL&gt; CONNECT "C:\DATABASES\FIREBIRD\MY_EMPLOYEE.FDB";                    
                </pre><p>
                </p><p>В Linux это будет выглядеть следующим образом:
                    </p><pre class="programlisting">
SQL&gt; CONNECT "/databases/firebird/MY_EMPLOYEE.FDB";                  
                </pre><p>
                </p><p>При использовании псевдонимов, настроенных в
                        <code class="filename">databases.conf</code>:
                    </p><pre class="programlisting">
SQL&gt; CONNECT MY_EMPLOYEE;                  
                </pre><p>
                </p><p>Если переменная окружения <code class="envar">ISC_USER</code> не задана, или требуется
                    указать другого пользователя, то необходимо использовать предложение USER:
                    </p><pre class="programlisting">
SQL&gt; CONNECT MY_EMPLOYEE USER SYSDBA;                  
                </pre><p>
                </p></div></div><br class="example-break"/><div class="example" id="d0e5859"><div class="example-title">Пример 5.5. Подключение к локальной (не embedded) базе данных</div><div class="example-contents"><p>На Windows можно использовать локальный протокол XNET
                    </p><pre class="programlisting">
SQL&gt; CONNECT xnet://MY_EMPLOYEE USER SYSDBA PASSWORD 'masterkey';                  
                </pre><p>
                </p><p>Во всех операционных системах через TCP
                    </p><pre class="programlisting">
SQL&gt; CONNECT inet://localhost/MY_EMPLOYEE USER SYSDBA PASSWORD 'masterkey';                  
                </pre><p>
                </p></div></div><br class="example-break"/><div class="example" id="d0e5872"><div class="example-title">Пример 5.6. Подключение к удалённой базе данных с ролью RDB$ADMIN</div><div class="example-contents"><p>
                    </p><pre class="programlisting">
SQL&gt; CONNECT inet://dbserver/MY_EMPLOYEE USER BOB PASSWORD 'W45xs' ROLE RDB$ADMIN;                  
                </pre><p>
                </p></div></div><br class="example-break"/><div class="example" id="d0e5880"><div class="example-title">Пример 5.7. Подключение к удалённой базе данных с набором символов WIN1251</div><div class="example-contents"><p>
                    </p><pre class="programlisting">
SQL&gt; SET NAMES WIN1251;                        
SQL&gt; CONNECT inet://dbserver/MY_EMPLOYEE USER BOB PASSWORD 'W45xs';                  
                </pre><p>
                </p></div></div><br class="example-break"/></section></section><section class="section" id="isql-create_db"><div class="titlepage"><div><div><h2 class="title" style="clear: both">Создание базы данных</h2></div></div></div><a id="d0e5891" class="indexterm"/><p>Если при запуске isql вы не указали спецификацию для подключения к базе данных, то
            будет выдана подсказка о том что необходимо соединиться с базой данных с помощью
            оператора CONNECT или создать новую базу данных с помощью оператора CREATE
            DATABASE.</p><p>Оператор CREATE DATABASE является частью DSQL и подробно описан в <span class="quote">«<span class="quote">Руководство
                по языку SQL Firebird</span>»</span>, поэтому здесь будет приведён только краткий синтаксис
            и примеры использования. </p><p><span class="formalpara-title">Синтаксис: </span>
                </p><pre class="programlisting">                     
CREATE {DATABASE | SCHEMA} '<em class="replaceable"><code>&lt;filespec&gt;</code></em>'
  [USER <em class="replaceable"><code>username</code></em> [PASSWORD '<em class="replaceable"><code>password</code></em>'] [ROLE <em class="replaceable"><code>rolename</code></em>]]
  [PAGE_SIZE [=] <em class="replaceable"><code>size</code></em>]
  [LENGTH [=] <em class="replaceable"><code>num</code></em> [PAGE[S]]
  [SET NAMES '<em class="replaceable"><code>charset</code></em>']
  [DEFAULT CHARACTER SET <em class="replaceable"><code>default_charset</code></em>
  [COLLATION <em class="replaceable"><code>collation</code></em>]]
  [<em class="replaceable"><code>&lt;sec_file&gt;</code></em> [<em class="replaceable"><code>&lt;sec_file&gt;</code></em> ...]]
  [DIFFERENCE FILE '<em class="replaceable"><code>diff_file</code></em>'];

<em class="replaceable"><code>&lt;filespec&gt;</code></em> ::= [<em class="replaceable"><code>&lt;server_spec&gt;</code></em>]{<em class="replaceable"><code>filepath</code></em> | <em class="replaceable"><code>db_alias</code></em>}

<em class="replaceable"><code>&lt;server_spec&gt;</code></em> ::= 
    <em class="replaceable"><code>host</code></em>[\<em class="replaceable"><code>port</code></em> | <em class="replaceable"><code>service</code></em>]: 
  | \\<em class="replaceable"><code>host</code></em>[@<em class="replaceable"><code>port</code></em> | <em class="replaceable"><code>service</code></em>]\ 
  | <em class="replaceable"><code>&lt;protocol&gt;</code></em>://[<em class="replaceable"><code>host</code></em>[:<em class="replaceable"><code>port</code></em> | <em class="replaceable"><code>service</code></em>]/]

<em class="replaceable"><code>&lt;protocol&gt;</code></em> = inet | inet4 | inet6 | wnet | xnet

<em class="replaceable"><code>&lt;sec_file&gt;</code></em> ::= FILE '<em class="replaceable"><code>filepath</code></em>'
  [LENGTH [=] <em class="replaceable"><code>num</code></em> [PAGE[S]] [STARTING [AT [PAGE]] <em class="replaceable"><code>pagenum</code></em>]              
                  
</pre><p>
            </p><p>В следующем примере будет создана база данных <code class="filename">monkey.fdb</code> и
            сохранена в директории <code class="filename">test</code> на диске <code class="filename">С</code>.
            </p><pre class="programlisting">
SQL&gt;CREATE DATABASE 'C:\test\monkey.fdb' page_size 8192
CON&gt;user 'SYSDBA' password 'masterkey';            
        </pre><p>
        </p><div class="note"><h3 class="title">Примечание</h3><p>Путь к базе данных и пароль обязательно должны быть заключены в одинарные или
                двойные кавычки. Для имени пользователя, пароля и набора символов кавычки
                необязательны. При использовании двойных кавычек буду использованы правила
                3-диалекта, т.е. имя пользователя, роли и набора символов будут чувствительны к
                регистру символов.</p><p>Поскольку база данных создаётся в режиме embedded сервера, то файл базы данных
                будет создан с именем входа в систему в качестве владельца. Это может вызвать
                проблемы с доступом к файлу базы данных для других пользователей, особенно в Linux,
                которые могут захотеть подключится позднее. Если база данных создаётся с
                использованием сетевого или локального (Windows) протокола, то файл базы данных
                будет создан от имени пользователя службы (в Linux это пользователь
                firebird).</p></div><p>В данном случае база данных будет создана с использованием embedded версии Firebird.
            Для использования сетевых протоколов вы можете использовать префиксы протоколов или
            другие правила аналогичные правила для оператора CONNECT. </p><div class="example" id="d0e6028"><div class="example-title">Пример 5.8. Создание базы данных на удалённом сервере</div><div class="example-contents"><p>Создание базы данных на удалённом сервере baseserver расположенном по пути, на
                который ссылается псевдоним test, описанный в файле
                    <code class="filename">databases.conf</code>. Используется протокол TCP. Владельцем базы
                данных будет пользователь wizard.
                </p><pre class="programlisting">  
CREATE DATABASE 'baseserver:test'
USER wizard PASSWORD 'player' ROLE RDB$ADMIN
DEFAULT CHARACTER SET UTF8;                 
</pre><p>
                То же самое с использованием унифицированного URL-подобного синтаксиса задания
                спецификации удалённого сервера.
                </p><pre class="programlisting">  
CREATE DATABASE 'inet://baseserver:3050/test'
USER wizard PASSWORD 'player' ROLE RDB$ADMIN
DEFAULT CHARACTER SET UTF8;                 
</pre><p>
                или
                </p><pre class="programlisting">  
CREATE DATABASE 'inet://baseserver:gds_db/test'
USER wizard PASSWORD 'player' ROLE RDB$ADMIN
DEFAULT CHARACTER SET UTF8;                 
</pre><p>
                Начиная с Firebird 3.0.1 можно указать какой именно из протоколов IP v4 или IP v6 вы
                хотите использовать.
                </p><pre class="programlisting">  
CREATE DATABASE 'inet4://baseserver/test'
USER wizard PASSWORD 'player' ROLE RDB$ADMIN
DEFAULT CHARACTER SET UTF8;                 
</pre><p>
                или
                </p><pre class="programlisting">  
CREATE DATABASE 'inet6://baseserver/test'
USER wizard PASSWORD 'player' ROLE RDB$ADMIN
DEFAULT CHARACTER SET UTF8;                 
</pre><p>
                Создание базы данных с указанием IP адреса (IPv4) вместо указания имени сервера.
                </p><pre class="programlisting">  
CREATE DATABASE '127:0:0:1:test'
USER wizard PASSWORD 'player' ROLE RDB$ADMIN
DEFAULT CHARACTER SET UTF8;                 
</pre><p>
                Создание базы данных с указанием IP адреса (IPv6) вместо указания имени сервера.
                </p><pre class="programlisting">  
CREATE DATABASE '[::1]:test'
USER wizard PASSWORD 'player' ROLE RDB$ADMIN
DEFAULT CHARACTER SET UTF8;                 
</pre><p>
            </p></div></div><br class="example-break"/><div class="note"><h3 class="title">Примечание</h3><p>В отличие от оператора CONNECT в операторе CREATE DATABASE вы сразу можете указать
                набор символов, который будет использован в подключении после выполнения оператора
                CREATE DATABASE с помощью предложения SET NAMES.</p></div><p>После создания базы данных вы можете выполнять к ней запросы в интерактивном режиме.
            </p><pre class="programlisting">
SQL&gt;SELECT RDB$RELATION_ID FROM RDB$DATABASE;

RDB$RELATION_ID
===============
128

SQL&gt; commit;            
        </pre><p>
        </p><p>Чтобы вернуться в командную строку введите команду <code class="code">exit</code> или
                <code class="code">quit</code>.</p><div class="note"><h3 class="title">Примечание</h3><p>Вышеуказанная методика, как показано, работает, но в идеале базы данных и объекты
                метаданных должны создаваться и поддерживаться с использованием сценариев
                определения данных. </p></div></section><section class="section" id="isql-env"><div class="titlepage"><div><div><h2 class="title" style="clear: both">Установка переменных окружения ISC_USER и ISC_PASSWORD </h2></div></div></div><p>Переменная среды — это именованный объект, который содержит информацию, используемую
            одним или несколькими приложениями. Они глобальны для своих конкретных операционных
            систем. Сервер Firebird распознает и использует определенные переменные среды,
            настроенные в Windows, Linux и других системах Unix.</p><p>Переменные среды <code class="envar">ISC_USER</code> и <code class="envar">ISC_PASSWORD</code> в Firebird
            предназначены для предоставления SYSDBA доступа к базе данных из служебных программ
            командной строки и клиентских приложений всем, кто имеет доступ к хост-машине.</p><div class="caution"><h3 class="title">Внимание</h3><p>При запуске таких утилит командной строки, как <span class="application">isql</span>,
                    <span class="application">gbak</span>, <span class="application">gstat</span> и
                    <span class="application">gfix</span>, Firebird будет искать, установлены ли
                переменные среды <code class="envar">ISC_USER</code> и <code class="envar">ISC_PASSWORD</code>. Если вы не
                предоставите имя пользователя и пароль при локальном подключении к базе данных,
                Firebird позволит вам войти в систему, если найдет эти переменные.</p><p>Из соображений безопасности не рекомендуется указывать имя пользователя и пароль
                SYSDBA с использованием этих двух переменных среды, особенно на незащищенном
                компьютере.</p></div><p>Переменные среды <code class="envar">ISC_USER</code> и <code class="envar">ISC_PASSWORD</code> могут быть
            установлены для локального запуска <span class="application">isql</span>. Чтобы установить
            переменные среды:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>В Windows это делается в Панели управления -&gt; Система -&gt; Дополнительно -&gt;
                        Переменные среды. Любые изменения, сделанные здесь, будут постоянными. Вы
                        также можете определить эти переменные в командном окне до запуска любой из
                        утилит Firebird, например isql. Например:
                        </p><pre class="programlisting">
C:\&gt; set ISC_USER=sysdba
C:\&gt; set ISC_PASSWORD=secret
C:\&gt; isql my_employee

SQL&gt;                        
                    </pre><p>
                    </p></li><li class="listitem"><p>На платформах Linux и Unix это зависит от типа используемой оболочки и от
                        конфигурации настольного компьютера. Обратитесь к документации вашей
                        операционной системы, чтобы установить переменные среды. Для оболочки bash
                        этот процесс показан в следующем примере:
                        </p><pre class="programlisting">
cosmos&gt; export ISC_USER=sysdba
cosmos&gt; export ISC_PASSWORD=secret
cosmos&gt; /opt/firebird/bin/isql my_employee

SQL&gt;                        
                    </pre><p>
                    </p></li></ul></div></section><section class="section" id="isql-sql_dialect"><div class="titlepage"><div><div><h2 class="title" style="clear: both">SQL диалект</h2></div></div></div><p>Firebird поддерживает три диалекта SQL на каждом клиенте и сервере базы данных. Эти
            диалекты SQL различаются в контексте формата даты и времени и точности числового типа
            данных. Диалекты служат для инструктирования сервера Firebird о том, как обрабатывать
            функции, реализованные в устаревших базах данных Borland Interbase, более ранних, чем
            версия 6.0. Диалекты устанавливаются во время выполнения и могут быть изменены для
            клиента во время подключения или с помощью команды SET SQL DIALECT.</p><div class="note"><h3 class="title">Примечание</h3><p>Диалект 2 используется только при преобразовании базы данных диалекта 1 в базу
                данных диалекта 3.</p></div><p>Следующая таблица демонстрирует некоторые различия между диалектами. </p><div class="table" id="d0e6146"><div class="table-title">Таблица 5.3. Различия между SQL диалектами</div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="c1"/><col class="c2"/><col class="c3"/><col class="c4"/></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">SQL</th><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">Dialect 1</th><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">Dialect 2</th><th style="border-bottom: 1px solid ; ">Dialect 3</th></tr></thead><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">Тип данных DATE</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">Дата + время (Timestamp)</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">Сообщение об ошибке</td><td style="border-bottom: 1px solid ; ">Только дата</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">Тип данных TIMSTAMP</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">Timestamp</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">Timestamp</td><td style="border-bottom: 1px solid ; ">Timestamp</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">Тип данных TIME</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">Сообщение об ошибке</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">Сообщение об ошибке</td><td style="border-bottom: 1px solid ; ">Только время</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">Идентификаторы с разделителями (квотированные идентификаторы)
                                    "<em class="replaceable"><code>&lt;identifier&gt;</code></em>"</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">Строка</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">Сообщение об ошибки</td><td style="border-bottom: 1px solid ; ">Идентификатор</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">Точность арифметических операций. Например 1/3</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">0.3333333... (double precision)</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">0</td><td style="border-bottom: 1px solid ; ">0 (по правилам целочисленного деления)</td></tr><tr><td style="border-right: 1px solid ; ">Представление NUMERIC и DECIMAL с точностью больше 10</td><td style="border-right: 1px solid ; ">double precision</td><td style="border-right: 1px solid ; ">64-битное целое</td><td>64-битное целое (BIGINT)</td></tr></tbody></table></div></div><p><br class="table-break"/></p><div class="note"><h3 class="title">Примечание</h3><p>В настоящее время возможно создание баз данных только на диалекте 1 и 3, однако
                рекомендуется использовать исключительно диалект 3, поскольку в конечном итоге
                диалект 1 будет устаревшим. Диалект 2 нельзя использовать для создания базы данных,
                поскольку он служит только для преобразования Диалекта 1 в Диалект 3.</p></div><p>При подключении к базе данных с использованием <span class="application">isql</span> утилита
            использует диалект базы данных, если не указано иное. Диалекты не могут быть установлены
            в качестве параметра оператора <code class="code">CREATE DATABASE</code>. Таким образом, при создании
            базы данных с использованием <span class="application">isql</span> база данных будет на
            диалекте, который является текущим в <span class="application">isql</span> во время выполнения
            оператора <code class="code">CREATE DATABASE</code>. Вы можете установить диалект с помощью утилиты
                <span class="application">isql</span> двумя способами:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>При старте isql укажите диалект с использованием переключателя
                        -sql_dialect
                        </p><pre class="programlisting">
cosmos&gt; isql -sql_dialect 3                        
                    </pre><p>
                    </p></li><li class="listitem"><p>Внутри sql скрипта или в isql сессии с помощью команды <code class="code">SET SQL
                            DIALECT</code>
                        </p><pre class="programlisting">
SQL&gt; SET SQL DIALECT 3;                       
                    </pre><p>
                    </p></li></ul></div></section><section class="section" id="isql-terminator"><div class="titlepage"><div><div><h2 class="title" style="clear: both">Символ терминатора</h2></div></div></div><p>Символом терминатором по умолчанию для базы данных Firebird является точка с запятой
                <span class="quote">«<span class="quote">;</span>»</span>. Операторы будут только выполнены если они заканчиваются точкой с
            запятой. Однако вы можете использовать <span class="application">isql</span> для изменения
            символа на любой печатный символ или несколько символов из первых 127 символов
            подмножества ASCII с помощью команды <code class="code">SET TERM</code>.</p><div class="note"><h3 class="title">Примечание</h3><p>Терминатор по умолчанию может быть изменен во всех случаях, за исключением
                Procedural SQL или PSQL. PSQL не принимает никаких терминаторов, кроме точки с
                запятой.</p></div><p>Для изменения символа терминатора на тильду <span class="quote">«<span class="quote">~</span>»</span> введите следующую
            команду: </p><pre class="programlisting">
    SQL&gt; SET TERM ~ ;        
        </pre><p>
        </p><p>Для возврата терминатора, вы должны использовать текущий терминатор! Изменение
            терминатора полезно, если вы хотите ввести функцию PSQL, как показано в следующем
            примере. Поскольку PSQL будет принимать только точку с запятой в качестве терминатора,
            isql должен знать, какая точка с запятой используется для кода PSQL, а какая
            используется для завершения вводимых команд SQL.
            </p><pre class="programlisting">
SQL&gt; set term ~ ;

SQL&gt; create procedure test_proc (iInput integer = 666)
CON&gt; returns (oOutput integer)
CON&gt; as
CON&gt; begin
CON&gt;   oOutput = iInput;
CON&gt;   suspend;
CON&gt; end~

SQL&gt; set term ; ~

SQL&gt; commit;

SQL&gt; select * from test_proc;

     OOUTPUT
============
         666            
        </pre><p>
        </p><p>Вы можете видеть, что внутри кода самой процедуры терминатором является точка с
            запятой. Однако вне фактического кода процедуры терминатором является тильда (~).
                <span class="application">isql</span> обрабатывает одну команду <code class="code">CREATE
                PROCEDURE</code>, но внутри этого одного оператора SQL есть несколько встроенных
            операторов PSQL:
            </p><pre class="programlisting">
oOutput = iInput;
suspend;                
            </pre><p>
        </p><p>Они имеют точку с запятой, как того требует PSQL. Конец команды CREATE PROCEDURE
            обозначается использованием тильды в качестве терминатора:
            </p><pre class="programlisting">
end~               
            </pre><p>
        </p><p>При желании вы можете просто изменить терминатор, потому что вы предпочитаете что-то
            другое, а не точку с запятой.
            </p><pre class="programlisting">
SQL&gt; -- Change terminator from ; to +
SQL&gt; set term + ;

SQL&gt; select count(*) from employee+

       COUNT
============
          42

SQL&gt; -- Change terminator from + to 'fred'
SQL&gt; set term fred +

SQL&gt; select count(*) from employee fred

       COUNT
============
          42

SQL&gt; -- Change back from 'fred' to ;
SQL&gt; set term ; fred
            </pre><p>
        </p><p>Однако вы должны быть осторожны, чтобы не выбрать символ-терминатор, который приведет
            к сбою операторов SQL из-за того, что терминатор используется в какой-то момент в
            операторе SQL.
            </p><pre class="programlisting">
SQL&gt; select 600+60+6 as The_Beast from rdb$database;

THE_BEAST
=====================
666

SQL&gt; set term + ;
SQL&gt; select 600+60+6 as The_Beast from rdb$database+

Statement failed, SQLSTATE = 42000
Dynamic SQL Error
-SQL error code = -104
-Unexpected end of command - line 1, column 8
...

SQL&gt; set term ; +                
            </pre><p>
        </p><p>Присутствие терминатора в выражении вызвало ошибку <span class="quote">«<span class="quote">Unexpected end of
                command</span>»</span>. Анализатор SQL в ядре базы данных Firebird определил, что
                <code class="code">select 600</code> не является допустимым оператором. По этой причине лучше
            всегда выбирать символ или символы, которые не будут путать синтаксический анализатор.
            </p><pre class="programlisting">
SQL&gt; set term !! ;

SQL&gt; select 600+60+6 as The_Beast from rdb$database!!

THE_BEAST
=====================
666              
            </pre><p>
        </p></section><section class="section" id="isql-prompts"><div class="titlepage"><div><div><h2 class="title" style="clear: both">Подсказки ISQL</h2></div></div></div><p><span class="formalpara-title">Подсказка SQL. </span>Как показано выше, обычная подсказка <span class="application">isql</span> для ввода —
                это подсказка <code class="code">SQL&gt;</code>. Это указывает на то, что предыдущая команда была
                выполнена, и теперь <span class="application">isql</span> ожидает обработки новой
                команды.</p><p><span class="formalpara-title">Подсказка CON. </span>Подсказка <code class="code">CON&gt;</code> отображается, если пользователь нажимает клавишу ENTER
                без завершения оператора SQL с помощью терминатора. Например:
                </p><pre class="programlisting">
SQL&gt; HELP
CON&gt;                
            </pre><p>
            </p><p>Всякий раз, когда вы видите приглашение <code class="code">CON&gt;</code>, вы можете либо продолжить
            ввод оставшейся части команды, либо ввести терминатор для завершения команды. В
            последнем случае команда будет выполнена после нажатия клавиши ENTER.</p></section><section class="section" id="isql-errors"><div class="titlepage"><div><div><h2 class="title" style="clear: both">Обработка ошибок и поддержка исключений</h2></div></div></div><p>Обработка исключений — это программная конструкция, предназначенная для обработки
            ситуаций, которые нарушает нормальное выполнение программы. Это так называемые ошибки.
            Исключением являются именованное сообщение об ошибке, определяемые пользователем,
            написанные специально для базы данных и сохраненные в этой базе данных для использования
            в хранимых процедурах, функциях, пакетах, анонимных блоках и триггерах.</p><p>Например, если в триггере обнаруживается, что значение для таблицы неверно, то
            возникает исключение. Это приводит к откату всей транзакции, которую клиентское
            приложение пытается зафиксировать. Исключения могут совместно использоваться различными
            модулями приложения и даже различными приложениями, совместно использующими базу данных.
            Они предоставляют простой способ стандартизировать обработку заранее запрограммированных
            ошибок ввода.</p><p>Исключения составляют объекты базы данных, такие как таблицы, представления и домены,
            и являются частью метаданных базы данных. Их можно создавать, изменять и удалять, как и
            все другие объекты Firebird, используя <span class="application">isql</span>.</p><p>В <span class="application">isql</span> сообщения об ошибках содержат переменную SQLSTATE и
            статус вектор Firebird. Расшифровку кодов ошибок SQLSTATE вы можете найти в <span class="quote">«<span class="quote">Руководстве
            по языку SQL СУБД Firebird</span>»</span>.</p><div class="example" id="d0e6381"><div class="example-title">Пример 5.9. Сообщение об ошибке в isql</div><div class="example-contents"><p>
                </p><pre class="programlisting">

SQL&gt; select 1/0 from rdb$database;

               DIVIDE
=====================
Statement failed, SQLSTATE = 22012
arithmetic exception, numeric overflow, or string truncation
-Integer divide by zero.  The code attempted to divide an integer value by an 
integer divisor of zero.
                    
                </pre><p>
            </p></div></div><br class="example-break"/></section><section class="section" id="isql-transactions"><div class="titlepage"><div><div><h2 class="title" style="clear: both">Обработка транзакций</h2></div></div></div><p>В <span class="application">isql</span> транзакция начинается сразу после запуска утилиты.
            Транзакция начинается в изоляции SNAPSHOT с разрешением блокировки в режиме WAIT.
            Поскольку утилита Firebird <span class="application">isql</span> принимает DDL, DML и другие
            команды, транзакции обрабатываются соответствующим образом следующими способами: </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Операторы DDL фиксируются автоматически в двух случаях:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>Когда операторы COMMIT включен в скрипт.</p></li><li class="listitem"><p>Когда включена автоматическая фиксация транзакций для DDL
                                    операторов (режим по умолчанию). В этом случае выполнение
                                    каждого DDL оператора транзакция автоматически подтверждается
                                    после ввода каждого оператора DDL, и стартует новая транзакция.
                                    Чтобы отключить режим автоматической фиксации, выполните
                                    инструкцию <code class="code">SET AUTODDL OFF</code>. Для возврата в режим
                                    автоматической фиксации для DDL операторов выполните инструкцию
                                        <code class="code">SET AUTODDL ON</code>.</p></li></ul></div></li><li class="listitem"><p>Операторы DML для выборки или изменения данных стартуют новую транзакцию с
                        уровнем изоляции SNAPSHOT, если она не была начата ранее. Такая транзакция
                        будет активной до тех пор, пока не будет вручную подтверждена оператором
                        COMMIT или отменена оператором ROLLBACK. </p></li><li class="listitem"><p>Вы можете использовать различные команды SHOW в isql для запроса
                        метаданных базы данных. При этом ISQL запускает транзакцию с уровнем
                        изоляции READ COMMITED, что дает возможность видеть все изменения
                        метаданных, подтвержденные другими пользователями. </p></li></ul></div><p>Пользователи могут указать уровень изоляции и другие параметры для следующей
            транзакции с помощью оператора <code class="code">SET TRANSACTION</code>. Он может быть выполнен
            только тогда, когда не активна другая транзакция. В противном случае будет задан вопрос:
            подтвердить или откатить активную транзакцию. Синтаксис оператора <code class="code">SET
                TRANSACTION</code> подробно описан в <span class="quote">«<span class="quote">Руководство по языку SQL
                Firebird</span>»</span>.</p><div class="example" id="d0e6434"><div class="example-title">Пример 5.10. Старт транзакции с режимом изолированности READ COMMITED</div><div class="example-contents"><p>
                </p><pre class="programlisting">
SET TRANSACTION WAIT READ COMMITTED LOCK TIMEOUT 10;                    
                </pre><p>
            </p></div></div><br class="example-break"/><div class="note"><h3 class="title">Примечание</h3><p>Поскольку оператор <code class="code">SET TRANSACTION</code> является оператором DSQL, а не
                собственной командой <span class="application">isql</span>, то информация о нём
                отсутствует в справке выдаваемой оператором <code class="code">HELP SET</code>.</p></div><p>После выполнения COMMIT или ROLLBACK, новая DML команда стартует транзакцию с
            параметрами по умолчанию. Если необходимо, чтобы новая транзакция стартовала с
            параметрами, которые были указаны для предыдущей транзакции, то необходимо включить
            режим сохранения параметров транзакции с помощью команды <code class="code">SET
                KEEP_TRAN_PARAMS</code> (может быть сокращена до SET KEEP_TRAN).</p><p>Если режим KEEP_TRAN_PARAMS установлен в: </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>ON, то <span class="application">isql</span> сохраняет текст следующего
                        успешного оператора SET TRANSACTION, и новые транзакции DML запускаются с
                        использованием того же SQL (вместо режима по умолчанию CONCURRENCY
                        WAIT);</p></li><li class="listitem"><p>OFF, то <span class="application">isql</span> начинает новую транзакцию DML как
                        обычно.</p></li></ul></div><div class="note"><h3 class="title">Примечание</h3><p>Режим сохранения параметров транзакции появился в Firebird 3.0.6. Ранее невозможно
                было включить режим сохранения параметров транзакции. После команд COMMIT и ROLLBACK
                необходимо было каждый раз выполнять команду SET TRANSACTION с необходимыми
                параметрами.</p></div><p><span class="formalpara-title">См. также: </span><a class="link" href="#isql-commands_set-set_keep_tran" title="SET KEEP_TRAN_PARAMS">SET KEEP_TRAN</a></p></section><section class="section" id="isql-script_handling"><div class="titlepage"><div><div><h2 class="title" style="clear: both">Обработка скрипта</h2></div></div></div><p>Пакет операторов DDL и/или DML в текстовом файле называется сценарием (скриптом).
            Скрипты могут быть использованы для создания и изменения объектов базы данных
            (метаданных). Они называются сценариями языка определения данных (DDL). Скрипты, которые
            манипулируют данными путем выбора, вставки, обновления, удаления или выполнения
            преобразований данных, называются скриптами языка манипулирования данными (DML).</p><p> Одной из наиболее важных задач, выполняемых <span class="application">isql</span>, является
            обработка скриптов. Он может обрабатывать как сценарии DDL, так и сценарии DML. Большие
            файлы сценариев можно разбить на несколько файлов скриптов поменьше с помощью инструкции
            INPUT. </p><p><span class="formalpara-title">Синтаксис: </span>
                </p><pre class="programlisting"> 
INPUT <em class="replaceable"><code>&lt;filespec&gt;</code></em>                      
                    </pre><p>
            </p><p>Данный оператор позволяет включить один файл сценария внутрь другого. Операторы
            сценариев выполняются в том порядке, в котором они появляются в файле сценариев.
            Настройка по умолчанию в <span class="application">isql</span> для AUTODDL установлена на ON.
            Вы можете использовать команду <code class="code">SET AUTODDL</code>, чтобы контролировать, где или
            когда будут подтверждены операторы изменения метаданных. </p><div class="note"><h3 class="title">Примечание</h3><p>Параметр AUTODDL влияет только на операторы DDL. Он не фиксирует транзакцию для
                операторов DML. Если вы смешиваете инструкции DDL и DML в одном и том же
                интерактивном сеансе, то фиксации транзакций для DDL с помощью AUTODDL не фиксируют
                ваши транзакции для операторов DML. Например:
                </p><pre class="programlisting">
SQL&gt; set autoddl on;

SQL&gt; insert into test(a) values (666);
SQL&gt; commit;

SQL&gt; select * from test;

A
============
666

SQL&gt; insert into test(a) values (999);
SQL&gt; select * from test;

A
============
666
999

SQL&gt; create table another_test(b integer);
SQL&gt; rollback;

SQL&gt; select * from test;

A
============
666                
            </pre><p>
            </p></div><p>Скрипты могут перенаправить свои выходные данные в файл журнала с помощью команды
                <code class="code">OUTPUT <em class="replaceable"><code>&lt;file_name&gt;</code></em></code>. Это можно ввести
            непосредственно в приглашении <span class="application">isql</span> или как часть самого файла
            скрипта. </p></section><section class="section" id="isql-commands"><div class="titlepage"><div><div><h2 class="title" style="clear: both">ISQL команды</h2></div></div></div><p>Команды Isql влияют на работу самого isql и никак не влияют на базу данных или данные.
            Эти команды используются для отображения справки, чтения, записи и запуска сценариев, а
            также выполнение инструкций командной строки. Вы можете легко увидеть список доступных
            команд, набрав команду HELP, которая выдаст следующий вывод: </p><pre class="screen">

SQL&gt; HELP;
Frontend commands:
BLOBDUMP &lt;blobid&gt; &lt;file&gt;   -- dump BLOB to a file
BLOBVIEW &lt;blobid&gt;          -- view BLOB in text editor
EDIT     [&lt;filename&gt;]      -- edit SQL script file and execute
EDIT                       -- edit current command buffer and execute
HELP                       -- display this menu
INput    &lt;filename&gt;        -- take input from the named SQL file
OUTput   [&lt;filename&gt;]      -- write output to named file
OUTput                     -- return output to stdout
SET      &lt;option&gt;          -- (Use HELP SET for complete list)
SHELL    &lt;command&gt;         -- execute Operating System command in sub-shell
SHOW     &lt;object&gt; [&lt;name&gt;] -- display system information
    &lt;object&gt; = CHECK, COLLATION, DATABASE, DOMAIN, EXCEPTION, FILTER, FUNCTION,
               GENERATOR, GRANT, INDEX, PACKAGE, PROCEDURE, ROLE, SQL DIALECT,
               SYSTEM, TABLE, TRIGGER, VERSION, USERS, VIEW
EXIT                       -- exit and commit changes
QUIT                       -- exit and roll back changes

All commands may be abbreviated to letters in CAPitals
            
        </pre><p>
        </p><p>Теперь обсудим каждую из команд отдельно.</p><div class="note"><h3 class="title">Примечание</h3><p>Обратите внимание на последнюю строку вывода команды help. Это объясняет, что
                каждая из команд может быть сокращена до букв, отображаемых заглавными буквами. В
                следующем обсуждении дополнительные символы будут отображаться, как указано выше,
                строчными буквами. Например, команда ввода будет показана как INput, чтобы указать,
                что символы 'put' являются необязательными.</p></div><section class="section" id="isql-commands-blobdump"><div class="titlepage"><div><div><h3 class="title">BLOBDUMP</h3></div></div></div><a id="d0e6544" class="indexterm"/><p><span class="formalpara-title">Назначение: </span>Сохранение данных BLOB в указанном файле.</p><p><span class="formalpara-title">Синтаксис: </span>
                    </p><pre class="programlisting"> 
BLOBDUMP <em class="replaceable"><code>&lt;blob_id&gt;</code></em> <em class="replaceable"><code>&lt;filename&gt;</code></em>                      
                    </pre><p>
                </p><p>
                </p><div class="table" id="d0e6570"><div class="table-title">Таблица 5.4. Параметры оператора BLOBDUMP</div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col style="text-align: left; " class="colArgument"/><col style="text-align: left; " class="colDesc"/></colgroup><thead><tr valign="middle"><th style="text-align: center; vertical-align: middle; border-right: 1px solid ; border-bottom: 1px solid ; ">Параметр</th><th style="text-align: center; vertical-align: middle; border-bottom: 1px solid ; ">Описание</th></tr></thead><tbody><tr><td style="text-align: left; border-right: 1px solid ; border-bottom: 1px solid ; "><em class="replaceable"><code>blob_id</code></em></td><td style="text-align: left; border-bottom: 1px solid ; ">
                                    <p>BLOB идентификатор.</p>
                                </td></tr><tr><td style="text-align: left; border-right: 1px solid ; "><em class="replaceable"><code>filename</code></em></td><td style="text-align: left; ">
                                    <p>Имя файла в который необходимо сохранить BLOB.</p>
                                </td></tr></tbody></table></div></div><p><br class="table-break"/>
            </p><p>Эта команда позволяет вам скопировать BLOB из базы данных во внешний файл.
                Оператор BLOBDUMP требует два параметра, идентификатор BLOB-объекта и имя файла. Вам
                необходимо передать идентификатор BLOB-объекта в виде пары шестнадцатеричных чисел,
                разделенных двоеточием. Первое число — это идентификатор таблицы, а второе —
                последовательный номер в базе данных. Для получения этого идентификатора выполните
                любой оператор SELECT, который выбирает столбец BLOB. Вывод покажет
                шестнадцатеричный идентификатор BLOB выше или на месте столбца BLOB в зависимости от
                того, установлен ли SET BLOBDISPLAY в ON или OFF.</p><div class="example" id="d0e6605"><div class="example-title">Пример 5.11. Сохранение BLOB во внешний файл</div><div class="example-contents"><p>
                    </p><pre class="programlisting">

SQL&gt; set blobdisplay off;

SQL&gt; select proj_id, proj_desc
CON&gt; from project
CON&gt; where proj_id = 'MKTPR';

PROJ_ID PROJ_DESC
======= =================
MKTPR   85:10

SQL&gt; blobdump 85:10 c:\project.jpg;
                        
                    </pre><p>
                </p></div></div><br class="example-break"/><p>Идентификатор BLOB-объекта, необходимый в приведенном выше примере, равен
                85:10.</p><p><span class="formalpara-title">Смотри также: </span><a class="link" href="#isql-commands_set-set_blob" title="SET BLOB">SET BLOBDISPLAY</a>, <a class="link" href="#isql-commands-blobview" title="BLOBVIEW">BLOBVIEW</a>.</p></section><section class="section" id="isql-commands-blobview"><div class="titlepage"><div><div><h3 class="title">BLOBVIEW</h3></div></div></div><a id="d0e6628" class="indexterm"/><p><span class="formalpara-title">Назначение: </span>Отображение данных BLOB в текстовом редакторе по умолчанию.</p><p><span class="formalpara-title">Синтаксис: </span>
                    </p><pre class="programlisting"> 
BLOBVIEW <em class="replaceable"><code>&lt;blob_id&gt;</code></em>                      
                    </pre><p>
                </p><p>
                </p><div class="table" id="d0e6651"><div class="table-title">Таблица 5.5. Параметры оператора BLOBVIEW</div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col style="text-align: left; " class="colArgument"/><col style="text-align: left; " class="colDesc"/></colgroup><thead><tr valign="middle"><th style="text-align: center; vertical-align: middle; border-right: 1px solid ; border-bottom: 1px solid ; ">Параметр</th><th style="text-align: center; vertical-align: middle; border-bottom: 1px solid ; ">Описание</th></tr></thead><tbody><tr><td style="text-align: left; border-right: 1px solid ; "><em class="replaceable"><code>blob_id</code></em></td><td style="text-align: left; ">
                                    <p>BLOB идентификатор.</p>
                                </td></tr></tbody></table></div></div><p><br class="table-break"/>
            </p><p>Команда BLOBVIEW отображает данные BLOB в текстовом редакторе по умолчанию. </p><div class="example" id="d0e6677"><div class="example-title">Пример 5.12. Открытие BLOB во внешнем текстовом редакторе</div><div class="example-contents"><p>
                    </p><pre class="programlisting">

SQL&gt; set blobdisplay off;

SQL&gt; select proj_id, proj_desc
CON&gt; from project
CON&gt; where proj_id = 'MKTPR';

PROJ_ID PROJ_DESC
======= =================
MKTPR   85:10

SQL&gt; blobview 85:10;
                        
                    </pre><p>
                </p></div></div><br class="example-break"/><p>В примере выше содержимое выбранного BLOB будет отображено во внешнем редакторе.
                Когда редактор закрыт, управление возвращается в <span class="application">isql</span>. Вы
                не можете использовать <span class="application">isql</span>, пока редактор открыт.</p><div class="note"><h3 class="title">Примечание</h3><p>BLOBVIEW может вернуть ошибку <span class="quote">«<span class="quote">Invalid transaction handle</span>»</span> после
                    закрытия редактора. Для исправления ситуации запустите транзакцию вручную с
                    помощью команды <code class="code">SET TRANSACTION</code>.</p></div><p><span class="formalpara-title">Смотри также: </span><a class="link" href="#isql-commands-blobdump" title="BLOBDUMP">BLOBDUMP</a>.</p></section><section class="section" id="isql-commands-edit"><div class="titlepage"><div><div><h3 class="title">EDIT</h3></div></div></div><a id="d0e6712" class="indexterm"/><p><span class="formalpara-title">Назначение: </span>Вызов текстового редактора по умолчанию для скрипта.</p><p><span class="formalpara-title">Синтаксис: </span>
                    </p><pre class="programlisting"> 
EDIT [<em class="replaceable"><code>&lt;filename&gt;</code></em>]                      
                    </pre><p>
                </p><p>
                </p><div class="table" id="d0e6735"><div class="table-title">Таблица 5.6. Параметры оператора EDIT</div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col style="text-align: left; " class="colArgument"/><col style="text-align: left; " class="colDesc"/></colgroup><thead><tr valign="middle"><th style="text-align: center; vertical-align: middle; border-right: 1px solid ; border-bottom: 1px solid ; ">Параметр</th><th style="text-align: center; vertical-align: middle; border-bottom: 1px solid ; ">Описание</th></tr></thead><tbody><tr><td style="text-align: left; border-right: 1px solid ; "><em class="replaceable"><code>filename</code></em></td><td style="text-align: left; ">
                                    <p>Имя файла для редактирования.</p>
                                </td></tr></tbody></table></div></div><p><br class="table-break"/>
            </p><p>Команда EDIT позволяет редактировать существующий файл. Это может быть файл команд
                SQL, который будет использоваться командой ввода <span class="application">isql</span>
                (см. ниже), или любой другой текстовый файл. Файл должен существовать.</p><p>Если имя файла не указано, история всех ваших предыдущих команд будет отображаться
                для редактирования.</p><div class="note"><h3 class="title">Примечание</h3><p>Обратите внимание, что при выходе из редактора в этом случае команды,
                    оставленные в буфере в конце редактирования, будут выполняться как файл
                    сценария.</p></div></section><section class="section" id="isql-commands-help"><div class="titlepage"><div><div><h3 class="title">HELP</h3></div></div></div><a id="d0e6772" class="indexterm"/><p><span class="formalpara-title">Назначение: </span>Отображение список команд <span class="application">isql</span> с их
                    описанием.</p><p><span class="formalpara-title">Синтаксис: </span>
                    </p><pre class="programlisting"> 
HELP [SET]                    
                    </pre><p>
                </p><p>Команда HELP отображает список основных команд <span class="application">isql</span> с
                их описанием. </p><pre class="screen">

SQL&gt; HELP;
Frontend commands:
BLOBDUMP &lt;blobid&gt; &lt;file&gt;   -- dump BLOB to a file
BLOBVIEW &lt;blobid&gt;          -- view BLOB in text editor
EDIT     [&lt;filename&gt;]      -- edit SQL script file and execute
EDIT                       -- edit current command buffer and execute
HELP                       -- display this menu
INput    &lt;filename&gt;        -- take input from the named SQL file
OUTput   [&lt;filename&gt;]      -- write output to named file
OUTput                     -- return output to stdout
SET      &lt;option&gt;          -- (Use HELP SET for complete list)
SHELL    &lt;command&gt;         -- execute Operating System command in sub-shell
SHOW     &lt;object&gt; [&lt;name&gt;] -- display system information
    &lt;object&gt; = CHECK, COLLATION, DATABASE, DOMAIN, EXCEPTION, FILTER, FUNCTION,
               GENERATOR, GRANT, INDEX, PACKAGE, PROCEDURE, ROLE, SQL DIALECT,
               SYSTEM, TABLE, TRIGGER, VERSION, USERS, VIEW
EXIT                       -- exit and commit changes
QUIT                       -- exit and roll back changes

All commands may be abbreviated to letters in CAPitals
            
        </pre><p>
            </p><p>Если после HELP присутствует необязательное ключевое слово SET, то будет
                отображена справка по набору команд начинающихся с SET. </p><pre class="screen">

SQL&gt; help set;
Set commands:
    SET                    -- display current SET options
    SET AUTOddl            -- toggle autocommit of DDL statements
    SET BAIL               -- toggle bailing out on errors in non-interactive mode
    SET BLOB [ALL|&lt;n&gt;]     -- display BLOBS of subtype &lt;n&gt; or ALL
    SET BLOB               -- turn off BLOB display
    SET COUNT              -- toggle count of selected rows on/off
    SET MAXROWS [&lt;n&gt;]      -- limit select stmt to &lt;n&gt; rows, zero is no limit
    SET ECHO               -- toggle command echo on/off
    SET EXPLAIN            -- toggle display of query access plan in the explained form
    SET HEADING            -- toggle display of query column titles
    SET LIST               -- toggle column or table display format
    SET NAMES &lt;csname&gt;     -- set name of runtime character set
    SET PLAN               -- toggle display of query access plan
    SET PLANONLY           -- toggle display of query plan without executing
    SET SQL DIALECT &lt;n&gt;    -- set sql dialect to &lt;n&gt;
    SET STATs              -- toggle display of performance statistics
    SET TIME               -- toggle display of timestamp with DATE values
    SET TERM &lt;string&gt;      -- change statement terminator string
    SET WIDTH &lt;col&gt; [&lt;n&gt;]  -- set/unset print width to &lt;n&gt; for column &lt;col&gt;

All commands may be abbreviated to letters in CAPitals
            
        </pre><p>
            </p><div class="note"><h3 class="title">Примечание</h3><p>Обратите внимание на последнюю строку вывода команды help. Это объясняет, что
                    каждая из команд может быть сокращена до букв, отображаемых заглавными буквами.
                    В следующем обсуждении дополнительные символы будут отображаться, как указано
                    выше, строчными буквами. Например, команда ввода будет показана как INput, чтобы
                    указать, что символы 'put' являются необязательными.</p></div></section><section class="section" id="isql-commands-add"><div class="titlepage"><div><div><h3 class="title">ADD</h3></div></div></div><a id="d0e6812" class="indexterm"/><p><span class="formalpara-title">Назначение: </span>Добавление записей в таблицу.</p><p><span class="formalpara-title">Синтаксис: </span>
                    </p><pre class="programlisting"> 
ADD <em class="replaceable"><code>&lt;tablename&gt;</code></em>                    
                    </pre><p>
                </p><p>
                </p><div class="table" id="d0e6835"><div class="table-title">Таблица 5.7. Параметры оператора ADD</div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col style="text-align: left; " class="colArgument"/><col style="text-align: left; " class="colDesc"/></colgroup><thead><tr valign="middle"><th style="text-align: center; vertical-align: middle; border-right: 1px solid ; border-bottom: 1px solid ; ">Параметр</th><th style="text-align: center; vertical-align: middle; border-bottom: 1px solid ; ">Описание</th></tr></thead><tbody><tr><td style="text-align: left; border-right: 1px solid ; "><em class="replaceable"><code>tablename</code></em></td><td style="text-align: left; ">
                                    <p>Имя таблицы для добавления данных.</p>
                                </td></tr></tbody></table></div></div><p><br class="table-break"/>
            </p><p>Команда ADD запрашивает данные для каждого столбца, указанной таблицы, и добавляет
                запись в таблицу. Вы можете добавить столько записей, сколько пожелаете, так как
                команда продолжается до тех пор, пока не произойдет ошибка или не будет нажата
                клавиша ENTER без данных. Если вы хотите установить для столбца значение NULL,
                введите его в точности так, как показано.</p><div class="example" id="d0e6861"><div class="example-title">Пример 5.13. Добавление данных в таблицу с помощью команды ADD</div><div class="example-contents"><p>
                    </p><pre class="programlisting">

SQL&gt; add country;

Enter data or NULL for each column. RETURN to end.
Enter COUNTRY&gt;Scotland
Enter CURRENCY&gt;GBP
Enter COUNTRY&gt;

SQL&gt; commit;
                        
                    </pre><p>
                </p></div></div><br class="example-break"/></section><section class="section" id="isql-commands-copy"><div class="titlepage"><div><div><h3 class="title">COPY</h3></div></div></div><a id="d0e6872" class="indexterm"/><p><span class="formalpara-title">Назначение: </span>Копирование структуры таблицы.</p><p><span class="formalpara-title">Синтаксис: </span>
                    </p><pre class="programlisting"> 
COPY <em class="replaceable"><code>&lt;from_tablename&gt;</code></em> <em class="replaceable"><code>&lt;to_tablename&gt;</code></em> [<em class="replaceable"><code>&lt;other_database&gt;</code></em>]                  
                    </pre><p>
                </p><p>
                </p><div class="table" id="d0e6901"><div class="table-title">Таблица 5.8. Параметры оператора COPY</div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col style="text-align: left; " class="colArgument"/><col style="text-align: left; " class="colDesc"/></colgroup><thead><tr valign="middle"><th style="text-align: center; vertical-align: middle; border-right: 1px solid ; border-bottom: 1px solid ; ">Параметр</th><th style="text-align: center; vertical-align: middle; border-bottom: 1px solid ; ">Описание</th></tr></thead><tbody><tr><td style="text-align: left; border-right: 1px solid ; border-bottom: 1px solid ; "><em class="replaceable"><code>from_tablename</code></em></td><td style="text-align: left; border-bottom: 1px solid ; ">
                                    <p>Имя таблицы из которой делается копия.</p>
                                </td></tr><tr><td style="text-align: left; border-right: 1px solid ; border-bottom: 1px solid ; "><em class="replaceable"><code>to_tablenamee</code></em></td><td style="text-align: left; border-bottom: 1px solid ; ">
                                    <p>Имя таблицы в которую будет сделана копия.</p>
                                </td></tr><tr><td style="text-align: left; border-right: 1px solid ; "><em class="replaceable"><code>other_database</code></em></td><td style="text-align: left; ">
                                    <p>Спецификация для подключения к другой базе данных, в
                                        которую будет производится копирование. </p>
                                </td></tr></tbody></table></div></div><p><br class="table-break"/>
            </p><p>Команда COPY позволяет скопировать большую часть структуры таблицы в новую таблицу
                в текущей базе данных или другой. К сожалению, у неё есть проблемы: </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Она выполняет командную строку для выполнения работы и подключается к
                            принимающей базе данных с помощью приложения с именем
                                <span class="application">isql</span>. Если ваша система переименовала
                                <code class="filename">isql</code> в <code class="filename">isql-fb</code>, вы на
                            самом деле в конечном итоге запустите неправильное приложение
                                <span class="application">isql</span>, и единственным результатом будет
                            запутанная ошибка.</p></li><li class="listitem"><p>Предполагается, что <span class="application">isql</span> будет находится в
                                <code class="filename">$PATH</code> или <code class="filename">%PATH%</code>. </p></li><li class="listitem"><p>Вам необходимо определить <code class="envar">ISC_USER</code> и
                                <code class="envar">ISC_PASSWORD</code> для дочернего процесса
                                <span class="application">isql</span> для входа в получающую базу данных
                            для создания таблицы. Это очень небезопасно.</p></li><li class="listitem"><p>Из-за необходимости в <code class="envar">ISC_USER</code> и
                                <code class="envar">ISC_PASSWORD</code> принимающая база данных должна работать
                            на том же сервере, что и исходная база данных.</p></li><li class="listitem"><p>Данные таблицы не копируются в принимающую базу данных (или таблицу).
                            Копируются только следующие части структур таблицы:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle; "><li class="listitem"><p>Домены, необходимые для воссоздания таблицы. Это
                                        применимо, только если копия находится в другой базе
                                        данных.</p></li><li class="listitem"><p>Сама таблица будет создана.</p></li><li class="listitem"><p>Ограничение первичного ключа, если оно есть.</p></li></ul></div></li><li class="listitem"><p>Копируется не вся структура таблицы. Отсутствуют:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle; "><li class="listitem"><p>Ограничения внешнего ключа.</p></li><li class="listitem"><p>Ограничения проверок (CHECK).</p></li><li class="listitem"><p>Индексы, за исключением индекса необходимого для поддержки
                                        первичного ключа.</p></li><li class="listitem"><p>Триггеры.</p></li><li class="listitem"><p>Все данные таблицы.</p></li></ul></div></li></ul></div><p>Если вы хотите скопировать в другую базу данных, то другая база данных должна быть
                на том же сервере, что и текущая. Например, вы не можете подключиться к базе данных
                на сервере с именем tux и скопировать таблицу в базу данных, работающую на сервере
                tuxrep. Команда COPY не может передать имя пользователя и/или пароль, установка
                    <code class="envar">ISC_USER</code> и <code class="envar">ISC_PASSWORD</code> влияет сразу на все
                подключения, пользователь может отсутствовать на другом сервере или у него может
                быть другой пароль. </p><div class="example" id="d0e7034"><div class="example-title">Пример 5.14. Копирование структуры таблицы командой COPY</div><div class="example-contents"><p>
                    </p><pre class="programlisting">

tux&gt;$ export ISC_USER=SYSDBA
tux&gt;$ export ISC_PASSWORD=secret
tux&gt;$ isql employee

Database: employee, User: sysdba

SQL&gt; -- MAke a copy of the employee table into this database.
SQL&gt; copy employee employee_2;

SQL&gt; -- Compare table structures...
SQL&gt; show table employee;

EMP_NO              (EMPNO) SMALLINT Not Null
FIRST_NAME          (FIRSTNAME) VARCHAR(15) Not Null
LAST_NAME           (LASTNAME) VARCHAR(20) Not Null
PHONE_EXT           VARCHAR(4) Nullable
HIRE_DATE           TIMESTAMP Not Null DEFAULT 'NOW'
DEPT_NO             (DEPTNO) CHAR(3) Not Null
                    CHECK (VALUE = '000' OR
                    (VALUE &gt; '0' AND VALUE &lt;= '999') OR VALUE IS NULL)
JOB_CODE            (JOBCODE) VARCHAR(5) Not Null
                    CHECK (VALUE &gt; '99999')
JOB_GRADE           (JOBGRADE) SMALLINT Not Null
CHECK               (VALUE BETWEEN 0 AND 6)
JOB_COUNTRY         (COUNTRYNAME) VARCHAR(15) Not Null
SALARY              (SALARY) NUMERIC(10, 2) Not Null DEFAULT 0
                    CHECK (VALUE &gt; 0)
FULL_NAME           Computed by: (last_name || ', ' || first_name)
CONSTRAINT INTEG_28:
  Foreign key (DEPT_NO) References DEPARTMENT (DEPT_NO)
CONSTRAINT INTEG_29:
  Foreign key (JOB_CODE, JOB_GRADE, JOB_COUNTRY)
  References JOB (JOB_CODE, JOB_GRADE, JOB_COUNTRY)
CONSTRAINT INTEG_27:
  Primary key (EMP_NO)
CONSTRAINT INTEG_30:
  CHECK ( salary &gt;= (SELECT min_salary FROM job WHERE
                     job.job_code = employee.job_code AND
                     job.job_grade = employee.job_grade AND
                     job.job_country = employee.job_country) AND
          salary &lt;= (SELECT max_salary FROM job WHERE
                     job.job_code = employee.job_code AND
                     job.job_grade = employee.job_grade AND
                     job.job_country = employee.job_country))
Triggers on Table EMPLOYEE:
SET_EMP_NO, Sequence: 0, Type: BEFORE INSERT, Active
SAVE_SALARY_CHANGE, Sequence: 0, Type: AFTER UPDATE, Active

SQL&gt; show table employee_2;

EMP_NO              (EMPNO) SMALLINT Not Null
FIRST_NAME          (FIRSTNAME) VARCHAR(15) Not Null
LAST_NAME           (LASTNAME) VARCHAR(20) Not Null
PHONE_EXT           VARCHAR(4) Nullable
HIRE_DATE           TIMESTAMP Not Null DEFAULT 'NOW'
DEPT_NO             (DEPTNO) CHAR(3) Not Null
                    CHECK (VALUE = '000' OR
                          (VALUE &gt; '0' AND VALUE &lt;= '999') OR VALUE IS NULL)
JOB_CODE            (JOBCODE) VARCHAR(5) Not Null
                    CHECK (VALUE &gt; '99999')
JOB_GRADE           (JOBGRADE) SMALLINT Not Null
                    CHECK (VALUE BETWEEN 0 AND 6)
JOB_COUNTRY         (COUNTRYNAME) VARCHAR(15) Not Null
SALARY              (SALARY) NUMERIC(10, 2) Not Null DEFAULT 0
CHECK               (VALUE &gt; 0)
FULL_NAME           Computed by: (last_name || ', ' || first_name)
CONSTRAINT INTEG_93:
  Primary key (EMP_NO)
  
SQL&gt; -- Check indices on both tables...
SQL&gt; show indices employee;

NAMEX INDEX ON EMPLOYEE(LAST_NAME, FIRST_NAME)
RDB$FOREIGN8 INDEX ON EMPLOYEE(DEPT_NO)
RDB$FOREIGN9 INDEX ON EMPLOYEE(JOB_CODE, JOB_GRADE, JOB_COUNTRY)
RDB$PRIMARY7 UNIQUE INDEX ON EMPLOYEE(EMP_NO)

SQL&gt; show indices employee_2;
RDB$PRIMARY27 UNIQUE INDEX ON EMPLOYEE_2(EMP_NO)

SQL&gt; -- Check data counts on both tables...
SQL&gt; select count(*) from employee;

       COUNT
============
          42

SQL&gt; select count(*) from employee_2;

       COUNT
============
           0
                        
                    </pre><p>
                </p></div></div><br class="example-break"/><p>Команда COPY работает только при условии, что ваше приложение
                    <span class="application">isql</span> действительно называется isql. Кроме того, если
                в таблице много данных, вам все равно придется копировать их вручную, так как
                команда копирования будет копировать только структуру таблицы. Помните, что в новой
                таблице не будет ни триггеров, ни внешних ключей, ни индексов, кроме первичного
                ключа, ни данных.</p><div class="note"><h3 class="title">Примечание</h3><p>Возможно команда COPY будет удалена из ISQL в следующих версиях.</p></div></section><section class="section" id="isql-commands-input"><div class="titlepage"><div><div><h3 class="title">INPUT</h3></div></div></div><a id="d0e7053" class="indexterm"/><p><span class="formalpara-title">Назначение: </span>Подключение файла скрипта.</p><p><span class="formalpara-title">Синтаксис: </span>
                    </p><pre class="programlisting"> 
INPUT <em class="replaceable"><code>&lt;filename&gt;</code></em>                    
                    </pre><p>
                </p><p>
                </p><div class="table" id="d0e7076"><div class="table-title">Таблица 5.9. Параметры оператора INPUT</div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col style="text-align: left; " class="colArgument"/><col style="text-align: left; " class="colDesc"/></colgroup><thead><tr valign="middle"><th style="text-align: center; vertical-align: middle; border-right: 1px solid ; border-bottom: 1px solid ; ">Параметр</th><th style="text-align: center; vertical-align: middle; border-bottom: 1px solid ; ">Описание</th></tr></thead><tbody><tr><td style="text-align: left; border-right: 1px solid ; "><em class="replaceable"><code>filename</code></em></td><td style="text-align: left; ">
                                    <p>Имя файла с подключаемым скриптом.</p>
                                </td></tr></tbody></table></div></div><p><br class="table-break"/>
            </p><p>Команда INPUT читает и выполняет блок команд из указанного текстового файла
                (скрипта SQL). Входные файлы могут содержать другие команды INPUT, предоставляя
                таким образом возможность проектирования цепочного или структурированного набора
                скриптов DDL.</p><div class="example" id="d0e7102"><div class="example-title">Пример 5.15. Использование команды INPUT для включения скрипта</div><div class="example-contents"><p>
                    </p><pre class="programlisting">
SQL&gt; shell;

$ cat test.sql
drop table fred;
commit;

$ exit;

SQL&gt; show table fred;

A       INTEGER Nullable
B       INTEGER Not Null

SQL&gt; input test.sql;

SQL&gt; show table fred;
There is no table FRED in this database                        
                    </pre><p>
                </p></div></div><br class="example-break"/><p><span class="formalpara-title">Смотри также: </span><a class="link" href="#isql-commands-shell" title="SHELL">SHELL</a>.</p></section><section class="section" id="isql-commands-output"><div class="titlepage"><div><div><h3 class="title">OUTPUT</h3></div></div></div><a id="d0e7120" class="indexterm"/><p><span class="formalpara-title">Назначение: </span>Перенаправление вывода.</p><p><span class="formalpara-title">Синтаксис: </span>
                    </p><pre class="programlisting"> 
OUTPUT [<em class="replaceable"><code>&lt;filename&gt;</code></em>]                    
                    </pre><p>
                </p><p>
                </p><div class="table" id="d0e7143"><div class="table-title">Таблица 5.10. Параметры оператора OUTPUT</div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col style="text-align: left; " class="colArgument"/><col style="text-align: left; " class="colDesc"/></colgroup><thead><tr valign="middle"><th style="text-align: center; vertical-align: middle; border-right: 1px solid ; border-bottom: 1px solid ; ">Параметр</th><th style="text-align: center; vertical-align: middle; border-bottom: 1px solid ; ">Описание</th></tr></thead><tbody><tr><td style="text-align: left; border-right: 1px solid ; "><em class="replaceable"><code>filename</code></em></td><td style="text-align: left; ">
                                    <p>Имя файла для вывода.</p>
                                </td></tr></tbody></table></div></div><p><br class="table-break"/>
            </p><p>Команда OUTPUT перенаправляет весь вывод, который обычно отображается на экране, в
                определенный файл. Если указано имя файла, все последующие выходные данные
                отправляются в этот файл и не отображаются на экране. Если имя файла не указано,
                вывод снова перенаправляется на экран.</p><div class="example" id="d0e7169"><div class="example-title">Пример 5.16. Использование команды OUTPUT</div><div class="example-contents"><p>
                    </p><pre class="programlisting">

SQL&gt; output test.log;

SQL&gt; show tables;

SQL&gt; output;

SQL&gt; shell;

$ cat test.log

COUNTRY              CUSTOMER
DEPARTMENT           EMPLOYEE
EMPLOYEE_PROJECT     FRED
JOB                  PROJECT
PROJ_DEPT_BUDGET     SALARY_HISTORY
SALES
                       
                    </pre><p>
                </p></div></div><br class="example-break"/><p><span class="formalpara-title">Смотри также: </span><a class="link" href="#isql-commands-shell" title="SHELL">SHELL</a>.</p></section><section class="section" id="isql-commands-set"><div class="titlepage"><div><div><h3 class="title">SET</h3></div></div></div><a id="d0e7187" class="indexterm"/><p><span class="formalpara-title">Назначение: </span>Отображение текущий установок.</p><p><span class="formalpara-title">Синтаксис: </span>
                    </p><pre class="programlisting"> 
SET                  
                    </pre><p>
                </p><p>Команда SET выводит текущие опции установленные с помощью команд SET.</p><div class="example" id="d0e7207"><div class="example-title">Пример 5.17. Использование команды SET</div><div class="example-contents"><p>
                    </p><pre class="programlisting">

SQL&gt; SET;

Print statistics:        OFF
Echo commands:           OFF
List format:             OFF
Show Row Count:          OFF
Select maxrows limit:    0
Autocommit DDL:          ON
Access Plan:             OFF
Access Plan only:        OFF
Explain Access Plan:     OFF
Display BLOB type:       1
Column headings:         ON
Terminator:              ;
Time:                    OFF
Warnings:                ON
Bail on error:           OFF
Keep transaction params: OFF

SQL&gt;
                       
                    </pre><p>
                </p></div></div><br class="example-break"/></section><section class="section" id="isql-commands-shell"><div class="titlepage"><div><div><h3 class="title">SHELL</h3></div></div></div><a id="d0e7218" class="indexterm"/><p><span class="formalpara-title">Назначение: </span>Предоставление доступа к командной строке.</p><p><span class="formalpara-title">Синтаксис: </span>
                    </p><pre class="programlisting"> 
SHELL [<em class="replaceable"><code>&lt;command&gt;</code></em>]                  
                    </pre><p>
                </p><p>
                </p><div class="table" id="d0e7241"><div class="table-title">Таблица 5.11. Параметры оператора SHELL</div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col style="text-align: left; " class="colArgument"/><col style="text-align: left; " class="colDesc"/></colgroup><thead><tr valign="middle"><th style="text-align: center; vertical-align: middle; border-right: 1px solid ; border-bottom: 1px solid ; ">Параметр</th><th style="text-align: center; vertical-align: middle; border-bottom: 1px solid ; ">Описание</th></tr></thead><tbody><tr><td style="text-align: left; border-right: 1px solid ; "><em class="replaceable"><code>command</code></em></td><td style="text-align: left; ">
                                    <p>Команда системной консоли.</p>
                                </td></tr></tbody></table></div></div><p><br class="table-break"/>
            </p><p>Команда SHELL позволяет вам временно выйти из isql и использовать сеанс системной
                оболочки для дальнейшей обработки. При этом не происходит подтверждение или откат
                любой транзакции. </p><p>Аргумент <em class="replaceable"><code>&lt;command&gt;</code></em> является необязательным, это
                команда или вызов, допустимый в командной строке, из которой была запущена
                    <span class="application">isql</span>. Команда будет выполнена, а управление
                возвращено <span class="application">isql</span>. Если команда не указана,
                    <span class="application">isql</span> открывает интерактивную сессию в командной
                строке. При выходе из оболочки вы вернетесь в <span class="application">isql</span>. Вы не
                можете использовать сеанс <span class="application">isql</span>, который активировал
                оболочку, пока сеанс оболочки остается открытым.</p><div class="example" id="d0e7287"><div class="example-title">Пример 5.18. Использование команды SHELL</div><div class="example-contents"><p>
                    </p><pre class="programlisting">

SQL&gt; shell;

$ cat test.log

  COUNTRY              CUSTOMER
  DEPARTMENT           EMPLOYEE
  EMPLOYEE_PROJECT     FRED
  JOB                  PROJECT
  PROJ_DEPT_BUDGET     SALARY_HISTORY
  SALES
$ exit
SQL&gt;
                       
                    </pre><p>
                </p></div></div><br class="example-break"/></section><section class="section" id="isql-commands-exit"><div class="titlepage"><div><div><h3 class="title">EXIT</h3></div></div></div><a id="d0e7298" class="indexterm"/><p><span class="formalpara-title">Назначение: </span>Выход из isql.</p><p><span class="formalpara-title">Синтаксис: </span>
                    </p><pre class="programlisting"> 
EXIT                  
                    </pre><p>
                </p><p>Команда EXIT подтверждает текущую транзакцию без подсказки, закрывает базу данных
                и завершает сессию <span class="application">isql</span>.</p></section><section class="section" id="isql-commands-quit"><div class="titlepage"><div><div><h3 class="title">QUIT</h3></div></div></div><a id="d0e7324" class="indexterm"/><p><span class="formalpara-title">Назначение: </span>Выход из isql.</p><p><span class="formalpara-title">Синтаксис: </span>
                    </p><pre class="programlisting"> 
QUIT                  
                    </pre><p>
                </p><p>Команда QUIT отменяет текущую транзакцию и закрывает базу данных и завершает
                сессию <span class="application">isql</span>.</p></section></section><section class="section" id="isql-commands_set"><div class="titlepage"><div><div><h2 class="title" style="clear: both">ISQL SET команды</h2></div></div></div><p>Как объясняется в команде HELP, вы можете ввести команду HELP SET, чтобы перейти к
            различным опциям доступных для SET команды. Команда HELP SET выводит следующую справку. </p><pre class="screen">
            
SQL&gt; help set;

Set commands:
    SET                    -- display current SET options
    SET AUTOddl            -- toggle autocommit of DDL statements
    SET BAIL               -- toggle bailing out on errors in non-interactive mode
    SET BLOB [ALL|&lt;n&gt;]     -- display BLOBS of subtype &lt;n&gt; or ALL
    SET BLOB               -- turn off BLOB display
    SET COUNT              -- toggle count of selected rows on/off
    SET MAXROWS [&lt;n&gt;]      -- limit select stmt to &lt;n&gt; rows, zero is no limit
    SET ECHO               -- toggle command echo on/off
    SET EXPLAIN            -- toggle display of query access plan in the explained form
    SET HEADING            -- toggle display of query column titles
    SET LIST               -- toggle column or table display format
    SET NAMES &lt;csname&gt;     -- set name of runtime character set
    SET PLAN               -- toggle display of query access plan
    SET PLANONLY           -- toggle display of query plan without executing
    SET SQL DIALECT &lt;n&gt;    -- set sql dialect to &lt;n&gt;
    SET STATs              -- toggle display of performance statistics
    SET TIME               -- toggle display of timestamp with DATE values
    SET TERM &lt;string&gt;      -- change statement terminator string
    SET WIDTH &lt;col&gt; [&lt;n&gt;]  -- set/unset print width to &lt;n&gt; for column &lt;col&gt;

All commands may be abbreviated to letters in CAPitals        

        </pre><p>
        </p><div class="note"><h3 class="title">Примечание</h3><p> В выше приведённом примере команды BLOB являются неполными. Они должны быть
                отображены как BLOBdisplay. Далее мы будем использовать полную версию
                команды.</p></div><p>Последняя строка вышеприведенного вывода указывает, что эти команды могут быть
            сокращены до заглавных букв. К сожалению, кроме команды SET AUTOddl, ни одна из других
            не имеет краткой формы.</p><section class="section" id="isql-commands_set-set"><div class="titlepage"><div><div><h3 class="title">SET</h3></div></div></div><a id="d0e7363" class="indexterm"/><p><span class="formalpara-title">Назначение: </span>Отображение текущий установок.</p><p><span class="formalpara-title">Синтаксис: </span>
                    </p><pre class="programlisting"> 
SET                  
                    </pre><p>
                </p><p>Команда SET выводит текущие опции, установленные с помощью команд SET.</p><div class="example" id="d0e7383"><div class="example-title">Пример 5.19. Использование команды SET</div><div class="example-contents"><p>
                    </p><pre class="programlisting">

SQL&gt; SET;

Print statistics:        OFF
Echo commands:           OFF
List format:             OFF
Show Row Count:          OFF
Select maxrows limit:    0
Autocommit DDL:          ON
Access Plan:             OFF
Access Plan only:        OFF
Explain Access Plan:     OFF
Display BLOB type:       1
Column headings:         ON
Terminator:              ;
Time:                    OFF
Warnings:                ON
Bail on error:           OFF
Keep transaction params: OFF

SQL&gt;
                       
                    </pre><p>
                </p></div></div><br class="example-break"/></section><section class="section" id="isql-commands_set-set_autoddl"><div class="titlepage"><div><div><h3 class="title">SET AUTODDL</h3></div></div></div><a id="d0e7394" class="indexterm"/><p><span class="formalpara-title">Назначение: </span>Установка или отключение автоматического подтверждения для DDL
                    операторов.</p><p><span class="formalpara-title">Синтаксис: </span>
                    </p><pre class="programlisting"> 
SET AUTOddl [ON | OFF]                 
                    </pre><p>
                </p><p>Команда SET AUTODDL устанавливает будет ли автоматически подтверждаться транзакция
                для DDL операторов. Команда без каких-либо параметров действует как переключатель,
                она отключает функцию AUTODLL, если она включена или наоборот. Вы можете указать
                конкретный параметр, чтобы прояснить свои намерения. Параметр должен быть одним из
                двух ON или OFF. Команда SET без параметров отобразит текущую настройку. По
                умолчанию функция AUTODDL включена.</p></section><section class="section" id="isql-commands_set-set_bail"><div class="titlepage"><div><div><h3 class="title">SET BAIL</h3></div></div></div><a id="d0e7417" class="indexterm"/><p><span class="formalpara-title">Назначение: </span>Передача обработки ошибок операционной системе.</p><p><span class="formalpara-title">Синтаксис: </span>
                    </p><pre class="programlisting"> 
SET BAIL [ON | OFF]                 
                    </pre><p>
                </p><p>Команда SET BAIL устанавливает, будет ли isql останавливать выполнение скрипта в
                пакетном режиме при возникновении ошибки и передавать управление операционной
                системе, возвращая при этом код ошибки. В интерактивном режиме при возникновении
                ошибок <span class="application">isql</span> не будет прекращать свою работу.</p><p>Выполнение этой команды без передачи параметра приводит к переключению текущего
                состояния. Если SET BAIL включен, то он отключится и наоборот.</p></section><section class="section" id="isql-commands_set-set_blob"><div class="titlepage"><div><div><h3 class="title">SET BLOB</h3></div></div></div><a id="d0e7445" class="indexterm"/><a id="d0e7450" class="indexterm"/><p><span class="formalpara-title">Назначение: </span>Включение или выключение отображения подтипа BLOB.</p><p><span class="formalpara-title">Синтаксис: </span>
                    </p><pre class="programlisting"> 
SET BLOB [<em class="replaceable"><code>&lt;n&gt;</code></em> |ALL | OFF] 
                        
SET BLOBDISPLAY [<em class="replaceable"><code>&lt;n&gt;</code></em> |ALL | OFF]                         
                    </pre><p>
                </p><p>
                </p><div class="table" id="d0e7476"><div class="table-title">Таблица 5.12. Параметры оператора SET BLOB </div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col style="text-align: left; " class="colArgument"/><col style="text-align: left; " class="colDesc"/></colgroup><thead><tr valign="middle"><th style="text-align: center; vertical-align: middle; border-right: 1px solid ; border-bottom: 1px solid ; ">Параметр</th><th style="text-align: center; vertical-align: middle; border-bottom: 1px solid ; ">Описание</th></tr></thead><tbody><tr><td style="text-align: left; border-right: 1px solid ; "><em class="replaceable"><code>n</code></em></td><td style="text-align: left; ">
                                    <p>Номер подтипа BLOB. Значение по умолчанию n=1 (текст).
                                        Положительные числа определены в системе; отрицательные
                                        числа определяются пользователем.</p>
                                </td></tr></tbody></table></div></div><p><br class="table-break"/>
            </p><p>Команда SET BLOB определяет, должны ли данные столбца BLOB отображаться в выводе.
                Если параметры не переданы в команду SET BLOB или передан параметр OFF, то поля типа
                BLOB отображаться не будут, вместо них будут отображаться идентификаторы BLOB.
                Идентификатор BLOB представляет собой два шестнадцатеричных числа, разделенных
                двоеточием. Первое число — это идентификатор таблицы, а второе — последовательный
                номер в базе данных.</p><p>Если в команду SET BLOB передан параметр ALL, то будут отображаться BLOB поля всех
                подтипов.</p><p>Если передано число, представляющее подтип BLOB, то будут отображаться только BLOB
                с указанным подтипом. По умолчанию отображаются поля с подтипом 1 (текстовые
                данные).</p><div class="example" id="d0e7506"><div class="example-title">Пример 5.20. Использование SET BLOB</div><div class="example-contents"><p>
                    </p><pre class="programlisting">

SQL&gt; -- Don't display any blob data.
SQL&gt; set blob off;

SQL&gt; select proj_desc
CON&gt; from project
CON&gt; where proj_id = 'HWRII';

        PROJ_DESC
=================
           85:1e4

SQL&gt; -- Display all blob data.
SQL&gt;  set blobdisplay all;

SQL&gt; select proj_desc
CON&gt; from project
CON&gt; where proj_id = 'HWRII';

        PROJ_DESC
=================
           85:1e4
==============================================================================
PROJ_DESC:
Integrate the hand-writing recognition module into the
universal language translator.

==============================================================================

SQL&gt; -- Only display type 1 blob data = text.
SQL&gt; set blob 1;

SQL&gt; select proj_desc
CON&gt; from project
CON&gt; where proj_id = 'HWRII';

        PROJ_DESC
=================
           85:1e4
==============================================================================
PROJ_DESC:
Integrate the hand-writing recognition module into the
universal language translator.

==============================================================================

SQL&gt; -- Only display blob type 7 = not text!
SQL&gt; set blob 7;

SQL&gt; select proj_desc
CON&gt; from project
CON&gt; where proj_id = 'HWRII';

        PROJ_DESC
=================
           85:1e4
==============================================================================
PROJ_DESC:
BLOB display set to subtype 7. This BLOB: subtype = 1
==============================================================================
                        
                    </pre><p>
                </p></div></div><br class="example-break"/><p>В последнем примере вы заметите, что было отображено сообщение о том, что мы
                отображаем данные BLOB только для подтипа 7, а данные BLOB в этой таблице являются
                подтипом 1, поэтому данные не отображаются.</p><p><span class="formalpara-title">Смотри также: </span><a class="link" href="#isql-commands-blobdump" title="BLOBDUMP">BLOBDUMP</a>, <a class="link" href="#isql-commands-blobview" title="BLOBVIEW">BLOBVIEW</a>.</p></section><section class="section" id="isql-commands_set-set_bulk_insert"><div class="titlepage"><div><div><h3 class="title">SET BULK_INSERT</h3></div></div></div><a id="d0e7529" class="indexterm"/><p><span class="formalpara-title">Назначение: </span>Пакетная вставка записей в таблицу.</p><p><span class="formalpara-title">Синтаксис: </span>
                    </p><pre class="programlisting"> 
SET BULK_INSERT <em class="replaceable"><code>&lt;prepared insert statement&gt;</code></em>                                             
                    </pre><p>
                </p><p>
                </p><div class="table" id="d0e7552"><div class="table-title">Таблица 5.13. Параметры оператора SET BULK_INSERT </div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col style="text-align: left; " class="colArgument"/><col style="text-align: left; " class="colDesc"/></colgroup><thead><tr valign="middle"><th style="text-align: center; vertical-align: middle; border-right: 1px solid ; border-bottom: 1px solid ; ">Параметр</th><th style="text-align: center; vertical-align: middle; border-bottom: 1px solid ; ">Описание</th></tr></thead><tbody><tr><td style="text-align: left; border-right: 1px solid ; "><em class="replaceable"><code>prepared insert statement</code></em></td><td style="text-align: left; ">
                                    <p>Подготовленный оператор INSERT.</p>
                                </td></tr></tbody></table></div></div><p><br class="table-break"/>
            </p><p>Команда SET BULK_INSERT осуществляет примитивную обработку подготовленных запросов
                на вставку. После ввода этой команды пользователь входит в интерактивный режим
                    (<code class="code">BULK&gt;</code>), где требуется ввести параметры в виде кортежа
                        <code class="code">(<em class="replaceable"><code>val1</code></em>, ...,
                    <em class="replaceable"><code>valN</code></em>)</code>. Для выхода из интерактивного режима
                введите пустую строку или любой символ, отличный от <span class="quote">«<span class="quote">(</span>»</span> и
                    <span class="quote">«<span class="quote">--</span>»</span> (можно явно выйти, введя слово STOP). Кортежи должны
                располагаться на одной строке, за исключением параметров в кавычках. Однако, если
                добавить <span class="quote">«<span class="quote">+++</span>»</span> после запятой, параметры кортежа можно переносить на
                следующую строку. Одиночные комментарии (<span class="quote">«<span class="quote">--</span>»</span>) можно добавлять только
                между кортежами. Команды COMMIT или COMMIT WORK вводятся с первого символа строки и
                располагаются на одной строке. Любые символы, идущие за кортежем, кроме
                    <span class="quote">«<span class="quote">)</span>»</span> и <span class="quote">«<span class="quote">+++</span>»</span>, будут игнорироваться.</p><div class="example" id="d0e7608"><div class="example-title">Пример 5.21. Использование SET BULK_INSERT для пакетной вставки</div><div class="example-contents"><p>
                    </p><pre class="programlisting">

SQL&gt; create table t1(id int not null primary key, name varchar(50));

SQL&gt; set bulk_insert insert into t1(id, name) values(?, ?);
BULK&gt; (1, 'a')
BULK&gt; (2, 'b')
BULK&gt; (3, 'c')
BULK&gt; commit;
BULK&gt;
SQL&gt; select * from t1;

          ID NAME
============ ==================================================
           1 a
           2 b
           3 c
           
SQL&gt; set bulk_insert insert into t1(id, name) values(?, ?);
BULK&gt; -- insert 4 record
BULK&gt; (4, 'abcd')
BULK&gt; (5, +++
CON&gt; 'efg')
BULK&gt; stop

SQL&gt; commit;

SQL&gt; select * from t1;

          ID NAME
============ ==================================================
           1 a
           2 b
           3 c
           4 abcd
           5 efg           
                        
                    </pre><p>
                </p></div></div><br class="example-break"/></section><section class="section" id="isql-commands_set-set_count"><div class="titlepage"><div><div><h3 class="title">SET COUNT</h3></div></div></div><a id="d0e7619" class="indexterm"/><p><span class="formalpara-title">Назначение: </span>Включение или выключение отображения количества строк затронутых
                    запросом.</p><p><span class="formalpara-title">Синтаксис: </span>
                    </p><pre class="programlisting"> 
SET COUNT [ON|OFF]                                            
                    </pre><p>
                </p><p>Команда SET COUNT включает или выключает отображение количества строк затронутых
                DML запросом. Выполнение этой команды без передачи параметра приводит к переключению
                текущего состояния.</p><p>
                </p><pre class="programlisting">

SQL&gt; set count on;

SQL&gt; select count(*) from employee;

                COUNT
=====================
                   42

Records affected: 1
                    
                </pre><p>
            </p><p>Количество затронутых записей отображается для всех DDL операторов, а не только
                для SELECT. </p><pre class="programlisting">

SQL&gt; create table fred( a integer);
SQL&gt; commit;

SQL&gt; insert into fred values (666);
Records affected: 1

SQL&gt; update fred set a = 123 where a = 666;
Records affected: 1

SQL&gt; delete from fred;
Records affected: 1

SQL&gt; commit;
                    
                </pre><p>
            </p><p><span class="formalpara-title">Смотри также: </span>SET ROWCOUNT.</p></section><section class="section" id="isql-commands_set-set_echo"><div class="titlepage"><div><div><h3 class="title">SET ECHO</h3></div></div></div><a id="d0e7657" class="indexterm"/><p><span class="formalpara-title">Назначение: </span>Включение или выключение отображения команд до их выполнения.</p><p><span class="formalpara-title">Синтаксис: </span>
                    </p><pre class="programlisting"> 
SET ECHO [ON|OFF]                                            
                    </pre><p>
                </p><p>Команда SET ECHO включает или выключает отображение команд до их выполнения. Вы
                может отключить эхо-вывод для части файла сценария, хотя по умолчанию эхо вывод
                выключен в ISQL. Выполнение этой команды без передачи параметра приводит к
                переключению текущего состояния.</p><div class="example" id="d0e7677"><div class="example-title">Пример 5.22. Использование команды SET ECHO</div><div class="example-contents"><p>
                    </p><pre class="programlisting">

SQL&gt; set echo on;

SQL&gt; select count(*) from rdb$database;
select count(*) from rdb$database;

                COUNT
=====================
                    1

Records affected: 1
SQL&gt; set echo off;
set echo off;

SQL&gt; select count(*) from rdb$database;

                COUNT
=====================
                    1

Records affected: 1
                    
                </pre><p>
                </p></div></div><br class="example-break"/><p>Эта команда может быть полезна в файле сценария. Если вы получаете сообщение об
                ошибке, иногда бывает трудно определить точный оператор SQL, вызвавший ее. Если вы
                установите ECHO ON в своем скрипте, вы по крайней мере сможете точно определить,
                какой оператор потерпел неудачу.</p></section><section class="section" id="isql-commands_set-set_explain"><div class="titlepage"><div><div><h3 class="title">SET EXPLAIN</h3></div></div></div><a id="d0e7690" class="indexterm"/><p><span class="formalpara-title">Назначение: </span>Включение или выключение отображения расширенного плана запроса.</p><p><span class="formalpara-title">Синтаксис: </span>
                    </p><pre class="programlisting"> 
SET EXPLAIN [ON|OFF]                                            
                    </pre><p>
                </p><p>Команда SET EXPLAIN включает или выключает отображение расширенного плана запроса.
                Расширенный план выводит более подробную информацию о методах доступа используемых
                оптимизатором, однако его нельзя включить в запрос. По умолчанию вывод расширенного
                плана запроса отключен. Выполнение этой команды без передачи параметра приводит к
                переключению текущего состояния.</p><div class="example" id="d0e7710"><div class="example-title">Пример 5.23. Использование команды SET EXPLAIN</div><div class="example-contents"><p>
                    </p><pre class="programlisting">

SQL&gt; set explain on;
SQL&gt; set planonly on;
SQL&gt; select * from employee cross join rdb$database;

Select Expression
    -&gt; Nested Loop Join (inner)
        -&gt; Table "RDB$DATABASE" Full Scan
        -&gt; Table "EMPLOYEE" Full Scan
SQL&gt;
                    
                </pre><p>
                </p></div></div><br class="example-break"/><div class="tip"><h3 class="title">Подсказка</h3><p>Если вам необходимо вывести только план запроса без его выполнения, то вы
                    можете выполнить команду <code class="code">SET PLANONLY ON</code>.</p></div><p><span class="formalpara-title">Смотри также: </span><a class="link" href="#isql-commands_set-set_plan" title="SET PLAN">SET PLAN</a>, <a class="link" href="#isql-commands_set-set_planonly" title="SET PLANONLY">SET PLANONLY</a>.</p></section><section class="section" id="isql-commands_set-set_heading"><div class="titlepage"><div><div><h3 class="title">SET HEADING</h3></div></div></div><a id="d0e7737" class="indexterm"/><p><span class="formalpara-title">Назначение: </span>Включение или выключение отображения заголовков столбцов.</p><p><span class="formalpara-title">Синтаксис: </span>
                    </p><pre class="programlisting"> 
SET HEADING [ON|OFF]                                            
                    </pre><p>
                </p><p>Команда SET HEADING включает или выключает отображение заголовков столбцов. По
                умолчанию отображение заголовков столбцов включено. Выполнение этой команды без
                передачи параметра приводит к переключению текущего состояния.</p><div class="example" id="d0e7757"><div class="example-title">Пример 5.24. Использование команды SET HEADING</div><div class="example-contents"><p>
                    </p><pre class="programlisting">

SQL&gt; set plan off;
SQL&gt; set heading off;
SQL&gt; select count(*) from employee;

                   42

SQL&gt; set heading on;
SQL&gt; select count(*) from employee;

                COUNT
=====================
                   42
                    
                </pre><p>
                </p></div></div><br class="example-break"/></section><section class="section" id="isql-commands_set-set_keep_tran"><div class="titlepage"><div><div><h3 class="title">SET KEEP_TRAN_PARAMS</h3></div></div></div><a id="d0e7768" class="indexterm"/><p><span class="formalpara-title">Назначение: </span>Включение или выключение сохранения параметров транзакции.</p><p><span class="formalpara-title">Синтаксис: </span>
                    </p><pre class="programlisting"> 
SET KEEP_TRAN[_PARAMS] [ON|OFF]                                            
                    </pre><p>
                </p><p>Операторы DML для выборки или изменения данных стартуют новую транзакцию с уровнем
                изоляции SNAPSHOT с разрешением блокировки в режиме WAIT, если она не была начата
                ранее. Такая транзакция будет активной до тех пор, пока не будет вручную
                подтверждена оператором COMMIT или отменена оператором ROLLBACK. </p><p>Пользователи могут указать уровень изоляции и другие параметры для следующей
                транзакции с помощью оператора SET TRANSACTION. Он может быть выполнен только тогда,
                когда не активна другая транзакция. В противном случае будет задан вопрос:
                подтвердить или откатить активную транзакцию.</p><p>После выполнения COMMIT или ROLLBACK, новая DML команда стартует транзакцию с
                параметрами по умолчанию. Если необходимо, чтобы новая транзакция стартовала с
                параметрами, которые были указаны для предыдущей транзакции, то необходимо включить
                режим сохранения параметров транзакции с помощью команды <code class="code">SET
                    KEEP_TRAN_PARAMS</code> (может быть сокращена до SET KEEP_TRAN).</p><p>Если режим KEEP_TRAN_PARAMS установлен в: </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>ON, то isql сохраняет текст следующего успешного оператора SET
                            TRANSACTION, и новые транзакции DML запускаются с использованием того же
                            SQL (вместо режима по умолчанию CONCURRENCY WAIT);</p></li><li class="listitem"><p>OFF, то isql начинает новую транзакцию DML как обычно.</p></li></ul></div><div class="example" id="d0e7804"><div class="example-title">Пример 5.25. Использование SET KEEP_TRAN_PARAMS</div><div class="example-contents"><pre class="programlisting">
SQL&gt; SET;                        
                    </pre><pre class="screen">
...
Keep transaction params: OFF
                    </pre><pre class="programlisting">
SQL&gt; SET TRANSACTION READ COMMITTED WAIT;
Commit current transaction (y/n)?y
Committing.

SQL&gt; SELECT RDB$GET_CONTEXT('SYSTEM', 'ISOLATION_LEVEL') FROM RDB$DATABASE;

RDB$GET_CONTEXT                                                                                                                                                                                                                                 
===============================================================================
READ COMMITTED                                                                                                                                                                                                                                  

SQL&gt; commit;
SQL&gt; SELECT RDB$GET_CONTEXT('SYSTEM', 'ISOLATION_LEVEL') FROM RDB$DATABASE;

RDB$GET_CONTEXT                                                                                                                                                                                                                                 
===============================================================================
SNAPSHOT                                                                                                
                    </pre><p>Как видите после COMMIT новая транзакция стартует с параметрами по умолчанию.
                    Теперь установим режим сохранения параметров транзакции.</p><pre class="programlisting">
SQL&gt; SET KEEP_TRAN_PARAMS ON; 
SQL&gt; SET;
                    </pre><pre class="screen">
...
Keep transaction params: ON
                    </pre><pre class="programlisting">
SQL&gt; SET TRANSACTION READ COMMITTED WAIT;
Commit current transaction (y/n)?y
Committing.
SQL&gt; SELECT RDB$GET_CONTEXT('SYSTEM', 'ISOLATION_LEVEL') FROM RDB$DATABASE;

RDB$GET_CONTEXT                                                                                                                                                                                                                                 
===============================================================================
READ COMMITTED                                                                                                                                                                                                                                  

SQL&gt; commit;
SQL&gt; SELECT RDB$GET_CONTEXT('SYSTEM', 'ISOLATION_LEVEL') FROM RDB$DATABASE;

RDB$GET_CONTEXT                                                                                                                                                                                                                                 
===============================================================================
READ COMMITTED                                                                                                                                                                   
                    </pre></div></div><br class="example-break"/><div class="note"><h3 class="title">Примечание</h3><p>Данная функциональность была введена в Firebird 3.0.6. Ранее невозможно было
                    включить режим сохранения параметров транзакции. После команд COMMIT и ROLLBACK
                    необходимо было каждый раз выполнять команду SET TRANSACTION с необходимыми
                    параметрами.</p></div></section><section class="section" id="isql-commands_set-set_list"><div class="titlepage"><div><div><h3 class="title">SET LIST</h3></div></div></div><a id="d0e7827" class="indexterm"/><p><span class="formalpara-title">Назначение: </span>Включение или выключение отображения вывода результатов SELECT запроса в виде
                    списка.</p><p><span class="formalpara-title">Синтаксис: </span>
                    </p><pre class="programlisting"> 
SET LIST [ON|OFF]                                            
                    </pre><p>
                </p><p>Команда SET LIST управляет отображением данных, возвращаемых оператором SELECT. По
                умолчанию данные на экране выводятся в табличном варианте, где сверху названия
                столбцов, а под ними все строки, удовлетворяющие запросу SELECT. Включение режима
                списка приводит к другому формату, в котором заголовок каждого столбца отображается
                слева, а данные столбца — справа. Это повторяется для каждой строки, возвращаемой
                запросом. </p><p>Выполнение этой команды без передачи параметра приводит к переключению текущего
                состояния.</p><div class="example" id="d0e7849"><div class="example-title">Пример 5.26. Использование команды SET LIST</div><div class="example-contents"><p>
                    </p><pre class="programlisting">


SQL&gt; set list off;
SQL&gt; select emp_no, first_name, last_name, salary
CON&gt; from employee;

 EMP_NO FIRST_NAME      LAST_NAME                           SALARY
======= =============== ==================== =====================
      2 Robert          Nelson                           105900.00
      4 Bruce           Young                             97500.00
      5 Kim             Lambert                          102750.00
      8 Leslie          Johnson                           64635.00
.............

SQL&gt; set list on;
SQL&gt; select emp_no, first_name, last_name, salary
CON&gt; from employee;

EMP_NO                          2
FIRST_NAME                      Robert
LAST_NAME                       Nelson
SALARY                          105900.00

EMP_NO                          4
FIRST_NAME                      Bruce
LAST_NAME                       Young
SALARY                          97500.00

..........
                    
                </pre><p>
                </p></div></div><br class="example-break"/></section><section class="section" id="isql-commands_set-set_names"><div class="titlepage"><div><div><h3 class="title">SET NAMES</h3></div></div></div><a id="d0e7860" class="indexterm"/><p><span class="formalpara-title">Назначение: </span>Установка набора символов для последующий подключений.</p><p><span class="formalpara-title">Синтаксис: </span>
                    </p><pre class="programlisting"> 
SET NAMES [<em class="replaceable"><code>&lt;character_set&gt;</code></em>]                                         
                    </pre><p>
                </p><p>
                </p><div class="table" id="d0e7883"><div class="table-title">Таблица 5.14. Параметры оператора SET NAMES</div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col style="text-align: left; " class="colArgument"/><col style="text-align: left; " class="colDesc"/></colgroup><thead><tr valign="middle"><th style="text-align: center; vertical-align: middle; border-right: 1px solid ; border-bottom: 1px solid ; ">Параметр</th><th style="text-align: center; vertical-align: middle; border-bottom: 1px solid ; ">Описание</th></tr></thead><tbody><tr><td style="text-align: left; border-right: 1px solid ; "><em class="replaceable"><code>character_set</code></em></td><td style="text-align: left; ">
                                    <p>Набор символов для последующих подключений.</p>
                                </td></tr></tbody></table></div></div><p><br class="table-break"/>
            </p><p>Оператор SET NAMES устанавливает набор символов для последующих подключений к базе
                данных с помощью isql. Это позволяет вам переопределить набор символов по умолчанию
                для базы данных. Чтобы вернуться к использованию набора символов по умолчанию,
                используйте SET NAMES без аргументов.</p><p>Используйте команду SET NAMES перед подключением к базе данных для того, чтобы
                указать требуемый набор символов. Список поддерживаемых наборов символов можно
                посмотреть выполнив запрос: </p><pre class="programlisting"> 

SQL&gt; select RDB$CHARACTER_SET_NAME
CON&gt; from RDB$CHARACTER_SETS
CON&gt; order by 1;

RDB$CHARACTER_SET_NAME
==============================
ASCII
BIG_5
CP943C
CYRL
...
DOS864
DOS865
DOS866
DOS869
...
NONE
OCTETS
...
UTF8
...
WIN1250
WIN1251
WIN1252
...
                                        
                    </pre><p>
            </p><p>Выбор набора символов ограничивает возможные порядки сопоставления (сортировки)
                подмножеством всех доступных порядков сопоставления для заданного набора
                символов.</p><p>Если набор символов по умолчанию для базы данных не равен NONE, то в ситуациях,
                когда клиент использует другой набор символов для базы данных, возможно пострадать
                от повреждения данных, поскольку некоторые наборы символов не могут преобразовать
                некоторые символы в подходящий символ в другом наборе символов.</p><p>Если вы не передадите набор символов, то по умолчанию будет использоваться набор
                символов NONE.</p></section><section class="section" id="isql-commands_set-set_plan"><div class="titlepage"><div><div><h3 class="title">SET PLAN</h3></div></div></div><a id="d0e7923" class="indexterm"/><p><span class="formalpara-title">Назначение: </span>Включение или отключение отображение плана запроса.</p><p><span class="formalpara-title">Синтаксис: </span>
                    </p><pre class="programlisting"> 
SET PLAN [ON | OFF]                                         
                    </pre><p>
                </p><p>Команда SET PLAN определяет, будет ли <span class="application">isql</span> отображать
                план, который он использовал для доступа к данным для каждого выполненного
                оператора. По умолчанию <span class="application">isql</span> никогда не отображает план.
                Как и во многих других командах, отсутствие параметра переключает текущее
                состояние.</p><div class="example" id="d0e7949"><div class="example-title">Пример 5.27. Использование команды SET PLAN</div><div class="example-contents"><p>
                    </p><pre class="programlisting">

SQL&gt; set plan on;

SQL&gt; select emp_no, first_name, last_name
CON&gt; from employee
CON&gt; where emp_no = 107;

PLAN (EMPLOYEE INDEX (RDB$PRIMARY7))

 EMP_NO FIRST_NAME      LAST_NAME
======= =============== ====================
    107 Kevin           Cook

SQL&gt; update employee
CON&gt; set first_name = 'Norman'
CON&gt; where last_name = 'Cook';

PLAN (EMPLOYEE INDEX (NAMEX))

SQL&gt; select count(*) from employee;

PLAN (EMPLOYEE NATURAL)

                COUNT
=====================
                   42
                            
                        </pre><p>
                </p></div></div><br class="example-break"/><p>План выполнения отображается перед выводом из оператора SELECT.</p><div class="tip"><h3 class="title">Подсказка</h3><p>Для вывода расширенного плана используйте команду SET EXPLAIN.</p></div><p><span class="formalpara-title">Смотри также: </span><a class="link" href="#isql-commands_set-set_explain" title="SET EXPLAIN">SET EXPLAIN</a>, <a class="link" href="#isql-commands_set-set_planonly" title="SET PLANONLY">SET PLANONLY</a>.</p></section><section class="section" id="isql-commands_set-set_planonly"><div class="titlepage"><div><div><h3 class="title">SET PLANONLY</h3></div></div></div><a id="d0e7975" class="indexterm"/><p><span class="formalpara-title">Назначение: </span>Включение или отключение режима отображение только плана запроса без его
                    выполнения.</p><p><span class="formalpara-title">Синтаксис: </span>
                    </p><pre class="programlisting"> 
SET PLANONLY [ON | OFF]                                         
                    </pre><p>
                </p><p>Команда <code class="code">SET PLANONLY ON</code> не позволяет Firebird фактически выполнить
                оператор SQL, а просто показывает план, который будет использоваться для доступа к
                данным. Эта команда опирается на команду SET PLAN. Если <code class="code">SET PLAN OFF</code>
                был выполнен, то эта команда не имеет никакого эффекта, поэтому включение PLANONLY
                ON имеет дополнительный эффект неявного выполнения <code class="code">SET PLAN ON</code>.
                Выполнение <code class="code">SET PLANONLY OFF</code> не вызывает неявного выполнения <code class="code">SET
                    PLAN OFF</code>.</p><div class="example" id="d0e8010"><div class="example-title">Пример 5.28. Использование команды SET PLANONLY</div><div class="example-contents"><p>
                    </p><pre class="programlisting">

SQL&gt; set planonly on;

SQL&gt; select count(*) from employee;

PLAN (EMPLOYEE NATURAL)
                            
                        </pre><p>
                </p></div></div><br class="example-break"/><p>Как и во многих других командах, отсутствие параметра переключает текущее
                состояние.</p><p>Действие команды <code class="code">SET PLANONLY ON</code> также распространяется и на вывод
                расширенного плана без фактического выполнения запроса. </p><div class="example" id="d0e8025"><div class="example-title">Пример 5.29. Использование команды SET PLANONLY совместно с SET EXPLAIN</div><div class="example-contents"><p>
                    </p><pre class="programlisting">

SQL&gt; set explain on;
SQL&gt; set planonly on;

SQL&gt; select count(*) from employee;

Select Expression
    -&gt; Aggregate
        -&gt; Table "EMPLOYEE" Full Scan
                            
                        </pre><p>
                </p></div></div><br class="example-break"/><p><span class="formalpara-title">Смотри также: </span><a class="link" href="#isql-commands_set-set_plan" title="SET PLAN">SET PLAN</a>, <a class="link" href="#isql-commands_set-set_explain" title="SET EXPLAIN">SET EXPLAIN</a>.</p></section><section class="section" id="isql-commands_set-set_sqlda"><div class="titlepage"><div><div><h3 class="title">SET SQLDA_DISPLAY</h3></div></div></div><a id="d0e8046" class="indexterm"/><p><span class="formalpara-title">Назначение: </span>Включение или отключение отображения информации о внутренних структурах для
                    входных и выходных сообщений.</p><p><span class="formalpara-title">Синтаксис: </span>
                    </p><pre class="programlisting"> 
SET SQLDA_DISPLAY [ON | OFF]                                         
                    </pre><p>
                </p><p>Это скрытая команда, которая не упоминается в выводе команды HELP SET. Она
                отображает внутренние подробности о структурах для входных и выходных сообщений
                операторов SQL, выполняемых <span class="application">isql</span>. Раньше она была
                доступна только в специальной отладочной сборке, но начиная с версии 2.0 она
                доступна в <span class="application">isql</span>.</p><div class="example" id="d0e8072"><div class="example-title">Пример 5.30. Использование команды SET SQLDA_DISPLAY</div><div class="example-contents"><p>
                    </p><pre class="programlisting">

SQL&gt; set sqlda_display on;

SQL&gt; select count(*) from employee;

INPUT message field count: 0

OUTPUT message field count: 1
01: sqltype: 580 INT64 scale: 0 subtype: 0 len: 8
  :  name: COUNT  alias: COUNT
  : table:   owner:

                COUNT
=====================
                   42
                   
SQL&gt; select emp_no as id, first_name from employee fetch first row only;

INPUT message field count: 0

OUTPUT message field count: 2
01: sqltype: 500 SHORT scale: 0 subtype: 0 len: 2
  :  name: EMP_NO  alias: ID
  : table: EMPLOYEE  owner: SYSDBA
02: sqltype: 448 VARYING scale: 0 subtype: 0 len: 15 charset: 0 NONE
  :  name: FIRST_NAME  alias: FIRST_NAME
  : table: EMPLOYEE  owner: SYSDBA

     ID FIRST_NAME
======= ===============
      2 Robert       
      
SQL&gt; select emp_no as id, first_name from employee 
CON&gt; where emp_no = ? fetch first row only;

INPUT message field count: 1
01: sqltype: 500 SHORT scale: 0 subtype: 0 len: 2
  :  name:   alias:
  : table:   owner:

OUTPUT message field count: 2
01: sqltype: 500 SHORT scale: 0 subtype: 0 len: 2
  :  name: EMP_NO  alias: ID
  : table: EMPLOYEE  owner: SYSDBA
02: sqltype: 448 VARYING scale: 0 subtype: 0 len: 15 charset: 0 NONE
  :  name: FIRST_NAME  alias: FIRST_NAME
  : table: EMPLOYEE  owner: SYSDBA
Statement failed, SQLSTATE = 07002
Dynamic SQL Error
-SQLDA error
-No SQLDA for input values provided      
                            
                        </pre><p>
                </p></div></div><br class="example-break"/><div class="note"><h3 class="title">Примечание</h3><p>Обратите внимание, что при запуске команд HELP SET или SET информация об этой
                    команде не отображается.</p></div><div class="tip"><h3 class="title">Подсказка</h3><p>Как видите последний оператор вызвал ошибку, поскольку
                        <span class="application">isql</span> не позволяет запрашивать значения для
                    входных параметров. Вы можете подавить её отключив фактическое выполнение
                    команды с помощью <code class="code">SET PLANONLY ON</code>.</p></div></section><section class="section" id="isql-commands_set-set_sqldialect"><div class="titlepage"><div><div><h3 class="title">SET SQL DIALECT</h3></div></div></div><a id="d0e8095" class="indexterm"/><p><span class="formalpara-title">Назначение: </span>Установка SQL диалекта.</p><p><span class="formalpara-title">Синтаксис: </span>
                    </p><pre class="programlisting"> 
SET SQL DIALECT {1 | 2 | 3}                                       
                    </pre><p>
                </p><p>Команда SET SQL DIALECT задает диалект SQL Firebird, на который должен быть
                изменен сеанс клиента. Если сеанс в настоящее время присоединен к базе данных,
                отличной от диалекта, указанного в команде, отображается предупреждение.</p><p>Посмотрите <a class="link" href="#isql-sql_dialect" title="SQL диалект">Диалекты SQL</a> для того, чтобы
                узнать о различиях между тремя диалектами.</p><div class="example" id="d0e8120"><div class="example-title">Пример 5.31. Использование команды SET SQL DIALECT</div><div class="example-contents"><p>
                    </p><pre class="programlisting">

SQL&gt; set sql dialect 1;
WARNING: Client SQL dialect has been set to 1 when 
connecting to Database SQL dialect 3 database.
...
SQL&gt; set sql dialect 3;                
                            
                        </pre><p>
                </p><div class="note"><h3 class="title">Примечание</h3><p>Предупреждение в приведенном выше примере пришлось разделить на две
                        строки, чтобы оно поместилось на странице. Обычно оно состоит из одной
                        строки.</p></div></div></div><br class="example-break"/></section><section class="section" id="isql-commands_set-set_stats"><div class="titlepage"><div><div><h3 class="title">SET STATs</h3></div></div></div><a id="d0e8134" class="indexterm"/><p><span class="formalpara-title">Назначение: </span>Включение или отключение отображения статистки.</p><p><span class="formalpara-title">Синтаксис: </span>
                    </p><pre class="programlisting"> 
SET STATs [ON | OFF]                                       
                    </pre><p>
                </p><p>Команда SET STATS определяет, должен ли <span class="application">isql</span> отображать
                различную статистику о каждой выполненной команде SQL. Как и во многих других
                командах, отсутствие параметра переключает текущее состояние.</p><div class="example" id="d0e8157"><div class="example-title">Пример 5.32. Использование команды SET STATS</div><div class="example-contents"><p>
                    </p><pre class="programlisting">

SQL&gt; set stat on;
SQL&gt; select count(*) from employee;

                COUNT
=====================
                   42

Current memory = 19458128
Delta memory = 282544
Max memory = 19531888
Elapsed time= 0.103 sec
Buffers = 2048
Reads = 28
Writes = 0
Fetches = 360              
                            
                        </pre><p>
                </p></div></div><br class="example-break"/></section><section class="section" id="isql-commands_set-set_time"><div class="titlepage"><div><div><h3 class="title">SET TIME</h3></div></div></div><a id="d0e8168" class="indexterm"/><p><span class="formalpara-title">Назначение: </span>Включение или отключение отображение времени для типа DATE в
                    1-диалекте.</p><p><span class="formalpara-title">Синтаксис: </span>
                    </p><pre class="programlisting"> 
SET TIME [ON | OFF]                                       
                    </pre><p>
                </p><p>Команда SET TIME применяется только к базам данных диалекта 1. Её выполнение
                приводит к тому, что часть времени отображается или нет, когда выбираются данные с
                типом данных DATE. Команда не имеет действия с базами данных в других
                диалектах.</p><div class="example" id="d0e8188"><div class="example-title">Пример 5.33. Использовании команды SET TIME</div><div class="example-contents"><p>
                    </p><pre class="programlisting">

SQL&gt; select localtimestamp from rdb$database;

LOCALTIMESTAMP
==============
23-FEB-2020

SQL&gt; set time on;
SQL&gt; select localtimestamp from rdb$database;

           LOCALTIMESTAMP
=========================
23-FEB-2020 13:25:30.7800

SQL&gt;
                        
                    </pre><p>
                </p></div></div><br class="example-break"/></section><section class="section" id="isql-commands_set-set_term"><div class="titlepage"><div><div><h3 class="title">SET TERM</h3></div></div></div><a id="d0e8199" class="indexterm"/><p><span class="formalpara-title">Назначение: </span>Установка символа (символов) терминатора команды или оператора.</p><p><span class="formalpara-title">Синтаксис: </span>
                    </p><pre class="programlisting"> 
SET TERM <em class="replaceable"><code>&lt;new_terminator&gt;</code></em> <em class="replaceable"><code>&lt;current_terminator&gt;</code></em>                                     
                    </pre><p>
                </p><p>
                </p><div class="table" id="d0e8225"><div class="table-title">Таблица 5.15. Параметры оператора SET TERM</div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col style="text-align: left; " class="colArgument"/><col style="text-align: left; " class="colDesc"/></colgroup><thead><tr valign="middle"><th style="text-align: center; vertical-align: middle; border-right: 1px solid ; border-bottom: 1px solid ; ">Параметр</th><th style="text-align: center; vertical-align: middle; border-bottom: 1px solid ; ">Описание</th></tr></thead><tbody><tr><td style="text-align: left; border-right: 1px solid ; border-bottom: 1px solid ; "><em class="replaceable"><code>new_terminator</code></em></td><td style="text-align: left; border-bottom: 1px solid ; ">
                                    <p>Новый символ (символы) терминатор.</p>
                                </td></tr><tr><td style="text-align: left; border-right: 1px solid ; "><em class="replaceable"><code>current_terminator</code></em></td><td style="text-align: left; ">
                                    <p>Текущий символ (символы) терминатор.</p>
                                </td></tr></tbody></table></div></div><p><br class="table-break"/>
            </p><p>Команда SET TERM изменяет терминатор оператора по умолчанию с точки с запятой на
                что-то другое, определенное в переданной строке. Это полезно, когда вы собираетесь
                ввести строку SQL-операторов, составляющих, например, процедуру или триггер. Isql
                попытается выполнить каждый оператор, когда встречает завершающую точку с запятой,
                поэтому сначала нужно изменить терминатор, а затем ввести требуемый код. После
                завершения ввода, вы можете изменить его обратно. При этом необходимо помнить, что
                вы должны завершить команду SET TERM текущим символом (символами)
                терминатором.</p><p>При первом запуске isql использует точку с запятой в качестве терминатора по
                умолчанию.</p><div class="example" id="d0e8262"><div class="example-title">Пример 5.34. Использование команды SET TERM</div><div class="example-contents"><p>
                    </p><pre class="programlisting">

SQL&gt; set term ~ ;

SQL&gt; create procedure test_proc (iInput integer = 666)
CON&gt; returns (oOutput integer)
CON&gt; as
CON&gt; begin
CON&gt;   oOutput = iInput;
CON&gt;   suspend;
CON&gt; end~

SQL&gt; set term ; ~

SQL&gt; commit;

SQL&gt; select * from test_proc;

     OOUTPUT
============
         666             
                            
                        </pre><p>
                </p></div></div><br class="example-break"/><p><span class="formalpara-title">Смотри также: </span><a class="link" href="#isql-terminator" title="Символ терминатора">Символ терминатора</a>.</p></section><section class="section" id="isql-commands_set-set_warnings"><div class="titlepage"><div><div><h3 class="title">SET WARNINGS</h3></div></div></div><a id="d0e8280" class="indexterm"/><a id="d0e8285" class="indexterm"/><p><span class="formalpara-title">Назначение: </span>Включение или выключение вывода предупреждающих сообщений.</p><p><span class="formalpara-title">Синтаксис: </span>
                    </p><pre class="programlisting"> 
SET {WARNINGS | WNG} [ON | OFF]                                  
                    </pre><p>
                </p><p>Команда SET WARNINGS включает или выключает вывод предупреждающих
                сообщений.</p></section><section class="section" id="isql-commands_set-set_width"><div class="titlepage"><div><div><h3 class="title">SET WIDTH</h3></div></div></div><a id="d0e8308" class="indexterm"/><p><span class="formalpara-title">Назначение: </span>Установка ширины вывода для символьных столбцов.</p><p><span class="formalpara-title">Синтаксис: </span>
                    </p><pre class="programlisting"> 
SET WIDTH <em class="replaceable"><code>&lt;column_name&gt;</code></em> [<em class="replaceable"><code>&lt;width&gt;</code></em>]                                  
                    </pre><p>
                </p><p>
                </p><div class="table" id="d0e8334"><div class="table-title">Таблица 5.16. Параметры оператора SET WIDTH</div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col style="text-align: left; " class="colArgument"/><col style="text-align: left; " class="colDesc"/></colgroup><thead><tr valign="middle"><th style="text-align: center; vertical-align: middle; border-right: 1px solid ; border-bottom: 1px solid ; ">Параметр</th><th style="text-align: center; vertical-align: middle; border-bottom: 1px solid ; ">Описание</th></tr></thead><tbody><tr><td style="text-align: left; border-right: 1px solid ; border-bottom: 1px solid ; "><em class="replaceable"><code>column_name</code></em></td><td style="text-align: left; border-bottom: 1px solid ; ">
                                    <p>Наименование или псевдоним символьного столбца.</p>
                                </td></tr><tr><td style="text-align: left; border-right: 1px solid ; "><em class="replaceable"><code>width</code></em></td><td style="text-align: left; ">
                                    <p>Ширина вывода в символах.</p>
                                </td></tr></tbody></table></div></div><p><br class="table-break"/>
            </p><p>Обычно ширина вывода символьных столбцов в таблице определяется по размеру
                выбираемых символьных полей. Использование команды SET WIDTH позволяет пользователю
                определять ширину выходного столбца в большую или меньшую сторону. Если параметр
                    <em class="replaceable"><code>width</code></em> не указан, то будет использована ширина столбца
                по умолчанию для этого столбца.</p><p>В следующем примере показано изменение ширины столбца last_name. Первый SELECT
                отображается с настройками по умолчанию. В этом случае ширина столбца last_name
                составляет 20 символов (считайте количество символов <span class="quote">«<span class="quote">=</span>»</span> в заголовке).
                Она задаётся определением столбца last_name в таблице employee. Второй пример
                показывает таблицу с шириной, уменьшенной до 10 символов. </p><pre class="programlisting"> 

SQL&gt; select emp_no, last_name
CON&gt; from employee
CON&gt; order by last_name
CON&gt; fetch first 5 rows only;

 EMP_NO LAST_NAME
======= ====================
     34 Baldwin
    105 Bender
     28 Bennet
     83 Bishop
    109 Brown

SQL&gt; set width last_name 10;

SQL&gt; select emp_no, last_name
CON&gt; from employee
CON&gt; order by last_name
CON&gt; fetch first 5 rows only;

 EMP_NO LAST_NAME
======= ==========
     34 Baldwin
    105 Bender
     28 Bennet
     83 Bishop
    109 Brown
                             
                    </pre><p>
            </p><p>Столбец emp_no имеет тип SMALLINT. ISQL не может изменить ширину столбцов, которые
                не являются символьными типами. В следующем примере команда <code class="code">set width emp_no
                    10</code> не имеет никакого эффекта. В нём также показано отключение настройки
                ширины для столбца last_name. </p><pre class="programlisting">

SQL&gt; set width last_name;

SQL&gt; set width emp_no 10;

SQL&gt; select emp_no, last_name
CON&gt; from employee
CON&gt; order by last_name
CON&gt; fetch first 5 rows only;

 EMP_NO LAST_NAME
======= ====================
     34 Baldwin
    105 Bender
     28 Bennet
     83 Bishop
    109 Brown
                     
                </pre><p>
            </p></section></section><section class="section" id="isql-commands_show"><div class="titlepage"><div><div><h2 class="title" style="clear: both">ISQL SHOW команды</h2></div></div></div><p>Как объясняется в команде HELP, в isql есть несколько отдельных команд SHOW. Общий
            синтаксис следующий:
            </p><pre class="programlisting">
SHOW <em class="replaceable"><code>&lt;object&gt;</code></em> [<em class="replaceable"><code>&lt;name&gt;</code></em>]   
</pre><p>
        </p><p>
            </p><div class="table" id="d0e8404"><div class="table-title">Таблица 5.17. Параметры оператора SHOW</div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col style="text-align: left; " class="colArgument"/><col style="text-align: left; " class="colDesc"/></colgroup><thead><tr valign="middle"><th style="text-align: center; vertical-align: middle; border-right: 1px solid ; border-bottom: 1px solid ; ">Параметр</th><th style="text-align: center; vertical-align: middle; border-bottom: 1px solid ; ">Описание</th></tr></thead><tbody><tr><td style="text-align: left; border-right: 1px solid ; border-bottom: 1px solid ; "><em class="replaceable"><code>object</code></em></td><td style="text-align: left; border-bottom: 1px solid ; ">
                                <p>Тип отображаемого или отображаемых объектов метаданных.</p>
                            </td></tr><tr><td style="text-align: left; border-right: 1px solid ; "><em class="replaceable"><code>name</code></em></td><td style="text-align: left; ">
                                <p>Наименование объекта метаданных.</p>
                            </td></tr></tbody></table></div></div><p><br class="table-break"/>
        </p><p>Тип объекта метаданных требуется указывать всегда, а имя требуется для отображения
            сведений о конкретном объекте. Без имени команды обычно отображают все имена объекты
            запрошенного типа.</p><p>В отличие от команд SET, нет удобной детализации различных команд SHOW, c
            использованием команды HELP. Однако, если вы наберете SHOW без аргументов, то вам будет
            оказана небольшая помощь. </p><pre class="programlisting">
        
SQL&gt; show;

Valid options are:
CHECKs                   COMMENTs                 COLLATEs
COLLATIONs               DOMAINs                  DB
DATABASE                 DEPENdency               DEPENdencies
EXCEPtions               FILTERs                  FUNCtions
GENerators               GRANTs                   INDexes
INDICES                  MAPping                  PROCedures
PACKages                 ROLEs                    SYStem
SEQuences                SECURITY CLAsses         SECCLAsses
SCHEmas                  TABLEs                   TRIGgers
USERS                    VIEWs
Command error: show
            
        </pre><p>
        </p><p>Каждый тип объекта метаданных может быть сокращен до букв, отображаемых заглавными
            буквами.</p><div class="note"><h3 class="title">Примечание</h3><p>Подсказка, выданная командой SHOW, содержит несколько ошибок. Например, следующие
                команды не работают:</p><div class="itemizedlist"><ul style="list-style-type: disc; " class="itemizedlist"><li class="listitem"><p>SHOW SCHEmas (очевидно зарезервирована для будущих версий где могут
                            появится схемы);</p></li><li class="listitem"><p>SHOW SECURITY CLAsses</p></li></ul></div></div><p>Команды SHOW подробно детализированы и описаны ниже. Где это возможно, приведены
            примеры из базы данных employee.</p><section class="section" id="isql-commands_show-show_check"><div class="titlepage"><div><div><h3 class="title">SHOW CHECK</h3></div></div></div><a id="d0e8461" class="indexterm"/><p><span class="formalpara-title">Назначение: </span>Отображение ограничений для указанной таблицы.</p><p><span class="formalpara-title">Синтаксис: </span>
                    </p><pre class="programlisting"> 
SHOW CHECKs <em class="replaceable"><code>&lt;table_name&gt;</code></em>                                                          
                    </pre><p>
                </p><p>
                </p><div class="table" id="d0e8484"><div class="table-title">Таблица 5.18. Параметры оператора SHOW CHECK</div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col style="text-align: left; " class="colArgument"/><col style="text-align: left; " class="colDesc"/></colgroup><thead><tr valign="middle"><th style="text-align: center; vertical-align: middle; border-right: 1px solid ; border-bottom: 1px solid ; ">Параметр</th><th style="text-align: center; vertical-align: middle; border-bottom: 1px solid ; ">Описание</th></tr></thead><tbody><tr><td style="text-align: left; border-right: 1px solid ; "><em class="replaceable"><code>table_name</code></em></td><td style="text-align: left; ">
                                    <p>Наименование таблицы для которой требуется отобразить
                                        ограничения.</p>
                                </td></tr></tbody></table></div></div><p><br class="table-break"/>
            </p><p>Команда SHOW CHECKs отображает все проверочные ограничения, определенные
                пользователем для заданной таблицы. В отличие от других команд SHOW, здесь нет опции
                для отображения списка всех проверочных ограничений в базе данных. Вы всегда должны
                указывать имя таблицы как часть команды.</p><div class="example" id="d0e8510"><div class="example-title">Пример 5.35. Использование команды SHOW CHECK</div><div class="example-contents"><p>
                    </p><pre class="programlisting">

SQL&gt; show check employee;

CONSTRAINT INTEG_30:
  CHECK ( salary &gt;= (SELECT min_salary FROM job WHERE
                        job.job_code = employee.job_code AND
                        job.job_grade = employee.job_grade AND
                        job.job_country = employee.job_country) AND
            salary &lt;= (SELECT max_salary FROM job WHERE
                        job.job_code = employee.job_code AND
                        job.job_grade = employee.job_grade AND
                        job.job_country = employee.job_country))
    
</pre><p>
                </p></div></div><br class="example-break"/></section><section class="section" id="isql-commands_show-show_collations"><div class="titlepage"><div><div><h3 class="title">SHOW COLLATION</h3></div></div></div><a id="d0e8521" class="indexterm"/><a id="d0e8526" class="indexterm"/><p><span class="formalpara-title">Назначение: </span>Отображение списка пользовательских параметров сортировок или параметров для
                    указанной сортировке.</p><p><span class="formalpara-title">Синтаксис: </span>
                    </p><pre class="programlisting"> 
SHOW {COLLATIONs | COLLATION <em class="replaceable"><code>&lt;collate_name&gt;</code></em> }   
                        
SHOW {COLLATEs | COLLATE <em class="replaceable"><code>&lt;collate_name&gt;</code></em> }                         
                    </pre><p>
                </p><p>
                </p><div class="table" id="d0e8552"><div class="table-title">Таблица 5.19. Параметры оператора SHOW COLLATION</div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col style="text-align: left; " class="colArgument"/><col style="text-align: left; " class="colDesc"/></colgroup><thead><tr valign="middle"><th style="text-align: center; vertical-align: middle; border-right: 1px solid ; border-bottom: 1px solid ; ">Параметр</th><th style="text-align: center; vertical-align: middle; border-bottom: 1px solid ; ">Описание</th></tr></thead><tbody><tr><td style="text-align: left; border-right: 1px solid ; "><em class="replaceable"><code>collate_name</code></em></td><td style="text-align: left; ">
                                    <p>Имя определённой пользователем сортировки.</p>
                                </td></tr></tbody></table></div></div><p><br class="table-break"/>
            </p><p>Эти команды отображают список всех параметров для опреределённых пользователем
                сортировок в текущей базе данных. В первой форме отображается список всех параметров
                всех определенных пользователем сортировок. Если указано имя конкретной сортировки,
                то будут отображаться только её параметры. </p><div class="example" id="d0e8578"><div class="example-title">Пример 5.36. Использование команды SHOW COLLATION</div><div class="example-contents"><p>
                    </p><pre class="programlisting">

SQL&gt; show collations;
UNICODE_ENUS_CI, CHARACTER SET UTF8, FROM EXTERNAL ('UNICODE'), PAD SPACE,
CASE INSENSITIVE, 'COLL-VERSION=58.0.6.48'
UNICODE_ENUS_CS, CHARACTER SET UTF8, FROM EXTERNAL ('UNICODE'), PAD SPACE,
'COLL-VERSION=58.0.6.48'

SQL&gt; show collation unicode_enus_ci;
UNICODE_ENUS_CI, CHARACTER SET UTF8, FROM EXTERNAL ('UNICODE'), PAD SPACE,
CASE INSENSITIVE, 'COLL-VERSION=58.0.6.48'
                        
                    </pre><p>
                </p></div></div><br class="example-break"/><p>Выше приведённые результаты не являются частью базы данных
                    <code class="filename">employee</code>. Некоторые строки в приведенном выше тексте
                пришлось разделить на две, чтобы они поместились на странице.</p></section><section class="section" id="isql-commands_show-show_comments"><div class="titlepage"><div><div><h3 class="title">SHOW COMMENTS</h3></div></div></div><a id="d0e8594" class="indexterm"/><p><span class="formalpara-title">Назначение: </span>Отображение всех комментариев, созданных для различных объектов базы
                    данных.</p><p><span class="formalpara-title">Синтаксис: </span>
                    </p><pre class="programlisting"> 
SHOW COMMENTs                        
                    </pre><p>
                </p><p>Команда SHOW COMMENTЫ отображает все комментарии, которые были созданы для
                различных объектов в текущей базе данных. Нет возможности отобразить конкретный
                комментарий. Каждый комментарий перечисляется вместе с типом объекта и именем, к
                которому он был применен.</p><div class="example" id="d0e8614"><div class="example-title">Пример 5.37. Использование команды SHOW COLLATION</div><div class="example-contents"><p>
                    </p><pre class="programlisting">

SQL&gt; show comments;

COMMENT ON DATABASE IS This is the demonstration EMPLOYEE database.;
COMMENT ON TABLE EMPLOYEE IS The EMPLOYEE table has details of our employees.;
                        
                    </pre><p>
                </p></div></div><br class="example-break"/><p>Фактический текст комментария отображается между ключевым словом IS и конечной
                точкой с запятой</p></section><section class="section" id="isql-commands_show-show_db"><div class="titlepage"><div><div><h3 class="title">SHOW DATABASE</h3></div></div></div><a id="d0e8627" class="indexterm"/><a id="d0e8632" class="indexterm"/><p><span class="formalpara-title">Назначение: </span>Отображение информации о текущей базе данных.</p><p><span class="formalpara-title">Синтаксис: </span>
                    </p><pre class="programlisting"> 
SHOW {DATABASE | DB}                       
                    </pre><p>
                </p><p>Команда SHOW DATABASE (или SHOW DB) отображает сведения о текущей базе данных (имя
                файла, владелец, размер и количество выделенных страниц, интервал очистки, счётчики
                транзакций, флаг Forced Writes, ODS, зашифрована ли база данных, набор символов по
                умолчанию).</p><div class="example" id="d0e8652"><div class="example-title">Пример 5.38. Использование команды SHOW DATABASE</div><div class="example-contents"><p>
                    </p><pre class="programlisting">

SQL&gt; show database;

Database: employee
        Owner: SYSDBA
PAGE_SIZE 8192
Number of DB pages allocated = 326
Number of DB pages used = 297
Number of DB pages free = 29
Sweep interval = 20000
Forced Writes are OFF
Transaction - oldest = 181
Transaction - oldest active = 214
Transaction - oldest snapshot = 214
Transaction - Next = 218
ODS = 12.0
Database not encrypted
Default Character set: NONE
                        
                    </pre><p>
                </p></div></div><br class="example-break"/></section><section class="section" id="isql-commands_show-show_dependencies"><div class="titlepage"><div><div><h3 class="title">SHOW DEPENDENCIES</h3></div></div></div><a id="d0e8663" class="indexterm"/><a id="d0e8668" class="indexterm"/><p><span class="formalpara-title">Назначение: </span>Отображение зависимости для указанного объекта базы данных.</p><p><span class="formalpara-title">Синтаксис: </span>
                    </p><pre class="programlisting"> 
SHOW DEPENdencies <em class="replaceable"><code>&lt;object_name&gt;</code></em>

SHOW DEPENdency <em class="replaceable"><code>&lt;object_name&gt;</code></em>
                    </pre><p>
                </p><p>
                </p><div class="table" id="d0e8694"><div class="table-title">Таблица 5.20. Параметры оператора SHOW DEPENDENCIES</div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col style="text-align: left; " class="colArgument"/><col style="text-align: left; " class="colDesc"/></colgroup><thead><tr valign="middle"><th style="text-align: center; vertical-align: middle; border-right: 1px solid ; border-bottom: 1px solid ; ">Параметр</th><th style="text-align: center; vertical-align: middle; border-bottom: 1px solid ; ">Описание</th></tr></thead><tbody><tr><td style="text-align: left; border-right: 1px solid ; "><em class="replaceable"><code>object_name</code></em></td><td style="text-align: left; ">
                                    <p>Наименование объекта метаданных для которого отображаются
                                        зависимости.</p>
                                </td></tr></tbody></table></div></div><p><br class="table-break"/>
            </p><p>Команда SHOW DEPENDENCIES отображают все зависимости для указанного имени объекта.
                Указанное имя объекта может быть таблицей, представлением, хранимой процедурой,
                функцией, пакетом и т.д.</p><p>Выводимый список представляет собой разделенный запятыми список других объектов в
                базе данных, от которых зависит указанный объект. Другими словами, процедура не
                сможет скомпилироваться, если, например, будет удалена какая-либо из перечисленных
                зависимостей. </p><pre class="programlisting">

SQL&gt; show dependencies SET_CUST_NO;
        [SET_CUST_NO:Trigger]
CUSTOMER:Table&lt;-CUST_NO, CUST_NO_GEN:Generator
+++
                
            </pre><p>
            </p><p>Вышеприведенный листинг показывает, что SET_CUST_NO является триггером и что он
                зависит от двух объектов, столбца CUST_NO таблицы CUSTOMER и
                последовательности/генератора с именем CUST_NO_GEN. Если вы отобразите сам триггер,
                вы увидите оба упомянутых объекта: </p><pre class="programlisting">

SQL&gt; show trigger set_cust_no;

Triggers on Table CUSTOMER:
SET_CUST_NO, Sequence: 0, Type: BEFORE INSERT, Active
Trigger text:
=============================================================================
AS
BEGIN
  if (new.cust_no is null) then
    new.cust_no = gen_id(cust_no_gen, 1);
END
=============================================================================
                
            </pre><p>
            </p><p>Иногда вывод может показаться немного запутанным. Вы можете увидеть различные
                объекты в списке, которые не кажутся релевантными. Таблица RDB$DEPENDENCIES, также
                содержит сведения об объектах, от которых будет зависеть данный объект.</p></section><section class="section" id="isql-commands_show-show_domain"><div class="titlepage"><div><div><h3 class="title">SHOW DOMAIN</h3></div></div></div><a id="d0e8735" class="indexterm"/><p><span class="formalpara-title">Назначение: </span>Отображение списка имён доменов или определение указанного домена.</p><p><span class="formalpara-title">Синтаксис: </span>
                    </p><pre class="programlisting"> 
SHOW {DOMAINs | DOMAIN <em class="replaceable"><code>&lt;domain_name&gt;</code></em>}
                    </pre><p>
                </p><p>
                </p><div class="table" id="d0e8758"><div class="table-title">Таблица 5.21. Параметры оператора SHOW DOMAIN</div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col style="text-align: left; " class="colArgument"/><col style="text-align: left; " class="colDesc"/></colgroup><thead><tr valign="middle"><th style="text-align: center; vertical-align: middle; border-right: 1px solid ; border-bottom: 1px solid ; ">Параметр</th><th style="text-align: center; vertical-align: middle; border-bottom: 1px solid ; ">Описание</th></tr></thead><tbody><tr><td style="text-align: left; border-right: 1px solid ; "><em class="replaceable"><code>domain_name</code></em></td><td style="text-align: left; ">
                                    <p>Наименование домена.</p>
                                </td></tr></tbody></table></div></div><p><br class="table-break"/>
            </p><p>Команда SHOW DOMAIN отображает информацию о домене. Домен — это определенный
                пользователем тип данных, глобальный для базы данных. </p><p>Команда SHOW DOMAIN имеют две формы. Первая отображает список всех известных
                доменов в базе данных, а вторая отображает сведения о конкретном домене.</p><div class="example" id="d0e8786"><div class="example-title">Пример 5.39. Использование команды SHOW DOMAIN</div><div class="example-contents"><p>
                    </p><pre class="programlisting">

SQL&gt; show domains;

       ADDRESSLINE                            BUDGET
       COUNTRYNAME                            CUSTNO
       DEPTNO                                 EMPNO
       FIRSTNAME                              JOBCODE
       JOBGRADE                               LASTNAME
       PHONENUMBER                            PONUMBER
       PRODTYPE                               PROJNO
       SALARY
       
SQL&gt; show domain addressline;

ADDRESSLINE                     VARCHAR(30) Nullable
                        
                    </pre><p>
                </p></div></div><br class="example-break"/></section><section class="section" id="isql-commands_show-show_exeption"><div class="titlepage"><div><div><h3 class="title">SHOW EXCEPTION</h3></div></div></div><a id="d0e8797" class="indexterm"/><p><span class="formalpara-title">Назначение: </span>Отображение информации обо всех или указанном исключении.</p><p><span class="formalpara-title">Синтаксис: </span>
                    </p><pre class="programlisting"> 
SHOW {EXCEPTIONs | EXCEPTION <em class="replaceable"><code>&lt;exception_name&gt;</code></em>}
                    </pre><p>
                </p><p>
                </p><div class="table" id="d0e8820"><div class="table-title">Таблица 5.22. Параметры оператора SHOW EXCEPTION</div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col style="text-align: left; " class="colArgument"/><col style="text-align: left; " class="colDesc"/></colgroup><thead><tr valign="middle"><th style="text-align: center; vertical-align: middle; border-right: 1px solid ; border-bottom: 1px solid ; ">Параметр</th><th style="text-align: center; vertical-align: middle; border-bottom: 1px solid ; ">Описание</th></tr></thead><tbody><tr><td style="text-align: left; border-right: 1px solid ; "><em class="replaceable"><code>exception_name</code></em></td><td style="text-align: left; ">
                                    <p>Наименование исключения.</p>
                                </td></tr></tbody></table></div></div><p><br class="table-break"/>
            </p><p>Команда SHOW EXCEPTION отображает все исключения, которые были определены в
                текущей базе данных. Отображаются также детальная информации об каждом исключениях:
                сообщение об ошибке, объекты, которые используют исключение. Вы можете отобразить
                детальную информацию об отдельном исключении, задав в качестве параметра имя
                исключения.</p><div class="example" id="d0e8846"><div class="example-title">Пример 5.40. Использование команды SHOW EXCEPTION</div><div class="example-contents"><p>
                    </p><pre class="programlisting">

SQL&gt; show exceptions;

Exception Name                  Used by, Type
=============================== =============================================
CUSTOMER_CHECK                  SHIP_ORDER, Stored procedure
Msg: Overdue balance -- can not ship.

CUSTOMER_ON_HOLD                SHIP_ORDER, Stored procedure
Msg: This customer is on hold.

ORDER_ALREADY_SHIPPED           SHIP_ORDER, Stored procedure
Msg: Order status is "shipped."

REASSIGN_SALES                  DELETE_EMPLOYEE, Stored procedure
Msg: Reassign the sales records before deleting this employee.

UNKNOWN_EMP_ID                  ADD_EMP_PROJ, Stored procedure
Msg: Invalid employee number or project id.



SQL&gt; show exception customer_on_hold;

Exception Name                  Used by, Type
=============================== =============================================
CUSTOMER_ON_HOLD                SHIP_ORDER, Stored procedure
Msg: This customer is on hold.

                        
                    </pre><p>
                </p></div></div><br class="example-break"/></section><section class="section" id="isql-commands_show-show_filter"><div class="titlepage"><div><div><h3 class="title">SHOW FILTER</h3></div></div></div><a id="d0e8857" class="indexterm"/><p><span class="formalpara-title">Назначение: </span>Отображение списка BLOB-фильтров или информации об указанном фильтре.</p><p><span class="formalpara-title">Синтаксис: </span>
                    </p><pre class="programlisting"> 
SHOW {FILTERs | FILTER <em class="replaceable"><code>&lt;filter_name&gt;</code></em>}
                    </pre><p>
                </p><p>
                </p><div class="table" id="d0e8880"><div class="table-title">Таблица 5.23. Параметры оператора SHOW FILTER</div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col style="text-align: left; " class="colArgument"/><col style="text-align: left; " class="colDesc"/></colgroup><thead><tr valign="middle"><th style="text-align: center; vertical-align: middle; border-right: 1px solid ; border-bottom: 1px solid ; ">Параметр</th><th style="text-align: center; vertical-align: middle; border-bottom: 1px solid ; ">Описание</th></tr></thead><tbody><tr><td style="text-align: left; border-right: 1px solid ; "><em class="replaceable"><code>filter_name</code></em></td><td style="text-align: left; ">
                                    <p>Наименование BLOB-фильтра.</p>
                                </td></tr></tbody></table></div></div><p><br class="table-break"/>
            </p><p>Команда SHOW FILTER отображает список BLOB-фильтров определённых оператором
                    <code class="code">DECLARE FILTER</code> или информацию об указанном фильтре.</p><div class="example" id="d0e8909"><div class="example-title">Пример 5.41. Использование команды SHOW FILTER</div><div class="example-contents"><p>
                    </p><pre class="programlisting">

SQL&gt; show filter;

    FUNNEL
...

SQL&gt; show filter funnel; 

BLOB Filter: FUNNEL
Input subtype: 2 Output subtype: 1
Filter library is myfilterlib
Entry point is blr2asc
                        
                    </pre><p>
                </p></div></div><br class="example-break"/></section><section class="section" id="isql-commands_show-show_function"><div class="titlepage"><div><div><h3 class="title">SHOW FUNCTION</h3></div></div></div><a id="d0e8920" class="indexterm"/><p><span class="formalpara-title">Назначение: </span>Отображение информации обо всех определённых пользователем функциях или
                    определение указанной функции.</p><p><span class="formalpara-title">Синтаксис: </span>
                    </p><pre class="programlisting"> 
SHOW {FUNCTIONs | FUNCTION <em class="replaceable"><code>&lt;function_name&gt;</code></em>}
                    </pre><p>
                </p><p>
                </p><div class="table" id="d0e8943"><div class="table-title">Таблица 5.24. Параметры оператора SHOW FUNCTION</div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col style="text-align: left; " class="colArgument"/><col style="text-align: left; " class="colDesc"/></colgroup><thead><tr valign="middle"><th style="text-align: center; vertical-align: middle; border-right: 1px solid ; border-bottom: 1px solid ; ">Параметр</th><th style="text-align: center; vertical-align: middle; border-bottom: 1px solid ; ">Описание</th></tr></thead><tbody><tr><td style="text-align: left; border-right: 1px solid ; "><em class="replaceable"><code>function_name</code></em></td><td style="text-align: left; ">
                                    <p>Наименование функции.</p>
                                </td></tr></tbody></table></div></div><p><br class="table-break"/>
            </p><p>Команда SHOW FUNCTION отображает все определённые пользователем функции, а так же
                их зависимости, т.е. объекты которые используются функцией. Если указано имя функции
                в качестве параметра, то для будет отображена дополнительная информация, которая
                зависит от типа функции:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>для внешних Legacy функций будет отображена информация о входных
                            параметре и возвращаемом результате, имя динамической библиотеки, имя
                            точки входа;</p></li><li class="listitem"><p>для PSQL функций будет отображена информация о входных параметре и
                            возвращаемом результате и тексте функции;</p></li><li class="listitem"><p>для внешних UDR функций будет отображена информация о входных
                            параметре и возвращаемом результате, имени используемого плагина и точке
                            входа.</p></li></ul></div><div class="example" id="d0e8979"><div class="example-title">Пример 5.42. Использование команды SHOW FUNCTION</div><div class="example-contents"><p>
                    </p><pre class="programlisting">

SQL&gt; show functions;
Global functions

Function Name                     Invalid Dependency, Type
================================= ======= =====================================
F                                         T, Table
GETEXACTTIMESTAMPUTC
ISLEAPYEAR
ISLEAPYEAR_2
SUM_ARGS


SQL&gt; show function isleapyear;

External function ISLEAPYEAR:
Function library is fbudf
Entry point is isLeapYear
Returns  BY VALUE INTEGER
Argument 1: TIMESTAMP


SQL&gt; show function isleapyear_2;
Function text:
=============================================================================
begin
  return mod(extract(year from adate), 4) = 0;
end
=============================================================================
Parameters:
                                  OUTPUT BOOLEAN
ADATE                             INPUT TIMESTAMP


SQL&gt; show function f;
Function text:
=============================================================================
begin
  return (select count(*) from t);
end
=============================================================================
Parameters:
                                  OUTPUT INTEGER
                                  

SQL&gt; show function sum_args;
External name: myudr!sum_args
Engine: UDR
Parameters:
                                  OUTPUT INTEGER
N1                                INPUT INTEGER
N2                                INPUT INTEGER
N3                                INPUT INTEGER
                        
                    </pre><p>
                </p></div></div><br class="example-break"/><p><span class="formalpara-title">Смотри также: </span><a class="link" href="#isql-commands_show-show_procedure" title="SHOW PROCEDURE">SHOW PROCEDURE</a>, <a class="link" href="#isql-commands_show-show_trigger" title="SHOW TRIGGER">SHOW TRIGGER</a>, <a class="link" href="#isql-commands_show-show_package" title="SHOW PACKAGE">SHOW PACKAGE</a>.</p></section><section class="section" id="isql-commands_show-show_generator"><div class="titlepage"><div><div><h3 class="title">SHOW GENERATOR</h3></div></div></div><a id="d0e9003" class="indexterm"/><p><span class="formalpara-title">Назначение: </span>Отображение информации обо всех не системных генераторах или об одном
                    указанном генераторе.</p><p><span class="formalpara-title">Синтаксис: </span>
                    </p><pre class="programlisting"> 
SHOW {GENERATORs | GENERATOR <em class="replaceable"><code>&lt;generator_name&gt;</code></em>}
                        
SHOW {SEQUENCEs | SEQUENCE <em class="replaceable"><code>&lt;sequence_name&gt;</code></em>}                        
                    </pre><p>
                </p><p>
                </p><div class="table" id="d0e9029"><div class="table-title">Таблица 5.25. Параметры оператора SHOW GENERATOR</div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col style="text-align: left; " class="colArgument"/><col style="text-align: left; " class="colDesc"/></colgroup><thead><tr valign="middle"><th style="text-align: center; vertical-align: middle; border-right: 1px solid ; border-bottom: 1px solid ; ">Параметр</th><th style="text-align: center; vertical-align: middle; border-bottom: 1px solid ; ">Описание</th></tr></thead><tbody><tr><td style="text-align: left; border-right: 1px solid ; "><em class="replaceable"><code>generator_name</code></em></td><td style="text-align: left; ">
                                    <p>Наименование генератора (последовательности).</p>
                                </td></tr></tbody></table></div></div><p><br class="table-break"/>
            </p><p>Эти две команды идентичны. Генераторы — это старый термин Firebird для того, что
                обычно называют последовательностями в других базах данных, а также в SQL стандарте.
                Вам рекомендуется использовать последовательности, а не генераторы, но Firebird
                считает их одинаковыми.</p><p>Если имя генератора (последовательности) не указано, то будут выведены сведения
                обо всех генераторах (имя, текущее значение, начальное значение, значение шага
                приращения). Если указано имя генератора (последовательности), то будет выведены
                сведения о конкретном генераторе.</p><div class="example" id="d0e9057"><div class="example-title">Пример 5.43. Использование команды SHOW GENERATOR</div><div class="example-contents"><p>
                    </p><pre class="programlisting">

SQL&gt; show generators;
Generator CUST_NO_GEN, current value: 1015, initial value: 0, increment: 1
Generator EMP_NO_GEN, current value: 145, initial value: 0, increment: 1

SQL&gt; show generator emp_no_gen;
Generator EMP_NO_GEN, current value: 145, initial value: 0, increment: 1
                        
                    </pre><p>
                </p></div></div><br class="example-break"/><p><span class="formalpara-title">Смотри также: </span><a class="link" href="#isql-commands_show-show_sequence" title="SHOW SEQUENCE">SHOW SEQUENCE</a>.</p></section><section class="section" id="isql-commands_show-show_grants"><div class="titlepage"><div><div><h3 class="title">SHOW GRANTS</h3></div></div></div><a id="d0e9075" class="indexterm"/><p><span class="formalpara-title">Назначение: </span>Отображение список всех разрешений в текущей базе данных или разрешений на
                    указанный объект или разрешений для указанной роли.</p><p><span class="formalpara-title">Синтаксис: </span>
                    </p><pre class="programlisting"> 
SHOW {GRANTs | GRANT {<em class="replaceable"><code>&lt;object_name&gt;</code></em> | <em class="replaceable"><code>&lt;role_name&gt;</code></em>}}                        
                    </pre><p>
                </p><p>
                </p><div class="table" id="d0e9101"><div class="table-title">Таблица 5.26. Параметры оператора SHOW GRANT</div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col style="text-align: left; " class="colArgument"/><col style="text-align: left; " class="colDesc"/></colgroup><thead><tr valign="middle"><th style="text-align: center; vertical-align: middle; border-right: 1px solid ; border-bottom: 1px solid ; ">Параметр</th><th style="text-align: center; vertical-align: middle; border-bottom: 1px solid ; ">Описание</th></tr></thead><tbody><tr><td style="text-align: left; border-right: 1px solid ; border-bottom: 1px solid ; "><em class="replaceable"><code>object_name</code></em></td><td style="text-align: left; border-bottom: 1px solid ; ">
                                    <p>Наименование объекта метаданных для которого отображаются
                                        разрешения.</p>
                                </td></tr><tr><td style="text-align: left; border-right: 1px solid ; "><em class="replaceable"><code>role_name</code></em></td><td style="text-align: left; ">
                                    <p>Наименование роли для которой отображается список
                                        пользователей которым эта роль назначена.</p>
                                </td></tr></tbody></table></div></div><p><br class="table-break"/>
            </p><p>Команда SHOW GRANT отображает список всех разрешений в текущей базе данных, если
                команда используется без параметров. Если в качестве аргумента команды указано имя
                объекта (таблица, процедура, функция, триггер, и т.д.), то будут отображены
                разрешения для указанного объекта. Если в качестве аргумента указано имя роли, то
                будет отображён список пользователей (вместе с оператором разрешения на роль) для
                которых выдана эта роль.</p><div class="example" id="d0e9136"><div class="example-title">Пример 5.44. Использование команды SHOW GRANT</div><div class="example-contents"><p>
                    </p><pre class="programlisting">

SQL&gt; show grants;

/* Grant permissions for this database */
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON COUNTRY 
TO PUBLIC WITH GRANT OPTION
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES 
ON CUSTOMER TO PUBLIC WITH GRANT OPTION
...
GRANT EXECUTE ON PROCEDURE SHIP_ORDER TO PUBLIC WITH GRANT OPTION
GRANT EXECUTE ON PROCEDURE SHOW_LANGS TO PUBLIC WITH GRANT OPTION
GRANT EXECUTE ON PROCEDURE SUB_TOT_BUDGET TO PUBLIC WITH GRANT OPTION

SQL&gt; show grants employee;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES 
ON EMPLOYEE TO PUBLIC WITH GRANT OPTION

SQL&gt; show grants ship_order;
GRANT EXECUTE ON PROCEDURE SHIP_ORDER TO PUBLIC WITH GRANT OPTION

SQL&gt; show grants default_user;
GRANT DEFAULT_USER TO SYSDBA
                        
                    </pre><p>
                </p></div></div><br class="example-break"/><div class="note"><h3 class="title">Примечание</h3><p>Обратите внимание, что некоторые строки в приведенном выше разделены, чтобы
                    они могли поместиться на странице.</p></div></section><section class="section" id="isql-commands_show-show_indexes"><div class="titlepage"><div><div><h3 class="title">SHOW INDEXES</h3></div></div></div><a id="d0e9150" class="indexterm"/><p><span class="formalpara-title">Назначение: </span>Отображение информации обо всех индексах или об указанном индексе.</p><p><span class="formalpara-title">Синтаксис: </span>
                    </p><pre class="programlisting"> 
SHOW {INDexes | INDICES}

SHOW {INDICES | INDexes} <em class="replaceable"><code>&lt;table_name&gt;</code></em>
                        
SHOW INDex <em class="replaceable"><code>&lt;index_name&gt;</code></em>                     
                    </pre><p>
                </p><p>
                </p><div class="table" id="d0e9176"><div class="table-title">Таблица 5.27. Параметры оператора SHOW INDICES</div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col style="text-align: left; " class="colArgument"/><col style="text-align: left; " class="colDesc"/></colgroup><thead><tr valign="middle"><th style="text-align: center; vertical-align: middle; border-right: 1px solid ; border-bottom: 1px solid ; ">Параметр</th><th style="text-align: center; vertical-align: middle; border-bottom: 1px solid ; ">Описание</th></tr></thead><tbody><tr><td style="text-align: left; border-right: 1px solid ; border-bottom: 1px solid ; "><em class="replaceable"><code>table_name</code></em></td><td style="text-align: left; border-bottom: 1px solid ; ">
                                    <p>Наименование таблицы для которой будет отображён список
                                        индексов.</p>
                                </td></tr><tr><td style="text-align: left; border-right: 1px solid ; "><em class="replaceable"><code>index_name</code></em></td><td style="text-align: left; ">
                                    <p>Наименование индекса по которому бкдет отображена
                                        информации.</p>
                                </td></tr></tbody></table></div></div><p><br class="table-break"/>
            </p><p>Первая форма этой команды перечислит все индексы в текущей базе данных. В этой
                форме вы можете использовать либо INDEXES, либо INDECES, они рассматриваются в
                Firebird как идентичные. Вторая форма команды будет отображать список индексов для
                указанной таблицы <em class="replaceable"><code>table_name</code></em>. Опять же, вы можете
                использовать INDEXES, либо INDECES. В последней форме команды отображаются сведения
                о указанном индексе <em class="replaceable"><code>index_name</code></em>, и в этой форме команды
                необходимо использовать ключевое слово INDEX.</p><div class="example" id="d0e9217"><div class="example-title">Пример 5.45. Использование команды SHOW INDEX</div><div class="example-contents"><p>
                    </p><pre class="programlisting">

SQL&gt; show indices;
RDB$PRIMARY1 UNIQUE INDEX ON COUNTRY(COUNTRY)
CUSTNAMEX INDEX ON CUSTOMER(CUSTOMER)
CUSTREGION INDEX ON CUSTOMER(COUNTRY, CITY)
...
RDB$PRIMARY24 UNIQUE INDEX ON SALES(PO_NUMBER)
SALESTATX INDEX ON SALES(ORDER_STATUS, PAID)


SQL&gt; show indices employee;
NAMEX INDEX ON EMPLOYEE(LAST_NAME, FIRST_NAME)
RDB$FOREIGN8 INDEX ON EMPLOYEE(DEPT_NO)
RDB$FOREIGN9 INDEX ON EMPLOYEE(JOB_CODE, JOB_GRADE, JOB_COUNTRY)
RDB$PRIMARY7 UNIQUE INDEX ON EMPLOYEE(EMP_NO)


SQL&gt; show index namex;
NAMEX INDEX ON EMPLOYEE(LAST_NAME, FIRST_NAME)
                        
                    </pre><p>
                </p></div></div><br class="example-break"/></section><section class="section" id="isql-commands_show-show_mapping"><div class="titlepage"><div><div><h3 class="title">SHOW MAPPING</h3></div></div></div><a id="d0e9228" class="indexterm"/><p><span class="formalpara-title">Назначение: </span>Информация локальных и глобальных отображений для объектов
                    безопасности.</p><p><span class="formalpara-title">Синтаксис: </span>
                    </p><pre class="programlisting"> 
SHOW {MAPping | MAPping <em class="replaceable"><code>&lt;mapping_name&gt;</code></em> }                                       
                    </pre><p>
                </p><p>
                </p><div class="table" id="d0e9251"><div class="table-title">Таблица 5.28. Параметры оператора SHOW MAPPING</div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col style="text-align: left; " class="colArgument"/><col style="text-align: left; " class="colDesc"/></colgroup><thead><tr valign="middle"><th style="text-align: center; vertical-align: middle; border-right: 1px solid ; border-bottom: 1px solid ; ">Параметр</th><th style="text-align: center; vertical-align: middle; border-bottom: 1px solid ; ">Описание</th></tr></thead><tbody><tr><td style="text-align: left; border-right: 1px solid ; "><em class="replaceable"><code>mapping_name</code></em></td><td style="text-align: left; ">
                                    <p>Имя отображения.</p>
                                </td></tr></tbody></table></div></div><p><br class="table-break"/>
            </p><p>Команда SHOW MAPPING выводит информацию обо всех отображениях (локальных и
                глобальных) для объектов безопасности. Если указано имя отображения, то будет
                выведена информация только он нём.</p><div class="example" id="d0e9277"><div class="example-title">Пример 5.46. Использование команды SHOW MAPPING</div><div class="example-contents"><p>
                    </p><pre class="programlisting">

SQL&gt; show mapping;
WIN_ADMINS USING PLUGIN WIN_SSPI FROM PREDEFINED_GROUP DOMAIN_ANY_RID_ADMINS TO ROLE RDB$ADMIN

*** Global mapping ***
TRUSTED_AUTH USING PLUGIN WIN_SSPI FROM ANY USER TO USER

SQL&gt; show mapping win_admins;
WIN_ADMINS USING PLUGIN WIN_SSPI FROM PREDEFINED_GROUP DOMAIN_ANY_RID_ADMINS TO ROLE RDB$ADMIN
                        
                    </pre><p>
                </p></div></div><br class="example-break"/></section><section class="section" id="isql-commands_show-show_package"><div class="titlepage"><div><div><h3 class="title">SHOW PACKAGE</h3></div></div></div><a id="d0e9288" class="indexterm"/><p><span class="formalpara-title">Назначение: </span>Отображение списка пакетов или информации об указанном пакете.</p><p><span class="formalpara-title">Синтаксис: </span>
                    </p><pre class="programlisting"> 
SHOW {PACKages | PACKage <em class="replaceable"><code>&lt;package_name&gt;</code></em> }                                       
                    </pre><p>
                </p><p>
                </p><div class="table" id="d0e9311"><div class="table-title">Таблица 5.29. Параметры оператора SHOW PACKAGE</div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col style="text-align: left; " class="colArgument"/><col style="text-align: left; " class="colDesc"/></colgroup><thead><tr valign="middle"><th style="text-align: center; vertical-align: middle; border-right: 1px solid ; border-bottom: 1px solid ; ">Параметр</th><th style="text-align: center; vertical-align: middle; border-bottom: 1px solid ; ">Описание</th></tr></thead><tbody><tr><td style="text-align: left; border-right: 1px solid ; "><em class="replaceable"><code>package_name</code></em></td><td style="text-align: left; ">
                                    <p>Имя пакета.</p>
                                </td></tr></tbody></table></div></div><p><br class="table-break"/>
            </p><p>Команда SHOW PACKAGE отображает список всех пакетов определенных в текущей базе
                данных. Если в качестве параметра указано имя пакета, то будет отображён исходный
                код заголовка и тела пакета.</p><div class="example" id="d0e9337"><div class="example-title">Пример 5.47. Использование команды SHOW PACKAGE</div><div class="example-contents"><p>
                    </p><pre class="programlisting">

SQL&gt; show packages;

       CHECK_NAME_UTILS                       DATE_UTILS                            
       REPL_APPLY_UTILS                       REPL_LOG_UTILS
       REPL_TRIGGERS_UTILS                    REPL_WRITE_LOG
       
SQL&gt; show package date_utils;

DATE_UTILS
Header source:
BEGIN
  ...  
  -- Возвращает строковое представление даты в формате dd MMM yyyy
  FUNCTION DateToChar_Rus(ADate DATE) RETURNS VARCHAR(35);
  -- Возвращает строковое представление даты в формате dd MMM yyyy
  FUNCTION DateToChar_En(ADate DATE) RETURNS VARCHAR(35);
  ...
END

Body source:
BEGIN
  ...
  /**
   * Возвращает строковое представление даты в формате dd MMM yyyy
   */
  FUNCTION DateToChar_Rus(ADate DATE) RETURNS VARCHAR(35)
  AS
  BEGIN
    RETURN EXTRACT(DAY FROM ADate) || ' ' ||
           TRIM (CASE EXTRACT(MONTH FROM ADate)
                  WHEN 1 THEN 'января'
                  WHEN 2 THEN 'февраля'
                  WHEN 3 THEN 'марта'
                  WHEN 4 THEN 'апреля'
                  WHEN 5 THEN 'мая'
                  WHEN 6 THEN 'июня'
                  WHEN 7 THEN 'июля'
                  WHEN 8 THEN 'августа'
                  WHEN 9 THEN 'сентября'
                  WHEN 10 THEN 'октября'
                  WHEN 11 THEN 'ноября'
                  WHEN 12 THEN 'декабря'
               END) || ' ' ||
               EXTRACT(YEAR FROM ADate);
  END

  /**
   * Возвращает строковое представление даты в формате dd MMM yyyy
   */
  FUNCTION DateToChar_En(ADate DATE) RETURNS VARCHAR(35)
  AS
  BEGIN
    RETURN EXTRACT(DAY FROM ADate) || ' ' ||
           TRIM (CASE EXTRACT(MONTH FROM ADate)
                   WHEN 1 THEN 'January'
                   WHEN 2 THEN 'February'
                   WHEN 3 THEN 'March'
                   WHEN 4 THEN 'April'
                   WHEN 5 THEN 'May'
                   WHEN 6 THEN 'June'
                   WHEN 7 THEN 'July'
                   WHEN 8 THEN 'August'
                   WHEN 9 THEN 'September'
                   WHEN 10 THEN 'October'
                   WHEN 11 THEN 'November'
                   WHEN 12 THEN 'December'
               END) || ' ' ||
               EXTRACT(YEAR FROM ADate);
  END
  ...
END  
                        
                    </pre><p>
                </p></div></div><br class="example-break"/><p><span class="formalpara-title">Смотри также: </span><a class="link" href="#isql-commands_show-show_function" title="SHOW FUNCTION">SHOW FUNCTION</a>, <a class="link" href="#isql-commands_show-show_trigger" title="SHOW TRIGGER">SHOW TRIGGER</a>, <a class="link" href="#isql-commands_show-show_procedure" title="SHOW PROCEDURE">SHOW PROCEDURE</a>.</p></section><section class="section" id="isql-commands_show-show_procedure"><div class="titlepage"><div><div><h3 class="title">SHOW PROCEDURE</h3></div></div></div><a id="d0e9361" class="indexterm"/><p><span class="formalpara-title">Назначение: </span>Отображение информации обо всех процедурах в текущей базе данных или об
                    указанной процедуре.</p><p><span class="formalpara-title">Синтаксис: </span>
                    </p><pre class="programlisting"> 
SHOW {PROCedures | PROCedure <em class="replaceable"><code>&lt;procedure_name&gt;</code></em> }                                       
                    </pre><p>
                </p><p>
                </p><div class="table" id="d0e9384"><div class="table-title">Таблица 5.30. Параметры оператора SHOW PROCEDURE</div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col style="text-align: left; " class="colArgument"/><col style="text-align: left; " class="colDesc"/></colgroup><thead><tr valign="middle"><th style="text-align: center; vertical-align: middle; border-right: 1px solid ; border-bottom: 1px solid ; ">Параметр</th><th style="text-align: center; vertical-align: middle; border-bottom: 1px solid ; ">Описание</th></tr></thead><tbody><tr><td style="text-align: left; border-right: 1px solid ; "><em class="replaceable"><code>procedure_name</code></em></td><td style="text-align: left; ">
                                    <p>Имя хранимой процедуры.</p>
                                </td></tr></tbody></table></div></div><p><br class="table-break"/>
            </p><p>Команда SHOW PROCEDURE позволяет отобразить список всех хранимых процедур
                определённых в текущей базе данных и их зависимостей, т.е. объекты которые
                используются процедурой. Если указано имя хранимой процедуры, то будет отображён её
                исходный код, а также сведения о входных и выходных параметрах.</p><div class="example" id="d0e9410"><div class="example-title">Пример 5.48. Использование команды SHOW PROCEDURE</div><div class="example-contents"><p>
                    </p><pre class="programlisting">

SQL&gt; show procedures;
Global procedures

Procedure Name                    Invalid Dependency, Type
================================= ======= =====================================
ADD_EMP_PROJ                              EMPLOYEE_PROJECT, Table
                                          UNKNOWN_EMP_ID, Exception
ALL_LANGS                                 JOB, Table
                                          SHOW_LANGS, Procedure
...


SQL&gt; show procedure all_langs;
Procedure text:
=============================================================================
BEGIN
        FOR SELECT job_code, job_grade, job_country FROM job
                INTO :code, :grade, :country

        DO
        BEGIN
            FOR SELECT languages FROM show_langs
                    (:code, :grade, :country) INTO :lang DO
                SUSPEND;
            /* Put nice separators between rows */
            code = '=====';
            grade = '=====';
            country = '===============';
            lang = '==============';
            SUSPEND;
        END
    END
=============================================================================
Parameters:
CODE                              OUTPUT VARCHAR(5)
GRADE                             OUTPUT VARCHAR(5)
COUNTRY                           OUTPUT VARCHAR(15)
LANG                              OUTPUT VARCHAR(15)
                        
                    </pre><p>
                </p></div></div><br class="example-break"/><p><span class="formalpara-title">Смотри также: </span><a class="link" href="#isql-commands_show-show_function" title="SHOW FUNCTION">SHOW FUNCTION</a>, <a class="link" href="#isql-commands_show-show_trigger" title="SHOW TRIGGER">SHOW TRIGGER</a>, <a class="link" href="#isql-commands_show-show_package" title="SHOW PACKAGE">SHOW PACKAGE</a>.</p></section><section class="section" id="isql-commands_show-show_role"><div class="titlepage"><div><div><h3 class="title">SHOW ROLE</h3></div></div></div><a id="d0e9434" class="indexterm"/><p><span class="formalpara-title">Назначение: </span>Отображение списка ролей в текущей базе данных, или списка пользователей
                    назначенных указанной роли.</p><p><span class="formalpara-title">Синтаксис: </span>
                    </p><pre class="programlisting"> 
SHOW {ROLEs | ROLE <em class="replaceable"><code>&lt;role_name&gt;</code></em> }                                       
                    </pre><p>
                </p><p>
                </p><div class="table" id="d0e9457"><div class="table-title">Таблица 5.31. Параметры оператора SHOW ROLE</div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col style="text-align: left; " class="colArgument"/><col style="text-align: left; " class="colDesc"/></colgroup><thead><tr valign="middle"><th style="text-align: center; vertical-align: middle; border-right: 1px solid ; border-bottom: 1px solid ; ">Параметр</th><th style="text-align: center; vertical-align: middle; border-bottom: 1px solid ; ">Описание</th></tr></thead><tbody><tr><td style="text-align: left; border-right: 1px solid ; "><em class="replaceable"><code>role_name</code></em></td><td style="text-align: left; ">
                                    <p>Имя роли.</p>
                                </td></tr></tbody></table></div></div><p><br class="table-break"/>
            </p><p>Команда SHOW ROLE выводит список ролей в текущей базе данных. Если в качестве
                аргумента передано имя роли, то будет выведен список пользователей которым назначена
                указанная роль.</p><div class="example" id="d0e9483"><div class="example-title">Пример 5.49. Использование команды SHOW ROLE</div><div class="example-contents"><p>
                    </p><pre class="programlisting">

SQL&gt; show roles;
       R1                                     R2
       R3
       
SQL&gt; show role r1;
Role R1 is granted to:
U1
U2       
                        
                    </pre><p>
                </p></div></div><br class="example-break"/></section><section class="section" id="isql-commands_show-show_secclasses"><div class="titlepage"><div><div><h3 class="title">SHOW SECCLASSES</h3></div></div></div><a id="d0e9494" class="indexterm"/><p><span class="formalpara-title">Назначение: </span>Отображение информации о классах безопасности для заданного объекта.</p><p><span class="formalpara-title">Синтаксис: </span>
                    </p><pre class="programlisting"> 
SHOW SECCLAsses <em class="replaceable"><code>&lt;object_name&gt;</code></em>                                      
                    </pre><p>
                </p><p>
                </p><div class="table" id="d0e9517"><div class="table-title">Таблица 5.32. Параметры оператора SHOW SECCLASSES</div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col style="text-align: left; " class="colArgument"/><col style="text-align: left; " class="colDesc"/></colgroup><thead><tr valign="middle"><th style="text-align: center; vertical-align: middle; border-right: 1px solid ; border-bottom: 1px solid ; ">Параметр</th><th style="text-align: center; vertical-align: middle; border-bottom: 1px solid ; ">Описание</th></tr></thead><tbody><tr><td style="text-align: left; border-right: 1px solid ; "><em class="replaceable"><code>object_name</code></em></td><td style="text-align: left; ">
                                    <p>Имя объекта метаданных.</p>
                                </td></tr></tbody></table></div></div><p><br class="table-break"/>
            </p><p>Команда SHOW SECCLASSES отображает информацию о классах безопасности для заданного
                объекта. В качестве <em class="replaceable"><code>object_name</code></em> может быть передано не
                только имя таблицы, это может быть имя хранимой процедуры, представления и
                т.д.</p><div class="example" id="d0e9546"><div class="example-title">Пример 5.50. Использование команды SHOW SECCLASSES</div><div class="example-contents"><p>
                    </p><pre class="programlisting">

SQL&gt; show secclasses employee;

Table's main sec class SQL$440
Table's default sec class SQL$DEFAULT54    
                        
                    </pre><p>
                </p></div></div><br class="example-break"/></section><section class="section" id="isql-commands_show-show_sequence"><div class="titlepage"><div><div><h3 class="title">SHOW SEQUENCE</h3></div></div></div><a id="d0e9557" class="indexterm"/><p><span class="formalpara-title">Назначение: </span>Отображение информации обо всех не системных последовательностях или об одной
                    указанной последовательности.</p><p><span class="formalpara-title">Синтаксис: </span>
                    </p><pre class="programlisting"> 
SHOW {SEQUENCEs | SEQUENCE <em class="replaceable"><code>&lt;sequence_name&gt;</code></em>} 

SHOW {GENERATORs | GENERATOR <em class="replaceable"><code>&lt;generator_name&gt;</code></em>}                                               
                    </pre><p>
                </p><p>
                </p><div class="table" id="d0e9583"><div class="table-title">Таблица 5.33. Параметры оператора SHOW SEQUENCE</div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col style="text-align: left; " class="colArgument"/><col style="text-align: left; " class="colDesc"/></colgroup><thead><tr valign="middle"><th style="text-align: center; vertical-align: middle; border-right: 1px solid ; border-bottom: 1px solid ; ">Параметр</th><th style="text-align: center; vertical-align: middle; border-bottom: 1px solid ; ">Описание</th></tr></thead><tbody><tr><td style="text-align: left; border-right: 1px solid ; "><em class="replaceable"><code>sequence_name</code></em></td><td style="text-align: left; ">
                                    <p>Наименование последовательности (генератора).</p>
                                </td></tr></tbody></table></div></div><p><br class="table-break"/>
            </p><p>Эти две команды идентичны. Генераторы — это старый термин Firebird для того, что
                обычно называют последовательностями в других базах данных, а также в SQL стандарте.
                Вам рекомендуется использовать последовательности, а не генераторы, но Firebird
                считает их одинаковыми.</p><p>Если имя последовательности ( генератора) не указано, то будут выведены сведения
                обо всех последовательностях (имя, текущее значение, начальное значение, значение
                шага приращения). Если указано имя последовательности (генератора), то будет
                выведены сведения о конкретном последовательности.</p><div class="example" id="d0e9611"><div class="example-title">Пример 5.51. Использование команды SHOW SEQUENCE</div><div class="example-contents"><p>
                    </p><pre class="programlisting">

SQL&gt; show sequences;
Generator CUST_NO_GEN, current value: 1015, initial value: 0, increment: 1
Generator EMP_NO_GEN, current value: 145, initial value: 0, increment: 1

SQL&gt; show sequence emp_no_gen;
Generator EMP_NO_GEN, current value: 145, initial value: 0, increment: 1
                        
                    </pre><p>
                </p></div></div><br class="example-break"/><p><span class="formalpara-title">Смотри также: </span><a class="link" href="#isql-commands_show-show_generator" title="SHOW GENERATOR">SHOW
                    GENERATOR</a>.</p></section><section class="section" id="isql-commands_show-show_sql_dialect"><div class="titlepage"><div><div><h3 class="title">SHOW SQL DIALECT</h3></div></div></div><a id="d0e9629" class="indexterm"/><p><span class="formalpara-title">Назначение: </span>Отображение SQL диалекта клиента и текущей базы данных.</p><p><span class="formalpara-title">Синтаксис: </span>
                    </p><pre class="programlisting"> 
SHOW SQL DIALECT                                              
                    </pre><p>
                </p><p>Команда SHOW SQL DIALECT отображает SQL диалект установленный в ISQL и диалект
                подключенной базы данных.</p><div class="example" id="d0e9649"><div class="example-title">Пример 5.52. Использование команды SHOW SQL DIALECT</div><div class="example-contents"><p>
                    </p><pre class="programlisting">

SQL&gt; show sql dialect;
        Client SQL dialect is set to: 3 and database SQL dialect is: 3
                        
                    </pre><p>
                </p></div></div><br class="example-break"/></section><section class="section" id="isql-commands_show-show_system"><div class="titlepage"><div><div><h3 class="title">SHOW SYSTEM</h3></div></div></div><a id="d0e9660" class="indexterm"/><p><span class="formalpara-title">Назначение: </span>Отображение списка системных объектов.</p><p><span class="formalpara-title">Синтаксис: </span>
                    </p><pre class="programlisting"> 
SHOW SYStem [{TABLEs | FUNCTIONs | COLLATIONs | COLLATEs}]                                              
                    </pre><p>
                </p><p>Команда SHOW SYSTEM выводит список внутренних, то есть системных объектов,
                созданных и используемых в текущей базе данных. По умолчанию отображаются системные
                таблицы, функции и сортировки. Необязательный параметр позволяет уточнить какой
                именно вид системных объектов необходимо отобразить.</p><div class="example" id="d0e9680"><div class="example-title">Пример 5.53. Использование команды SHOW SYSTEM</div><div class="example-contents"><p>
                    </p><pre class="programlisting">

SQL&gt; show system;

Tables:
       MON$ATTACHMENTS                        MON$CALL_STACK
       MON$CONTEXT_VARIABLES                  MON$DATABASE
...
       SEC$DB_CREATORS                        SEC$GLOBAL_AUTH_MAPPING
       SEC$USERS                              SEC$USER_ATTRIBUTES

Collations:
       ASCII                                  BIG_5
       BS_BA                                  CP943C
       CP943C_UNICODE                         CS_CZ
       CYRL                                   DA_DA
....
       WIN1257_EE                             WIN1257_LT
       WIN1257_LV                             WIN1258
       WIN_CZ                                 WIN_CZ_CI_AI
       WIN_PTBR
       
SQL&gt; show system tables;

       MON$ATTACHMENTS                        MON$CALL_STACK
       MON$CONTEXT_VARIABLES                  MON$DATABASE
...
       SEC$DB_CREATORS                        SEC$GLOBAL_AUTH_MAPPING
       SEC$USERS                              SEC$USER_ATTRIBUTES       
                        
                    </pre><p>
                </p></div></div><br class="example-break"/><div class="note"><h3 class="title">Примечание</h3><p>В Firebird 2.0-2.5 существовали системные функции RDB$GET_CONTEXT и
                    RDB$SET_CONTEXT, которые позже стали встроенными. В Firebird 2.5 команда SHOW
                    SYSTEM отобразит следующее: </p><pre class="programlisting">

SQL&gt; show system;

Tables:
       MON$ATTACHMENTS                        MON$CALL_STACK
       MON$CONTEXT_VARIABLES                  MON$DATABASE
...

Functions:
       RDB$GET_CONTEXT                        RDB$SET_CONTEXT

Collations:
       ASCII                                  BIG_5
       BS_BA                                  CP943C
....
       WIN_CZ                                 WIN_CZ_CI_AI
       WIN_PTBR
                        
                    </pre><p>
                </p></div><p>Если вы хотите отобразить детали определенного объекта, просто используйте
                соответствующую команду show. </p><pre class="programlisting">

SQL&gt; show table mon$io_stats;

MON$STAT_ID                     (RDB$STAT_ID) INTEGER Nullable
MON$STAT_GROUP                  (RDB$STAT_GROUP) SMALLINT Nullable
MON$PAGE_READS                  (RDB$COUNTER) BIGINT Nullable
MON$PAGE_WRITES                 (RDB$COUNTER) BIGINT Nullable
MON$PAGE_FETCHES                (RDB$COUNTER) BIGINT Nullable
MON$PAGE_MARKS                  (RDB$COUNTER) BIGINT Nullable

SQL&gt; show collation ascii;

ASCII, CHARACTER SET ASCII, PAD SPACE, SYSTEM
                        
                    </pre><p>
            </p></section><section class="section" id="isql-commands_show-show_table"><div class="titlepage"><div><div><h3 class="title">SHOW TABLE</h3></div></div></div><a id="d0e9702" class="indexterm"/><p><span class="formalpara-title">Назначение: </span>Отображение списка таблиц или информации о заданной таблице.</p><p><span class="formalpara-title">Синтаксис: </span>
                    </p><pre class="programlisting"> 
SHOW {TABLEs | TABLE <em class="replaceable"><code>&lt;table_name&gt;</code></em>}                                             
                    </pre><p>
                </p><p>
                </p><div class="table" id="d0e9725"><div class="table-title">Таблица 5.34. Параметры оператора SHOW TABLE</div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col style="text-align: left; " class="colArgument"/><col style="text-align: left; " class="colDesc"/></colgroup><thead><tr valign="middle"><th style="text-align: center; vertical-align: middle; border-right: 1px solid ; border-bottom: 1px solid ; ">Параметр</th><th style="text-align: center; vertical-align: middle; border-bottom: 1px solid ; ">Описание</th></tr></thead><tbody><tr><td style="text-align: left; border-right: 1px solid ; "><em class="replaceable"><code>table_name</code></em></td><td style="text-align: left; ">
                                    <p>Имя таблицы.</p>
                                </td></tr></tbody></table></div></div><p><br class="table-break"/>
            </p><p>В первом варианте команда SHOW TABLES отображает список таблиц, определённых в
                базе данных, в алфавитном порядке. Во втором варианте отображается список столбцов и
                их типы или домены для указанной в качестве параметра таблицы.</p><div class="example" id="d0e9751"><div class="example-title">Пример 5.54. Использование команды SHOW TABLE</div><div class="example-contents"><p>
                    </p><pre class="programlisting">

SQL&gt; show tables;

       COUNTRY                                CUSTOMER
       DEPARTMENT                             EMPLOYEE
       EMPLOYEE_PROJECT                       JOB
       PROJECT                                PROJ_DEPT_BUDGET
       SALARY_HISTORY                         SALES

SQL&gt; show table country;

COUNTRY                         (COUNTRYNAME) VARCHAR(15) Not Null
CURRENCY                        VARCHAR(10) Not Null
CONSTRAINT INTEG_2:
  Primary key (COUNTRY)   
                        
                    </pre><p>
                </p></div></div><br class="example-break"/><p>Если для таблицы определены комментарии, эта команда не будет их отображать. Вы
                можете использовать команду SHOW COMMENTS, но помните, что тогда вам будут
                отображены все комментарии в базе данных. По-видимому, не существует метода
                извлечения комментариев для одного объекта, если только вы не запросите системные
                таблицы напрямую. </p><pre class="programlisting">

SQL&gt; comment on table country is 'This table holds details about countries.';
SQL&gt; commit;

SQL&gt; show comments;
...
COMMENT ON TABLE        COUNTRY IS This table holds details about countries.;
...

SQL&gt; show table country;

COUNTRY                         (COUNTRYNAME) VARCHAR(15) Not Null
CURRENCY                        VARCHAR(10) Not Null
CONSTRAINT INTEG_2:
  Primary key (COUNTRY)
  
SQL&gt; select rdb$description
CON&gt; from rdb$relations
CON&gt; where rdb$relation_name = 'COUNTRY';

  RDB$DESCRIPTION
=================
            6:1ec
==============================================================================
RDB$DESCRIPTION:
This table holds details about countries.
============================================================================== 
                        
                    </pre><p>
            </p><p>Вывод последнего запроса выше не идеален, но, по крайней мере, он отображает
                гораздо меньше информации, когда в вашей базе данных много комментариев.</p></section><section class="section" id="isql-commands_show-show_trigger"><div class="titlepage"><div><div><h3 class="title">SHOW TRIGGER</h3></div></div></div><a id="d0e9769" class="indexterm"/><p><span class="formalpara-title">Назначение: </span>Отображение списка триггеров или подробной информации об указанном
                    триггере.</p><p><span class="formalpara-title">Синтаксис: </span>
                    </p><pre class="programlisting"> 
SHOW {TRIGgers | TRIGger <em class="replaceable"><code>&lt;trig_name&gt;</code></em>}                                             
                    </pre><p>
                </p><p>
                </p><div class="table" id="d0e9792"><div class="table-title">Таблица 5.35. Параметры оператора SHOW TRIGGER</div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col style="text-align: left; " class="colArgument"/><col style="text-align: left; " class="colDesc"/></colgroup><thead><tr valign="middle"><th style="text-align: center; vertical-align: middle; border-right: 1px solid ; border-bottom: 1px solid ; ">Параметр</th><th style="text-align: center; vertical-align: middle; border-bottom: 1px solid ; ">Описание</th></tr></thead><tbody><tr><td style="text-align: left; border-right: 1px solid ; "><em class="replaceable"><code>trig_name</code></em></td><td style="text-align: left; ">
                                    <p>Имя триггера.</p>
                                </td></tr></tbody></table></div></div><p><br class="table-break"/>
            </p><p>Команда SHOW TRIGGER отображает список всех триггеров определённых в текущей базе
                данных. Для табличных триггеров будет выведено имя таблицы для которого был создан
                триггер.</p><div class="example" id="d0e9818"><div class="example-title">Пример 5.55. Использование команды SHOW TRIGGERS</div><div class="example-contents"><p>
                    </p><pre class="programlisting">

SQL&gt; show triggers;
Trigger name                     Invalid
================================ =======
TR_BEFORE_DISCONNECT

Table name                       Trigger name                     Invalid
================================ ================================ =======
AGE                              AGE_BD
AGE                              AGE_BI
AGE                              AGE_BU
AIMTYPE                          TR_AIMTYPE_BI
ALGORITHM                        TR_ALGORITHM_BI
......
                        
                    </pre><p>
                </p></div></div><br class="example-break"/><p>Если указано имя триггера, то будет отображена подробная информация о триггере
                (имя триггера, порядок срабатывания, событие, активен ли триггер), а также его
                исходный код.</p><div class="example" id="d0e9828"><div class="example-title">Пример 5.56. Использование команды SHOW TRIGGER</div><div class="example-contents"><p>
                    </p><pre class="programlisting">

SQL&gt; show trigger set_cust_no;

Triggers on Table CUSTOMER:
SET_CUST_NO, Sequence: 0, Type: BEFORE INSERT, Active
Trigger text:
=============================================================================
AS
BEGIN
    if (new.cust_no is null) then
    new.cust_no = gen_id(cust_no_gen, 1);
END
=============================================================================
                        
                    </pre><p>
                </p></div></div><br class="example-break"/><p><span class="formalpara-title">Смотри также: </span><a class="link" href="#isql-commands_show-show_function" title="SHOW FUNCTION">SHOW FUNCTION</a>, <a class="link" href="#isql-commands_show-show_procedure" title="SHOW PROCEDURE">SHOW PROCEDURE</a>, <a class="link" href="#isql-commands_show-show_package" title="SHOW PACKAGE">SHOW PACKAGE</a>.</p></section><section class="section" id="isql-commands_show-show_users"><div class="titlepage"><div><div><h3 class="title">SHOW USERS</h3></div></div></div><a id="d0e9852" class="indexterm"/><p><span class="formalpara-title">Назначение: </span>Отображение списка пользователей в текущей БД безопасности.</p><p><span class="formalpara-title">Синтаксис: </span>
                    </p><pre class="programlisting"> 
SHOW USERs                                           
                    </pre><p>
                </p><p>Команда SHOW USERS отображает список пользователей определённых в текущей базе
                данных безопасности. Если пользователь не является администратором в базе данных
                безопасности, то будет отображены только сведения о нём самом. Перед каждым именем
                пользователя указано число, которое отображает количество соединений выполненное
                этим пользователем. Если перед именем пользователя напечатана решётка
                    <span class="quote">«<span class="quote">#</span>»</span>, то это текущий пользователь.</p><div class="example" id="d0e9875"><div class="example-title">Пример 5.57. Использование команды SHOW USERS</div><div class="example-contents"><p>
                    </p><pre class="programlisting">

SQL&gt; show users;
Users in the database
  1 #SYSDBA                              2  U1
  0  U3
                        
                    </pre><p>
                </p><p>В данном случае есть одно соединение пользователем SYSDBA — это текущий
                    пользователь, и два соединения пользователем U1.</p></div></div><br class="example-break"/></section><section class="section" id="isql-commands_show-show_version"><div class="titlepage"><div><div><h3 class="title">SHOW VERSION</h3></div></div></div><a id="d0e9888" class="indexterm"/><p><span class="formalpara-title">Назначение: </span>Отображение информации о версии ISQL, сервера и ODS базы данных.</p><p><span class="formalpara-title">Синтаксис: </span>
                    </p><pre class="programlisting"> 
SHOW VERsion                                         
                    </pre><p>
                </p><p>Команда SHOW VERSION отображает информацию о версии ISQL, версии сервера Firebird,
                сетевом протоколе, ODS текущей базы данных.</p><div class="example" id="d0e9908"><div class="example-title">Пример 5.58. Использование команды SHOW VERSION</div><div class="example-contents"><p>
                    </p><pre class="programlisting">

SQL&gt; show version;

ISQL Version: WI-V3.0.5.33168 Firebird 3.0
Server version:
Firebird/Windows/AMD/Intel/x64 (access method), 
version "WI-V3.0.5.33168 Firebird 3.0"
Firebird/Windows/AMD/Intel/x64 (remote server), 
version "WI-V3.0.5.33168 Firebird 3.0/tcp (DESKTOP-E3INAFT)/P15:C"
Firebird/Windows/AMD/Intel/x64 (remote interface), 
version "WI-V3.0.5.33168 Firebird 3.0/tcp (DESKTOP-E3INAFT)/P15:C"
on disk structure version 12.0
                        
                    </pre><p>
                </p></div></div><br class="example-break"/><div class="note"><h3 class="title">Примечание</h3><p>Обратите внимание, что некоторые строки в приведенном выше разделены, чтобы
                    они могли поместиться на странице.</p></div></section><section class="section" id="isql-commands_show-show_view"><div class="titlepage"><div><div><h3 class="title">SHOW VIEW</h3></div></div></div><a id="d0e9922" class="indexterm"/><p><span class="formalpara-title">Назначение: </span>Отображение списка представлений или информации об указанном
                    представлении.</p><p><span class="formalpara-title">Синтаксис: </span>
                    </p><pre class="programlisting"> 
SHOW {VIEWs | VIEW <em class="replaceable"><code>&lt;view_name&gt;</code></em>}                                        
                    </pre><p>
                </p><p>
                </p><div class="table" id="d0e9945"><div class="table-title">Таблица 5.36. Параметры оператора SHOW VIEW</div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col style="text-align: left; " class="colArgument"/><col style="text-align: left; " class="colDesc"/></colgroup><thead><tr valign="middle"><th style="text-align: center; vertical-align: middle; border-right: 1px solid ; border-bottom: 1px solid ; ">Параметр</th><th style="text-align: center; vertical-align: middle; border-bottom: 1px solid ; ">Описание</th></tr></thead><tbody><tr><td style="text-align: left; border-right: 1px solid ; "><em class="replaceable"><code>view_name</code></em></td><td style="text-align: left; ">
                                    <p>Имя представления.</p>
                                </td></tr></tbody></table></div></div><p><br class="table-break"/>
            </p><p>Команда SHOW VIEW отображает список представлений определённых в текущей базе
                данных. Если в качестве аргумента указано имя представления, то будет отображён
                список его столбцов с типами или доменами, и исходный код представления.</p><div class="example" id="d0e9971"><div class="example-title">Пример 5.59. Использование команды SHOW VIEW</div><div class="example-contents"><p>
                    </p><pre class="programlisting">

SQL&gt; show views;

       PHONE_LIST
       
SQL&gt; show view phone_list;

EMP_NO                          (EMPNO) SMALLINT Not Null
FIRST_NAME                      (FIRSTNAME) VARCHAR(15) Not Null
LAST_NAME                       (LASTNAME) VARCHAR(20) Not Null
PHONE_EXT                       VARCHAR(4) Nullable
LOCATION                        VARCHAR(15) Nullable
PHONE_NO                        (PHONENUMBER) VARCHAR(20) Nullable
View Source:
==== ======
SELECT
    emp_no, first_name, last_name, phone_ext, location, phone_no
    FROM employee, department
    WHERE employee.dept_no = department.dept_no
                        
                    </pre><p>
                </p></div></div><br class="example-break"/></section></section></section><section xml:lang="ru" class="chapter" id="gbak"><div class="titlepage"><div><div><h2 class="title">Глава 6. GBAK</h2></div></div></div><p/></section><section xml:lang="ru" class="chapter" id="nbackup"><div class="titlepage"><div><div><h2 class="title">Глава 7. Утилита NBACKUP</h2></div></div></div><a id="d0e9988" class="indexterm"/><p><span class="application">Nbackup</span> — утилита резервного копирования, включенная в Firebird
        начиная с версии 2.0. Она предоставляет возможности, отсутствующие у
            <span class="application">gbak</span> (штатной утилиты резервного копирования Firebird), но не
        заменяет <span class="application">gbak</span>. Обе утилиты имеют свои достоинства и недостатки, и
        их вполне можно использовать совместно.</p><section class="section" id="nbackup-common"><div class="titlepage"><div><div><h2 class="title" style="clear: both">Обзор возможностей Nbackup</h2></div></div></div><p>backup позволяет выполнять два типа задач: </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Делать полные и инкрементные копии. Инкрементные копии содержат только
                        изменения относительно предыдущей резервной копии.</p></li><li class="listitem"><p>Блокировать базу данных для ее онлайн-копирования средствами операционной
                        системы или другими утилитами. В этом режиме
                            <span class="application">nbackup</span> ничего не сохраняет и не копирует. Он
                        просто создает условия, при которых копирование файла базы данных является
                        безопасным. </p></li></ol></div><p>Обе этих задачи могут выполняться над активной базой данных, без необходимости
            отключения пользователей. Результирующий бэкап (или копия файла базы данных) будет
            содержать базу данных на момент начала копирования. Только SYSDBA и владелец базы данных
            (или администраторы операционной системы) могут делать бэкап, но при этом любой
            пользователь может восстановить базу данных из такого бэкапа. В этом плане
                <span class="application">nbackup</span> не отличается от
            <span class="application">gbak</span>.</p></section><section class="section" id="nbackup-advantage"><div class="titlepage"><div><div><h2 class="title" style="clear: both">Преимущества nbackup</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><span class="emphasis"><em>В обоих режимах</em></span>: высокая скорость (насколько позволяет
                    оборудование и операционная система), поскольку nbackup оперирует страницами БД,
                    а не записями, и не проверяет данные на страницах.</p></li><li class="listitem"><p>
                    <span class="emphasis"><em>В режиме копирования/восстановления</em></span>: экономия времени и
                    дискового пространства, поскольку нет необходимости делать полную копию каждый
                    раз. Это позволяет сильно упростить задачу резервного копирования
                    много-гигабайтных баз данных. </p></li><li class="listitem"><p>
                    <span class="emphasis"><em>В режиме блокировки</em></span>: полная свобода выбора способа
                    копирования файла БД. </p></li></ul></div><section class="section" id="nbackup-limitations"><div class="titlepage"><div><div><h3 class="title">Недостатки nbackup</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Nbackup не будет чистить мусор, освобождать место в базе данных, сжимать
                        бэкап, и так далее </p></li><li class="listitem"><p>Вы не можете поменять владельца БД через резервное копирование и
                        восстановление,как это может gbak </p></li><li class="listitem"><p>Nbackup не делает <span class="quote">«<span class="quote">transportable backup</span>»</span>, то есть, полученная
                        копия базы данных может быть несовместима с Firebird на другом аппаратном
                        обеспечении (kdv: имеются в виду платформы с разным порядком байт в integer
                        — big-endian и little-endian. К разным ОС на одной платформе это не имеет
                        никакого отношения) </p></li><li class="listitem"><p>В настоящий момент nbackup не работает с много-файловыми базами данных
                        (которые являются атавизмом и практически не используются) </p></li><li class="listitem"><p>Nbackup может оперировать только с локальными файлами баз данных. Nbackup
                        можно запускать удаленно, но сами базы и их копии все равно должны быть
                        локальными по отношению к серверу Firebird </p></li></ul></div></section></section><section class="section" id="nbackup-params"><div class="titlepage"><div><div><h2 class="title" style="clear: both">Функции и параметры</h2></div></div></div><p>В таблице перечислены параметры nbackup с общим описанием их назначения. </p><div class="table" id="d0e10072"><div class="table-title">Таблица 7.1. Описание параметров nbackup</div><div class="table-contents"><table style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; "><colgroup><col class="c1"/><col class="c2"/></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">Опция</th><th style="border-bottom: 1px solid ; ">Описание</th></tr></thead><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="code">-B <em class="replaceable"><code>n</code></em>
                                <em class="replaceable"><code>&lt;database&gt;</code></em>
                                    [<em class="replaceable"><code>&lt;filename&gt;</code></em>]</code></td><td style="border-bottom: 1px solid ; "><p>Сделать бэкап уровня n в указанный файл.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="code">-R <em class="replaceable"><code>&lt;database&gt;</code></em>
                                    [<em class="replaceable"><code>&lt;filename&gt;</code></em> ...]</code></td><td style="border-bottom: 1px solid ; "><p>Восстановить базу данных из указанных файлов.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="code">-L <em class="replaceable"><code>&lt;database&gt;</code></em></code></td><td style="border-bottom: 1px solid ; "><p>Заблокировать базу данных.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="code">-N <em class="replaceable"><code>&lt;database&gt;</code></em></code></td><td style="border-bottom: 1px solid ; "><p>Разблокировать восстановленную базу данных.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="code">-F <em class="replaceable"><code>&lt;database&gt;</code></em></code></td><td style="border-bottom: 1px solid ; "><p>Разблокировать заблокированную базу данных.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="code">-S</code></td><td style="border-bottom: 1px solid ; "><p>Показать размер базы данных в страницах после блокирования
                                (совместно с –L).</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="code">-T</code></td><td style="border-bottom: 1px solid ; "><p>Игнорировать триггеры уровня базы данных (совместно с –B, -L,
                                -N).</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="code">-D on|off</code></td><td style="border-bottom: 1px solid ; "><p>Прямой ввод-вывод включить (on) или выключить (off) (совместно
                                с -B).</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="code">-U <em class="replaceable"><code>&lt;username&gt;</code></em></code></td><td style="border-bottom: 1px solid ; "><p>Имя пользователя (совместно с -B, -L, -N).</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="code">-P <em class="replaceable"><code>&lt;password&gt;</code></em></code></td><td style="border-bottom: 1px solid ; "><p>Пароль пользователя (совместно с -B, -L, -N).</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="code">-FE <em class="replaceable"><code>&lt;filename&gt;</code></em></code></td><td style="border-bottom: 1px solid ; "><p>Взять пароль из файла (совместно с –B, -L, -N).</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="code">-DE <em class="replaceable"><code>&lt;command&gt;</code></em></code></td><td style="border-bottom: 1px solid ; "><p>Распаковка сжатых бекапов перед их восстановлением. В качестве
                                аргумента принимает командную строку, которая должна распаковать
                                архив и передать в stdout распакованный файл бэкапа.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="code">-Z</code></td><td style="border-bottom: 1px solid ; "><p>Вывести версию (отдельно или совместно с -B, - R, -L, -N,
                                -F).</p></td></tr><tr><td style="border-right: 1px solid ; "><code class="code">-?</code></td><td><p>Вывод справки по всем параметрам.</p></td></tr></tbody></table></div></div><br class="table-break"/><p>В зависимости от выбранной основной функции (-B, -L, -N, -R или -F) nbackup может
            требовать определенный уровень доступа к базе данных: соединение с сервером Firebird,
            прямой доступ к файлам, или и то и другое. Следующая таблица показывает детали:
                </p><div class="informaltable"><table style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; "><colgroup><col class="c1"/><col class="c2"/><col class="c3"/></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">Параметр</th><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">Назначение</th><th style="border-bottom: 1px solid ; ">Доступ</th></tr></thead><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="code">-B</code></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">Резервная копия</td><td style="border-bottom: 1px solid ; ">Сервер и файл</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="code">-R</code></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">Восстановление</td><td style="border-bottom: 1px solid ; ">Файл</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="code">-L</code></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">Блокирование</td><td style="border-bottom: 1px solid ; ">Сервер</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="code">-N</code></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">Разблокирование</td><td style="border-bottom: 1px solid ; ">Сервер</td></tr><tr><td style="border-right: 1px solid ; "><code class="code">-F</code></td><td style="border-right: 1px solid ; ">Разблокирование после восстановления</td><td>Файл</td></tr></tbody></table></div><p>
        </p><div class="note"><h3 class="title">Примечание</h3><p>Регистр параметров не имеет значения, может быть указано –B или –b, и так далее.
                Параметры приведены в верхнем регистре как минимум потому, что один из параметров –
                L в нижнем регистре –l выглядит как -1 в большинстве шрифтов.</p></div><p>Когда требуется доступ к серверу (с параметрами –B, -L и –N), пользователь должен
            указать имя пользователя и пароль (параметрами –U и –P|-FE, или через переменные
            пользователя <code class="envar">ISC_USER</code> и <code class="envar">ISC_PASSWORD</code>), или быть root на
            Unix или доверенным пользователем на Windows.</p><p>Когда требуется доступ к файловой системе (с –B, -R и –F), пользователь должен иметь
            достаточные привилегии к файлу базы данных для чтения и записи.</p><p>Когда требуется исключительный доступ к файлу (с –R и –F), пользователю не нужен логин
            к Firebird, и сервер Firebird может быть не запущен или отсутствовать.</p><div class="note"><h3 class="title">Примечание</h3><p>В приведенных таблицах и тексте имеется в виду доступ к базе данных. Доступ к
                файлам бэкапов — всегда на уровне файловой системы.</p></div></section><section class="section" id="nbackup-backup_and_restore"><div class="titlepage"><div><div><h2 class="title" style="clear: both">Создание резервных копий и восстановление</h2></div></div></div><p>Утилита <span class="application">nbackup</span> находится там же, где и другие утилиты
            Firebird (<span class="application">gbak</span>, <span class="application">gstat</span> ...), то
            есть в корневом каталоге установки.</p><p>Как и другие утилиты Firebird, <span class="application">nbackup</span> не имеет
            графического интерфейса. Вы запускаете его из командной строки, или из командного файла,
            или из приложения.</p><section class="section" id="nbackup-full-backup"><div class="titlepage"><div><div><h3 class="title">Полные резервные копии</h3></div></div></div><p>Чтобы сделать полный бэкап базы данных, выполните команду
                </p><pre class="synopsis">
nbackup –B 0 <em class="replaceable"><code>&lt;database&gt;</code></em> [<em class="replaceable"><code>&lt;filename&gt;</code></em>] -U <em class="replaceable"><code>&lt;user&gt;</code></em> - P <em class="replaceable"><code>&lt;password&gt;</code></em>                
            </pre><p>
            </p><p> Например
                </p><pre class="synopsis">
C:\Data&gt;nbackup –B 0 inventory.fdb inventory_2019-Aug-01.nbk
                </pre><p>
            </p><p>
                </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Параметр –B означает «бэкап». Уровень бэкапа 0 производит полный
                            бэкап, т.е. полную копию базы данных. Уровни бэкапа выше 0 используются
                            для инкрементных бэкапов, которые описаны дальше. </p></li><li class="listitem"><p>Вместо имени базы данных можно указать ее алиас </p></li><li class="listitem"><p>Вместо имени файла бэкапа можно указать stdout. В этом случае вывод
                            можно перенаправить, например, в архиватор. </p></li><li class="listitem"><p>Параметры –U и –P можно не указывать при следующих условиях:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>Установлены корректные значения в переменных среды
                                        ISC_USER и ISC_PASSWORD, это SYSDBA или владелец БД и
                                        пароль. </p></li><li class="listitem"><p>Вы вошли на Linux как root, это эквивалентно SYSDBA.
                                    </p></li><li class="listitem"><p>На Windows: В <code class="filename">firebird.conf</code>
                                            (<code class="filename">databases.conf</code>) включена
                                        доверенная аутентификация (trusted authentification), и вы
                                        вошли в Windows с правами администратора, которому доступен
                                        файл базы данных. Для получения прав SYSDBA должен быть
                                        установлен AUTO ADMIN MAPPING.</p></li></ul></div><p>
                        </p></li></ul></div><p>
            </p><div class="note"><h3 class="title">Примечание</h3><p>Для упрощения, в дальнейшем параметры –U и –P не указываются в
                    примерах.</p></div><p>
                </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Начиная с Firebird 2.5 вместо <code class="code">–P &lt;password&gt;</code> можно
                            указывать <code class="code">–FE &lt;filename&gt;</code>. В этом случае
                                <code class="filename">nbackup</code> прочитает пароль из указанного файла. В
                            случае –FE пароль не указывается в командной строек, и это позволяет
                            исключить доступ к паролю людей, которые могут посмотреть историю команд
                            в командной строке (например, командой w на Unix или в скрипте).</p></li><li class="listitem"><p>Параметр –T отключает триггеры базы данных. Подробнее см. раздел
                                    <span class="quote">«<span class="quote"><a class="link" href="#nbackup-nodbtriggers" title="Отключение триггеров базы данных">Отключение
                                    триггеров БД</a></span>»</span>.</p></li><li class="listitem"><p>В Firebird 2.1.4 и выше возможно отключить кэширование БД файловой
                            системой (включить прямой ввод-вывод) параметром <code class="code">–D on</code> (или
                            выключить прямой ввод-вывод <code class="code">–D off</code>). Подробности см. далее
                            в <a class="link" href="#nbackup-direct_io" title="Кэширование ввода-вывода (Direct I/O)">соответствующем
                            разделе</a>.</p></li><li class="listitem"><p>Разные параметры (<code class="code">-B</code>, <code class="code">-U</code> и др.) могут быть
                            указаны в любом порядке. Разумеется, за каждым параметром должен
                            следовать его аргумент. В случае –B это три аргумента — уровень бэкапа,
                            имя базы данных, и имя файла бэкапа — именно в таком порядке.</p></li><li class="listitem"><p>Если параметр <code class="code">–B</code> указан последним, вы можете не указывать
                            имя файла бэкапа. В этом случае <span class="application">nbackup</span> сам
                            сгенерирует имя вида
                                <code class="filename">database.fdb-0-20190807-2105.nbk</code>, где 0 это
                            уровень, 20190807 – дата, 2105 — время. Но это может привести к ошибке,
                            если бэкап одного и того же уровня делается два раза в одну и ту же
                            минуту.</p></li></ul></div><p>
            </p><div class="important"><h3 class="title">Важно</h3><p>Не используйте <span class="application">nbackup</span> на много-файловых базах
                    данных. Это может привести к потере данных (неполный и поврежденный бэкап), при
                    том что <span class="application">nbackup</span> не выдаст сообщение об ошибке.</p></div><section class="simplesect" id="d0e10432"><div class="titlepage"><div><div><h4 class="title">Немного о том, как это устроено</h4></div></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Сначала база данных блокируется (выставляется внутренний флаг
                            состояния). С этого момента любые изменения базы данных записываются во
                            временный файл — так называемый <span class="quote">«<span class="quote">дельта-файл</span>»</span>.</p></li><li class="listitem"><p>Производится бэкап. Это эквивалент копирования файла, однако для
                            приведения копии в рабочее состояние над ней нужно выполнить
                                <code class="code">nbackup –F</code>. </p></li><li class="listitem"><p>По завершении бэкапа, содержимое дельта-файла записывается в базу
                            данных. База данных разблокируется, и дельта-файл удаляется. </p></li></ol></div><p>Шаги 1 и 3 обеспечиваются новыми командами SQL — <code class="code">ALTER DATABASE BEGIN
                        BACKUP</code> и <code class="code">ALTER DATABASE END BACKUP</code>. Эти команды не
                    выполняют сам бэкап (копирование), они только создают условия, при которых база
                    данных может быть успешно скопирована. Выполнять эти операторы самостоятельно
                    нет необходимости (так как из SQL вы не имеете доступа к файлам),
                        <span class="application">nbackup</span> сделает всё за вас.</p></section></section><section class="section" id="nbackup-full-restore"><div class="titlepage"><div><div><h3 class="title">Восстановление полных резервных копий</h3></div></div></div><p>Полная резервная копия восстанавливается следующей командой
                </p><pre class="synopsis">
nbackup –R <em class="replaceable"><code>&lt;database&gt;</code></em> [<em class="replaceable"><code>&lt;filename&gt;</code></em>]                
            </pre><p>
            </p><p>Например
                </p><pre class="synopsis">
C:\Data&gt;nbackup –R inventory.fdb inventory_2019_08_07.nbk
                </pre><p>
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> Не нужно указывать <span class="quote">«<span class="quote">уровень</span>»</span> восстановления. </p></li><li class="listitem"><p> При восстановлении параметр <code class="code">–R</code> должен быть указан последним.
                        Причина этого будет объяснена далее. </p></li><li class="listitem"><p> Вместо имени базы данных можно указать алиас. </p></li><li class="listitem"><p> Если указано имя существующей базы данных, то будет выдана ошибка.
                    </p></li><li class="listitem"><p> Здесь также можно не указывать имя бэкапа. В этом случае
                            <span class="application">nbackup</span> запросит имя файла. </p></li><li class="listitem"><p> Восстановление полностью работает на уровне файловой системы, и может
                        быть выполнено без работающего Firebird. Любые значения, указанные для
                        параметров <code class="code">–U</code> и <code class="code">–P</code> игнорируются. То же самое в
                        отношении опции <code class="code">–FE</code>, однако <span class="application">nbackup</span>
                        все равно будет пытаться прочитать пароль из файла, и если произошла ошибка,
                        вся операция будет отменена. </p></li></ul></div></section><section class="section" id="nbackup-increment-backup"><div class="titlepage"><div><div><h3 class="title">Инкрементные резервные копии</h3></div></div></div><p>Чтобы сделать инкрементный (разностный) бэкап нужно указать уровень бэкапа больше
                0. Инкрементный бэкап уровня 1 и выше всегда содержит только те изменения базы
                данных, которые произошли с момента предыдущего бэкапа уровня N-1.</p><p>Рассмотрим пример использование инкрементной копии.</p><p>Через день после полного бэкапа (уровня 0) вы делаете один уровня 1:
                </p><pre class="synopsis">
C:\Data&gt;nbackup –B 1 inventory.fdb inventory_20190808_1.nbk                
            </pre><p>
            </p><div class="important"><h3 class="title">Важно</h3><p>Рекомендуется в имени инкрементных бэкапов указывать уровень такого бэкапа,
                    чтобы не запутаться. Также, для сортировки имен бэкапов удобно использовать
                    формат даты yyyymmdd.</p></div><p>Этот бэкап будет содержать только те изменения, которые произошли в БД за
                последний день. Еще через день, выполняете еще один бэкап уровня 1
                </p><pre class="synopsis">
C:\Data&gt;nbackup –B 1 inventory.fdb inventory_20190809_1.nbk              
            </pre><p>
            </p><p>Этот инкремент будет содержать изменения за 2 последних дня, с момента полного
                бэкапа (уровня 0), а не только изменения, которые произошли с момента предыдущего
                бэкапа уровня 1.</p><p>Через несколько часов сделаем бэкап уровня 2:
                </p><pre class="synopsis">
C:\Data&gt;nbackup –B 1 inventory.fdb inventory_20190809_2.nbk              
            </pre><p>
            </p><p>Этот свежий инкремент содержит изменения, начиная с самого последнего (свежего)
                бэкапа уровня 1.</p><div class="note"><h3 class="title">Примечание</h3><p>Все комментарии по поводу полного бэкапа относятся и к инкрементным
                    бэкапам.</p></div></section><section class="section" id="nbackup-increment-restore"><div class="titlepage"><div><div><h3 class="title">Восстановление инкрементных бэкапов</h3></div></div></div><p>При восстановлении базы данных из инкрементных бэкапов необходимо указать полную
                цепочку файлов, начиная от уровня 0 до требуемого уровня. База данных будет
                построена заново, шаг за шагом.</p><p><span class="formalpara-title">Синтаксис: </span>
                    </p><pre class="programlisting"> 
nbackup –R <em class="replaceable"><code>&lt;database&gt;</code></em> [<em class="replaceable"><code>&lt;backup_0&gt;</code></em> <em class="replaceable"><code>&lt;backup_1&gt;</code></em> […]]              
                    </pre><p>
                </p><p>Таким образом, восстановление из бэкапа уровня 2 по предыдущим примерам будет
                таким:
                </p><pre class="synopsis">
C:\Data\nbackup –R inventory.fdb inventory_2019_08_07.nbk
inventory_20190808_1.nbk inventory_20190809_2.nbk                
            </pre><p>
                Разумеется, строка здесь <span class="quote">«<span class="quote">разделена</span>»</span> на две части только из-за
                форматирования. На самом деле это одна строка, которая завершается Enter в конце. </p><p>Комментарии (в дополнение к <a class="link" href="#nbackup-full-restore" title="Восстановление полных резервных копий">восстановлению полного бэкапа</a>): </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Поскольку заранее неизвестно, сколько имен файлов вы укажете после
                            параметра –R, nbackup считает все аргументы после –R именами файлов.
                            Поэтому никакие другие параметры не должны следовать за –R. </p></li><li class="listitem"><p>Нет лимита для номеров инкрементных бэкапов, но на практике редко
                            имеет смысл заходить дальше уровней 3 или 4. </p></li></ul></div><p>Что произойдет, если вы пропустите нужный файл в аргументах <code class="code">–R</code>, или
                укажете некорректную цепочку файлов? В соответствии с примерами, допустим, укажете
                бэкап 0, затем первый бэкап уровня 1, и затем бэкап уровня 2, который построен на
                втором бэкапе уровня 1? Бэкапов уровня 1 две штуки, поэтому, казалось бы, есть
                нормальная последовательность <span class="quote">«<span class="quote">0, 1, 2</span>»</span> файлов для восстановления
                БД.</p><p>К счастью, такая ошибка никогда не приведет к восстановлению некорректной БД.
                Каждый бэкап (любого уровня) имеет свой собственный идентификатор. И, например,
                каждый бэкап уровня 1 (и выше) содержит идентификатор бэкапа уровня 0, на котором он
                базируется. При восстановлении <span class="application">nbackup</span> проверяет эти
                идентификаторы. Если в цепочке <span class="quote">«<span class="quote">родительский</span>»</span> идентификатор <span class="quote">«<span class="quote">не
                    тот</span>»</span>, то операция отменяется и вы увидите сообщение об ошибке.</p></section><section class="section" id="nbackup-backup-raw_devices"><div class="titlepage"><div><div><h3 class="title">Бэкапы баз данных на сырых устройствах (raw devices)</h3></div></div></div><p>Базы Firebird не обязательно должны быть файлами, они могут располагаться на так
                называемых сырых (raw) устройствах, не имеющих файловой системы. Здесь может
                возникнуть вопрос, где будет в этом случае располагаться дельта-файл. Например, на
                Posix-системах, если база данных находится в <code class="filename">/dev/hdb5</code>, то
                дельта при старте <span class="application">nbackup</span> может получить имя
                    <code class="filename">/dev/hdb5.delta</code>. Понятно, что такая ситуация
                нежелательна.</p><p>Начиная с Firebird 2.1 <span class="application">nbackup</span> отказывается работать с
                базой на сырых устройствах до тех пор, пока расположение дельта-файла не задано
                явно. Эта тема обсуждается в разделе <span class="quote">«<span class="quote"><a class="link" href="#nbackup-tune_delta" title="Настройка дельта-файла">Настройка дельта-файла</a></span>»</span>.</p></section><section class="section" id="nbackup-nodbtriggers"><div class="titlepage"><div><div><h3 class="title">Отключение триггеров базы данных</h3></div></div></div><p>В Firebird 2.1 появились триггеры уровня базы данных. Некоторые типы этих
                триггеров могут срабатывать при подключении к базе данных и отключении от нее. При
                бэкапе <span class="application">nbackup</span> подключается к базе данных обычным
                способом (в некоторых версиях больше чем одним коннектом). Для предотвращения
                срабатывания триггеров уровня базы данных введен новый параметр <code class="code">–T</code>.
                Помните, что аналогичный параметр у <span class="application">gbak</span> и
                    <span class="application">isql</span> называется <code class="code">–nodbtriggers</code>.</p></section><section class="section" id="nbackup-direct_io"><div class="titlepage"><div><div><h3 class="title">Кэширование ввода-вывода (Direct I/O)</h3></div></div></div><p>Первоначально, nbackup использовал прямой ввод-вывод только под Windows NT (и
                последующих 2000, 2003 и так далее). На других операционных системах прямой
                ввод-вывод был выключен. Это приводило к проблемам на некоторых Linux, поэтому в
                версиях 2.0.6 и 2.1.3 прямой ввод-вывод также был включен по умолчанию на Linux.
                Однако, это создало определенные проблемы на некоторых конфигурациях Linux. В 2.1.4
                и 2.5 оригинальное поведение было восстановлено, но в этот раз включить или
                выключить прямой ввод-вывод можно параметром <code class="code">–D</code>:
                </p><pre class="synopsis">
nbackup –B 0 cups.fdb cups.nbk –D on -- прямой ввод-вывод включен
nbackup –B 0 mugs.fdb mugs.nbk –D off –- прямой ввод-вывод выключен               
            </pre><p>
            </p><p>Также как и параметр, аргументы on и off являются нечувствительными к
                регистру.</p><p>Прямой ввод-вывод относится только к бэкапу, не к восстановлению. На Windows
                    <code class="code">–D on</code> реализуется использованием FILE_FLAG_NO_BUFFERING. На других
                системах это O_DIRECT и POSIX_FADV_NOREUSE.</p><p>Последние два на некоторых системах могут не работать. В этом случае они (или один
                из них) молча не используется. Даже если пользователь указал <code class="code">–D on</code>
                явно, это не выдаст на таких системах предупреждения или сообщения об ошибке.</p><div class="note"><h3 class="title">Примечание</h3><p>Рекомендуем всегда явно указывать эту опцию (<code class="code">-D on</code> или <code class="code">–D
                        off</code>).</p></div><div class="tip"><h3 class="title">Подсказка</h3><p><span class="quote">«<span class="quote">Прямой ввод-вывод</span>»</span> или Direct IO это ОТКЛЮЧЕНИЕ кэша файловой
                    системы. То есть, <code class="code">-D on</code> отключает кэш файловой системы, а <code class="code">–D
                        off</code> — включает.</p><p>Тут нужно заметить, что по умолчанию, если в
                        <code class="filename">firebird.conf</code> значение параметра
                        <em class="parameter"><code>DBDefaultCachePages</code></em> меньше
                        <em class="parameter"><code>FileSystemCacheThreshold</code></em>, то файловый кэш для БД
                    включен (на любой ОС), и это сильно помогает производительности в архитектурах
                    Classic и SuperClassic. Однако, если на таких системах выполнить бэкап
                        <span class="application">nbackup</span> с опцией <code class="code">–D on</code>, это
                    немедленно ВЫКЛЮЧИТ файловый кэш для базы данных, и производительность может
                    резко упасть. Восстановится она только после окончания бэкапа, пока
                        <span class="application">nbackup</span> не <span class="quote">«<span class="quote">отпустит</span>»</span> базу данных и
                    кэширование базы файловой системой опять не заработает.</p><p>Наоборот, если вы используете SuperServer, и отключили файловый кэш у БД,
                    включение файлового кэша <code class="code">nbackup –D off</code> может привести к выпадению
                    процессов в виртуальную память, так как операционной системе потребуется память
                    для размещения там файлового кэша базы данных.</p><p>Таким образом, в обычной ситуации следует всегда использовать <code class="code">–D
                        off</code>, а когда вы точно знаете, что кэш БД выключен в
                        <code class="filename">firebird.conf</code> — <code class="code">-D on</code>.</p></div></section><section class="section" id="nbackup-decompress"><div class="titlepage"><div><div><h3 class="title">Распаковка сжатых копий</h3></div></div></div><p>Начиная с Firebird 3.0 введён дополнительный параметр <code class="code">–DE</code>, который
                предназначен для распаковки сжатых бэкапов на линуксе при восстановлении БД из
                бэкапов. В качестве аргумента принимает командную строку, которая должна распаковать
                архив и передать в stdout распакованный файл бэкапа.</p><p>Примеры:
                </p><pre class="programlisting">
nbackup -de bzcat -r e.fdb e.b0.bz2 e.b1.bz2
nbackup -de 'bzip2 -d -c' -r e.fdb e.b0.bz2 e.b1.bz2
nbackup -de 'bzip2 -d -c @' -r e.fdb e.b0.bz2 e.b1.bz                
            </pre><p>
            </p><p>Все эти 3 команды приведут к одному и тому же результату — архивы будут
                распакованы и из них будет создана база данных e.fdb.</p></section><section class="section" id="d0e10754"><div class="titlepage"><div><div><h3 class="title">Информационные параметры</h3></div></div></div><p>Кроме упомянутых ранее <code class="code">–FE</code> и <code class="code">–D</code>
                <span class="application">nbackup</span> в Firebird дополнительно имеет два параметра:
                    <code class="code">-Z</code> показывает информацию о версии. Этот параметр может быть
                использован независимо, или вместе с другими параметрами, <code class="code">-B</code>,
                    <code class="code">-R</code>, <code class="code">-L</code> и т.д.</p><p>? показывает все возможные параметры командной строки. Если указывается
                    <code class="code">-?</code>, то все остальные параметры игнорируются.</p></section><section class="section" id="nbackup-wire"><div class="titlepage"><div><div><h3 class="title">Бэкапы по сети</h3></div></div></div><p><span class="application">nbackup</span> работает с локальными базами данных. Но в
                Firebird 2.5 и выше, операции nbackup могут быть выполнены удаленно через Sevices
                Manager. Для этого используется утилита fbsvcmgr. Она находится в той же папке, что
                и <span class="application">nbackup</span>. Первый аргумент всегда
                        <code class="code"><em class="replaceable"><code>hostname</code></em>:service_mgr</code>, где
                    <em class="replaceable"><code>hostname</code></em> это имя удаленного сервера (где работает
                Firebird). Другие параметры: </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p><code class="code">-user <em class="replaceable"><code>username</code></em></code></p></li><li class="listitem"><p><code class="code">-password <em class="replaceable"><code>password</code></em></code></p></li><li class="listitem"><p><code class="code">-action_nbak</code></p></li><li class="listitem"><p><code class="code">-action_nrest</code></p></li><li class="listitem"><p><code class="code">-nbk_level <em class="replaceable"><code>n</code></em></code></p></li><li class="listitem"><p><code class="code">-dbname <em class="replaceable"><code>database</code></em></code></p></li><li class="listitem"><p><code class="code">-nbk_file <em class="replaceable"><code>filename</code></em></code></p></li><li class="listitem"><p><code class="code">-nbk_no_triggers</code></p></li><li class="listitem"><p><code class="code">-nbk_direct on|off</code></p></li></ul></div><p>Выполнить nbackup на машине srv можно следующим образом:
                </p><pre class="synopsis">
fbsvcmgr srv:service_mgr –user SYSDBA –password masterkey 
-action_nbak –nbk_level 0 –dbname c:\databases\countries.fdb –nbk_file
c:\databases\countries.nbk                
            </pre><p>
            </p><p>Или инкрементный бэкап
                </p><pre class="synopsis">
fbsvcmgr srv:service_mgr –user SYSDBA –password masterkey 
-action_nbak –nbk_level 1 –dbname c:\databases\countries.fdb –nbk_file
c:\databases\countries_1.nbk               
            </pre><p>
            </p><p>Для восстановления базы данных
                </p><pre class="synopsis">
fbsvcmgr srv:service_mgr –user SYSDBA –password masterkey 
-action_nrest –dbname c:\databases\countries_restored.fdb –nbk_file
c:\databases\countries.nbk –nbk_file c:\databases\countries_1.nbk            
            </pre><p>
            </p><p>Каждая такая строка должна быть введена как единое целое, без переводов
                строки.</p><p>Комментарии: </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Services Manager всегда требует указания имени пользователя и пароля,
                            явного при помощи опций <em class="parameter"><code>–user</code></em> и
                                <em class="parameter"><code>–password</code></em>, или автоматического (root или
                            trusted authentification). Переменные <code class="envar">isc_user</code> и
                                <code class="envar">isc_password</code> не используются. AUTO ADMIN MAPPING не
                            действует при удаленном соединении. </p></li><li class="listitem"><p>Восстановление (<em class="parameter"><code>-action_nrest</code></em>) также требует
                            аутентификации, но она реально не используется. Поэтому не нужно быть
                            владельцем БД, SYSDBA или суперпользователем. </p></li><li class="listitem"><p>Services Manager может быть использован локально. В этом случае первый
                            аргумент становится service_mgr, без имени сервера. При локальном
                            соединении AUTO ADMIN MAPPING действует, как будто вы указали localhost
                            в качестве имени сервера. Локальное использование Services Manager имеет
                            смысл если вы не имеете файлового доступа к базе данных и каталогам с
                            бэкапами, а Firebird — имеет. Если же у вас есть соответствующие права,
                            то имеет смысл использовать непосредственно
                                <span class="application">nbackup</span>, а не
                                <span class="application">fbsvcmgr</span>. </p></li><li class="listitem"><p>Вместо имени файла базы данных вы можете использовать алиас. </p></li></ul></div></section><section class="section" id="nbackup-practical"><div class="titlepage"><div><div><h3 class="title">Практическое применение</h3></div></div></div><p>Обычная схема использования nbackup может выглядеть так </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>в начале каждого месяца выполняется полный бэкап уровня 0 </p></li><li class="listitem"><p>каждую неделю – уровень 1 </p></li><li class="listitem"><p>каждый день – уровень 2 </p></li><li class="listitem"><p>каждый час – уровень 3 </p></li></ul></div><p>Если вы сохраняете эти бэкапы, то можете восстановить базу данных на любой час
                любого дня месяца. В этом случае используется максимум 4 уровня (от 0 до 3). Вы
                можете использовать другие интервалы времени, в зависимости от загрузки сервера,
                например, уровни 0 и 1 можно делать на выходных, и уровень 2 ночью.</p><p>Если вы не хотите хранить все бэкапы вечно, можно использовать схему:
                    </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>бэкапы уровня 3 удаляются каждый 8й день</p></li><li class="listitem"><p>файлы уровня 2 – каждый месяц </p></li><li class="listitem"><p>файлы уровня 1 – каждые 6 месяцев </p></li><li class="listitem"><p>полный бэкап оставляем на 2 года, затем удаляем </p></li></ul></div><p>Это просто примеры, выбирайте самостоятельно частоту бэкапов и необходимые
                уровни.</p><div class="note"><h3 class="title">Примечание</h3><p>Вы должны заранее оценить скорость вашей дисковой подсистемы и объемы
                    инкрементов, чтобы бэкап самого последнего используемого вами уровня успел
                    выполниться в назначенный интервал времени. То есть, если бэкап уровня 3
                    делается каждый час, то он сам по себе не должен длиться больше часа ни при
                    каких условиях (загруженности системы и скорости дисков).</p></div><div class="note"><h3 class="title">Примечание</h3><p><span class="application">nbackup</span> уровня 1 позволяет вам понять, какое
                    количество изменений (страниц) происходит в вашей базе за некий интервал
                    времени. Если вы делаете nbackup –b 1 через день после <code class="code">nbackup –b
                    0</code>, то размер файла уровня 1 будет как раз содержать количество измененных
                    страниц за 1 день.</p><p>Это не эквивалентно количеству изменений за день вообще, т.к. одна страница БД
                    может изменяться множество раз, но в бэкап уровня 1 попадет только самое
                    последнее изменение этой страницы.</p><p>Одной из неожиданных для меня схем в одной из компаний был отказ от бэкапов
                    уровня выше 1. То есть, после бэкапа уровня 0 весь месяц, каждый день, делаются
                    бэкапы только уровня 1. Понятно, что каждый день файл бэкапа уровня 1 может
                    расти, но опять же, это зависит от количества изменений разных страниц, а не
                    одних и тех же страниц.</p><p>Для примера, база 10 гигабайт. <span class="application">nbackup</span> уровня 0
                    делается 1 раз в месяц. Бэкап уровня 1 делается раз в неделю, и занимает 1
                    гигабайт, бэкапы уровня 2 каждый день по 800 мегабайт, бэкапы уровня 3 раз в час
                    по 300 мегабайт. В итоге, если хранить все это за месяц, получается 136 гигабайт
                    для 10гб базы данных.</p><p>Обратите внимание, что бэкапы уровня 3, которые делаются 1 раз в час, занимают
                    по 300мб каждый, а бэкап уровня 2, который делается 1 раз в день, занимает
                    800мб. Если умножить 300мб на 24 часа, мы получим необходимость хранения 7.2
                    гигабайт ежечасных бэкапов вместо одного 800 мегабайтного за день. Но это цена
                    возможности восстановления состояния базы данных на каждый час, а не на каждый
                    день. Поэтому, при планировании бэкапов необходимо учитывать стоимость
                    возможности восстановления на каждый час и стоимость хранения этих
                    данных.</p><p>Другой пример — база данных 375 гигабайт, бэкап уровня 0 длится 45 минут,
                    бэкапы уровня 1 (каждый день) длятся не более 20 минут, и занимают до 25
                    гигабайт. В результате, объем файлов бэкапа уровня 0 плюс бэкапы уровня 1 за 30
                    дней занимают 1.1 терабайт.</p><p>Кстати, просто для сравнения. Восстановление из
                        <span class="application">nbackup</span> такой БД (375 гиг) занимает 1 час, а
                    восстановление из бэкапа <span class="application">gbak</span> — 17 часов.</p></div><div class="important"><h3 class="title">Важно</h3><p>При работе с nbackup необходимо следить за двумя параметрами — как долго
                    существует дельта-файл, и какой размер он имеет. Критическими являются
                    существование дельта файла больше двух-трёх часов, или если размер дельта-файла
                    превысил более трети размера БД. Оба этих критических значения указывают на то,
                    что разблокирование БД после старта nbackup не произошло по какой-то причине, и
                    все изменения до сих пор пишутся в дельта-файл, а не в базу данных.</p><p>Посмотреть состояние базы данных (и состояние бэкапа) можно командой
                        <code class="code">gstat –h</code> &lt;database&gt;.</p></div></section><section class="section" id="d0e10980"><div class="titlepage"><div><div><h3 class="title">Что дальше?</h3></div></div></div><p>К этому моменту вы уже знаете всё о бэкапах и восстановлении. Далее приведена
                информация о специфических режимах работы nbackup, которые могут быть вам
                интересны.</p></section></section><section class="section" id="nbackup-lock_and_unlock"><div class="titlepage"><div><div><h2 class="title" style="clear: both">Блокирование и разблокирование</h2></div></div></div><p>Если вы хотите использовать собственные средства бэкапа, или просто сделать файловую
            копию БД, то режим блокирования и разблокирования БД будет интересен для вас.
                <span class="quote">«<span class="quote">Блокирование</span>»</span> означает что база данных будет <span class="quote">«<span class="quote">заморожена</span>»</span>
            на некоторое время, и в ней не будут производиться никакие изменения. Изменения будут
            записаны в дельта-файл, и при разблокировании дельта-файл будет записан обратно в базу
            данных.</p><section class="section" id="nbackup-lock"><div class="titlepage"><div><div><h3 class="title">Блокирование базы данных и самостоятельное копирование</h3></div></div></div><p>Типичный сеанс самостоятельного бэкапа выглядит так: </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Блокируем базу данных параметром –L</p><p><code class="code">nbackup [-U <em class="replaceable"><code>user</code></em> –P
                                    <em class="replaceable"><code>password</code></em>] –L
                                    <em class="replaceable"><code>database</code></em></code></p></li><li class="listitem"><p>Теперь можно скопировать базу данных любыми утилитами. </p></li><li class="listitem"><p>Разблокируем базу данных параметром –N </p><p><code class="code">nbackup [-U <em class="replaceable"><code>user</code></em> –P
                                    <em class="replaceable"><code>password</code></em>] –N
                                    <em class="replaceable"><code>database</code></em></code></p></li></ol></div><p>На шаге 3 все изменения, которые происходили с базой данных во время шага 2, будут
                записаны в БД из дельта-файла.</p><p>Комментарии: </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Вы можете указать алиас вместо имени БД </p></li><li class="listitem"><p>Параметры <code class="code">–U</code> и <code class="code">–P</code> могут не указываться, если
                            вы установили переменные <code class="envar">ISC_USER</code> и
                                <code class="envar">ISC_PASSWORD</code>, или являетесь root, или доверенным
                            пользователем на Windows. </p></li><li class="listitem"><p>Начиная с Firebird 2.5 вы можете вместо <code class="code">–P
                                    <em class="replaceable"><code>&lt;password&gt;</code></em></code> указать
                                <code class="code">–FE <em class="replaceable"><code>&lt;filename&gt;</code></em></code>
                        </p></li><li class="listitem"><p>Обе опции, <code class="code">-L</code> и <code class="code">–N</code>, производят обычный
                            подключение к базе данных, поэтому в Firebird 2.1 и выше может быть
                            имеет смысл дополнительно указать <code class="code">–T</code> (<a class="link" href="#nbackup-nodbtriggers" title="Отключение триггеров базы данных">Отключение триггеров
                            БД</a>).</p></li><li class="listitem"><p>Если вы делаете бэкап базы данных, расположенной на «сыром
                            устройстве», то вероятно,вам не помешает параметр –S для получения
                            информации о базе данных. </p></li><li class="listitem"><p>Можно указать параметр –Z, который выводит информацию о версии.
                        </p></li></ul></div><div class="note"><h3 class="title">Примечание</h3><p>Что относится к бэкапу и восстановлению, точно так же относится и к
                    блокированию разблокированию многофайловых баз данных. Не используйте nbackup на
                    многофайловых базах данных, совсем.</p></div></section><section class="section" id="nbackup-unlock"><div class="titlepage"><div><div><h3 class="title">Восстановление бэкапа после "nbackup -L"</h3></div></div></div><p>Скопированная в момент блокирования база данных также является заблокированной,
                поэтому вы не можете её использовать сразу после копирования. Корректный сценарий
                использования копии выглядит так: </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Копируем заблокированную БД нужными нам средствами </p></li><li class="listitem"><p>Разблокируем БД, но не параметром <code class="code">–N</code>, а параметром
                                <code class="code">–F</code> (fixup)</p><p><code class="code">nbackup –F
                            <em class="replaceable"><code>&lt;database&gt;</code></em></code></p></li></ol></div><p>Здесь можно использовать алиас вместо имени файла базы данных, и указывать
                параметр <code class="code">–Z</code>. Указание других параметров не имеет смысла.</p><p>Почему есть два параметра разблокирования, <code class="code">-N</code> и <code class="code">–F</code>? </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="code">-N</code> вначале проверяет, были-ли изменения БД с момента ее
                            блокирования <code class="code">–L</code>. Если да, то дельта-файл применяется к БД,
                            после чего БД разблокируется, а дельта-файл удаляется. </p></li><li class="listitem"><p><code class="code">-F</code> просто меняет флаг состояния БД из
                                <span class="quote">«<span class="quote">заблокировано</span>»</span> в <span class="quote">«<span class="quote">нормальный</span>»</span>. </p></li></ul></div><div class="note"><h3 class="title">Примечание</h3><p>Опцию <code class="code">–F</code> можно использовать вместо <code class="code">–N</code> если в
                    процессе <span class="application">nbackup</span> (от момента блокирования БД)
                    произошло повреждение дельта-файла. Разумеется, в этом случае все изменения,
                    которые были в дельта-файле, пропадут, т.е. не будут записаны в БД.</p></div><p>Итак, вы используете </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="code">-N</code> после того как сделали копию файла самостоятельно
                            (после <code class="code">–L</code>) </p></li><li class="listitem"><p><code class="code">-F</code> если хотите восстановить БД из скопированного файла.
                        </p></li></ul></div></section><section class="section" id="nbackup-lock_unlock-how_it_works"><div class="titlepage"><div><div><h3 class="title">Как это работает</h3></div></div></div><p>Этот раздел не содержит обязательных знаний, но дает дополнительную информацию для
                понимания работы некоторых параметров <span class="application">nbackup</span>.</p><p><code class="code">nbackup –L</code> делает следующее: </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p> подсоединяется к БД </p></li><li class="listitem"><p> стартует транзакцию </p></li><li class="listitem"><p> выполняет ALTER DATABASE BEGIN BACKUP (этот оператор уже обсуждался в
                            разделе <a class="link" href="#nbackup-full-restore" title="Восстановление полных резервных копий">"Восстановление полных
                                бэкапов"</a></p></li><li class="listitem"><p> делает коммит транзакции </p></li><li class="listitem"><p> отсоединяется от базы данных </p></li></ol></div><p><code class="code">nbackup –N</code> выполняет те же самые шаги, только на шаге 3 <code class="code">... END
                    BACKUP</code>.</p><p><code class="code">nbackup –F</code> работает так: </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p> открывает файл базы данных </p></li><li class="listitem"><p> внутри файла меняет флаг состояния nback_state_stalled на
                            nback_state_normal </p></li><li class="listitem"><p> закрывает файл базы данных </p></li></ol></div><p><code class="code">nbackup –F</code> работает только с файлом, поэтому может быть выполнен без
                работающего сервера Firebird. Любые аргументы параметров –U, -P, или –FE
                игнорируются, так же как и для <code class="code">nbackup –R</code>.</p></section><section class="section" id="nbackup-lock_db-raw_devices"><div class="titlepage"><div><div><h3 class="title">Блокирование баз на сырых устройствах</h3></div></div></div><p>Как уже было упомянуто в разделе <span class="quote">«<span class="quote"><a class="link" href="#nbackup-backup-raw_devices" title="Бэкапы баз данных на сырых устройствах (raw devices)">Бэкапы баз данных на сырых
                        устройствах</a></span>»</span>, проблемы могут возникнуть если дельта-файл
                создается для базы данных, которая находится на сыром устройстве (raw device).
                Поэтому, в Firebird 2.1 и выше <span class="application">nbackup</span> отказывается
                работать с базами на сырых устройствах до тех пор, пока не будет задано явное
                расположение дельта-файла. Как это сделать, написано в<a class="link" href="#nbackup-tune_delta" title="Настройка дельта-файла"> следующем разделе</a>.</p><p>Есть и другая проблема, если вы блокируете и пытаетесь скопировать сырое
                устройство — вы не знаете реального размера базы данных! Само устройство может иметь
                размер 10 гигабайт, а база данных на нем может занимать всего 200 мегабайт. Чтобы не
                копировать всё устройство целиком, и не тратить зря время и место, в Firebird 2.1
                введен новый параметр <code class="code">nbackup –S</code>. Этот параметр работает только вместе
                с параметром <code class="code">–L</code>, и если указан, <span class="application">nbackup</span>
                выведет размер базы данных в страницах в stdout, после того как БД будет
                заблокирована. Поскольку размер приведен в количестве страниц, его нужно умножить на
                размер страницы, чтобы получить размер базы данных. Или, если вы пользуетесь
                утилитой <span class="application">dd</span>, можно указать размер блока параметром ibs,
                равному размеру страницы.</p></section></section><section class="section" id="nbackup-tune_delta"><div class="titlepage"><div><div><h2 class="title" style="clear: both">Настройка дельта-файла</h2></div></div></div><p>По умолчанию дельта-файл располагается рядом с базой данных. Имя файла такое же, как у
            базы данных, но к нему добавлено расширение <code class="filename">.delta</code>. Обычно такое
            поведение является приемлемым, однако иногда может потребоваться указать явно
            расположение дельта-файла, особенно если база данных находится на сыром устройстве (raw
            device). <span class="application">nbackup</span> не имеет возможности указать расположение
            дельта-файла, это делается оператором SQL.</p><p>Подсоединитесь к базе данных, и выполните следующую команду:
            </p><pre class="programlisting">
alter database add difference file '<em class="replaceable"><code>path-and-filename</code></em>'                
            </pre><p>
        </p><p>Такое расположение и имя дельта-файла будет в базе данных постоянным, оно хранится в
            системной таблице RDB$FILES. Для возврата к поведению по умолчанию используйте следующую
            команду:
            </p><pre class="programlisting">
alter database drop difference file              
            </pre><p>
        </p><p>Указать путь к дельта-файлу можно и при создании базы данных:
            </p><pre class="programlisting">
create database '<em class="replaceable"><code>path-and-dbname</code></em>' difference file '<em class="replaceable"><code>path-and-deltaname</code></em>'
...
            </pre><p>
        </p><p>Замечания: </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Если вы укажете только имя файла в [ADD] DIFFERENCE FILE, без пути, то
                        дельта-файл с этим именем будет создан не рядом с базой данных, а в
                            <span class="quote">«<span class="quote">текущем каталоге</span>»</span> с точки зрения сервера. На Windows это
                        обычно системная папка (например, <code class="filename">C:\Windows\system32</code>).
                        То же самое справедливо и для относительных имен каталогов. </p></li><li class="listitem"><p>Указанный путь должен существовать. Firebird не будет создавать
                        отсутствующие папки/каталоги. </p></li><li class="listitem"><p>Если вы хотите поменять имя дельта-файла или путь к нему, сначала вы
                        должны удалить(DROP) старое имя, и добавить (ADD) новое. </p></li></ul></div></section><section class="section" id="nbackup-history"><div class="titlepage"><div><div><h2 class="title" style="clear: both">Лог истории бэкапов</h2></div></div></div><p>Firebird созхраняет всю историю бэкапов nbackup в системной таблице
            RDB$BACKUP_HISTORY. Эта информация используется nbackup для собственных нужд, но также
            может использоваться для просмотра когда, какого уровня бэкап был сделан, и с каким
            именем файла. Например, можно посмотреть информацию о 5ти последних бэкапах:
            </p><pre class="programlisting">
SELECT RDB$BACKUP_ID, RDB$TIMESTAMP, RDB$BACKUP_LEVEL, RDB$GUID,
RDB$SCN, RDB$FILE_NAME
FROM RDB$BACKUP_HISTORY
ORDER BY RDB$TIMESTAMP DESC
ROWS 5            
        </pre><p>
        </p><div class="table" id="d0e11325"><div class="table-title">Таблица 7.2. Столбцы таблицы RDB$BACKUP_HISTORY</div><div class="table-contents"><table style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; "><colgroup><col class="c1"/><col class="c2"/></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">Столбец</th><th style="border-bottom: 1px solid ; ">Описание</th></tr></thead><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="code">RDB$BACKUP_ID</code></td><td style="border-bottom: 1px solid ; "><p>Первичный ключ.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="code">RDB$TIMESTAMP</code></td><td style="border-bottom: 1px solid ; "><p>Дата и время бэкапа.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="code">RDB$BACKUP_LEVEL</code></td><td style="border-bottom: 1px solid ; "><p>Уровень бэкапа.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="code">RDB$GUID</code></td><td style="border-bottom: 1px solid ; "><p>GUID бэкапа (используется для проверки взаимозависимостей
                                разных уровней).</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="code">RDB$SCN</code></td><td style="border-bottom: 1px solid ; "><p/></td></tr><tr><td style="border-right: 1px solid ; "><code class="code">RDB$FILE_NAME</code></td><td><p>Имя файла бэкапа.</p></td></tr></tbody></table></div></div><br class="table-break"/><p>Пояснения по столбцу RDB$SCN вы можете прочитать в следующем разделе.</p><p>Содержимое таблицы RDB$BACKUP_HISTORY не сохраняется (и не восстанавливается) gbak-ом
            (потому что <span class="application">gbak</span> при восстановлении создает базу данных
            заново, и эта база данных по содержимому страниц не имеет ничего общего с базой данных,
            бэкап которой был сделан gbak).</p></section><section class="section" id="nbackup-technical_info"><div class="titlepage"><div><div><h2 class="title" style="clear: both">Техническая информация</h2></div></div></div><p>nbackup делает бэкап копируя страницы базы данных, либо все (-B 0), либо те, которые
            были изменены с момента бэкапа предыдущего уровня (-B N). Например, бэкап уровня 1
            содержит все страницы, которые были изменены с момента создания бэкапа уровня 0. Чтобы
            найти измененные страницы Firebird использует маркер, именуемый SCN (сокращение от
            System Change Number). Этот номер увеличивается каждый раз при изменении состояния
            бэкапа. Кроме того, у базы данных есть три состояния (находится в странице заголовка БД
            и может быть просмотрено <code class="code">gstat –h</code>).</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> nback_state_normal — нормальное состояние БД. nbackup не работает, ввод-вывод
                    не переадресуется,нет дельта-файла </p></li><li class="listitem"><p> nback_state_stalled — бэкап в процессе. Ввод-вывод перенаправляется в дельта
                    файл: все изменения записываются только в дельта-файл, измененные страницы
                    читаются из дельта файла, не измененные страницы читаются из БД</p></li><li class="listitem"><p> nback_state_merge — бэкап завершается. Изменения записываются из дельта файла
                    в базу данных. Ввод вывод всё еще перенаправлен: изменяемые страницы
                    записываются как в БД, таки в дельта-файл, не измененные страницы записываются
                    из дельты в БД,измененные страницы читаются из дельты, не измененные – из БД.
                </p></li></ul></div><p>Эти состояния меняются из одного на другое, допустимы три варианта: </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p> nback_state_normal (не бэкап) в nback_state_stalled (при начале бэкапа)
                    </p></li><li class="listitem"><p> nback_state_stalled в nback_state_merge (при завершении бэкапа) </p></li><li class="listitem"><p> nback_state_merge в nback_state_normal (по окончании бэкапа) </p></li></ol></div><p>SCN базы данных перед стартом бэкапа записывается в страницу заголовка БД, и в
            результате также попадает в бэкап. Самый первый бэкап получает SCN = 0, второй = 3, и
            так далее. Этот номер не зависит от уровня бэкапа. SCN используется для маркировки
            страниц в базе данных. Например, значения SCN на страницах БД: </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> 0 – страница перед бэкапом </p></li><li class="listitem"><p> 1 – страница, записанная в дельту или обновленная в ней во время бэкапа
                    </p></li><li class="listitem"><p> 2 – страница, модифицированная во время заливки дельты в базу данных
                    </p></li><li class="listitem"><p> 3 – страница, модифицированная после окончания бэкапа </p></li></ul></div><p>Дальше, при очередном инкрементном бэкапе, сервер может определить, какие страницы
            были модифицированы после окончания предыдущего бэкапа, и какой это был уровень бэкапа.
            Например, когда производится бэкап уровня 1, nbackup читает информацию о предыдущем
            бэкапе (уровня 0), и сохраняет в бэкап уровня 1 только те страницы, SCN которых больше,
            чем у бэкапа уровня 0. То же самое происходит с бэкапами уровня 2, и так далее.</p><p>В Firebird 3 в базе данных хранится информация о SCN всех страниц, что позволяет
            серверу при очередном инкрементном бэкапе читать только измененные страницы. В
            предыдущих версиях Firebird для любого инкремента приходилось каждый раз сканировать всю
            базу данных. Таким образом, если бэкап уровня 0 базы размером 31 гигабайт проходит за 6
            минут, то бэкап уровня 1 при отсутствии изменений в базе с момента бэкапа уровня 0 будет
            выполнен за 14 секунд (прочитано 1984 страницы вместо чтения 3909536 страниц всей
            базы).</p><section class="section" id="nbackup-swept"><div class="titlepage"><div><div><h3 class="title">Swept флаг</h3></div></div></div><p>У Firebird 3 есть другая особенность – это флаг swept у страниц данных. Этот флаг
                устанавливается в false, как только на странице появляются версии записей, и
                устанавливается в true, когда sweep или сборщик мусора полностью очищают страницу
                данных от мусорных версий. Главным здесь является то, что после restore, несмотря на
                отсутствие версий на страницах данных, все страницы данных помечены как swept=false.
                Это означает, что при очередном запуске sweep все страницы данных могут поменяться
                (флаг swept установится в true). В результате следующая последовательность приведет
                к максимальному размеру инкремента </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>restore</p></li><li class="listitem"><p>nbackup –b 0</p></li><li class="listitem"><p>sweep</p></li><li class="listitem"><p>nbackup –b 1</p></li></ol></div><p>В пункте 4 инкремент будет содержать все страницы данных, у которых флаг swept был
                установлен в true, то есть, этот инкремент будет максимального размера. Поэтому,
                если это возможно, после restore нужно сразу запустить sweep, а nbackup нулевого
                уровня делать уже после sweep (то есть, поменять местами пункты 2 и 3).</p><p>Далее, если sweep будет запускаться между инкрементами, это не приведет ни к каким
                    <span class="quote">«<span class="quote">лишним</span>»</span> страницам в инкременте. Потому что если на странице
                появились версии, то она изменена, а если убран мусор, то она тоже изменена, и в
                следующий инкремент такая страница всё равно должна будет попасть.</p></section></section></section><section xml:lang="ru" class="chapter" id="gfix"><div class="titlepage"><div><div><h2 class="title">Глава 8. Утилита GFIX</h2></div></div></div><a id="d0e11465" class="indexterm"/><p>Утилита <span class="application">GFIX</span> является одним из основных инструментов
        администратора БД. Она позволяет: </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Выполнять принудительную чистку (sweep) базы данных; </p></li><li class="listitem"><p>Изменять интервал автоматической чистки (sweep interval); </p></li><li class="listitem"><p>Закрывать (shutdown) базу данных для получения монопольного доступа, и затем
                    снова открывать ее; </p></li><li class="listitem"><p>Переводить базу в режимы «чтение/запись» или «только чтение»; </p></li><li class="listitem"><p>Переключаться между синхронным и асинхронным вводом (Forced Writes); </p></li><li class="listitem"><p>Изменять диалект БД; </p></li><li class="listitem"><p>Устанавливать размер кэша для БД; </p></li><li class="listitem"><p>Отыскивать повисшие транзакции и отменять или подтверждать их; </p></li><li class="listitem"><p>Активировать или удалять теневые копии; </p></li><li class="listitem"><p>Производить ремонт поврежденных баз данных. </p></li></ul></div><p>Запуск GFIX осуществляется следующим образом:
        </p><pre class="synopsis">
gfix [<em class="replaceable"><code>&lt;commands and parameters&gt;</code></em>] <em class="replaceable"><code>database_name</code></em>        
    </pre><p>
    </p><p>Если база данных состоит из нескольких файлов, то при запуске
            <span class="application">gfix</span> необходимо указать первичный файл.</p><p>Для того, чтобы выполнить любую операцию над базой данных с помощью gfix, необходимо
        пройти процедуру идентификации и аутентификации — указать имя и пароль пользователя, который
        имеет право на запуск сервиса gfix. Для указания имени и пароля пользователя используются
        переключатели <code class="code">-user</code> и <code class="code">-pa[ssword]</code>, соответственно, например:
        </p><pre class="synopsis">
gfix -user testuser -pa pass -role rdb$admin [<em class="replaceable"><code>&lt;commands&gt;</code></em>] <em class="replaceable"><code>database_name</code></em>         
    </pre><p>
    </p><p>Необязательный переключатель <code class="code">-role</code> задаёт имя роли, права которой будут
        учитываться при выполнении каких-либо действий утилиты.</p><p>Имя пользователя и пароль можно не указывать, если в системе установлены контекстные
        переменные <code class="envar">ISC_USER</code> и <code class="envar">ISC_PASSWORD</code>. А также если используется
        доверительная аутентификация Windows (Win_Sspi), и пользователь системы, от имени которого
        запускается утилита, является членом группы администраторов.</p><p>Запуск gfix без команды (или с неверной командой) или с переключателем -? приводит к
        отображению следующего экрана справочной информации: </p><pre class="screen">
        
usage: gfix [options] &lt;database&gt;
plausible options are:
   -ac(tivate_shadow)   activate shadow file for database usage
   -at(tach)            shutdown new database attachments
   -b(uffers)           set page buffers &lt;n&gt;
   -co(mmit)            commit transaction &lt;tr / all&gt;
   -ca(che)             shutdown cache manager
   -fu(ll)              validate record fragments (-v)
   -fo(rce_shutdown)    force database shutdown
   -fe(tch_password)    fetch password from file
   -h(ousekeeping)      set sweep interval &lt;n&gt;
   -i(gnore)            ignore checksum errors
   -icu                 fix database to be usable with present ICU version
   -k(ill_shadow)       kill all unavailable shadow files
   -l(ist)              show limbo transactions
   -me(nd)              prepare corrupt database for backup
   -mo(de)              read_only or read_write database
   -nol(inger)          close database ignoring linger setting for it
   -n(o_update)         read-only validation (-v)
   -o(nline)            database online &lt;single / multi / normal&gt;
   -pr(ompt)            prompt for commit/rollback (-l)
   -pa(ssword)          default password
   -role                set SQL role name
   -r(ollback)          rollback transaction &lt;tr / all&gt;
   -sq(l_dialect)       set database dialect n
   -sw(eep)             force garbage collection
   -sh(utdown)          shutdown &lt;full / single / multi&gt;
   -tw(o_phase)         perform automated two-phase recovery
   -tra(nsaction)       shutdown transaction startup
   -tru(sted)           use trusted authentication
   -u(se)               use full or reserve space for versions
   -user                default user name
   -v(alidate)          validate database structure
   -w(rite)             write synchronously or asynchronously
   -z                   print software version number

    Options can be abbreviated to the unparenthesized characters  
    
    </pre><p>
    </p><p>Набор всех возможных опций утилиты GFIX, представлен ниже.</p><div class="table" id="d0e11557"><div class="table-title">Таблица 8.1. Команды и опции утилиты GFIX</div><div class="table-contents"><table style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; "><colgroup><col class="c1"/><col class="c2"/></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">Опция</th><th style="border-bottom: 1px solid ; ">Описание</th></tr></thead><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="code">-ac[tivate_shadow] <em class="replaceable"><code>&lt;shadow
                            copy&gt;</code></em></code></td><td style="border-bottom: 1px solid ; "><p>Параметр предназначен для активации теневой копии.
                                    <code class="code"><em class="replaceable"><code>&lt;shadow copy&gt;</code></em></code> —
                            адрес и имя файла теневой копии (или первого из файлов).</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="code">-at[tach] <em class="replaceable"><code>&lt;n&gt;</code></em></code></td><td style="border-bottom: 1px solid ; "><p>Дополнительный параметр к <code class="code">-shut</code>. Предназначен для
                            запрета новых соединений с БД.
                                    <code class="code"><em class="replaceable"><code>&lt;n&gt;</code></em></code> указывает
                            количество секунд, через которое произойдет отключение БД. Отключение
                            отменится, если к этому времени еще останутся активные
                            соединения.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="code">-b[uffers] <em class="replaceable"><code>&lt;n&gt;</code></em></code></td><td style="border-bottom: 1px solid ; "><p>Устанавливает новый размер кэша (буфера) БД.
                                    <code class="code"><em class="replaceable"><code>&lt;n&gt;</code></em></code> — количество
                            страниц. Это значение перекрывает значение параметра
                                <em class="parameter"><code>DefaultDbCachePages</code></em> в
                                (<code class="filename">firebird.conf</code> и
                                <code class="filename">databases.conf</code>).</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="code">-co[mmit] {<em class="replaceable"><code>&lt;ID&gt;</code></em> |
                        all}</code></td><td style="border-bottom: 1px solid ; "><p>Завершает подтверждением зависшую транзакцию с идентификатором
                                    <code class="code"><em class="replaceable"><code>&lt;ID&gt;</code></em></code>, или все
                            зависшие транзакции <code class="code">all</code>.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="code">-ca[che]</code></td><td style="border-bottom: 1px solid ; "><p>Не используется.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="code">-fu[ll]</code></td><td style="border-bottom: 1px solid ; "><p>Используется вместе с <code class="code">-v[alidate]</code> для проверки
                            структур записей и таблиц; освобождает неназначенные фрагменты
                            записей.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="code">-fo[rce_shutdown]
                        <em class="replaceable"><code>&lt;n&gt;</code></em></code></td><td style="border-bottom: 1px solid ; "><p>Дополнительный параметр к <code class="code">-shut</code>. Предназначен для
                            принудительного закрытия базы данных.
                                    <code class="code"><em class="replaceable"><code>&lt;n&gt;</code></em></code> указывает
                            количество секунд, через которое произойдет закрытие. Если остались
                            активные пользователи, они отключатся, последние результаты их работы
                            будут потеряны. Такое средство нужно применять с осторожностью, как
                            последнюю возможность.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="code">-fe[tch_password] {<em class="replaceable"><code>&lt;password file
                                name&gt;</code></em> | stdin | /dev/tty}</code></td><td style="border-bottom: 1px solid ; "><p>Извлекает пароль из файла. Если имя файла указано как stdin, то
                            пользователю будет предложено ввести пароль. В системах POSIX имя файла
                                <code class="filename">/dev/tty</code> также приведет к запросу
                            пароля.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="code">-h[ousekeeping] <em class="replaceable"><code>&lt;n&gt;</code></em></code></td><td style="border-bottom: 1px solid ; "><p>Изменяет интервал транзакций для автоматической чистки sweep.
                                    <code class="code"><em class="replaceable"><code>&lt;n&gt;</code></em></code> устанавливает
                            новый интервал. Если <code class="code">n = 0</code>, автоматическая чистка
                            запрещена.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="code">-i[gnore]</code></td><td style="border-bottom: 1px solid ; "><p>Игнорировать ошибки контрольных сумм при проверке.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="code">-icu</code></td><td style="border-bottom: 1px solid ; "><p>Исправляет базу данных для работы с текущей версией
                        ICU.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="code">-k[ill_shadow]
                        <em class="replaceable"><code>&lt;database&gt;</code></em></code></td><td style="border-bottom: 1px solid ; "><p>Удаляет все неиспользуемые теневые копии базы данных</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="code">-l[ist]</code></td><td style="border-bottom: 1px solid ; "><p>Показывает некоторые сведения (в том числе ID) о всех зависших
                            транзакциях.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="code">-me[nd]</code></td><td style="border-bottom: 1px solid ; "><p>Подготавливает испорченную базу данных для резервного копирования.
                            Помечает разрушенные записи как неиспользуемые.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="code">-mo[de] {read_write | read_only}</code></td><td style="border-bottom: 1px solid ; "><p>Устанавливает режим записи для базы данных — только для чтения или
                            чтение/запись. Этот параметр может принимать два
                        значения.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="code">-nol[inger]</code></td><td style="border-bottom: 1px solid ; "><p>Закрывает указанную базу данных, после того как последнего
                            соединения не стало, независимо от установок LINGER в базе
                            данных.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="code">-n[o_update]</code></td><td style="border-bottom: 1px solid ; "><p>Используется вместе с <code class="code">-v[alidate]</code> для проверки
                            разрушенных или неразмещенных структур. Если таковые есть, они
                            отобразятся в сообщении, но не будут исправлены.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="code">-o[nline] [single | multi | normal]</code></td><td style="border-bottom: 1px solid ; "><p>Открывает закрытую после <code class="code">-shut</code> базу данных. Опция
                            normal позволяет устанавливать соединение с БД любым авторизованным
                            пользователям, а не только SYSDBA и владельцем БД (она используется по
                            умолчанию). Опция multi позволяет устанавливать соединение с БД только
                            SYSDBA и владельцем БД. Опция single похожа на multi, за тем
                            исключением, что только один из пользователей — SYSDBA или владелец БД —
                            может соединиться.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="code">-pr[ompt]</code></td><td style="border-bottom: 1px solid ; "><p>Используется вместе с <code class="code">-l[ist]</code>. Выводит подсказки при
                            восстановлении транзакций.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="code">-pa[ssword]
                        <em class="replaceable"><code>&lt;password&gt;</code></em></code></td><td style="border-bottom: 1px solid ; "><p>Пароль пользователя для работы с gfix.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="code">-role</code></td><td style="border-bottom: 1px solid ; "><p>Роль пользователя для работы с gfix.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="code">-r[ollback] {<em class="replaceable"><code>&lt;ID&gt;</code></em> |
                        all}</code></td><td style="border-bottom: 1px solid ; "><p>Завершает откатом зависшую транзакцию с идентификатором
                                <em class="replaceable"><code>&lt;ID&gt;</code></em>, или все зависшие транзакции
                            (all).</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="code">-sq[l_dialect] <em class="replaceable"><code>&lt;n&gt;</code></em></code></td><td style="border-bottom: 1px solid ; "><p>Изменяет диалект базы данных. <em class="replaceable"><code>&lt;n&gt;</code></em>
                            может быть 1 или 3. Изменение диалекта не влияет на ранее созданные
                            объекты метаданных, они останутся в прежнем диалекте.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="code">-sw[eep]</code></td><td style="border-bottom: 1px solid ; "><p>Запускает принудительную чистку БД.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="code">-sh[utdown] {full | single | multi}</code></td><td style="border-bottom: 1px solid ; "><p>Закрывает базу данных. Используется с одним из дополнительных
                            параметров <code class="code">-attach</code>, <code class="code">-force</code> или
                                <code class="code">-tran</code>. Опция multi позволяет устанавливать соединение с
                            БД только SYSDBA и владельцем БД. Опция single похожа на multi, за тем
                            исключением, что только один из пользователей — SYSDBA или владелец БД —
                            может соединиться. Опция full не позволяет соединиться с БД никому, даже
                            SYSDBA и владельцу БД.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="code">-sw[o_phase] {<em class="replaceable"><code>&lt;ID&gt;</code></em> |
                        all}</code></td><td style="border-bottom: 1px solid ; "><p>Автоматическое двухфазное восстановление limbo транзакции с номером
                                <em class="replaceable"><code>&lt;ID&gt;</code></em>, или всех транзакций
                            (all).</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="code">-tra[nsaction] <em class="replaceable"><code>&lt;n&gt;</code></em></code></td><td style="border-bottom: 1px solid ; "><p>Дополнительный параметр к <code class="code">-shut</code>. Предназначен для
                            запрета запуска новых транзакций. <em class="replaceable"><code>&lt;n&gt;</code></em>
                            указывает количество секунд, через которое произойдет отключение БД.
                            Отключение отменится, если к этому времени еще останутся активные
                            транзакции.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="code">-tru[sted]</code></td><td style="border-bottom: 1px solid ; ">Используется trusted авторизацию.</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="code">-u[se] {full | reserve}</code></td><td style="border-bottom: 1px solid ; "><p>Включает 100% заполнение страниц БД (full) или 80% заполнение по
                            умолчанию (reserve). 100%-е заполнение имеет смысл для баз только для
                            чтения.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="code">-user</code></td><td style="border-bottom: 1px solid ; "><p>Имя пользователя для работы с gfix.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="code">-v[alidate]</code></td><td style="border-bottom: 1px solid ; "><p>Проверяет страницы базы данных, в том числе обнаруживает не
                            назначенные страницы (Orphan pages).</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="code">-w[rite] {sync|async}</code></td><td style="border-bottom: 1px solid ; "><p>Переключает режимы синхронной/асинхронной записи Forced
                            Writes.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="code">-z</code></td><td style="border-bottom: 1px solid ; "><p>Выводит версию Firebird и утилиты gfix.</p></td></tr><tr><td style="border-right: 1px solid ; "><code class="code">-?</code></td><td><p>Вывод экрана справочной информации.</p></td></tr></tbody></table></div></div><br class="table-break"/><section class="section" id="gfix-shadow"><div class="titlepage"><div><div><h2 class="title" style="clear: both">Теневые копии</h2></div></div></div><p>Файл теневой копии является дополнительной копией первичного файла(ов) базы данных.
            Для любой данной базы данных может существовать несколько теневых копий, которые могут
            быть активированы и деактивированы по умолчанию с помощью утилиты
                <span class="application">gfix</span>.</p><p>Под активацией теневой копии понимается процесс преобразования файла теневой копии в
            файл базы данных. Под деактивацией теневой копии подразумевается удаление недоступной
            теневой копии.</p><p>Далее описании при активации и деактивации теневых файлов предполагается, что теневой
            файл уже существует для базы данных. Для этого была создана тень:
            </p><pre class="screen">
isql my_employee;
SQL&gt; create shadow 1 manual '/home/norman/firebird/shadow/my_employee.shd1';
SQL&gt; create shadow 2 manual '/home/norman/firebird/shadow/my_employee.shd2';
SQL&gt; commit;
SQL&gt; show database;
Database: my_employee
 Owner: SYSDBA
 Shadow 1: "/home/norman/firebird/shadow/my_employee.shd1" manual
 Shadow 2: "/home/norman/firebird/shadow/my_employee.shd2" manual
...
SQL&gt; quit;            
        </pre><p>
        </p><p>Можно видеть, что в базе данных теперь есть два отдельных теневых файла, но поскольку
            они являются ручными (manual), то они не были активированы. Мы можем увидеть их наличие
            запустив gstat следующим образом:
            </p><pre class="screen">
norman&gt; gstat -header my_employee | grep -i shadow
Shadow count 2            
        </pre><p>
        </p><section class="section" id="d0e11941"><div class="titlepage"><div><div><h3 class="title">Активация теневой копии</h3></div></div></div><p>Для активации теневой копии используется команда <code class="code">-ac[tivate]</code>:
                </p><pre class="synopsis">
gfix -ac[tivate] <em class="replaceable"><code>&lt;shadow_file_name&gt;</code></em>                
            </pre><p>
            </p><p>Эта команда делает файл теневой копии файлом базы данных, с помощью изменения
                заголовка базы данных.</p><p>В случае, если ваш основной файл(ы) базы данных поврежден или нечитабелен,
                администратор базы данных может активировать теневой файл. После активации этот файл
                больше не является файлом теневой копии. Файл теневой копии должен быть переименован
                на имя старого файла базы данных, который он заменяет.</p><div class="warning"><h3 class="title">Предупреждение</h3><p>Следует отметить, что активация теневой копии, в то время как сама база данных
                    активна, может привести к повреждению тени. Перед ее активацией убедитесь, что
                    файл базы данных действительно недоступен.</p></div><p>Как только файл теней был активирован, вы можете увидеть факт наличия активных
                теней в выводе gstat:
                </p><pre class="screen">
linux&gt; gstat -header my_employee | grep -i shadow
Shadow count 2
Attributes   active shadow, multi-user maintenance                
            </pre><p>
            </p><div class="note"><h3 class="title">Примечание</h3><p>Администратор базы данных может настроить базу данных для автоматического
                    создания нового теневого файла в случае активации текущей тени. Это позволяет
                    обеспечить непрерывную поставку теневых файлов и предотвращает работу базы
                    данных без нее.</p></div></section><section class="section" id="d0e11970"><div class="titlepage"><div><div><h3 class="title">Удаление теневых копий</h3></div></div></div><p>Удаление всех недоступных теневых копий конкретной базы данных производится
                командой:
                </p><pre class="synopsis">
gfix -k[ill] <em class="replaceable"><code>&lt;database_name&gt;</code></em>                
            </pre><p>
            </p><p>В случае, если база данных, работающая с теневыми файлами, теряет тень, или по
                какой-либо причине тень становится непригодной, база данных перестанет принимать
                новые соединения до тех пор, пока администратор базы не уничтожит поврежденную тень
                и, в идеале, создаст новую тень для замены сломанной.</p><p>В следующем (надуманном) примере показано, что происходит, когда база данных
                теряет теневой файл и предпринимается попытка подключиться к этой базе данных. В
                следующем примере есть два сеанса, один из которых подключен к базе данных, а второй
                удаляет теневой файл, а затем пытается подключиться к базе данных.</p><p>Сначала начальный сеанс подключается к базе данных и видит, что к нему прикреплены
                два теневых файла:
                </p><pre class="screen">
linux_1&gt;isql my_employee
Database: my_employee
SQL&gt; show database;
Database: my_employee
   Owner: SYSDBA
Shadow 1: "/home/norman/firebird/shadow/my_employee.shd1" manual
Shadow 2: "/home/norman/firebird/shadow/my_employee.shd2" manual
 ...                
            </pre><p>
            </p><p>Во втором сеансе мы удаляем один из теневых файлов, а затем пытаемся подключиться
                к базе данных.
                </p><pre class="screen">
linux_2&gt; rm /home/norman/firebird/shadow/my_employee.shd2
linux_2&gt; isql_my_employee
Statement failed, SQLCODE = -901
lock conflict on no wait transaction
-I/O error for file "/home/norman/firebird/shadow/my_employee.shd2"
-Error while trying to open file
-No such file or directory
-a file in manual shadow 2 in unavailable
Use CONNECT or CREATE DATABASE to specify a database
SQL&gt; quit;                 
            </pre><p>
            </p><p>Второй сеанс не может подключиться к базе данных, пока проблема не будет
                устранена. Администратор баз данных может использовать команду <code class="code">gfix
                    -k[ill]</code> для удаления недоступного файла теневой копии из базы данных,
                после чего второй (и последующие) сеансы смогут подключиться.
                </p><pre class="screen">
linux_2&gt; gfix -kill my_employee
 
linux_2&gt; isql my_employee
Database: my_employee
SQL&gt; show database;
Database: my_employee
   Owner: SYSDBA
Shadow 1: "/home/norman/firebird/shadow/my_employee.shd1" manual
...                
            </pre><p>
            </p><p>База данных теперь имеет один теневой файл вместо двух. Следует отметить, однако,
                что <span class="application">gstat</span> по-прежнему показывает базу данных как имеющую
                две тени, даже если одна была удалена.</p><pre class="screen">
linux&gt; gstat -header my_employee | grep -i shadow
Shadow count 2
Attributes   active shadow, multi-user maintenance                
            </pre><div class="note"><h3 class="title">Примечание</h3><p>При соединении с локальной базой данных пользователь может не обладать правом
                    на запуск сервиса <span class="application">gfix</span>. Однако он сможет выполнить ту
                    или иную операцию, только если у него есть соответствующие права. Например, для
                    удаления теневой копии пользователь должен обладать правом на DDL-операцию DROP
                    SHADOW.</p></div></section></section><section class="section" id="gfix-buffers"><div class="titlepage"><div><div><h2 class="title" style="clear: both">Установка размера кэша базы данных</h2></div></div></div><p>Кэш базы данных — это область оперативной памяти, выделенная для хранения
            (кэширования) страниц базы данных в памяти, чтобы повысить эффективность работы с базой
            данных. Операции в оперативной памяти происходят гораздо быстрее, чем если данные
            постоянно считываются с диска.</p><p>Размер кеша указывается в страницах. Размер памяти, занимаемый кэшем, зависит от
            количества страниц кэша и размера страниц БД. </p><p>В различных архитектурах сервера страничный кэш используется по разному. В
            архитектурах Classic Server или Super Classic каждое соединение с базой данных получает
            свой собственный кэш, в то время как Super Server использует общий страничный кэш для
            всех соединений. Поэтому для архитектур Classic Server или Super Classic необходимо
            устанавливать относительно небольшой размер кэша (256-2048 страниц), в случае Super
            Server вы можете установить достаточно большой размер страничного кеша, например 100000
            и более страниц.</p><p>Установить размер кэша в заголовок базы данных можно командой:
            </p><pre class="synopsis">
gfix -b[uffers] <em class="replaceable"><code>&lt;n&gt;</code></em> <em class="replaceable"><code>database_name</code></em>            
        </pre><p>
        </p><p>Данная команда прописывает размер страничного кеша на заголовочную страницы базы
            данных. Значение на заголовочной странице перекрывает значение параметра
                <em class="parameter"><code>DefaultDbCachePages</code></em> в конфигурационных файла
                <code class="filename">databases.conf</code> и <code class="filename">firebird.conf</code>.</p><p>Минимально допустимое значение равняется 50 страницам, максимальное в 32 разрядной
            версии Firebird равен 128000 страниц, в 64 разрядной —
                    <code class="code">2<sup>31</sup> - 1</code>. Если размер страничного кеша на
            заголовочной странице установлен в 0, то страничный кеш будет размером равным значению
            параметра <em class="parameter"><code>DefaultDbCachePages</code></em> из
                <code class="filename">databases.conf</code> и <code class="filename">firebird.conf</code>. Если
            параметр <em class="parameter"><code>DefaultDbCachePages</code></em> закоментирован, то для архитектур
            Classic Server или Super Classic размер кеша будет равен 256 страниц, для Super Server —
            2048 страниц.</p><p>Это действие применяется только к указанной вами базе данных. На другие базы данных,
            работающие на том же сервере, это изменение не повлияет.</p><div class="tip"><h3 class="title">Подсказка</h3><p>Рекомендуем вам не пользоваться этой командой. В Firebird 3.0 для каждой базы вы
                можете установить индивидуальный размер страничного кэша в файле
                    <code class="filename">databases.conf</code> используя параметр
                    <em class="parameter"><code>DefaultDbCachePages</code></em>. Это позволяет сосредоточить все
                связанные параметры в одном месте.</p></div><p>В следующем примере показано использование <span class="application">gstat</span> для чтения
            текущего количества буферов, утилита <span class="application">gfix</span> используется для
            установки буферов на 4000 страниц, а <span class="application">gstat</span> используется для
            подтверждения настройки. Нулевое значение для буферов страниц указывает, что
            используется значение параметра <em class="parameter"><code>DefaultDbCachePages</code></em> из
                <code class="filename">databases.conf</code> и <code class="filename">firebird.conf</code>.</p><pre class="screen">
linux&gt; gstat -header my_employee | grep -i "page buffers"
Page buffers    0
    
linux&gt; gfix -buffers 4000 my_employee
    
linux&gt; gstat -header my_employee | grep -i "page buffers"
Page buffers 4000            
        </pre></section><section class="section" id="gfix-limbo"><div class="titlepage"><div><div><h2 class="title" style="clear: both">Управление limbo транзакциями</h2></div></div></div><p><span class="quote">«<span class="quote">Застрявшей</span>»</span> (<span class="quote">«<span class="quote">зависшей</span>»</span>, <span class="quote">«<span class="quote">in limbo</span>»</span>)
            транзакцией называют транзакцию, которая работает одновременно с двумя или более базами
            данных. При завершении такой транзакции, Firebird совершает двухфазное подтверждение
            Commit, гарантируя, что изменения будут внесены либо во все БД, либо ни в одну. При этом
            подтверждения в базах данных будут даваться по очереди. Если в это время возникнет сбой
            системы, то может получиться, что в каких то БД изменения были сделаны, а в каких то
            нет. При этом транзакция переходит в неопределенное состояние, когда сервер не знает,
            следует ли подтвердить эту транзакцию, или откатить.</p><p>Gfix предоставляет несколько команд, позволяющих управлять limbo транзакциями.</p><section class="section" id="gfix-limbo-list"><div class="titlepage"><div><div><h3 class="title">Список limbo транзакций</h3></div></div></div><p>Команда <code class="code">gfix -l[ist]</code> будет отображать сведения о limbo транзакциях.
                Если команда не выдала результата, то зависших транзакций нет, и дальнейшие действия
                не требуются. Команда выглядит следующим образом:
                </p><pre class="synopsis">
gfix -l[ist] <em class="replaceable"><code>database_name</code></em>                
            </pre><p>
            </p><p>Пример перечисления неопределенных транзакций показан ниже. Эта команда
                выполняется для локальной базы данных на сервере с именем linux, где была выполнена
                транзакция с несколькими базами данных, подключенная к базам данных
                    <code class="code">linux@my_employee</code> и <code class="code">remote:testlimbo</code>. Обе эти имени
                базы данных имеют псевдонимы в <code class="filename">databases.conf</code>.</p><pre class="screen">
linux&gt; gfix -list my_employee
Transaction 67 is in limbo.
  Multidatabase transaction:
  Host Site: linux
  Transaction 67
has been prepared.
  Remote Site: remote
  Database path: /opt/firebird/examples/testlimbo.fdb                
            </pre><p>Если команда выполняется для удаленной базы данных, то ничего не будет выведено,
                потому что в этой базе нет никаких limbo транзакций — транзакция, которая перешла в
                неопределенное (limbo) состояние, например, когда произошел сбой сети, была
                инициирована в локальной базе данных.</p><p>Эту команду можно дополнить ключом <code class="code">-pr[ompt]</code>, и тогда вам будет
                предложено выполнить Commit или Rollback для каждой обнаруженной транзакции limbo. В
                этом случае команда будет такой:
                </p><pre class="synopsis">
gfix -l[ist] -p[rompt] <em class="replaceable"><code>database_name</code></em>                
            </pre><p>
            </p><p>Пример вывода с дополнительным ключом <code class="code">-pr[ompt]</code>
                </p><pre class="screen">
linux&gt; gfix -list -prompt my_employee
Transaction 67 is in limbo.
  Multidatabase transaction:
  Host Site: linux
  Transaction 67
has been prepared.
  Remote Site: remote
  Database path: /opt/firebird/examples/testlimbo.fdb
Commit, rollback or neither (c, r, or n)?                
            </pre><p>
            </p></section><section class="section" id="d0e12163"><div class="titlepage"><div><div><h3 class="title">Подтверждение или откат</h3></div></div></div><p>При обнаружении limbo транзакции администратор базы данных имеет возможность
                зафиксировать или откатить limbo транзакцию. Если обнаружено больше одной транзакции
                в состоянии in-limbo, то администратор может подтвердить (или откатить) все limbo
                транзакции или какую-то одну, по идентификатору.
                </p><pre class="synopsis">
gfix -commit {all | <em class="replaceable"><code>&lt;ID&gt;</code></em>} <em class="replaceable"><code>database_name</code></em>
                
gfix -rollback {all | <em class="replaceable"><code>&lt;ID&gt;</code></em>} <em class="replaceable"><code>database_name</code></em>                
            </pre><p>
            </p><p>После работы этих команд <span class="application">gfix</span> не выводит никаких
                сообщений о том, что эти команды отработали. Вам нужно будет повторно запустить
                команду <code class="code">gfix -list</code>, чтобы убедиться, что limbo транзакций больше
                нет.</p><p>Вы не можете зафиксировать или откатить транзакцию, которая не находится в
                подвешенном состоянии. Если вы попытаетесь, произойдет следующее:
                </p><pre class="screen">
linux&gt; gfix -commit 388 my_employee
failed to reconnect to a transaction in database my_employee
transaction is not in limbo
-transaction 388 is active
unknown ISC error 0             
            </pre><p>
            </p><p>При фиксации или откате всех limbo транзакций можно указать опцию
                    <code class="code">-p[rompt]</code>. Однако это не разрешено при обработке одной транзакции.
                Пример использования опции <code class="code">-p[rompt]</code> был показан выше в разделе <a class="link" href="#gfix-limbo-list" title="Список limbo транзакций">Список limbo транзакций</a>.</p></section><section class="section" id="d0e12207"><div class="titlepage"><div><div><h3 class="title">Автоматическое двухфазное восстановление</h3></div></div></div><p>Gfix можно использовать для автоматического двухфазного восстановления limbo
                транзакции с идентификатором, или всех транзакций:
                </p><pre class="synopsis">
gfix -t[wo_phase] {all | <em class="replaceable"><code>&lt;ID&gt;</code></em>} <em class="replaceable"><code>database_name</code></em>               
            </pre><p>
            </p><p>При автоматическом восстановлении всех limbo транзакций можно указать опцию
                    <code class="code">-p[rompt]</code>. Однако это не разрешено при обработке одной
                транзакции.</p><div class="note"><h3 class="title">Примечание</h3><p>Так как при запуске <span class="application">gfix</span> можно указать только одну
                    пару имя пользователя/пароль, то при восстановлении зависших двухфазных
                    транзакций, которые работали с базами данных на разных серверах, логин и пароль
                    пользователя, выполняющего восстановление, должны совпадать на всех
                    серверах.</p><p>Кроме того, при использовании gfix -t все сервера и БД двухфазной транзакции
                    должны быть доступны (online).</p></div></section></section><section class="section" id="gfix-read_write_mode"><div class="titlepage"><div><div><h2 class="title" style="clear: both">Установка режима доступа для базы данных</h2></div></div></div><p>База данных может работать в одном из двух режимов доступа: только для чтения, или для
            чтения/записи (по умолчанию).</p><p>Например, если вы хотите разместить базу данных на CD, DVD или другом read-only
            носителе, у вас не получится это сделать в режиме <span class="quote">«<span class="quote">чтения-записи</span>»</span>. После
            того, как база данных будет заполнена данными, ее следует изменить в режим только для
            чтения, а затем использовать на CD диске (или других файловых системах только для
            чтения) без проблем.</p><div class="note"><h3 class="title">Примечание</h3><p>В обычном режиме (read_write) Firebird записывает информацию о транзакциях в базу
                данных, поэтому даже если вы выполняете только операторы SELECT, всё равно требуется
                чтобы базы данных была размещена в файловой системе позволяющей чтение и
                запись.</p></div><p>Для изменения режима доступа к базе данных, выполните команду:
            </p><pre class="synopsis">
gfix -mo[de] {read_only | read_write} <em class="replaceable"><code>database</code></em>            
        </pre><p>
        </p><p>В следующем примере показано, как перевести базу данных в режим только для чтения, а
            затем снова изменить ее. В примере также показано, что происходит, когда вы пытаетесь
            обновить базу данных, работая в режиме только для чтения.</p><pre class="screen">
linux&gt; gfix -mode read_only my_employee

linux&gt; isql my_employee
Database: my_employee

SQL&gt; create table test(stuff integer);
Statement failed, SQLSTATE = 42000
Dynamic SQL Error
-attempted update on read-only database

SQL&gt; quit;

linux&gt; gfix -mode read_write my_employee

linux&gt; isql my_employee
Database: my_employee

SQL&gt; create table test(stuff integer);

SQL&gt; show table test;
STUFF      INTEGER Nullable

SQL&gt; quit;            
        </pre><p>Если есть какие-либо подключения к базе данных в режиме чтения/записи, то при попытке
            преобразовать базу данных в режим только для чтения, будет выдана следующая
            ошибка.</p><pre class="screen">
linux&gt; gfix -mode read_only my_employee
lock time-out on wait transaction
-object /opt/firebird/databases/my_employee.fdb is in use

linux&gt; echo $?
0            
        </pre></section><section class="section" id="gfix-dialect"><div class="titlepage"><div><div><h2 class="title" style="clear: both">Изменение SQL диалекта</h2></div></div></div><p>Диалект базы данных — это просто термин, который определяет специфические особенности
            языка SQL, доступные при доступе к этой базе данных. В настоящее время существует три
            диалекта: </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Диалект 1 хранит информацию о дате и времени в типе данных DATE и имеет тип
                    данных TIMESTAMP, который идентичен типу DATE. Двойные кавычки используются для
                    разделения строковых данных. Точность для типов данных NUMERIC и DECIMAL меньше,
                    чем для базы данных диалекта 3, а если точность больше 9, Firebird сохраняет их
                    как DOUBLE PRECISION. INT64 не разрешен в качестве типа данных.</p></li><li class="listitem"><p>Диалект 2 доступен только при подключении клиента Firebird и не может быть
                    установлен в базе данных. Он предназначен для отладки возможных проблем с
                    устаревшими данными при переносе базы данных с диалекта 1 на 3. Этот диалект не
                    может быть установлен для базы данных с использованием
                        <span class="application">gfix</span>. </p></li><li class="listitem"><p>Базы данных диалекта 3 позволяют сохранять числа (типы данных DECIMAL и
                    NUMERIC) как INT64, если точность больше 9. Тип данных TIME может использоваться
                    и хранить только данные времени. Тип данных DATE хранит информацию о дате.
                    Двойные кавычки могут использоваться, но только для идентификаторов, которые
                    зависят от регистра, но не для строковых данных, которые должны использовать
                    одинарные кавычки.</p></li></ul></div><p>Подробнее о разнице SQL диалектов вы можете прочитать в документе <a class="link" href="https://firebirdsql.org/manual/isql-dialects.html" target="_top">SQL
            Dialects</a>.</p><p>Для изменения диалекта SQL для базы данных используется следующая команда:
            </p><pre class="synopsis">
gfix -s[ql_dialect] <em class="replaceable"><code>&lt;dialect&gt;</code></em> <em class="replaceable"><code>&lt;databasee&gt;</code></em>            
        </pre><p>
        </p><p>Параметр <code class="code"><em class="replaceable"><code>&lt;dialect&gt;</code></em></code> должен быть 1 или
            3.</p><p>В следующем примере изменяется диалект базы данных на 3, что позволит использовать
            многие новые функции SQL 92. Изменение диалекта БД не влияет на диалект уже созданных
            объектов баз данных (check constraint, view, процедуры, триггеры). Установленный для БД
            диалект будет действовать только при создании или изменении объектов БД, и разумеется,
            при выполнении SQL запросов (с клиента или execute statement).</p><pre class="screen">
linux&gt; gfix -sql_dialect 3 my_employee

linux&gt; gstat -header my_employee | grep dialect
Database dialect    3

linux&gt; gfix -sql_dialect 1 my_employee

linux&gt; gstat -header my_employee | grep dialect
Database dialect    1            
        </pre><p>Вы можете использовать команду <span class="application">isql</span>
            <code class="code">SHOW SQL DIALECT</code>, чтобы увидеть, какой диалект используют ваш клиент и база
            данных, как показано ниже:
            </p><pre class="screen">
linux&gt; isql employee -user sysdba
Database: employee, User: SYSDBA
SQL&gt; show sql dialect;
        Client SQL dialect is set to: 3 and database SQL dialect is: 3            
        </pre><p>
        </p><p>Хотя использование диалект 2 возможно на клиенте, попытка установить диалект 2 на
            сервере не удастся. Диалект 2 является тестовым диалектом для проверки перевода
            метаданных БД в третий диалект. Это показано в следующем примере.</p><pre class="screen">
linux&gt; gfix -sql_dialect 2 my_employee
Database dialect 2 is not a valid dialect.
-Valid database dialects are 1 and 3.
-Database dialect not changed.            
        </pre><p>Чтобы установить диалект 2 для использования в клиентском приложении
                <span class="application">isql</span> выполните:
            </p><pre class="screen">
linux&gt; isql my_employee
Database: my_employee

SQL&gt; set sql dialect 2;
WARNING: Client SQL dialect has been set to 2 when connecting to Database SQL dialect 3 
database.

SQL&gt; show sql dialect;
        Client SQL dialect is set to: 2 and database SQL dialect is: 3
        </pre><p>
        </p></section><section class="section" id="gfix-sweep"><div class="titlepage"><div><div><h2 class="title" style="clear: both">Чистка (sweep) базы данных</h2></div></div></div><section class="section" id="d0e12333"><div class="titlepage"><div><div><h3 class="title">Сборка мусора и sweep</h3></div></div></div><p>Многоверсионная архитектура Firebird может порождать ситуацию, когда множество
                версий строк данных хранится непосредственно на страницах базы данных. Firebird
                сохраняет старые версии при изменении или удалении записи. Версии записей, которые
                не нужны ни одной активной транзакции называются мусорными версиями. При нормальном
                ходе событий устаревшие версии записей, созданные изменёнными данными, вычищаются
                фоновой или кооперативной сборкой мусора.</p><p><span class="emphasis"><em>Кооперативная сборка</em></span> мусора возможна в любой архитектуре
                сервера. Кооперативность сборки мусора проявляется в том, что "мусорные" версии
                детектируются только при чтении этих самых версий. То есть до тех пор, пока запись с
                версиями не прочитана ни в одной транзакции, ее версии остаются на диске и как мусор
                не собираются (если, конечно, в данный момент они неактуальны, и действительно
                являются мусором).</p><p><span class="emphasis"><em>Фоновая сборка</em></span> мусора возможна только в архитектуре
                SuperServer. При обнаружении мусорных версий на странице (при чтении и обновлении)
                об этом сигнализируется потоку (thread) сборщика мусора. Сборщик мусора периодически
                собирает мусор на помеченных страницах.</p><p>В Firebird можно управлять стратегией сборки мусора. Для этого в конфигурации
                    (<code class="filename">firebird.conf</code> и <code class="filename">databases.conf</code>) есть
                параметр <em class="parameter"><code>GCPolicy</code></em>, который имеет 3 варианта: </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>background – сборщик мусора работает как фоновый, собирая мусор
                            отдельным потоком (thread);</p></li><li class="listitem"><p>cooperative – сборщик мусора работает в кооперативном режиме, собирая
                            мусор немедленно при чтении "мусорных" версий;</p></li><li class="listitem"><p>combined – сборщик мусора работает в кооперативном режиме, но если
                            мусор собрать не удается, то о "замусоренных" страницах сигнализируется
                            фоновому сборщику мусора.</p></li></ul></div><p>Чистка базы данных (sweep) является способом систематического удаления устаревших
                строк из базы данных. При старте sweep он просматривает все страницы данных и
                индексов в базе данных, и убрать все мусорные версии, существующие на текущий
                момент. А также, попытаться подвинуть <span class="quote">«<span class="quote">вверх</span>»</span> застрявшую OIT (Oldest
                Interesting Transaction, OIT — находится в любом состоянии, кроме подтвержденного.
                Возможна эта транзакция всё ещё активная или в состоянии Limbo, либо отменена). То
                есть, если кооперативная сборка мусора возникает только при чтении конкретных
                записей, то sweep — это принудительная сборка мусора во всех таблицах базы данных
                (то есть, грубо говоря, sweep это принудительное чтение всего файла БД с
                вероятностью операций записи — собственно сборки мусора).</p><p>Для чего sweep пытается собрать мусор во всей базе данных? Для того, чтобы
                подвинуть "вверх" номер Oldest Interesting Transaction (Oldest transaction в
                    <code class="code">gstat -h</code>). Дело в том, что единственные транзакции, которые
                приводят к "залипанию" Oldest на месте, это транзакции, которые завершились
                Rollback, и для которых сервер не смог отменить все изменения по сохраненным в
                памяти savepoints (это либо dead транзакции, обнаруженные после аварийного
                завершения сервера, либо объём изменений превышает ~50000 записей). То есть, пока
                все версии, созданные этой транзакцией, не будут отменены, ее состояние нельзя
                изменить в committed. А транзакции snapshot оценивают состояния конкурирующих
                транзакций и возможность модификации записей именно от Oldest transaction до Next
                transaction. Собственно, при чтении версий, номер транзакций которых меньше Oldest
                transaction, сервер даже не проверяет наличие версий, потому что таковых нет и быть
                не может, а кроме того, все транзакции меньше Oldest обязательно находятся в
                состоянии committed (т. е. их версии можно читать).</p><p>Таким образом, если в БД застревает номер Oldest transaction, то новые транзакции
                snapshot при старте будут копировать в свою локальную память всё больше и больше
                состояний транзакций (линейный массив от Oldest transaction до Next, по 2 бита на
                транзакцию). На производительность это влияет незначительно (увеличивается время
                старта таких транзакций), а вот потребление памяти может сильно возрасти,если разрыв
                Next-OT большой и приложения стартуют много транзакций snapshot. Определить, какой
                объем памяти распределяется для транзакции snapshot под состояния транзакций можно
                по формуле <code class="code">(Next - Oldest transaction)/4</code>, в байтах.</p><p>Чистка может производится в ручном и автоматическом режиме. В автоматическом
                режиме чистка запускается при достижении так называемого интервала чистки (sweep
                interval).</p><p>Интервал чистки (sweep interval) — разница между Oldest Transaction (или Oldest
                Interesting Transaction, OIT) и Oldest Snapshot Transaction (OST). По умолчанию для
                новых баз данных интервал чистки (sweep interval) равен 20000 транзакций. Посмотреть
                интервал чистки (Sweep interval) можно с помощью команды <code class="code">gstat –h</code>, если
                вывод отсутствует, то интервал чистки считается равным 20000.</p><section class="section" id="d0e12389"><div class="titlepage"><div><div><h4 class="title">Swept flag</h4></div></div></div><p>Для уменьшения объёма чтения при выполнении чистки начиная с ODS 12.0
                    (Firebird 3.0) на страницах DP (Data Page) и PP (Pointer Page) был введён swept
                    флаг. Этот флаг выставляется на странице при посещении сборщиком мусора или
                    sweep, если на ней вычищены все мусорные версии. Если на такой странице будет
                    создана новая версия, то флаг сбрасывается. При выполнении sweep проверяет
                    значение swept флага, и если он истинен (на странице нет мусора), то sweep может
                    не посещать данную страницу. Это позволяет значительно уменьшить объём
                    физического чтения с диска при повторном выполнении sweep, если, конечно, вы не
                    изменяете все страницы базы данных.</p><div class="warning"><h3 class="title">Предупреждение</h3><p>После восстановления базы данных из бэкапа утилитой gbak все страницы
                        новой базы данных будут иметь флаг swept = false. Поэтому первая же чистка
                        (sweep) базы данных прочитает и модифицирует абсолютно все страницы (будет
                        долгой).</p></div></section></section><section class="section" id="d0e12397"><div class="titlepage"><div><div><h3 class="title">Изменение sweep interval</h3></div></div></div><p>Изменить интервал чистки для конкретной базы данных можно с помощью опции
                    <code class="code">-h[ouskeeping]</code>:
                </p><pre class="synopsis">
gfix -h[ousekeeping] <em class="replaceable"><code>&lt;interfval&gt;</code></em> <em class="replaceable"><code>&lt;database&gt;</code></em>                
            </pre><p>
            </p><p>Параметр <em class="replaceable"><code>&lt;interfval&gt;</code></em> — это новое значение
                интервала чистки. В следующем примере показано изменение параметра со значения по
                умолчанию на новое значение 30000.</p><pre class="synopsis">
linux&gt; gfix -h 30000 my_employee                
            </pre><pre class="screen">
linux&gt; gstat -header my_employee | grep Sweep
Sweep interval:     30000                
            </pre></section><section class="section" id="d0e12423"><div class="titlepage"><div><div><h3 class="title">Отмена автоматического sweep</h3></div></div></div><p>Если установить интервал чистки в 0, то в этом случае автоматическая чистка
                выполняться будет.</p><p>Автоматический sweep базы данных приходит в непредсказуемые моменты. Поскольку при
                выполнении sweep будет прочитано значительное количество страниц (или даже все
                страницы) базы данных, то это может приводить к резкой просадки производительности
                при работе с базой данных во время sweep. Если вы наблюдаете подобные симптомы, то
                рекомендуем вам отключить автоматический sweep и выполнять ручной sweep по
                расписанию в период наименьшей активности базы данных.</p></section><section class="section" id="d0e12430"><div class="titlepage"><div><div><h3 class="title">Выполнение ручного sweep</h3></div></div></div><p>Администратор может запустить чистку (sweep) вручную с помощью следующей команды:
                </p><pre class="synopsis">
 gfix -s[weep]  <em class="replaceable"><code>&lt;database&gt;</code></em>                
            </pre><p>
            </p><p>В следующем примере показан запуск sweep вручную:
                </p><pre class="screen">
linux&gt; gfix -sweep my_employee                
            </pre><p>
            </p></section><section class="section" id="d0e12446"><div class="titlepage"><div><div><h3 class="title">Отслеживание запусков sweep</h3></div></div></div><p>В файл <code class="filename">firebird.log</code> пишутся события начала и окончания sweep,
                а так же ошибки которые возникли во время sweep, помешавшие его выполнению. Для
                событий начала и окончания sweep в журнал пишутся также значения счётчиков
                транзакций, которые были на этот момент.</p><p>Это позволяет отследить, успешно ли выполнена чистка (sweep), а так же
                сопоставлять связаны ли проблемы производительности с процедурой начала
                sweep.</p><p>Для события начала sweep запись в <code class="filename">firebird.log</code> выглядит
                следующим образом: </p><pre class="programlisting">

     Sweep is started by &lt;user name&gt;
     Database &lt;database name&gt;
     OIT &lt;n&gt;, OAT &lt;n&gt;, OST &lt;n&gt;, Next &lt;n&gt;
                    
                </pre><p>
            </p><p>Если sweep начался в автоматическом режиме, то в качестве имени пользователя будет
                указано SWEEPER, иначе (ручной запуск) — SYSDBA или владелец базы данных.</p><p>Для события успешного окончания sweep запись в <code class="filename">firebird.log</code>
                выглядит следующим образом: </p><pre class="programlisting">

     Sweep is finished
     Database &lt;database name&gt;
     OIT &lt;n&gt;, OAT &lt;n&gt;, OST &lt;n&gt;, Next &lt;n&gt;
                    
                </pre><p>
            </p><p>Если во время sweep произошла ошибка, в <code class="filename">firebird.log</code> будет
                записано: </p><pre class="programlisting">

     Error during sweep:
     &lt;error details&gt;
                    
                </pre><p>
            </p><p>Ниже приведён пример записей в <code class="filename">firebird.log</code> о различных
                событиях, связанных со sweep:
                </p><pre class="screen">
               

BIGSRV (Server) Wed Dec 12 15:22:05 2019
Error during sweep:deadlock

....

BIGSRV (Server)	Wed Dec 12 19:30:16 2019
	Sweep is started by SWEEPER
	Database "D:\RTDATACOLLECTOR\DATABASE\DATABASE.FDB" 
	OIT 3086403, OAT 4338117, OST 4337973, Next 4338183

.....

BIGSRV (Server)	Wed Dec 12 20:23:27 2019
	Sweep is finished
	Database "D:\RTDATACOLLECTOR\DATABASE\DATABASE.FDB" 
	OIT 4337972, OAT 4572476, OST 4572408, Next 4572596
         
           </pre><p>
            </p></section></section><section class="section" id="gfix-shutdown_online"><div class="titlepage"><div><div><h2 class="title" style="clear: both">Открытие (online) и закрытие (shutdown) базы данных</h2></div></div></div><section class="section" id="gfix-shutdown"><div class="titlepage"><div><div><h3 class="title">Закрытие (shutdown) базы данных</h3></div></div></div><p>Закрытие базы данных означает, что база данных переводится в особый режим, в
                котором к ней запрещены некоторые подключения, в зависимости от указанного
                состояния. Полноценная работа с закрытой базой данных возможна только после
                обратного ее перевода в открытый режим.</p><p>Закрытие базы данных может быть необходимо для получения монопольного доступа к
                ней и проведения действий по восстановлению структуры базы и/или хранящихся в ней
                данных.</p><p>Для закрытия базы данных используется команда <code class="code">-sh[ut]</code>. Совместно с
                этой командой указывается режим отключения существующих соединений и время ожидания
                (в секундах) до полной блокировки. При этом реального отключения соединений не
                происходит, но вся активность в них принудительно прекращается.
                </p><pre class="synopsis">
gfix -sh[ut] <em class="replaceable"><code>&lt;state&gt;</code></em> <em class="replaceable"><code>&lt;mode&gt;</code></em> <em class="replaceable"><code>timeout</code></em> <em class="replaceable"><code>database</code></em>   
                
<em class="replaceable"><code>&lt;state&gt;</code></em> ::= {full | single | multi}         
                
<em class="replaceable"><code>&lt;mode&gt;</code></em> ::= { -at[tach] | -tr[аn] | -f[orce] }                   
            </pre><p>
            </p><p>После закрытия база данных переводится в одно из следующих состояний: </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>full — в этом состоянии запрещены любые подключения, даже SYSDBA и
                            владельца базы данных. В этом случае подключение возможно только в
                            режиме embedded. Это состояние отображается в <code class="code">gstat -h</code> как
                            full shutdown; </p></li><li class="listitem"><p>multi — в этом состоянии пользователи SYSDBA и владелец базы данных
                            могут делать неограниченное количество подключений. Все остальные
                            соединения запрещены. Это состояние используется по умолчанию при
                            блокировке базы данных. Это состояние отображается в <code class="code">gstat
                                -h</code> как multi-user maintenance;</p></li><li class="listitem"><p>single — в этом состоянии пользователю SYSDBA или владельцу базы
                            данных позволено одно подключение к базе данных. Все остальные
                            соединения запрещены. Это состояние отображается в <code class="code">gstat -h</code>
                            как single-user maintenance. </p></li></ul></div><p>Закрытие базы данных может происходить в одном из следующих режимов: </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="code">-at[tach]</code> — предотвращение новых соединений;</p></li><li class="listitem"><p><code class="code">-tr[an]</code> — предотвращение старта новых транзакций;</p></li><li class="listitem"><p><code class="code">-f[orce]</code> — принудительной закрытие базы данных, с отменой
                            всех активных транзакций.</p></li></ul></div><p>
            </p><p>Далее рассмотрим эти режимы подробнее.</p><section class="section" id="d0e12568"><div class="titlepage"><div><div><h4 class="title">Предотвращение новых соединений</h4></div></div></div><p>Закрытие базы данных в режиме <code class="code">-at[tach]</code> означает, что все новые
                    соединения к базе данных запрещены. Существующие соединения при этом не
                    разрываются. Число <em class="replaceable"><code>timeout</code></em> определяет количество
                    секунд, которое сервер будет ждать до завершения всех активных соединений к базе
                    данных. Если после этого не останется ни одного активного соединения, то база
                    данных будет закрыта. В противном случае, закрытие базы данных будет
                    отменено.</p><pre class="screen">
linux&gt; gfix -shut full -attach 5 my_employee
-database shutdown unsuccessful                   
                </pre><p>Если закрытие базы данных произойдет успешно, то никаких сообщений не будет
                    выведено.</p></section><section class="section" id="d0e12583"><div class="titlepage"><div><div><h4 class="title">Предотвращение новых транзакций</h4></div></div></div><p>При указании режима <code class="code">-tra[nsaction]</code> сервер заблокирует старт новых
                    транзакций в закрываемой базе данных. Если по истечении
                        <em class="replaceable"><code>timeout</code></em> секунд к базе не останется ни одного
                    активного подключения, то база данных будет закрыта. В противном случае закрытие
                    базы данных будет отменено.</p><pre class="screen">
linux&gt; gfix -shut full -tran 5 my_employee
-database shutdown unsuccessful                      
                </pre></section><section class="section" id="d0e12596"><div class="titlepage"><div><div><h4 class="title">Принудительное закрытие базы данных</h4></div></div></div><p>При закрытии базы данных в режиме <code class="code">-fo[rce_shutdown]</code> сервер будет
                    ждать завершения всех активных соединений к базе данных. По истечении времени
                        <em class="replaceable"><code>timeout</code></em> база будет закрыта вне зависимости от
                    того, есть ли еще к ней активные соединения. В этом режиме происходит отмена
                    всех активных транзакций (перевод их состояния в rollback), и он гарантирует, в
                    отличие от двух предыдущих, что база будет переведена в закрытое
                    состояние.</p></section></section><section class="section" id="gfix-online"><div class="titlepage"><div><div><h3 class="title">Открытие (online) базы данных</h3></div></div></div><p>После выполнения всех работ по обслуживанию, необходимых для базы данных, вам
                необходимо открыть базу данных, чтобы снова разрешить ее нормальное использование.
                Перевести закрытую базу снова в открытое состояние можно только с помощью команды
                    <code class="code">-on[line]</code></p><pre class="synopsis">
gfix -on[line] <em class="replaceable"><code>&lt;state&gt;</code></em> <em class="replaceable"><code>database</code></em>   
  
<em class="replaceable"><code>&lt;state&gt;</code></em> ::= {normal | single | multi}   
            </pre><p>После выполнения команды база данных переводится в одно из следующих состояний: </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>normal — к базе данных могут подключаться любые авторизованные
                            пользователи. Этот режим используется по умолчанию при открытии базы
                            данных; </p></li><li class="listitem"><p>multi — в этом состоянии пользователи SYSDBA и владелец базы данных
                            могут неограниченно подключаться к базе данных. Все остальные соединения
                            запрещены; </p></li><li class="listitem"><p>single — в этом состоянии пользователю SYSDBA или владельцу базы
                            данных позволено одно подключение к базе данных. Все остальные
                            соединения запрещены. </p></li></ul></div><div class="note"><h3 class="title">Примечание</h3><p>Опции single и multi не переводят базу в online. Они лишь повышают уровень
                    состояния shutdown: </p><div class="itemizedlist"><ul style="list-style-type: disc; " class="itemizedlist"><li class="listitem"><p><code class="code">-online single</code> — из full до single</p></li><li class="listitem"><p><code class="code">-online multi</code> — из full или single до multi.</p></li></ul></div><p>Только команда <code class="code">-online [normal]</code> переводит БД из любого состояние
                    в открытое (online).</p></div><p>Если для команды <code class="code">gfix -online</code> указать режим, эквивалентный текущему
                или ниже, то будет выдана ошибка. Например:
                </p><pre class="screen">
C:\Firebird\3.0&gt;gfix -shutdown multi -force 0 test

C:\Firebird\3.0&gt;gfix -online multi test
Target shutdown mode is invalid for database "f:\fbdata\3.0\test.fdb"                
            </pre><p>
                В остальных случаях эта команда молча переведёт базу данных в нужный режим. </p></section></section><section class="section" id="gfix-use_space"><div class="titlepage"><div><div><h2 class="title" style="clear: both">Использование пространства страниц базы данных</h2></div></div></div><p>Обычно Firebird резервирует на страницах данных (DP — Data Page) 20% свободного
            пространства для версий и фрагментов записей. Это оптимальный режим для баз данных в
            которых происходят модификации записей.</p><p>Для использования всего доступного пространства страницы базы данных вы можете
            использовать команду <code class="code">-use full</code>. Если впоследствии вы захотите вернуться к
            режиму по умолчанию, введите команду <code class="code">-use reserve</code>, чтобы использовать
            только 80% каждой страницы.</p><pre class="synopsis">
gfix -use {full|reserve} <em class="replaceable"><code>database</code></em>             
        </pre><p>В следующем примере база данных переводится в режим использования всего доступного
            пространства на каждой странице данных базы данных:
            </p><pre class="screen">
linux&gt; gfix -use full my_employee
linux&gt; gstat -header my_employee | grep Attributes
Attributes no reserve            
        </pre><p>
        </p><p>В следующем примере возвращается использование пространства для страниц данных по
            умолчанию:
            </p><pre class="screen">
linux&gt; gfix -use reserve my_employee
linux&gt; gstat -header my_employee | grep Attributes
Attributes          
        </pre><p>
        </p><p>Если база данных находится в режиме полного использования пространства страниц, то в
            Attributes это будет отображено текстом <span class="quote">«<span class="quote">no reserve</span>»</span>. Этот текст не
            отображается для обычного режима использования 80%.</p><div class="note"><h3 class="title">Примечание</h3><p>Режим <span class="quote">«<span class="quote">no reserve</span>»</span> не годится для часто модифицируемых данных. Он
                хорошо подходит только для read-only БД. В настоящий момент не существует способа
                задать режим резервирования индивидуально для каждой таблицы.</p></div></section><section class="section" id="gfix-validate_recovery"><div class="titlepage"><div><div><h2 class="title" style="clear: both">Проверка и исправление базы данных</h2></div></div></div><section class="section" id="gfix-validate"><div class="titlepage"><div><div><h3 class="title">Проверка базы данных</h3></div></div></div><p>При некорректном завершении работы сервера, аппаратном или программном сбое
                возможно появление различных ошибок в базе данных. Проверка базы данных с помощью
                утилиты gfix поможет найти такие фрагменты в базе данных и выбрать способ
                исправления той или иной ошибки. Проверку базы данных рекомендуется производить не
                только после аппаратных или программных сбоев в работе сервера, но и при
                возникновении любой ошибки при работе с базой данных, которая не связана с
                некорректно построенным запросом или проблемами с сетью, при ошибках резервного
                копирования/восстановления, а также с определенной периодичностью в профилактических
                целях.</p><div class="note"><h3 class="title">Примечание</h3><p>Проверка базы данных требует, чтобы у вас был эксклюзивный доступ к базе
                    данных. Чтобы запретить другим пользователям доступ к базе данных во время ее
                    проверки, используйте команду <code class="code">gfix -shut</code>, чтобы <a class="link" href="#gfix-shutdown" title="Закрытие (shutdown) базы данных">закрыть базу данных</a>.</p><p>Начиная с Firebird 2.5.9 появилась возможность делать онлайн проверку базы
                    данных. Однако, в этом случае не проверяются страницы Header\PIP\TIP\Generators
                    и системные таблицы. Подробнее смотри в разделе <a class="link" href="#gfix-validate-online" title="Онлайн проверка">Онлайн проверка</a>.</p></div><p>Проверка базы данных выполняется с помощью команды
                <code class="code">-v[alidate]</code>.</p><section class="section" id="d0e12730"><div class="titlepage"><div><div><h4 class="title">Проверка в режиме по умолчанию</h4></div></div></div><p>При проверке базы данных по умолчанию выполняются следующие проверки и
                    исправления: </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>Освобождаются потерянные страницы (orphan pages). Это обновляет
                                базу данных.</p></li><li class="listitem"><p>Сообщается о страницах которые были неверно распределены.</p></li><li class="listitem"><p>Сообщается о поврежденных структурах.</p></li></ul></div><p>Результаты работы утилиты <span class="application">gfix</span> сохраняются в
                    лог-файле сервера — <code class="filename">firebird.log</code>, суммарный результат
                    проверки выводится на консоль. Если ошибок не было — на консоль ничего не
                    выводится.</p><p>Команда для проверки базы данных по умолчанию выглядит следующим образом:
                    </p><pre class="synopsis">
gfix -v[alidate] <em class="replaceable"><code>database</code></em>               
            </pre><p>
                </p><p>Эта команда проверяет базу данных, исправляет поврежденные структуры и
                    освобождает потерянные страницы (orphan pages). Потерянная страница — это
                    страница, которая была распределена, но затем не связана с другими страницами,
                    например, когда сервер был перезагружен. </p></section><section class="section" id="d0e12763"><div class="titlepage"><div><div><h4 class="title">Полная проверка</h4></div></div></div><p>По умолчанию проверка работает на уровне страниц. Для проверки и на уровне
                    страниц, и на уровне записей используйте команду:
                    </p><pre class="synopsis">
gfix -v[alidate] -full <em class="replaceable"><code>database</code></em>               
            </pre><p>
                </p><p>Эта опция обновляет базу данных и исправляет любые поврежденные
                    структуры.</p></section><section class="section" id="d0e12776"><div class="titlepage"><div><div><h4 class="title">Проверка в режиме чтения</h4></div></div></div><p>Как объяснялось выше, проверка базы данных фактически проверяет и обновляет
                    структуры базы данных, чтобы вернуть базу данных в рабочее состояние. Однако вы
                    можете не захотеть, чтобы это произошло, и в этом случае вы должны выполнить
                    проверку в режиме только чтение, которая просто сообщает о любых проблемных
                    областях и не вносит никаких изменений в базу данных.</p><p>Чтобы выполнить проверку только для чтения, просто укажите опцию
                        <code class="code">-n[o_update]</code> для любой командной строки, которую вы используете
                    для проверки. Чтобы выполнить полную проверку на уровне записей и страниц,
                    только в режиме отчета, используйте следующую команду:
                    </p><pre class="synopsis">
gfix -v[alidate] -full -n[o_update] <em class="replaceable"><code>database</code></em>               
            </pre><p>
                </p><p>Если нужно проверить базу данных только на уровне страниц, то команда будет
                    такой:
                    </p><pre class="synopsis">
gfix -v[alidate] -n[o_update] <em class="replaceable"><code>database</code></em>               
            </pre><p>
                </p></section><section class="section" id="d0e12800"><div class="titlepage"><div><div><h4 class="title">Игнорирование ошибок контрольных сумм</h4></div></div></div><p>Контрольные суммы используются для проверки целостности данных на странице.
                    Если контрольная сумма не совпадает, то возможно, произошло повреждение базы
                    данных. Вы можете запустить проверку базы данных, с игнорированием контрольных
                    сумм, используя опцию <code class="code">-i[gnore]</code>.</p><p>Эта опция может быть объединена с опцией <code class="code">-n[o_update]</code>, описанной
                    выше, и применяется как к полной проверке, так и к проверке по умолчанию. Таким
                    образом, чтобы выполнить полную проверку и игнорировать контрольные суммы в базе
                    данных, но только сообщать об ошибках, используйте следующую команду:
                    </p><pre class="synopsis">
gfix -v[alidate] -full -i[gnore] -n[o_update] <em class="replaceable"><code>database</code></em>               
            </pre><p>
                </p><p>В качестве альтернативы, можно выполнить проверку на уровне страниц, игнорируя
                    ошибки контрольных сумм, но обновляя структуры базы данных для ее исправления. В
                    этом случае команда будет такой:
                    </p><pre class="synopsis">
gfix -v[alidate] -i[gnore] <em class="replaceable"><code>database</code></em>               
            </pre><p>
                </p></section><section class="section" id="gfix-validate-online"><div class="titlepage"><div><div><h4 class="title">Онлайн проверка</h4></div></div></div><p>Проверка базы данных позволяет на низком уровне проверять согласованность
                    структур на диске и даже исправлять некоторые незначительные повреждения. Для
                    любой ценной базы данных рекомендуется процедура периодической её проверки. </p><p>Обычная проверка базы данных требует эксклюзивного доступа, что препятствует
                    проведению проверок базы данных, к которой требуется постоянный доступ
                    пользователей. Онлайн проверка позволяет выполнять некоторые проверки
                    согласованности без монопольного доступа.</p><section class="section" id="d0e12834"><div class="titlepage"><div><div><h5 class="title">Что может онлайн проверка</h5></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>проверять все или некоторые пользовательские таблицы базы
                                данных;</p></li><li class="listitem"><p>проверять все или некоторые индексы;</p></li><li class="listitem"><p>системные таблицы не проверяются.</p></li></ul></div><p>Другие проверки ODS, такие как страницы Header\PIP\TIP\Generators, не
                        выполняются.</p></section><section class="section" id="d0e12849"><div class="titlepage"><div><div><h5 class="title">Защита во время онлайн проверки</h5></div></div></div><p>Пока таблица (и/или ее индекс) проходит проверку, пользовательские
                        вложения могут читать эту таблицу. Любая попытка изменить данные
                        (INSERT\UPDATE\DELETE) будет ожидать завершения проверки или, в зависимости
                        от времени ожидания пользовательской транзакции, выдаст ошибку времени
                        ожидания блокировки.</p><p>Любая сборка мусора в таблице или ее индексах отключена, пока она проходит
                        проверку: </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>фоновая и кооперативная сборка мусора просто пропустит эту
                                    таблицу</p></li><li class="listitem"><p>чистка (sweep) будет прервана с ошибкой</p></li></ul></div><p>Когда онлайн-проверка начинает проверять таблицу, она получает несколько
                        блокировок, чтобы предотвратить одновременное изменение своих данных: </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>блокировка таблицы в режиме PR (защищенное чтение)</p></li><li class="listitem"><p>блокировка сборки мусора в режиме PW (защищенная
                                    запись)</p></li></ul></div><p>Обе блокировки получены с использованием заданного пользователем таймаута
                        блокировки. Для любого запроса блокировки, который не выполняется,
                        сообщается об ошибке, и эта таблица пропускается.</p><p>Как только блокировки получены, таблица и ее индексы проверяются так же,
                        как это делает полная проверка. Блокировки снимаются после его завершения, и
                        вся процедура повторяется для следующей таблицы.</p></section><section class="section" id="d0e12876"><div class="titlepage"><div><div><h5 class="title">Действие isc_action_svc_validate в API служб</h5></div></div></div><p>Проверка в режиме онлайн реализована в виде службы Firebird и доступна
                        через сервис API. Таким образом, его нельзя запустить из утилиты
                            <span class="application">gfix</span>.</p><p>Вызов включает в себя следующие элементы:
                        </p><pre class="literallayout">
Действие:
	isc_action_svc_validate

Параметры:
	isc_spb_dbname :
		имя файла базы данных, строка, обязательный

	isc_spb_val_tab_incl, isc_spb_val_tab_excl,
	isc_spb_val_idx_incl, isc_spb_val_idx_excl :
		шаблоны для имён таблиц\индексов, строка, необязательный

	isc_spb_val_lock_timeout :
		таймаут блокировки, целое, необязательный

Вывод:
	текстовые сообщения о прогрессе онлайн валидации
           </pre><p>
                    </p></section><section class="section" id="d0e12889"><div class="titlepage"><div><div><h5 class="title">Использование онлайн проверки в интерактивном режиме</h5></div></div></div><p>Как говорилось выше онлайн проверку нельзя запустить в приложении
                            <span class="application">gfix</span>, поскольку она доступна только через API
                        служб, однако вы можете воспользоваться утилитой
                            <span class="application">fbsvcmgr</span>. Синтаксис использования следующий:
                        </p><pre class="synopsis">
fbsvcmgr [<em class="replaceable"><code>host</code></em>:]service_mgr [user <em class="replaceable"><code>&lt;username&gt;</code></em>] [password <em class="replaceable"><code>&lt;password&gt;</code></em>]
	action_validate dbname <em class="replaceable"><code>&lt;filename&gt;</code></em>
	[val_tab_incl <em class="replaceable"><code>&lt;pattern&gt;</code></em>]
	[val_tab_excl <em class="replaceable"><code>&lt;pattern&gt;</code></em>]
	[val_idx_incl <em class="replaceable"><code>&lt;pattern&gt;</code></em>]
	[val_idx_excl <em class="replaceable"><code>&lt;pattern&gt;</code></em>]
	[val_lock_timeout <em class="replaceable"><code>&lt;number&gt;</code></em>]                        
                    </pre><p>
                    </p><div class="table" id="d0e12930"><div class="table-title">Таблица 8.2. Опции онлайн проверки</div><div class="table-contents"><table style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; "><colgroup><col class="c1"/><col class="c2"/></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">Опция</th><th style="border-bottom: 1px solid ; ">Описание</th></tr></thead><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
                                        <code class="code"><em class="replaceable"><code>host</code></em></code>
                                    </td><td style="border-bottom: 1px solid ; "><p>Имя удалённого хоста на котором находится
                                            проверяемая база данных.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="code">user
                                            <em class="replaceable"><code>&lt;username&gt;</code></em></code></td><td style="border-bottom: 1px solid ; "><p>Имя пользователя.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="code">password
                                                <em class="replaceable"><code>&lt;password&gt;</code></em></code></td><td style="border-bottom: 1px solid ; "><p>Пароль.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="code">dbname
                                            <em class="replaceable"><code>&lt;filename&gt;</code></em></code></td><td style="border-bottom: 1px solid ; "><p>Путь к первичному файлу базы данных или его
                                            псевдониму.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="code">val_tab_incl
                                                <em class="replaceable"><code>&lt;pattern&gt;</code></em></code></td><td style="border-bottom: 1px solid ; "><p>Шаблон для имён таблиц включённых в процедуру
                                            проверки.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="code">val_tab_excl
                                                <em class="replaceable"><code>&lt;pattern&gt;</code></em></code></td><td style="border-bottom: 1px solid ; "><p>Шаблон для имён таблиц исключённых из процедуры
                                            проверки.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="code">val_idx_incl
                                                <em class="replaceable"><code>&lt;pattern&gt;</code></em></code></td><td style="border-bottom: 1px solid ; "><p>Шаблон для имён индексов включённых в процедуру
                                            проверки, по умолчанию <code class="code">%</code>, то есть все
                                            индексы.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="code">val_idx_excl
                                                <em class="replaceable"><code>&lt;pattern&gt;</code></em></code></td><td style="border-bottom: 1px solid ; "><p>Шаблон для имён индексов исключённых из процедуры
                                            проверки.</p></td></tr><tr><td style="border-right: 1px solid ; "><code class="code">val_lock_timeout
                                                <em class="replaceable"><code>&lt;number&gt;</code></em></code></td><td><p>Таймаут блокировки, используемый для получения
                                            блокировок для проверки таблицы. Измеряется в секундах.
                                            По умолчанию — 10 секунд. 0 — нет ожидания, -1 —
                                            бесконечное ожидание.</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="note"><h3 class="title">Замечания по использованию</h3><p>
                            </p><div class="itemizedlist"><ul style="list-style-type: disc; " class="itemizedlist"><li class="listitem"><p>Шаблоны — это регулярные выражения, которые обрабатываются
                                        по тем же правилам, что и выражения SIMILAR TO.</p></li><li class="listitem"><p>Все шаблоны чувствительны к регистру, независимо от
                                        диалекта базы данных.</p></li><li class="listitem"><p>Если шаблон для таблиц не указан, то все пользовательские
                                        таблицы будут проверены.</p></li><li class="listitem"><p>Если шаблон для индексов не указан, то все индексы для
                                        указанных таблиц будут проверены.</p></li><li class="listitem"><p>Системные таблицы не проверяются.</p></li></ul></div><p>
                        </p><p>Чтобы указать список таблиц: </p><div class="itemizedlist"><ul style="list-style-type: disc; " class="itemizedlist"><li class="listitem"><p>Разделяйте имена с помощью символа <span class="quote">«<span class="quote">|</span>»</span></p></li><li class="listitem"><p>Не добавляйте пробелы: <code class="code">TAB1 | TAB2</code> — это
                                        ошибка</p></li><li class="listitem"><p>Заключите весь список в двойные кавычки, чтобы не запутать
                                        интерпретатор команд</p></li></ul></div></div><section class="simplesect" id="d0e13067"><div class="titlepage"><div><div><h6 class="title">Примеры</h6></div></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Проверка всех таблиц в базе данных
                                        <code class="filename">c:\db.fdb</code> с именами, начинающимися с
                                        <span class="quote">«<span class="quote">A</span>»</span>. Индексы не проверяются. Ожидание
                                    блокировки не выполняется.</p><pre class="synopsis">
fbsvcmgr.exe service_mgr user SYSDBA password masterkey
		action_validate dbname c:\db.fdb
		val_tab_incl A%
		val_idx_excl %
		val_lock_timeout 0                                    
                                </pre></li><li class="listitem"><p>Проверка таблиц TAB1 и TAB2 и всех их индексов. Тайм-аут
                                    ожидания блокировки составляет 10 секунд (по умолчанию):</p><pre class="synopsis">
fbsvcmgr.exe service_mgr user SYSDBA password masterkey
		action_validate dbname c:\db.fdb
		val_tab_incl "TAB1|TAB2"                                    
                                </pre></li><li class="listitem"><p>Поведение по умолчанию для параметров <code class="code">val_XXX</code>:
                                    проверка всех пользовательских таблиц и их индексов в базе
                                    данных <span class="quote">«<span class="quote">c:\db.fdb</span>»</span>, ожидание блокировки по
                                    умолчанию — 10 секунд:</p><pre class="synopsis">
fbsvcmgr.exe service_mgr user SYSDBA password masterkey
               action_validate dbname c:\db.fdb                                    
                                </pre></li></ol></div></section></section></section></section><section class="section" id="d0e13098"><div class="titlepage"><div><div><h3 class="title">Восстановление базы данных</h3></div></div></div><p>Если проверка базы данных, описанная выше, ничего не выводит, то структуры базы
                данных можно считать действительными. Если же в ходе проверки базы данных, были
                найдены ошибки, то можно попытаться исправить базу данных. </p><section class="section" id="d0e13103"><div class="titlepage"><div><div><h4 class="title">Удаление поврежденных структур данных</h4></div></div></div><p>Команда <code class="code">gfix -m[end]</code> помечает поврежденные структуры как
                    неиспользуемые. Однако и она не в состоянии исправить все ошибки и может
                    привести к потере данных (поврежденных записей). Команда выглядит следующим
                    образом:
                    </p><pre class="synopsis">
gfix -m[end] <em class="replaceable"><code>database</code></em>               
            </pre><p>
                </p><p>Выполнение этой команды приводит к тому, что записи с повреждениями будут
                    удалены. Последующие действия с базой данных (например, создание резервной
                    копии) не будут включать поврежденные записи.</p><div class="important"><h3 class="title">Важно</h3><p>Лучший способ избежать потери данных — регулярно делать резервное
                        копирование и проверять копии на возможность восстановления. При попытке
                        исправить поврежденную базу данных всегда работайте с копией основного
                        файла, а не с оригиналом. Использование опции <code class="code">-mend</code> может
                        привести к автоматическому удалению поврежденных данных, потому что
                            <span class="application">gfix</span> не заботится о внутренних ограничениях
                        базы данных, таких как внешние ключи и других.</p></div></section><section class="section" id="d0e13128"><div class="titlepage"><div><div><h4 class="title">Сторонние инструменты и сервисы для расширенного восстановления</h4></div></div></div><p>Если <span class="application">gfix</span> не может исправить поврежденную базу
                    данных, то доступны <a class="link" href="https://firebirdsql.org/en/third-party-tools#rec" target="_top">сторонние
                        инструменты</a> для восстановления баз данных Firebird.</p></section></section></section><section class="section" id="d0e13139"><div class="titlepage"><div><div><h2 class="title" style="clear: both">Изменение режима записи на диск</h2></div></div></div><p>Многие операционные системы применяют кеширование операций ввода-вывода. При этом для
            буферизации используется некоторый объем быстрой памяти (который может быть как частью
            оперативной памяти сервера, так и специальной памятью, встроенной в сам диск). Это
            повышает производительность приложений, их интенсивность записи, но пользователь не
            будет уверен, когда его данные будут записаны на физический диск.</p><p>При работе с базой данных крайне желательно, чтобы данные были безопасно сохранены. В
            Firebird можно указать должны ли данные сразу записываться на физический диск по commit
            или в отложенном режиме (ОС сама решит когда записать).</p><p>Для изменения режима записи на диск используется следующая команда:
            </p><pre class="synopsis">
gfix -write <em class="replaceable"><code>&lt;mode&gt;</code></em> <em class="replaceable"><code>database</code></em>

<em class="replaceable"><code>&lt;mode&gt;</code></em> ::= {sync | async}
        </pre><p>
        </p><p>Параметр <em class="replaceable"><code>mode</code></em> указывает в каком режиме буду записываться
            данные: </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>sync — данные записываются синхронно (Forced writes). Это означает, что
                        данные записываются на диск в COMMIT. Это наиболее безопасно для ваших
                        данных. </p></li><li class="listitem"><p>async — данные записываются асинхронно. Операционная система контролирует,
                        когда данные фактически записываются на диск.</p></li></ul></div><p>По умолчанию, все БД работают с включенным Forced Writes (sync) и отключать этот режим
            не рекомендуется. Если все же вы не удовлетворены производительностью БД, и при этом
            стопроцентно уверены в своем серверном оборудовании, можете попробовать отключить Forced
            Writes.</p><p>Команда <code class="code">gstat -h</code> отображает режим sync как Forced Writes в строке
            Attributes, режим async никак не отображается.
            </p><pre class="screen">
C:\Firebird\3.0&gt;gstat -h test | grep Attributes
STDIN
        Attributes              force write

C:\Firebird\3.0&gt;gfix -user sysdba -password masterkey -write async test

C:\Firebird\3.0&gt;gstat -h test | grep Attributes
STDIN
        Attributes            
        </pre><p>
        </p></section><section class="section" id="d0e13182"><div class="titlepage"><div><div><h2 class="title" style="clear: both">Исправление базы данных для работы с текущей версией ICU</h2></div></div></div><p>Если база данных была создана на севере с одной версии библиотеки ICU, а затем
            перенесена на другой сервер с другой версией ICU, то в ряде случае могут возникать
            проблемы при использовании сопоставлений (COLLATION), зависимых от ICU. Такой случай
            описан в билете <a class="link" href="http://tracker.firebirdsql.org/browse/CORE-4571" target="_top">CORE-4571</a>. Для решения этой проблемы в gfix существует команда -icu.</p><pre class="synopsis">
gfix -icu <em class="replaceable"><code>icu_version</code></em> <em class="replaceable"><code>database</code></em>            
        </pre><p>Данная команда обновляет сопоставления (COLLATION), зависимые от ICU, и перестраивает
            зависимые индексы. </p></section><section class="section" id="d0e13200"><div class="titlepage"><div><div><h2 class="title" style="clear: both">Информация о версии</h2></div></div></div><p>Опция <code class="code">-z</code> для <span class="application">gfix</span> просто выводит версию
            программного обеспечения Firebird, которое вы используете. Она не принимает параметров,
            как показано в следующем примере
            </p><pre class="screen">
C:\Firebird\3.0&gt;gfix -z
gfix version WI-V3.0.6.33254 Firebird 3.0            
        </pre><p>
        </p></section></section><section xml:lang="ru" class="chapter" id="gstat"><div class="titlepage"><div><div><h2 class="title">Глава 9. Утилита GSTAT</h2></div></div></div><a id="d0e13219" class="indexterm"/><p><span class="application">gstat</span> — это одна из утилит базы данных, поставляемых с
        Firebird. Она используется для отображения статистических данных о содержимом базы данных.
        Утилита <span class="application">gstat</span> не подключается к базе данных, как это делают
        другие утилиты, вместо этого она открывает файлы базы данных напрямую и считывает
            <span class="quote">«<span class="quote">сырые</span>»</span> данные. Из-за этого <span class="application">gstat</span> не использует
        транзакции, и некоторая статистика, которую он собирает, может включать данные, которые были
        удалены, например, обычными транзакциями базы данных.</p><p>Утилита <span class="application">gstat</span> возвращает информацию о дате создания базы
        данных, размере страниц базы данных, количестве теневых копий, таблицах, индексах и
        другую.</p><p>Запуск <span class="application">gstat</span> осуществляется следующим образом:
        </p><pre class="synopsis">
gstat [<em class="replaceable"><code>&lt;options&gt;</code></em>] <em class="replaceable"><code>&lt;database&gt;</code></em>            
        </pre><p>
        или
        </p><pre class="synopsis">
gstat <em class="replaceable"><code>&lt;database&gt;</code></em> [<em class="replaceable"><code>&lt;options&gt;</code></em>]           
        </pre><p>
    </p><div class="note"><h3 class="title">Примечание</h3><p>Утилита <span class="application">gstat</span> должна запускаться от имени пользователя
                <span class="emphasis"><em>root</em></span> или пользователя <span class="emphasis"><em>firebird</em></span>. Это
            связано с тем, что разрешения операционной системы по умолчанию при создании новой базы
            данных таковы, что только владелец — <span class="emphasis"><em>firebird</em></span> — имеет доступ к
            файлам базы данных. Даже члены группы <span class="emphasis"><em>firebird</em></span> по умолчанию не
            имеют доступа для чтения.</p></div><p>Имя базы данных <em class="replaceable"><code>&lt;database&gt;</code></em> не может быть удаленной базой
        данных, оно должно быть локальным, но это может быть псевдоним для локальной базы данных.
        Причина, по которой оно должно быть локальным, заключается в том, что
            <span class="application">gstat</span> работает на физическом уровне файлов, а не
        устанавливает соединение сервером базы данных — она читает файл базы данных напрямую.</p><div class="note"><h3 class="title">Примечание</h3><p>Вы всё же можете получать статистику базы данных удалено, используя Service API. В
            Firebird существует консольная утилита FBSVCMGR для доступа к различным службам,
            использующим Service API.</p></div><p>Если <span class="application">gstat</span> вызывается с неверным переключателем или с
        переключателем <code class="code">-?</code>, то будет отображена справка по существующим переключателям.
        К сожалению, отображается только краткая форма переключателей.</p><pre class="synopsis">
gstat -?        
    </pre><pre class="screen">
        
usage:   gstat [options] &lt;database&gt; or gstat &lt;database&gt; [options]
Available switches:
    -a      analyze data and index pages
    -d      analyze data pages
    -e      analyze database encryption
    -h      analyze header page ONLY
    -i      analyze index leaf pages
    -s      analyze system relations in addition to user tables
    -u      username
    -p      password
    -fetch  fetch password from file
    -r      analyze average record and version length
    -t      tablename &lt;tablename2...&gt; (case sensitive)
    -role   SQL role name
    -z      display version number
option -t accepts several table names only if used after &lt;database&gt;  

    </pre><div class="table" id="d0e13304"><div class="table-title">Таблица 9.1. Переключатели командной строки</div><div class="table-contents"><table style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; "><colgroup><col class="c1"/><col class="c2"/></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">Опция</th><th style="border-bottom: 1px solid ; ">Описание</th></tr></thead><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="code">-a[ll]</code></td><td style="border-bottom: 1px solid ; "><p>Это переключатель по умолчанию, он эквивалентен <code class="code">-h[eader]
                                -d[ata] -i[ndex]</code>.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="code">-d[ata]</code></td><td style="border-bottom: 1px solid ; "><p>Получение статистики о данных всех или только указанных таблиц.
                            Пользовательские индексы, системные таблицы и системные индексы не
                            анализируются. Версии записей не анализируются.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="code">-e[cryption]</code></td><td style="border-bottom: 1px solid ; "><p>Анализ шифрования базы данных.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="code">-h[eader]</code></td><td style="border-bottom: 1px solid ; ">
                        <p>Этот переключатель отображает статистику о самой базе данных, а затем
                            завершает работу. Информация заголовка также отображается при
                            использовании любого другого переключателя, поэтому вы всегда получаете
                            подробные данные заголовка базы данных в своем выводе.</p>
                    </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="code">-i[ndex]</code></td><td style="border-bottom: 1px solid ; ">
                        <p>Указание этого параметра заставляет gstat анализировать каждый
                            пользовательский индекс в указанной базе данных. Пользовательские
                            таблицы, системные индексы и системные таблицы не анализируются. Если
                            указан переключатель <code class="code">-t</code>, то анализируются только индексы
                            указанных таблиц.</p>
                    </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="code">-s[ystem]</code></td><td style="border-bottom: 1px solid ; ">
                        <p>Этот переключатель является модификатором и изменяет выходные данные
                            переключателей <code class="code">-d[ata]</code> или <code class="code">-i[ndex]</code>, включая
                            системные таблицы (или индексы) в дополнение к пользовательским таблицам
                            (или индексам). Использование этого переключателя само по себе
                            эквивалентно вызову <span class="application">gstat</span> с указанным
                            параметром <code class="code">-a[ll] -s[ystem]</code>.</p>
                        <p>При запуске этот переключатель отображает статистику для различных
                            таблиц и индексов RDB$ и MON$.</p>
                    </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="code">-u[sername]
                        <em class="replaceable"><code>&lt;username&gt;</code></em></code></td><td style="border-bottom: 1px solid ; "><p>Позволяет указать имя пользователя: SYSDBA или пользователя
                            владельца базы данных. Его не нужно указывать, если переменная среды
                            ISC_USER существует и имеет правильное значение, или если вы вошли на
                            сервер под привилегированной учетной записью (root,
                        firebird).</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="code">-p[assword]
                        <em class="replaceable"><code>&lt;password&gt;</code></em></code></td><td style="border-bottom: 1px solid ; "><p>Предоставляет пароль для имени пользователя, указанного
                            выше.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="code">-fetch
                            {<em class="replaceable"><code>&lt;filename&gt;</code></em>|stdin|/dev/tty}</code></td><td style="border-bottom: 1px solid ; "><p>Этот переключатель заставляет читать пароль из файла, а не
                            использовать тот, что указан в командной строке. Указанное имя файла не
                            должно быть в кавычках и должно быть доступно для чтения пользователю,
                            выполняющему <span class="application">gstat</span>. Если имя файла указано
                            как stdin, то пользователю будет предложено ввести пароль. В системах
                            POSIX имя файла <code class="filename">/dev/tty</code> также приведет к запросу
                            пароля.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="code">-r[ecord]</code></td><td style="border-bottom: 1px solid ; ">
                        <p>Ключ <code class="code">-r[ecord]</code> является модификатором для ключей
                                <code class="code">-d[ata]</code> и <code class="code">-s[ystem]</code>. Он добавляет данные о
                            средней длине записи и версии для любых проанализированных таблиц данных
                            (пользовательских и/или системных). Этот ключ не влияет на ключ
                                <code class="code">-i[ndex]</code>.</p>
                    </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="code">-t[able] <em class="replaceable"><code>&lt;tablename&gt;</code></em> [...
                                <em class="replaceable"><code>&lt;tablename&gt;</code></em>]</code></td><td style="border-bottom: 1px solid ; ">
                        <p>Этот переключатель позволяет анализировать таблицу или список таблиц,
                            а также любые индексы, принадлежащие указанным таблицам. Посмотрите
                            раздел предостережений ниже для некоторых потенциальных проблем с этим
                            переключателем и примером того, как его следует использовать.</p>
                        <p>За переключателем <code class="code">-t[able]</code> должен следовать список имен
                            таблиц, которые вы хотите проанализировать. Список должен быть в верхнем
                            регистре, и каждая таблица разделена пробелом. Также можно использовать
                            двойные кавычки, чтобы <span class="application">gstat</span> анализировал
                            таблицу, имя которой не указано в верхнем регистре.</p>
                        <p>Нет необходимости указывать ключ <code class="code">-i[ndex]</code>, так как любые
                            индексы в указанных таблицах будут проанализированы. Информация
                            заголовка базы данных также отображается.</p>
                    </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="code">-role <em class="replaceable"><code>&lt;rolename&gt;</code></em></code></td><td style="border-bottom: 1px solid ; "><p>Позволяет указать имя роли. Роль должна быть выдана пользователю
                            указанному в переключателей <code class="code">-u[sername]</code>.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="code">-tr</code></td><td style="border-bottom: 1px solid ; "><p>Использовать доверительную аутентификацию</p></td></tr><tr><td style="border-right: 1px solid ; "><code class="code">-z</code></td><td><p>Это переключатель модификатор. Использование <code class="code">-z</code>
                            отображает номер версии утилиты <span class="application">gstat</span> и
                            сервера Firebird. Вы должны указать правильное имя базы данных и,
                            возможно, другой параметр. Этот переключатель добавляет информацию о
                            версии <span class="application">gstat</span> и Firebird к выводу другого
                            переключателя, который вы указали, или по умолчанию, если вы его не
                            указали. Если все, что вам нужно, это информация о версии, то самый
                            короткий вывод будет если указать в переключателе <code class="code">-t</code> не
                            существующую таблицу.</p>
                    </td></tr></tbody></table></div></div><br class="table-break"/><section class="section" id="d0e13510"><div class="titlepage"><div><div><h2 class="title" style="clear: both">gstat примеры и интерпретация</h2></div></div></div><p>В этом разделе обсуждаются частые примеры использования сбора статистики и объясняется
            вывод утилиты.</p><section class="section" id="d0e13515"><div class="titlepage"><div><div><h3 class="title">Статистика заголовочной страницы</h3></div></div></div><p>Запустив утилиту gstat с ключом <code class="code">-h[eader]</code> можно получить статистические данные о
                заголовочной странице указанной базы данных. Часть информации является статичной,
                часть — меняется в зависимости от происходящих в базе данных изменений. Пример
                информации с заголовочной страницы приводится ниже:</p><pre class="synopsis">
gstat employee -header                
            </pre><pre class="screen">
Database "C:\Firebird\3.0\examples\empbuild\employee.fdb"
Gstat execution time Sun Feb  9 12:45:13 2020

Database header page information:
        Flags                   0
        Generation              183
        System Change Number    3
        Page size               8192
        ODS version             12.0
        Oldest transaction      161
        Oldest active           162
        Oldest snapshot         162
        Next transaction        165
        Sequence number         0
        Next attachment ID      25
        Implementation          HW=AMD/Intel/x64 little-endian OS=Windows CC=MSVC
        Shadow count            0
        Page buffers            0
        Next header page        0
        Database dialect        3
        Creation date           Jan 31, 2020 12:42:02
        Attributes              force write

    Variable header data:
        Database backup GUID:   {B71E712F-377B-4526-5AB2-2B21879F2097}
        Sweep interval:         20000
        *END*
Gstat completion time Sun Feb  9 12:45:13 2020               
            </pre><p> Первая строка вывода отображает имя файла(ов) и путь к базе данных. Это может
                быть полезно, если задан псевдоним базы данных, и необходимо точно определить, где
                находится база данных. Поскольку база данных сотрудников является однофайловой,
                отображается только один файл. Если бы это была многофайловая база данных, конец
                перечисленного выше выглядел бы следующим образом:</p><pre class="screen">
...
    Variable header data:
        Continuation file:       C:\Firebird\3.0\examples\empbuild\employee_multy.fdb1
        Last logical page:       162                
            </pre><p>Описание различных полей заголовка описаны ниже.</p><p><span class="bold"><strong>Flags</strong></span> — это набор флагов, определяющий важные
                особенности поведения базы данных. Флаги устанавливаются только с помощью
                специальных инструментов вроде <span class="application">gfix</span>, изменять флаги с
                помощью других инструментов опасно — это может привести к порче базы данных. </p><p>Надо сказать, что при получении статистики показывается, что значение параметра
                    <span class="bold"><strong>Flags</strong></span> всегда равно нулю, вне зависимости от
                установленных флагов.</p><p><span class="bold"><strong>Generation</strong></span> — это счетчик, который увеличивается
                на единицу всякий раз, когда заголовочная страница записывается на диск.</p><p><span class="bold"><strong>System Change Number</strong></span> — маркер (число от 0 до 3),
                которым помечаются страницы базы данных при создании инкрементных копий с помощью
                утилиты nbackup. Nbackup выполняет резервное копирование страниц базы данных,
                копируя страницы, которые были изменены с момента последней резервной копии
                непосредственно предшествующего уровня. Если делается резервная копия уровня 0,
                копируются все страницы, а если уровня 1 — копируются только те страницы, которые
                были изменены после последнего уровня 0. Чтобы иметь возможность находить измененные
                страницы, Firebird использует маркер, который называется SCN. Это число
                увеличивается при каждом изменении состояния резервной копии и не зависит от уровня
                резервного копирования.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>0 — страницы перед резервным копированием; </p></li><li class="listitem"><p>1 — страницы, записанные в дельта-файл во время резервного копирования;
                    </p></li><li class="listitem"><p>2 — страницы, записанные во время слияния дельта-файла с основной
                        резервной копией;</p></li><li class="listitem"><p>3 — страницы, записанные после окончания первого бэкапа и слияния. </p></li></ul></div><p>Резервное копирование и восстановление с помощью <span class="application">gbak</span>
                не восстанавливает содержимое таблицы <span class="database">RDB$BACKUP_HISTORY</span> и
                сбрасывает SCN всех страниц обратно на 0. Таким образом, восстановление с помощью
                    <span class="application">gbak</span> перепишет всю базу данных (и может даже изменить
                размер страницы). Это делает предыдущие резервные копии с помощью
                    <span class="application">nbackup</span> бессмысленными в качестве отправной точки для
                последующих резервных копий: нужно начать заново с уровня 0.</p><p><span class="bold"><strong>Page size</strong></span> — размер страницы базы данных,
                исчисляется в байтах. Все файлы одной базы данных состоят из страниц одинакового
                размера, который устанавливается при создании базы данных и при восстановлении базы
                данных из резервной копии. Множество важнейших параметров сервера зависят от размера
                страницы — например, кеш базы данных. Рекомендуют создавать базу данных с размером
                страниц не менее 4096 байт, а лучше 8192 или 16384 байта.</p><p><span class="bold"><strong>ODS version</strong></span> – версия структуры базы данных на
                диске (On-Disk Structure). Представляет собой два числа, разделенные точкой. "Целая"
                часть — это основная версия ODS, которая зависит от версии сервера, создавшего
                данную базу данных. Главная версия определяет основные возможности работы с базой
                данных, и ее значение присваивается при создании (восстановлении) базы данных.
                "Дробная" часть (после точки) — это минорная версия ODS.</p><p>Значения, которые вы можете увидеть здесь:</p><p>
                </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>10.0 — Firebird 1.0;</p></li><li class="listitem"><p>10.1 — Firebird 1.5;</p></li><li class="listitem"><p>11.0 — Firebird 2.0;</p></li><li class="listitem"><p>11.1 — Firebird 2.1;</p></li><li class="listitem"><p>11.2 — Firebird 2.5;</p></li><li class="listitem"><p>12.0 — Firebird 3.0;</p></li><li class="listitem"><p>13.0 — Firebird 4.0.</p></li></ul></div><p>
            </p><p><span class="bold"><strong>Детали транзакций</strong></span>: </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><span class="bold"><strong>Oldest transaction</strong></span> — идентификатор
                            старейшей заинтересованной транзакции в базе данных (Oldest Interesting
                            Transaction или OIT). Первая транзакция с состоянием, отличным от
                            commit. На практике это: </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>Oldest Active Transaction;</p></li><li class="listitem"><p>номер самой старой транзакции, завершенной "настоящим"
                                        rollback (выполняется если пользователь в одной транзакции
                                        модифицировал более 100000 записей); </p></li><li class="listitem"><p>транзакция в состоянии in-limbo (полузавершенная)
                                        двухфазного commit. </p></li></ul></div><p>Значение этого параметра часто сравнивается с Oldest active. Разница
                            этих параметров влияет на автоматический запуск sweep.</p></li><li class="listitem"><p><span class="bold"><strong>Oldest active</strong></span> — старейшая транзакция,
                            которую пользователь стартовал, и до сих пор не завершил по commit или
                            rollback (Oldest Active Transaction или OAT). </p></li><li class="listitem"><p><span class="bold"><strong>Oldest snapshot</strong></span> — номер последней
                            транзакции snapshot, которая влияет на процесс сборки мусора (Oldest
                            Snapshot Transaction или OST). OST — это старейший <span class="quote">«<span class="quote">номер
                                snapshot</span>»</span> для всех активных транзакций. Транзакция
                                <span class="emphasis"><em>read-only, read committed</em></span> не имеет
                                <span class="quote">«<span class="quote">номера snapshot</span>»</span>. Транзакция <span class="emphasis"><em>read-write,
                                read committed</em></span> имеет <span class="quote">«<span class="quote">номер snapshot</span>»</span> равный
                            своему собственному номеру. Для транзакции snapshot <span class="quote">«<span class="quote">номер
                                snapshot</span>»</span> — это номер Oldest Active Transaction на момент ее
                            старта. Номер Oldest Snapshot Transaction обновляется, когда стартует
                            новая транзакция (или выполняется commit retaining) или когда стартует
                            sweep. Транзакции с таким или большим номер не подлежат сборке
                            мусора.</p></li><li class="listitem"><p><span class="bold"><strong>Next transaction</strong></span> — это просто номер,
                            который будет присвоен следующей транзакции при её старте.</p></li></ul></div><p>Если вы заметили, что разница между OAT и Next transaction постоянно
                увеличивается, значит какие-то транзакции не подтверждаются должным образом и
                следовательно может накапливаться все большее число мусорных записей. В конце концов
                вы увидите, что время запуска базы данных увеличивается, а производительность
                падает. Если разница между OIT и OAT велика, значит sweep не запускался в
                автоматическом или ручном режиме. В таком случае возможно следует запустить
                    <span class="application">gfix</span> для сборки мусора вручную.</p><p>
                <span class="bold"><strong>Sequence number</strong></span> — порядковый номер файла базы
                данных. Для базы данных, состоящей из одного файла, он всегда равен нулю. Второй
                файл в базе данных будет иметь номер 1 и так далее. </p><p><span class="bold"><strong>Next attachment ID</strong></span> — номер следующего соединения
                к этой базе данных. Каждый раз, когда приложение подключается к базе данных, это
                число увеличивается на один. Запуск и завершение работы базы данных также
                увеличивает этот номер. Запуск <span class="application">gstat</span> не изменяет этот
                идентификатор.</p><p>
                <span class="bold"><strong>Implementation</strong></span> — аппаратная архитектура, на которой
                была создана база данных.</p><p><span class="bold"><strong>Shadow count</strong></span> — количество файлов теневых копий,
                которые определены для данной базы данных.</p><p><span class="bold"><strong>Page buffers</strong></span> — размер кэша базы данных в
                страницах. Ноль означает, что база данных использует значение параметра
                    <em class="parameter"><code>DefaultDbCachePages</code></em> из файла конфигурации
                    (<code class="filename">firebird.conf</code> или
                <code class="filename">databases.conf</code>).</p><p><span class="bold"><strong>Next header page</strong></span> — номер следующей заголовочной
                страницы. Всегда равен нулю. Собственно говоря, любая страница в базе данных имеет
                ссылку на номер следующей страницы такого же типа,но так как заголовочная страница
                всегда единственная в каждом файле базы данных, то у нее эта ссылка обнулена.</p><p><span class="bold"><strong>Database dialect</strong></span> — диалект SQL базы
                данных.</p><p><span class="bold"><strong>Creation date</strong></span> — дата создания базы данных или
                последнего восстановления из резервной копии.</p><p><span class="bold"><strong>Attributes</strong></span> — различные атрибуты базы данных.
                Возможны следующий значения: </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>forced write — режим принудительной записи включен (forced write
                            on).</p></li><li class="listitem"><p>no reserve — указывает, что на страницах не резервируется место для
                            старых версий данных. Это позволяет более плотно упаковывать данные на
                            каждой странице, в силу чего база данных занимает меньше дискового
                            пространства. Это хорошо для баз данных только для чтения, однако
                            негативно отражается на базах данных в которых необходимо производить
                            обновления или удаление записей.</p></li><li class="listitem"><p>read only — база данных работает в режиме Read Only. Если флаг не
                            установлен, то допустимы как чтение, так и запись.</p></li><li class="listitem"><p>multi-user maintenance — база данных блокирована в режиме multi.
                            Множество соединений разрешены только для SYSDBA или владельца базы
                            данных.</p></li><li class="listitem"><p>single-user maintenance — база данных блокирована в режиме single.
                            Только одно соединение разрешено для SYSDBA или владельца базы
                            данных.</p></li><li class="listitem"><p>full shutdown — база данных блокирована в режиме full.</p></li><li class="listitem"><p>backup lock — Основной файл базы данных временно заблокирован.
                            Изменения фиксируются во временном файле дельты.</p></li><li class="listitem"><p>backup merge — Объединение файла дельты с основным файлом базы
                            данных.</p></li></ul></div><p><span class="bold"><strong>Variable header data</strong></span> — переменные данные
                заголовочной страницы. Эта часть отчета охватывает информацию, которой нет в
                фиксированной части заголовка базы данных. Например, интервал очистки (sweep
                interval), GUID базы даных, GUID последней резервной копии и другое.</p></section><section class="section" id="d0e13754"><div class="titlepage"><div><div><h3 class="title">Анализ всей базы данных</h3></div></div></div><p>Если не заданы никакие опции утилиты gstat по умолчанию выполняется анализ всей
                базы данных. Будет собрана информация о таблицах и индексах, содержащихся в базе
                данных. Поскольку вывод, скорее всего, будет очень большим, рекомендуется передать
                вывод в файл: </p><pre class="synopsis">
gstat /var/firebird/data/db.fdb &gt; /home/bob/db_stat.txt                
            </pre><p>Вывод будет состоять из анализа каждой пользовательской таблицы и всех связанных
                пользовательских индексов. Интерпретация этих результатов рассматривается ниже в
                разделах, посвященных анализу данных и индексным страницам.</p></section><section class="section" id="d0e13763"><div class="titlepage"><div><div><h3 class="title">Анализ только страниц с данным</h3></div></div></div><p>При использовании только опции <code class="code">-d[ata]</code>
                <span class="application">gstat</span> просматривает в базе данных таблицу за таблицей,
                отображая итоговую информацию о страницах данных. Таблицы выводятся в алфавитном
                порядке. Для включения в отчет системных таблиц добавьте переключатель -system.
                Никакие индексы не будут проанализированы или перечислены независимо от того,
                сколько их может существовать в базе данных. Поскольку вывод данной команды является
                достаточно большим рекомендуем вам перенаправлять его в файл. Пример команды для
                анализа страниц данных приведён ниже.</p><pre class="synopsis">
gstat mydb -data -user SYSDBA &gt; d:\mydb.txt            
            </pre><p>Вывод о каждой таблице будет примерно следующий:</p><pre class="screen">
TEST (151)
  Primary pointer page: 546, Index root page: 547
  Pointer pages: 2, data page slots: 5128
  Data pages: 5128, average fill: 87%
  Primary pages: 4820, secondary pages: 308, swept pages: 0
  Empty pages: 5, full pages: 5121
  Fill distribution:
   0 - 19% = 5
  20 - 39% = 0
  40 - 59% = 1
  60 - 79% = 0
  80 - 99% = 5122             
            </pre><p>Вывод статистики по таблице, приведенный выше, начинается с отображения имени
                таблицы — <span class="database">TEST</span> — и идентификатора таблицы — 151. Идентификатор
                таблицы фактически является столбцом <span class="database">RDB$RELATION_ID</span> в
                системной таблице <span class="database">RDB$RELATIONS</span>, как показано в следующем
                сеансе <span class="application">isql</span>:
                </p><pre class="programlisting">
SQL&gt; select rdb$relation_name 
CON&gt; from rdb$relations
CON&gt; where rdb$relation_id = 213;

RDB$RELATION_NAME
===================================
TEST                
            </pre><p>
            </p><div class="table" id="d0e13797"><div class="table-title">Таблица 9.2. Описание вывода gstat -data</div><div class="table-contents"><table style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; "><colgroup><col class="c1"/><col class="c2"/></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">Элемент</th><th style="border-bottom: 1px solid ; ">Описание</th></tr></thead><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><span class="bold"><strong>Primary pointer page</strong></span></td><td style="border-bottom: 1px solid ; "><p>Номер первой страницы косвенных указателей на страницы,
                                    хранящие данные таблицы.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><span class="bold"><strong>Index root page</strong></span></td><td style="border-bottom: 1px solid ; "><p>Номер страницы, которая является первой страницей
                                    указателей на индексы таблицы.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><span class="bold"><strong>Pointer pages</strong></span></td><td style="border-bottom: 1px solid ; "><p>Общее количество страниц косвенных указателей на страницы,
                                    хранящие данные таблицы.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><span class="bold"><strong>data page slots</strong></span></td><td style="border-bottom: 1px solid ; "><p>Количество указателей на страницы базы данных, содержащихся
                                    на страницах указателей. Должно равняться числу страниц
                                    данных.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><span class="bold"><strong>Data pages</strong></span></td><td style="border-bottom: 1px solid ; "><p>Общее количество страниц, в которых хранятся данные
                                    таблицы. Этот счетчик включает страницы, хранящие
                                    неподтвержденные версии записей и мусор, потому что
                                        <span class="application">gstat</span> не может их отличить друг
                                    от друга.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><span class="bold"><strong>average fill</strong></span></td><td style="border-bottom: 1px solid ; "><p>Пространство, используемое на каждой странице таблицы, в
                                    среднем. <span class="bold"><strong>Fill distribution</strong></span> (см.
                                    ниже) даёт более подробную информацию.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><span class="bold"><strong>Primary pages</strong></span></td><td style="border-bottom: 1px solid ; "><p>Количество страниц, равное (Data pages - Secondary
                                    pages).</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><span class="bold"><strong>secondary pages</strong></span></td><td style="border-bottom: 1px solid ; "><p>Количество страниц на которых не хранятся первичные версии
                                    записей.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><span class="bold"><strong>swept pages</strong></span></td><td style="border-bottom: 1px solid ; "><p>Количество страниц помеченных swept флагом. Этот флаг
                                    выставляется при сборке мусора или процедурой sweep, если на
                                    странице содержатся только первичные версии записей, и все они
                                    были созданы подтверждёнными транзакциями. Вторичные версии
                                    записей могут быть удалены при сборке мусора. Такие страницы
                                    данных должны быть пропущены процедурой sweep.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><span class="bold"><strong>Empty pages</strong></span></td><td style="border-bottom: 1px solid ; "><p>Количество страниц, на которых нет записей.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><span class="bold"><strong>full pages</strong></span></td><td style="border-bottom: 1px solid ; "><p>Количество полностью заполненных страниц.</p></td></tr><tr><td style="border-right: 1px solid ; "><span class="bold"><strong>Fill distribution</strong></span></td><td><p>Это гистограмма из пяти 20-процентных "полос", каждая из
                                    которых показывает количество страниц данных, чье среднее
                                    заполнение попадает в этот диапазон. Процент заполнения
                                    определяется соотношением пространства каждой страницы,
                                    содержащей данные. Сумма этих чисел дает общее количество
                                    страниц, содержащих данные.</p></td></tr></tbody></table></div></div><br class="table-break"/></section><section class="section" id="d0e13900"><div class="titlepage"><div><div><h3 class="title">Анализ только индексов</h3></div></div></div><p>При использовании только опции <code class="code">-i[ndex]</code>
                <span class="application">gstat</span> отыскивает в базе данных и отображает статистику по
                индексам: средняя длина ключа (в байтах), общее количество дубликатов и максимальное
                количество дубликатов одного ключа и другое. Таблицы выводятся в алфавитном порядке.
                Для включения в отчет системных таблиц добавьте переключатель <code class="code">-system</code>.
                Результаты, выводимые этой командой, будут перечислять пользовательские таблицы в
                алфавитном порядке. Таблицы не будут проанализированы; однако в отчете будут
                перечислены имена таблиц в алфавитном порядке и перечислены все соответствующие
                индексы под соответствующим именем таблицы. Поскольку вывод данной команды является
                достаточно большим рекомендуем вам перенаправлять его в файл. </p><p>К сожалению, не существует способа получить статистику по одному индексу. Однако
                вы можете ограничить результат одной таблицей, используя переключатель
                    <code class="code">-t</code>, за которым следует имя таблицы. Вы можете записать разделенный
                пробелам и список имен таблиц для получения результатов более чем по одной
                таблице.</p><p>Пример команды для анализа индексов приведён ниже.</p><pre class="synopsis">
gstat mydb -index -user SYSDBA &gt; d:\mydb_idx.txt            
            </pre><p>Вывод информации об индексе будет примерно следующим:</p><pre class="screen">
TEST (151)

    Index FK_TEST_BREED (15)
	Root page: 109775, depth: 2, leaf buckets: 135, nodes: 446205
	Average node length: 4.89, total dup: 445962, max dup: 98496
	Average key length: 2.00, compression ratio: 1.31
	Average prefix length: 2.63, average data length: 0.00
	Clustering factor: 36107, ratio: 0.08
	Fill distribution:
	     0 - 19% = 0
	    20 - 39% = 0
	    40 - 59% = 1
	    60 - 79% = 0
	    80 - 99% = 134
            </pre><p>Вышеприведенная выдержка из отчета начинается с отображения имени таблицы — TEST —
                и идентификатора таблицы — 151, как описано выше. Это все сведения о таблице
                представленные в данном отчете, далее следуют подробная информация об индексах этой
                таблицы.</p><p>Вывод информации об индексе начинается с его имени и идентификатора. Идентификатор
                отображает порядок создания индексов для указанной таблицы. Первый индекс имеет
                идентификатор 0, следующий — 1, и так далее. Идентификаторы индексов могут иметь
                пропуски, если какой-либо индекс был удалён после создания. Индексы таблицы
                выводятся в алфавитном порядке.</p><div class="table" id="d0e13931"><div class="table-title">Таблица 9.3. Описание вывода gstat -index</div><div class="table-contents"><table style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; "><colgroup><col class="c1"/><col class="c2"/></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">Элемент</th><th style="border-bottom: 1px solid ; ">Описание</th></tr></thead><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><span class="bold"><strong>Root page</strong></span></td><td style="border-bottom: 1px solid ; "><p>Номер корневой страницы индекса.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><span class="bold"><strong>depth</strong></span></td><td style="border-bottom: 1px solid ; "><p>Количество уровней в странице индексного дерева. Эта
                                    статистика отображает количество страниц, к которым необходимо
                                    получить доступ, чтобы попасть в листовую страницу. </p>
                                <p>На диске находится корневая страница индексов (Index Root
                                    Page), которая создается одновременно с таблицей. На этой
                                    странице содержится список указателей на верхние страницы (Root
                                    page корневая страница индекса) для каждого индекса — по одной
                                    странице на индекс. Для любого индекса эта страница содержит
                                    список указателей на: </p><div class="itemizedlist"><ul style="list-style-type: disc; " class="itemizedlist compact"><li class="listitem"><p>страницы другого уровня, если глубина больше 1,
                                                или,</p></li><li class="listitem"><p>на листовые страницы для фактических данных
                                                индекса, если глубина равна 1.</p></li></ul></div>
                                <p>Листовые страницы хранят расположение данных, которые были
                                    проиндексированы. Глубина индекса — это количество уровней,
                                    которые вы должны пройти от верхней (корневой) страницы индекса,
                                    чтобы попасть на листовые страницы. Ни корневая страница
                                    индексов, ни верхняя страница индекса не учитываются в
                                    глубине.</p>
                                <p>Если глубина индекса превышает 3, то скорее всего индекс будет
                                    работать не очень эффективно. В этом случае рекомендуется
                                    увеличить размер страницы с помощью резервного копирования и
                                    восстановления посредством
                                    <span class="application">gbak</span>.</p>
                            </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><span class="bold"><strong>leaf buckets</strong></span></td><td style="border-bottom: 1px solid ; "><p>Количество страниц самого низкого уровня (листовых) в
                                    дереве индекса. Это страницы, которые содержат указатели на
                                    записи. Страницы высокого уровня содержат косвенные
                                    связи.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><span class="bold"><strong>nodes</strong></span></td><td style="border-bottom: 1px solid ; "><p>Общее количество записей, индексированных в дереве. Должно
                                    быть равно количеству индексированных строк в дереве, хотя отчет
                                        <span class="application">gstat</span> может включать узлы,
                                    которые были удалены, но не вычищены в процессе сборки мусора.
                                    Может также включать множество элементов для записей, у которых
                                    был изменен индексный ключ.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><span class="bold"><strong>Average node length</strong></span></td><td style="border-bottom: 1px solid ; "><p>Средний размер узлов в байтах.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><span class="bold"><strong>total dup</strong></span></td><td style="border-bottom: 1px solid ; "><p>Общее количество строк дубликатов индекса.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><span class="bold"><strong>max dup</strong></span></td><td style="border-bottom: 1px solid ; "><p>Количество дублирующих узлов в "цепочке", имеющих
                                    наибольшее количество дубликатов. Всегда будет нулем для
                                    уникальных индексов. Если число велико по сравнению с числом в
                                    Total dup, то это признак плохой селективности.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><span class="bold"><strong>Average key length</strong></span></td><td style="border-bottom: 1px solid ; "><p>Средний размер ключа в байтах с учетом сжатия. К длине
                                    каждого ключа прибавляется от 1 до 5 байт в зависимости от
                                    размера ключа и префикса. Затем высчитывается средний размер
                                    ключа</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><span class="bold"><strong>compression ratio</strong></span></td><td style="border-bottom: 1px solid ; "><p>Средний коэффициент сжатия ключа.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><span class="bold"><strong>Average prefix length</strong></span></td><td style="border-bottom: 1px solid ; "><p>Средний размер, занимаемый префиксами узлов, в
                                    байтах</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><span class="bold"><strong>average data length</strong></span></td><td style="border-bottom: 1px solid ; "><p>Средняя длина каждого ключа в байтах. Она, скорее всего,
                                    меньше, чем фактическая сумма размеров столбцов, поскольку
                                    Firebird использует индексное сжатие для уменьшения объема
                                    данных, хранящихся на странице листа индекса.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><span class="bold"><strong>Clustering factor</strong></span></td><td style="border-bottom: 1px solid ; "><p>Это мера того, насколько много операций ввода-вывода будет
                                    осуществлять база данных, если бы ей пришлось читать каждую
                                    строку таблицы посредством индекса, в порядке индекса. То есть
                                    она показывает, насколько упорядочены строки в таблице по
                                    значениям индекса. Если значение близко к общему количеству
                                    страниц, значит таблица очень хорошо упорядочена. В этом случае
                                    записи индекса на одной странице листа индекса обычно указывают
                                    на строки, находящиеся в одних и тех же страницах данных. Если
                                    значение близко к общему количеству строк, значит, таблица
                                    весьма неупорядочена. В этом случае маловероятно, что записи
                                    индекса на одной странице листа индекса указывают на те же
                                    страницы данных.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><span class="bold"><strong>ratio</strong></span></td><td style="border-bottom: 1px solid ; "><p>Отношение Clustering factor к общему количеству узлов в
                                    индексе.</p></td></tr><tr><td style="border-right: 1px solid ; "><span class="bold"><strong>Fill distribution</strong></span></td><td><p>Это гистограмма с пятью 20-процентными полосами, каждая из
                                    которых показывает количество индексных страниц, чей средний
                                    процент заполнения находится в указанном диапазоне. Процент
                                    заполнения определяется соотношением пространства каждой
                                    страницы, содержащей данные. Сумма таких чисел дает общее
                                    количество листовых страниц (leaf buckets), содержащих индексные
                                    данные.</p>
                                <p>В идеале хотелось бы, чтобы все страницы были заполнены на
                                    80-99%. Если отчет показал, что все страницы заполнены менее чем
                                    на 60%, то такой индекс является кандидатом для перестройки.
                                    Обязательно учитывайте общее количество узлов перед началом
                                    перестройки — если в индексе только небольшое количество узлов,
                                    то перестройка не поможет использованию пространства, так как
                                    может не хватить записей для фактического заполнения страниц
                                    индекса.</p></td></tr></tbody></table></div></div><br class="table-break"/></section><section class="section" id="d0e14068"><div class="titlepage"><div><div><h3 class="title">Выбор таблиц для анализа</h3></div></div></div><p>Если вы хотите проанализировать не все пользовательские таблицы, а только из
                определённого списка таблиц, то вы можете задать его используя переключатель
                    <code class="code">-t[able]</code>. Обратите внимание, что указание имен таблиц таким
                способом также анализирует все индексы, связанные с этими таблицами. Имена таблиц
                разделяются пробелами. </p><pre class="synopsis">
gstat employee -user sysdba -t EMPLOYEE JOB COUNTRY                
            </pre><p>Если имена таблиц были созданы с использованием регистрозависимых идентификаторов
                (заключённых в двойные кавычки), то вместо таблиц в верхнем регистре необходимо
                использовать идентификаторы в двойных кавычках в исходном регистре.</p><pre class="synopsis">
gstat mymusic -t "MyMusic_Titles" "MyMusic_Artists"
            </pre></section><section class="section" id="d0e14082"><div class="titlepage"><div><div><h3 class="title">Включение в статистику системных таблиц и индексов</h3></div></div></div><p>Обычное использование <span class="application">gstat</span> не включает системные
                таблицы и индексы в вывод. При вызове <span class="application">gstat</span> с ключом
                    <code class="code">-system</code> эти таблицы и индексы включаются в анализ.</p><pre class="synopsis">
gstat employee -user sysdba -system &gt; d:\mydb_idx.txt  
            </pre></section><section class="section" id="d0e14098"><div class="titlepage"><div><div><h3 class="title">Статистика размеров записей и версий</h3></div></div></div><p>Когда вы запускаете <span class="application">gstat</span> с ключами по умолчанию или с
                    <code class="code">-d[ata]</code> или <code class="code">-t[able]</code> и добавляете ключ
                    <code class="code">-r[ecord]</code>, вы получаете в отчете дополнительную информацию, которая
                показывает среднюю длину записи и усредненную информацию о версиях таблицы. Кроме
                того в статистику будет включена информация о BLOB столбцах.</p><pre class="synopsis">            
gstat mydb -u sysdba -r -t TEST
</pre><pre class="screen">
...
TEST (151)
    Primary pointer page: 546, Index root page: 547
    Total formats: 2, used formats: 1
    Average record length: 135.33, total records: 446205
    Average version length: 0.00, total versions: 0, max versions: 0
    Average fragment length: 0.00, total fragments: 0, max fragments: 0
    Average unpacked length: 492.00, compression ratio: 3.64
    Pointer pages: 2, data page slots: 5128
    Data pages: 5128, average fill: 87%
    Primary pages: 4820, secondary pages: 308, swept pages: 0
    Empty pages: 5, full pages: 5121
    Blobs: 51316, total length: 3198656, blob pages: 0
        Level 0: 51316, Level 1: 0, Level 2: 0
    Fill distribution:
         0 - 19% = 5
        20 - 39% = 0
        40 - 59% = 1
        60 - 79% = 0
        80 - 99% = 5122
...        
            </pre><div class="table" id="d0e14119"><div class="table-title">Таблица 9.4. Описание вывода gstat -r</div><div class="table-contents"><table style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; "><colgroup><col class="c1"/><col class="c2"/></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">Элемент</th><th style="border-bottom: 1px solid ; ">Описание</th></tr></thead><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><span class="bold"><strong>Total formats</strong></span></td><td style="border-bottom: 1px solid ; "><p>Общее количество форматов для таблицы</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><span class="bold"><strong>used formats</strong></span></td><td style="border-bottom: 1px solid ; "><p>Количество используемых форматов</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><span class="bold"><strong>Average record length</strong></span></td><td style="border-bottom: 1px solid ; "><p>Средний размер сжатой записи в байтах</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><span class="bold"><strong>total records</strong></span></td><td style="border-bottom: 1px solid ; "><p>Общее количество записей в таблице Это значение может включать записи добавленные в
                                    неподтвержденных транзакциях или удалённые записи не вычищенные
                                    сборкой мусора.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><span class="bold"><strong>Average version length</strong></span></td><td style="border-bottom: 1px solid ; "><p>Среднее значение длины версий в байтах</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><span class="bold"><strong>total versions</strong></span></td><td style="border-bottom: 1px solid ; "><p>Общее количество старых версий. Если значение равно 0, то в таблице нет версий записей. Либо в
                                    таблице не было обновлений или удалений записей, либо сборка
                                    мусора удалила старые версии записей.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><span class="bold"><strong>max versions</strong></span></td><td style="border-bottom: 1px solid ; "><p>Максимальная длина цепочки старых версий
                                записи</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><span class="bold"><strong>Average fragment length</strong></span></td><td style="border-bottom: 1px solid ; "><p>Средний размер фрагмента записи в байтах</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><span class="bold"><strong>total fragments</strong></span></td><td style="border-bottom: 1px solid ; "><p>Общее количество фрагментов всех записей</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><span class="bold"><strong>max fragments</strong></span></td><td style="border-bottom: 1px solid ; "><p>Максимальное количество фрагментов для одной
                                записи</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><span class="bold"><strong>Average unpacked length</strong></span></td><td style="border-bottom: 1px solid ; "><p>Средний размер не сжатой записи в байтах </p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><span class="bold"><strong>compression ratio</strong></span></td><td style="border-bottom: 1px solid ; "><p>Отношение размера несжатых записей к сжатым</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><span class="bold"><strong>Blobs</strong></span></td><td style="border-bottom: 1px solid ; "><p>Общее количество BLOB 0, 1 и 2 уровней</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><span class="bold"><strong>total length</strong></span></td><td style="border-bottom: 1px solid ; "><p>Размер занимаемый BLOB полями</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><span class="bold"><strong>blob pages</strong></span></td><td style="border-bottom: 1px solid ; "><p>Количество страниц с BLOB</p></td></tr><tr><td style="border-right: 1px solid ; "><span class="bold"><strong>Level
                                    <em class="replaceable"><code>&lt;n&gt;</code></em></strong></span></td><td><p>Количество BLOB каждого уровня</p></td></tr></tbody></table></div></div><br class="table-break"/></section></section></section><section class="chapter" id="d0e14246"><div class="titlepage"><div><div><h2 class="title">Глава 10. FB_LOCK_PRINT</h2></div></div></div><p/></section><section class="chapter" id="d0e14250"><div class="titlepage"><div><div><h2 class="title">Глава 11. FBTRACEMGR</h2></div></div></div><p/></section><section xml:lang="ru" class="chapter" id="gsec"><div class="titlepage"><div><div><h2 class="title">Глава 12. Утилита GSEC</h2></div></div></div><a id="d0e14258" class="indexterm"/><div class="warning"><h3 class="title">Предупреждение</h3><p>Начиная с Firebird 3.0 утилита GSEC объявлена устаревшей. Язык SQL предоставляет более
            широкие возможности по манипулированию учётными записями пользователей.</p></div><p>Gsec — это утилита управления базой данных безопасности. Она позволяет SYSDBA (или любому
        привилегированному пользователю) управлять учетными записями пользователей для различных баз
        данных Firebird. Используя различные опции, можно добавлять, изменять или удалять учетные
        записи пользователей из базы данных безопасности.</p><p>Информация о всех пользователях хранится в обычной базе данных, называемой базой данных
        безопасности. По умолчанию база данных безопасности располагается в корневой директории
        Firebird и называется <code class="filename">security3.fdb</code>.</p><p>GSEC может быть запущена как в интерактивном, так и в командном режиме, и может отображать
        подсказки с перечислением всех опций.</p><p>Синтаксис запуска <span class="application">gsec</span> выглядит следующим образом:
        </p><pre class="synopsis">
gsec [<em class="replaceable"><code>&lt;options&gt;</code></em>] <em class="replaceable"><code>&lt;command&gt;</code></em> [<em class="replaceable"><code>&lt;parameters&gt;</code></em>]           
        </pre><p>
    </p><section class="section" id="d0e14290"><div class="titlepage"><div><div><h2 class="title" style="clear: both">Опции командной строки</h2></div></div></div><p>Независимо от режима, в котором работает <span class="application">gsec</span>, в командной
            строке может быть указано несколько параметров. Они перечислены ниже: </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="code">-user <em class="replaceable"><code>&lt;username&gt;</code></em></code></p><p>Позволяет указать имя пользователя. Укажите SYSDBA для возможности
                        управления учётными записями пользователей, или обычного пользователя если
                        необходимо просмотреть информацию о своей учётной записи. Этот параметр
                        можно не указывать если установлена переменная среды
                        <code class="envar">ISC_USER</code>.</p></li><li class="listitem"><p><code class="code">-password <em class="replaceable"><code>&lt;password&gt;</code></em></code></p><p>Предоставляет пароль для указанного пользователя. Этот параметр можно не
                        указывать если установлена переменная среды
                        <code class="envar">ISC_PASSWORD</code>.</p></li><li class="listitem"><p><code class="code">-fe[tch_password] <em class="replaceable"><code>&lt;password file
                                name&gt;</code></em> | stdin | /dev/tty</code></p><p>Этот переключатель позволяет указать файл из которого будет прочитан
                        пароль для указанного пользователя. Файл должен быть доступен для чтения
                        пользователю, запустившему <span class="application">gsec</span>. Если имя файла
                        указано как <code class="filename">stdin</code>, то пользователю будет предложено
                        ввести пароль. В системах POSIX имя файла <code class="filename">/dev/tty</code>
                        также приведет к запросу пароля.</p></li><li class="listitem"><p><code class="code">-role <em class="replaceable"><code>&lt;SQL role name&gt;</code></em></code></p><p>Позволяет указать роль, чьи права будет использовать указанный
                        пользователь. Роль должна быть выдана пользователю в текущей базе данных
                        безопасности.</p></li><li class="listitem"><p><code class="code">-database [<em class="replaceable"><code>&lt;host
                                name&gt;</code></em>:]<em class="replaceable"><code>&lt;secutity database
                                name&gt;</code></em></code></p><p>Вы можете указать базу данных безопасности (полный путь или алиас). Вы
                        также можете указать имя хоста, если необходимо удаленно администрировать
                        пользователей для указанного сервера. Весь параметр должен быть заключен в
                        кавычки, если в пути к базе данных безопасности есть пробелы.</p></li><li class="listitem"><p><code class="code">-trusted</code></p><p>Использовать доверительную аутентификацию.</p></li><li class="listitem"><p><code class="code">-z</code></p><p>Отображает версию утилиты gsec.</p></li><li class="listitem"><p><code class="code">-help</code> или <code class="code">-?</code></p><p>Справка отображает следующий экран информации: </p><pre class="screen">

   gsec utility - maintains user password database

   command line usage:
     gsec [ &lt;options&gt; ... ] &lt;command&gt; [ &lt;parameter&gt; ... ]

   interactive usage:
     gsec [ &lt;options&gt; ... ]
     GSEC&gt;
     &lt;command&gt; [ &lt;parameter&gt; ... ]

   available options:
     -user &lt;database administrator name&gt;
     -password &lt;database administrator password&gt;
     -fetch_password &lt;file to fetch password from&gt;
     -role &lt;database administrator SQL role name&gt;
     -trusted (use trusted authentication)
     -database &lt;database to manage&gt;
     -z

   available commands:
     adding a new user:
       add &lt;name&gt; [ &lt;parameter&gt; ... ]
     deleting a current user:
       delete &lt;name&gt;
     displaying all users:
       display
     displaying one user:
       display &lt;name&gt;
     modifying a user's parameters:
       modify &lt;name&gt; &lt;parameter&gt; [ &lt;parameter&gt; ... ]
     changing admins mapping to RDB$ADMIN role in security database:
       mapping {set|drop}
     help:
       ? (interactive only)
       help
     displaying version number:
       z (interactive only)
     quit interactive session:
       quit (interactive only)

   available parameters:
     -pw &lt;password&gt;
     -uid &lt;uid&gt;
     -gid &lt;uid&gt;
     -fname &lt;firstname&gt;
     -mname &lt;middlename&gt;
     -lname &lt;lastname&gt;
     -admin {yes|no}
                        
                    </pre><p>
                    </p></li></ul></div></section><section class="section" id="d0e14382"><div class="titlepage"><div><div><h2 class="title" style="clear: both">Команды GSEC</h2></div></div></div><p>После различных опций идет команда, которую вы хотите запустить. Следующие команды
            доступны как в пакетном, так и в интерактивном режимах. В пакетном режиме перед командой
            должен следовать знак минус.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="code">add <em class="replaceable"><code>&lt;name&gt;</code></em> [
                            <em class="replaceable"><code>&lt;parameter&gt;</code></em> ... ]</code></p><p>Эта команда добавляет нового пользователя в базу данных. При желании вы можете
                    добавить другие данные, такие как имя, отчество и фамилия, а также пароль для
                    нового пользователя, все в одной команде добавления. Кроме того, вы можете
                    добавить пользователя, а затем изменить его, чтобы заполнить недостающие
                    детали.</p></li><li class="listitem"><p><code class="code">delete <em class="replaceable"><code>&lt;name&gt;</code></em></code></p><p>Удаление пользователя с заданным именем.</p></li><li class="listitem"><p><code class="code">display [<em class="replaceable"><code>&lt;name&gt;</code></em>]</code></p><p>Эта команда отображает сведения о пользователе с заданным именем или обо всех
                    пользователях в базе данных безопасности, если имя пользователя не задано.
                    Пароль никогда не отображается.</p></li><li class="listitem"><p><code class="code">modify <em class="replaceable"><code>&lt;name&gt;</code></em>
                        <em class="replaceable"><code>&lt;parameter&gt;</code></em> [
                            <em class="replaceable"><code>&lt;parameter&gt;</code></em> ... ]</code></p><p>Изменяет информацию о пользователе с заданным именем.</p></li><li class="listitem"><p><code class="code">mapping {set | drop}</code></p><p>Включает или выключает флаг AUTO ADMIN MAPPING для автоматического
                    предоставления роли RDB$ADMIN администраторам Windows в текущей базе данных,
                    если используется доверительная авторизация.</p></li><li class="listitem"><p><code class="code">{? | help}</code></p><p>Отображает все опции и команды <span class="application">gsec</span>.</p></li><li class="listitem"><p><code class="code">z</code></p><p>Отображает версию <span class="application">gsec</span>.</p></li><li class="listitem"><p><code class="code">quit</code></p><p>Выход из интерактивного режима.</p></li></ul></div><p>Некоторые из приведенных выше команд принимают следующие параметры: </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="code">-pw <em class="replaceable"><code>&lt;password&gt;</code></em></code></p><p>Позволяет задать пароль для пользователя.</p></li><li class="listitem"><p><code class="code">-uid <em class="replaceable"><code>&lt;uid&gt;</code></em></code></p><p>Идентификатор пользователя в POSIX.</p></li><li class="listitem"><p><code class="code">-gid <em class="replaceable"><code>&lt;gid&gt;</code></em></code></p><p>Идентификатор группы в POSIX.</p></li><li class="listitem"><p><code class="code">-fname <em class="replaceable"><code>&lt;first name&gt;</code></em></code></p><p>Имя пользователя.</p></li><li class="listitem"><p><code class="code">-mname <em class="replaceable"><code>&lt;middle name&gt;</code></em></code></p><p>Отчёство пользователя.</p></li><li class="listitem"><p><code class="code">-lname <em class="replaceable"><code>&lt;lastname&gt;</code></em></code></p><p>Фамилия пользователя.</p></li><li class="listitem"><p><code class="code">-admin {yes | no}</code></p><p>Позволяет указать, будет ли пользователю предоставлена роль
                        RDB$ADMIN.</p></li></ul></div></section><section class="section" id="d0e14519"><div class="titlepage"><div><div><h2 class="title" style="clear: both">Интерактивный режим</h2></div></div></div><p>Чтобы запустить <span class="application">gsec</span> в интерактивном режиме, запустите
            утилиту с помощью командной строки:
            </p><pre class="screen">
C:\Firebird&gt;gsec -user sysdba -password masterkey
*** gsec is deprecated, will be removed soon ***

GSEC&gt;            
        </pre><p>
        </p><p>Подсказка <code class="code">GSEC&gt;</code> показывает, что утилита ожидает команду. Опции
                <code class="code">-user</code> и <code class="code">-password</code> — это параметры пользователя, который
            хочет манипулировать базой данных безопасности. Если вы хотите управлять пользователями,
            то в качестве имени пользователя необходимо указывать SYSDBA. Обычные пользователи могут
            только просматривать информацию о себе и изменять собственный пароль.</p><p>Для выхода из <span class="application">gsec</span> в интерактивном режиме используется
            команда quit: </p><pre class="screen">
GSEC&gt; quit        
C:\Firebird&gt;
        </pre><p>
        </p><p>В следующих разделах показано, как выполнять различные команды в интерактивном режиме.
            Предполагается, что вы уже запускаете утилиту как пользователь SYSDBA.</p><section class="section" id="d0e14551"><div class="titlepage"><div><div><h3 class="title">Отображение информации о пользователе</h3></div></div></div><p>Для отображения информации обо всех пользователях в базе данных безопасности
                введите следующую команду.
                </p><pre class="screen">
GSEC&gt; display
     user name                    uid   gid admin     full name
------------------------------------------------------------------------------------------------
SYSDBA                              0     0
NORMAN                              0     0           Norman  Dunbar
EPOCMAN                             0     0           Benoit Gilles Mascia
BOSS                                0     0 admin
GSEC&gt;                
            </pre><p>
            </p><p>Если в столбце admin отображает текст <span class="quote">«<span class="quote">admin</span>»</span>, то это обозначает что
                пользователю предоставлена роль RDB$ADMIN в базе данных безопасности. Такие
                пользователю могут управлять другими учётными записями.</p><p>Чтобы отобразить сведения об одном пользователе, передайте имя пользователя в
                качестве параметра в команду <code class="code">display</code>.</p><pre class="screen">
GSEC&gt; display epocman
     user name                    uid   gid admin     full name
------------------------------------------------------------------------------------------------
EPOCMAN                             0     0           Benoit Gilles Mascia                
            </pre><p>Если вы введете имя несуществующего пользователя в качестве параметра команды
                    <code class="code">display</code>, ничего не отобразится и <span class="application">gsec</span>
                останется в интерактивном режиме.</p><pre class="screen">
GSEC&gt; display alison
GSEC&gt;
            </pre></section><section class="section" id="d0e14581"><div class="titlepage"><div><div><h3 class="title">Добавление новых пользователей</h3></div></div></div><p>При добавлении нового пользователя в интерактивном режиме ничего не отображается,
                чтобы подтвердить, что пользователь действительно был добавлен. Вам нужно
                использовать команды <code class="code">display</code> или <code class="code">display &lt;name&gt;</code>,
                чтобы убедиться, что пользователь был успешно добавлен.</p><pre class="screen">
GSEC&gt; add newuser -pw newuser -fname New -lname User
GSEC&gt; display newuser
     user name                    uid   gid admin     full name
------------------------------------------------------------------------------------------------
NEWUSER                             0     0           New  User               
            </pre><p>Если необходимо добавить пользователя и выдать ему роль RDB$ADMIN в базе данных
                безопасности, то добавьте опцию <code class="code">-admin yes</code>.</p><pre class="screen">
GSEC&gt; add newadmin -pw secret -fname New -mname admin -lname User -admin yes
GSEC&gt; display newadmin
     user name                    uid   gid admin     full name
------------------------------------------------------------------------------------------------
NEWADMIN                            0     0 admin     New admin User
GSEC&gt;
            </pre></section><section class="section" id="d0e14601"><div class="titlepage"><div><div><h3 class="title">Удаление существующих пользователей</h3></div></div></div><p>При удалении пользователя в интерактивном режиме нет подтверждения, что
                пользователь был удален. Вы должны использовать команду <code class="code">display</code> или
                    <code class="code">display &lt;name&gt;</code> для проверки.</p><pre class="screen">
GSEC&gt; delete newuser
GSEC&gt; display
     user name                    uid   gid admin     full name
------------------------------------------------------------------------------------------------
SYSDBA                              0     0
NORMAN                              0     0           Norman  Dunbar
EPOCMAN                             0     0           Benoit Gilles Mascia
BOSS                                0     0 admin
NEWADMIN                            0     0 admin     New admin User                
            </pre><p>Если вы попытаетесь удалить несуществующего пользователя
                    <span class="application">gsec</span> выдаст сообщение об ошибке.</p><pre class="screen">
GSEC&gt; delete newuser
The user name specified was not found in the security database
GSEC&gt;                
            </pre></section><section class="section" id="d0e14621"><div class="titlepage"><div><div><h3 class="title">Редактирование существующих пользователей</h3></div></div></div><p>Для существующих пользователей можно изменить один или несколько своих атрибутов:
                пароль, фамилия, имя, отчество и другое. После выполнения команды не выводится
                никаких подтверждений. Вы должны использовать команду <code class="code">display</code> или
                    <code class="code">display &lt;name&gt;</code> для проверки.</p><pre class="screen">
GSEC&gt; modify norman -pw newpassword
GSEC&gt; modify norman -mname MiddleName -fname Fred
GSEC&gt; display norman
     user name                    uid   gid admin     full name
------------------------------------------------------------------------------------------------
NORMAN                              0     0           Fred MiddleName Dunbar                
            </pre><p>Если вы хотите удалить один или несколько атрибутов пользователя, не передавайте
                (новое) значение для этого атрибута.</p><pre class="screen">
GSEC&gt; modify norman -mname -fname -lname
GSEC&gt; display norman
     user name                    uid   gid admin     full name
------------------------------------------------------------------------------------------------
NORMAN                              0     0                
            </pre><p>Если необходимо выдать роль RDB$ADMIN указанному пользователю в базе данных
                безопасности, то установите опцию <code class="code">-admin</code> в зачение
                <code class="code">yes</code>.</p><pre class="screen">
GSEC&gt; modify norman -admin yes
GSEC&gt; display norman
     user name                    uid   gid admin     full name
------------------------------------------------------------------------------------------------
NORMAN                              0     0 admin                
            </pre></section><section class="section" id="d0e14648"><div class="titlepage"><div><div><h3 class="title">Отображение администраторов ОС</h3></div></div></div><p>По умолчанию администраторы доменов Windows не получают привилегии администратора
                в базе данных безопасности, поскольку отключено отображение администраторов на роль
                RDB$ADMIN. Это можно сделать в <span class="application">isql</span> следующим образом:
                </p><pre class="screen">
SQL&gt; alter role rdb$admin set auto admin mapping;
SQL&gt; commit;              
            </pre><p>
            </p><p>Приведенная выше команда приведет к тому, что все учетные записи администраторов
                Windows автоматически получат полный доступ к функциям управления пользователями.
                Автоматическое отображение может быть отменено следующим образом:
                </p><pre class="screen">
SQL&gt; alter role rdb$admin drop auto admin mapping;
SQL&gt; commit;                
            </pre><p>
            </p><p>Функциональность вышеупомянутых команд <span class="application">isql</span> также можно
                установить с помощью <span class="application">gsec</span>, как описано ниже, с помощью
                команды <code class="code">mapping</code>. Команда принимает параметр set или drop
                соответственно.</p><pre class="screen">GSEC&gt; mapping set</pre><p>или</p><pre class="screen">GSEC&gt; mapping drop</pre></section><section class="section" id="d0e14681"><div class="titlepage"><div><div><h3 class="title">Справка</h3></div></div></div><p>Команда <code class="code">help</code> в интерактивном режиме отображает тот же экран справки,
                как показано выше. Она может быть сокращена до одного знака вопроса.</p></section><section class="section" id="d0e14689"><div class="titlepage"><div><div><h3 class="title">Информация о версии</h3></div></div></div><p>Версию <span class="application">gsec</span> можно получить с помощью команды z.</p><pre class="screen">
GSEC&gt; z
gsec version WI-V3.0.6.33254 Firebird 3.0                
            </pre></section></section><section class="section" id="d0e14699"><div class="titlepage"><div><div><h2 class="title" style="clear: both">Пакетный режим</h2></div></div></div><div class="note"><h3 class="title">Примечание</h3><p>При описании пакетного режима будем считать что я установил переменные среды
                    <code class="envar">ISC_USER</code> и <code class="envar">ISC_PASSWORD</code>. Это позволяет запускать
                    <span class="application">gsec</span> без необходимости указывать ключи
                    <code class="code">-user</code> и <code class="code">-password</code>. Это, в свою очередь, уменьшает
                объем кода в командной строке, а это означает, что вся командная строка помещается
                по ширине страницы A4.</p><p>Эти переменные не всегда безопасны, поэтому не делайте этого! </p></div><p>В пакетном режиме командная строка для запуска gsec выглядит следующим образом:
            </p><pre class="synopsis">
gsec [<em class="replaceable"><code>&lt;options&gt;</code></em>] <em class="replaceable"><code>&lt;command&gt;</code></em> [<em class="replaceable"><code>&lt;parameters&gt;</code></em>]            
        </pre><p>
        </p><section class="section" id="d0e14736"><div class="titlepage"><div><div><h3 class="title">Отображение информации о пользователе</h3></div></div></div><p>Команда <code class="code">display</code> отображает всех пользователей в базе данных
                безопасности:
                </p><pre class="screen">
C:\Firebird\3.0&gt;gsec -display
     user name                    uid   gid admin     full name
------------------------------------------------------------------------------------------------
SYSDBA                              0     0
NORMAN                              0     0 
EPOCMAN                             0     0           Benoit Gilles Mascia
BOSS                                0     0 admin              
            </pre><p>
            </p><p>Чтобы отобразить сведения об одном пользователе, передайте имя пользователя в
                качестве параметра в команду <code class="code">display</code>:
                </p><pre class="screen">
C:\Firebird\3.0&gt;gsec -display epocman
     user name                    uid   gid admin     full name
------------------------------------------------------------------------------------------------
EPOCMAN                             0     0           Benoit Gilles Mascia                
            </pre><p>
            </p></section><section class="section" id="d0e14755"><div class="titlepage"><div><div><h3 class="title">Добавление новых пользователей</h3></div></div></div><p>При добавлении пользователя в пакетном режиме нет подтверждения, что пользователь
                был добавлен. Вы должны использовать команду <code class="code">-display</code> или
                    <code class="code">-display &lt;name&gt;</code> для проверки.</p><pre class="screen">
C:\Firebird\3.0&gt;gsec -add newuser -pw newuser -fname New -lname User

C:\Firebird\3.0&gt;gsec -display
     user name                    uid   gid admin     full name
------------------------------------------------------------------------------------------------
SYSDBA                              0     0
NORMAN                              0     0 
EPOCMAN                             0     0           Benoit Gilles Mascia
BOSS                                0     0 admin
NEWUSER                             0     0           New  User                
            </pre><p>Если необходимо добавить пользователя и выдать ему роль RDB$ADMIN в базе данных
                безопасности, то добавьте опцию <code class="code">-admin yes</code>.</p><pre class="screen">
C:\Firebird\3.0&gt;gsec -add newadmin -pw ignoreit -fname New -mname Admin -lname User -admin yes

C:\Firebird\3.0&gt;gsec -display newadmin
     user name                    uid   gid admin     full name
------------------------------------------------------------------------------------------------
NEWADMIN                            0     0 admin     New Admin User                
            </pre></section><section class="section" id="d0e14775"><div class="titlepage"><div><div><h3 class="title">Удаление существующего пользователя</h3></div></div></div><p>При удалении пользователя в пакетном режиме нет подтверждения, что пользователь
                был удален. Вы должны использовать команду <code class="code">-display</code> или <code class="code">-display
                    &lt;name&gt;</code> для проверки.</p><pre class="screen">
C:\Firebird\3.0&gt;gsec -delete newuser

C:\Firebird\3.0&gt;gsec -display
     user name                    uid   gid admin     full name
------------------------------------------------------------------------------------------------
SYSDBA                              0     0
NORMAN                              0     0 
EPOCMAN                             0     0           Benoit Gilles Mascia
BOSS                                0     0 admin            
            </pre></section><section class="section" id="d0e14788"><div class="titlepage"><div><div><h3 class="title">Изменение существующего пользователя</h3></div></div></div><p>Для существующих пользователей можно изменить один или несколько своих атрибутов:
                пароль, фамилия, имя, отчество и наличие прав администратора. </p><pre class="screen">
C:\Firebird\3.0&gt;gsec -modify norman -pw newpassword

C:\Firebird\3.0&gt;gsec -modify norman -mname MiddleName -fname Fred

C:\Firebird\3.0&gt;gsec -display norman
     user name                    uid   gid admin     full name
------------------------------------------------------------------------------------------------
NORMAN                              0     0           Fred MiddleName Dunbar

            </pre><p>Если вы хотите удалить один или несколько атрибутов пользователя, не передавайте
                (новое) значение для этого атрибута.</p><pre class="screen">
C:\Firebird\3.0&gt;gsec -modify norman -mname -fname -lname

C:\Firebird\3.0&gt;gsec -display norman
     user name                    uid   gid admin     full name
------------------------------------------------------------------------------------------------
NORMAN                              0     0                
            </pre></section><section class="section" id="d0e14799"><div class="titlepage"><div><div><h3 class="title">Информация о версии</h3></div></div></div><p>Версию <span class="application">gsec</span> можно получить с помощью команды
                    <span class="command"><strong>-z</strong></span>. Тем не менее, обратите внимание, что он оставляет вас в
                интерактивном режиме по завершении. Он не завершает работу, как другие команды
                пакетного режима, поэтому для выхода необходимо использовать интерактивную команду
                    <span class="command"><strong>quit</strong></span>. Существует способ обойти эту проблему, как показано
                ниже.</p><pre class="screen">
C:\Firebird\3.0&gt;gsec -z
gsec version WI-V3.0.6.33254 Firebird 3.0
*** gsec is deprecated, will be removed soon ***

GSEC&gt;                
            </pre><p>Решение состоит в том, чтобы иметь небольшой файл, содержащий команду
                    <span class="command"><strong>quit</strong></span>, и заставить <span class="application">gsec</span> прочитать
                этот файл, когда ему потребуется ввод пользователя, следующим образом.</p><pre class="screen">
C:\Firebird\3.0&gt;copy con fred
quit
^Z
        1 file(s) copied.
            </pre><pre class="screen">
C:\Firebird\3.0&gt;gsec -z &lt;fred
gsec version WI-V3.0.6.33254 Firebird 3.0
*** gsec is deprecated, will be removed soon ***

GSEC&gt;
C:\Firebird\3.0&gt;                
            </pre><p>Это может быть хорошим решением для любой из команд, которые оставляют вас
                    <span class="quote">«<span class="quote">застрявшими</span>»</span> в интерактивном режиме, когда вы думаете, что
                работаете в пакетном режиме. Перенаправляя ввод из командного файла,
                    <span class="application">gsec</span> будет читать строку текста из этого файла каждый
                раз, когда требуется ввод пользователя. Принудительно прочитав команду
                    <code class="code">quit</code>, вы заставляете его завершиться.</p></section><section class="section" id="d0e14838"><div class="titlepage"><div><div><h3 class="title">Отображение администраторов ОС</h3></div></div></div><p>По умолчанию администраторы доменов Windows не получают привилегии администратора
                в базе данных безопасности, поскольку отключено отображение администраторов на роль
                RDB$ADMIN. Это можно сделать с помощью команды <code class="code">mapping</code>. Команда
                принимает параметр set или drop соответственно. Выполнение команды <code class="code">mapping
                    set</code> приведет к тому, что все учетные записи администраторов Windows
                автоматически получат полный доступ к функциям управления пользователями.</p><pre class="screen">GSEC&gt; mapping set</pre><p>или</p><pre class="screen">GSEC&gt; mapping drop</pre></section></section><section class="section" id="d0e14855"><div class="titlepage"><div><div><h2 class="title" style="clear: both">Удаленный запуск gsec</h2></div></div></div><p>Gsec может использоваться для администрирования базы данных безопасности на удаленном
            сервере. Для этого вы должны указать имя удаленной базы данных безопасности в командной
            строке, как показано в следующем примере.</p><pre class="screen">
C:\Firebird\3.0&gt;gsec -database myserver/3053:security.db -user sysdba -password masterkey
*** gsec is deprecated, will be removed soon ***

GSEC&gt;            
        </pre><p>После подключения к удаленной базе данных безопасности вы можете работать с
            пользователями обычным способом в интерактивном или пакетном режимах, как описано
            выше.</p><div class="note"><h3 class="title">Примечание</h3><p>По умолчанию в Firebird 3.0 удалённое администрирование базы данных безопасности
                отключено (смотри настройку RemoteAccess в
                <code class="filename">databases.conf</code>).</p></div></section><section class="section" id="d0e14870"><div class="titlepage"><div><div><h2 class="title" style="clear: both">Особенности работы с GSEC</h2></div></div></div><p>Ниже представлены некоторые особенности, выявленные при практическом использовании
            утилиты <span class="application">GSEC</span>. Некоторые из них упомянуты выше, а некоторые,
            быть может, нет. Просматривая все это в одном месте, вы, скорее всего, сможете
            определить причину возникновения вашей конкретной проблемы при работе с
                <span class="application">GSEC</span>.</p><section class="section" id="d0e14881"><div class="titlepage"><div><div><h3 class="title">Обычные и привилегированные пользователи</h3></div></div></div><p>Вносить изменения в базу данных безопасности могут только администраторы в этой
                базе данных: пользователи с ролью RDB$ADMIN, владелец БД безопасности и пользователь
                sysdba. Обычный пользователь может запустить <span class="application">GSEC</span> только
                для просмотра информации. Начиная с СУБД Firebird 2 пользователь может изменить
                любую информацию о себе. Вот пример того, что происходит, когда обычный пользователь
                пытается добавить нового пользователя в базу данных безопасности:
                </p><pre class="screen">
C:\Firebird\3.0&gt;gsec -user norman -password norman
*** gsec is deprecated, will be removed soon ***

GSEC&gt; add myuser -pw mypassword
An error occurred while attempting to add the user.
no permission for INSERT access to TABLE PLG$SRP_VIEW
GSEC&gt;                
            </pre><p>
            </p><p>Обычный пользователь может только просматривать и изменять информацию о
                себе.</p><pre class="screen">
C:\Firebird\3.0&gt;gsec -user norman -password norman -display
     user name                    uid   gid admin     full name
------------------------------------------------------------------------------------------------
NORMAN                              0     0                
            </pre></section><section class="section" id="d0e14896"><div class="titlepage"><div><div><h3 class="title">Отличия интерактивного и пакетного режимов</h3></div></div></div><p>Команды <span class="application">GSEC</span> применимы к обоим режимам, но при работе в
                пакетном режиме вы должны использовать для них префикс <span class="quote">«<span class="quote">знак минус</span>»</span>
                (-), иначе получите нижеследующее сообщение об ошибке:
                </p><pre class="screen">
C:\Firebird\3.0&gt;gsec -user sysdba -password masterkey display
invalid parameter, no switch defined
error in switch specifications
*** gsec is deprecated, will be removed soon ***

GSEC&gt;                
            </pre><p>
            </p><p>Заметьте, что <span class="application">GSEC</span> оставляет вас в интерактивном режиме
                в случае возникновения ошибки. Чтобы этого избежать, достаточно поставить минус
                перед командой <code class="code">display</code>:
                </p><pre class="screen">
C:\Firebird\3.0&gt;gsec -user sysdba -password masterkey -display
     user name                    uid   gid admin     full name
------------------------------------------------------------------------------------------------
SYSDBA                              0     0
NORMAN                              0     0
EPOCMAN                             0     0           Benoit Gilles Mascia
BOSS                                0     0 admin              
            </pre><p>
            </p><p>Теперь <span class="application">GSEC</span> выполняет то, что от него требуют —
                отображает список пользователей, и завершает работу.</p></section><section class="section" id="d0e14926"><div class="titlepage"><div><div><h3 class="title">Коды завершения в пакетном режиме</h3></div></div></div><p>Запуская утилиту <span class="application">GSEC</span> в ОС windows, вы можете
                проанализировать код завершения через значение переменной
                    <code class="envar">%ERRORLEVEL%</code> и определить, удачно завершилась
                    <span class="application">GSEC</span> или возникла ошибка при выполнении требуемой
                задачи.</p><p>В случае с ОС Unix любой разновидности код завершения можно оценить по значению
                переменной $?.</p></section><section class="section" id="d0e14942"><div class="titlepage"><div><div><h3 class="title">Ошибки в пакетном режиме переводят GSEC в интерактивный режим</h3></div></div></div><p>Как уже говорилось ранее, в некоторых ситуациях ошибка пакетного режима может
                привести к тому, что утилита <span class="application">GSEC</span> перейдет в
                интерактивный режим, и скрипт прервет выполнение, ожидая клавиатурного ввода
                пользователя. Путь решения данной проблемы был описан выше.</p></section></section></section><section xml:lang="ru" class="chapter" id="fbsvcmgr"><div class="titlepage"><div><div><h2 class="title">Глава 13. Утилита FBSVCMGR</h2></div></div></div><p>Утилита <span class="application">fbsvcmgr</span> предоставляет интерфейс командной строки для
        API служб, предоставляя доступ к любой службе, реализованной в Firebird.</p><p>Несмотря на то, что существует множество инструментов администрирования баз данных,
        которые используют API-интерфейс служб через графические интерфейсы, инструмент
            <span class="application">fbsvcmgr</span> решает проблему для администраторов, которым
        требуется доступ к удаленным серверам через текстовую консоль. </p><section class="section" id="d0e14964"><div class="titlepage"><div><div><h2 class="title" style="clear: both">Использование fbsvcmgr</h2></div></div></div><p><span class="application">fbsvcmgr</span> не эмулирует переключатели, реализованные в
            традиционных утилитах <span class="quote">«<span class="quote">g*</span>»</span>. Это всего лишь внешний интерфейс, через который
            могут передаваться функции и параметры API служб. Поэтому пользователи должны быть
            знакомы с API-интерфейсом служб в его нынешнем виде. Заголовочный файл API —
                <code class="filename">ibase.h</code>, в каталоге <code class="filename">../include</code> — следует
            рассматривать как основной источник информации о том, что доступно.</p><section class="section" id="d0e14980"><div class="titlepage"><div><div><h3 class="title">Параметры</h3></div></div></div><p>Первый обязательный параметр командной строки — это менеджер служб, к которому вы
                хотите подключиться. Для локального соединения используйте просто
                    <code class="code">service_mgr</code>. Чтобы присоединить к удаленной машине необходимо
                дописать имя хоста в следующем формате
                    <code class="code"><em class="replaceable"><code>hostname</code></em>:service_mgr</code>.</p><p>Далее следуют блоки служебных параметров (SPB) со значениями, когда это
                необходимо. Любой из них может (или не может) иметь префикс с одним знаком
                    <span class="quote">«<span class="quote">-</span>»</span>. Для длинных командных строк, типичных для
                    <span class="application">fbsvcmgr</span>, использование <span class="quote">«<span class="quote">-</span>»</span> делает
                командную строку более удобочитаемой для человека. Сравните:
                </p><pre class="synopsis">
fbsvcmgr service_mgr user sysdba password masterkey
  action_db_stats dbname employee sts_hdr_pages                
            </pre><p>
                и
                </p><pre class="synopsis">
fbsvcmgr service_mgr -user sysdba -password masterkey
  -action_db_stats -dbname employee -sts_hdr_pages                
            </pre><p>
            </p></section><section class="section" id="d0e15010"><div class="titlepage"><div><div><h3 class="title">Синтаксис SPB</h3></div></div></div><p>Синтаксис SPB, который понимает <span class="application">fbsvcmgr</span>, почти
                совпадает с тем, который можно увидеть в файле <code class="filename">ibase.h</code> или в
                документации по InterBase 6.0 API. Чтобы сократить набор текста и сделать командную
                строку немного короче, используется немного сокращенная форма.</p><p>Все параметры SPB имеют одну из двух форм: (1)
                        <code class="code">isc_spb_<em class="replaceable"><code>VALUE</code></em></code> или (2)
                        <code class="code">isc_<em class="replaceable"><code>VALUE1</code></em>_svc_<em class="replaceable"><code>VALUE2</code></em></code>.
                При использовании fbsvcmgr для первого варианта нужно просто набрать
                        <code class="code"><em class="replaceable"><code>VALUE</code></em></code>, для второго —
                        <code class="code"><em class="replaceable"><code>VALUE1</code></em>_<em class="replaceable"><code>VALUE2</code></em></code>.
                Например:
                </p><pre class="programlisting">
isc_spb_dbname =&gt; dbname
isc_action_svc_backup =&gt; action_backup
isc_spb_sec_username =&gt; sec_username
isc_info_svc_get_env_lock =&gt; info_get_env_lock                
            </pre><p>
                и так далее. </p><div class="note"><h3 class="title">Примечание</h3><p>Исключением является <code class="code">isc_spb_user_name</code>: оно может быть указано
                    как user_name или просто как user.</p></div><section class="section" id="d0e15056"><div class="titlepage"><div><div><h4 class="title">Особенности синтаксиса fbsvcmgr</h4></div></div></div><p>Используя <span class="application">fbsvcmgr</span>, вы можете выполнить одно
                    действие (и получить результаты его выполнения, когда они доступны) или получить
                    несколько информационных элементов от менеджера служб. Например:
                    </p><pre class="synopsis">
fbsvcmgr service_mgr -user sysdba -password masterkey -action_display_user
                </pre><p>
                    выведет список пользователей на локальном сервере
                    </p><pre class="screen">
Login                        Full name                                 uid  gid adm
SYSDBA                                                                   0    0  no
NORMAN                                                                   0    0  no
EPOCMAN                      Benoit Gilles Mascia                        0    0  no
BOSS                                                                     0    0  no
NEWADMIN                     New Admin User                              0    0  no
                    </pre><p>
                    и
                    </p><pre class="synopsis">
fbsvcmgr service_mgr -user sysdba -password masterkey -info_server_version 
  -info_implementation
                </pre><p>
                    выведет информацию о версии сервера и его реализации
                    </p><pre class="screen">
Server version: WI-V3.0.6.33254 Firebird 3.0
Server implementation: Firebird/Windows/AMD/Intel/x64                        
                    </pre><p>
                    Но попытка смешать все это в одной командной строке:
                    </p><pre class="synopsis">
fbsvcmgr service_mgr -user sysdba -password masterkey -action_display_user 
  -info_server_version -info_implementation
                </pre><p>
                    выдаст ошибку:
                    </p><pre class="screen">
Unknown switch "-info_server_version"                        
                    </pre><p>
                </p></section></section></section><section class="section" id="d0e15082"><div class="titlepage"><div><div><h2 class="title" style="clear: both">Получение справки</h2></div></div></div><p>Запуск fbsvcmgr без параметров приводит к отображению экрана с сокращенной справочной
            информацией:
            </p><pre class="screen">
Usage: fbsvcmgr manager-name switches...
Manager-name should be service_mgr, may be prefixed with host name
according to common rules (host:service_mgr, \\host\service_mgr).
Switches exactly match SPB tags, used in abbreviated form.
Remove isc_, spb_ and svc_ parts of tag and you will get the switch.
For example: isc_action_svc_backup is specified as action_backup,
             isc_spb_dbname =&gt; dbname,
             isc_info_svc_implementation =&gt; info_implementation,
             isc_spb_prp_db_online =&gt; prp_db_online and so on.
You may specify single action or multiple info items when calling fbsvcmgr once.
Full command line samples:
fbsvcmgr service_mgr user sysdba password masterkey action_db_stats dbname employee sts_hdr_pages
  (will list header info in database employee on local machine)
fbsvcmgr yourserver:service_mgr user sysdba password masterkey info_server_version info_svr_db_info
  (will show firebird version and databases usage on yourserver)
To get full list of known services run with -? switch            
        </pre><p>
        </p><p>Как сказано в последнем предложении запуск <span class="application">fbsvcmgr</span> с
            переключателем <code class="code">-?</code> выведет дополнительную информацию об общих параметрах,
            список информационных тегов, список доступных сервисов и их параметры:
            </p><pre class="screen">
Attaching to services manager:
user [string value]
user_name [string value]
role [string value]
sql_role_name [string value]
password [string value]
fetch_password [file name]
trusted_auth
expected_db [string value]

Information requests:
info_server_version
info_implementation
info_user_dbpath
info_get_env
info_get_env_lock
info_get_env_msg
info_svr_db_info
info_version
info_capabilities

Actions:
action_backup:
    dbname [string value]
    verbose
    bkp_file [string value]
    bkp_length [int32 value]
    bkp_factor [int32 value]
    bkp_ignore_checksums
    bkp_ignore_limbo
    bkp_metadata_only
    bkp_no_garbage_collect
    bkp_old_descriptions
    bkp_non_transportable
    bkp_convert
    bkp_no_triggers
    verbint [int32 value]
    bkp_skip_data [string value]
    bkp_stat [string value]
action_restore:
    bkp_file [string value]
    dbname [string value]
    res_length [int32 value]
    verbose
    res_buffers [int32 value]
    res_page_size [int32 value]
    res_access_mode [prp_am_readonly | prp_am_readwrite]
    res_deactivate_idx
    res_no_shadow
    res_no_validity
    res_one_at_a_time
    res_replace
    res_create
    res_use_all_space
    res_fix_fss_data [string value]
    res_fix_fss_metadata [string value]
    res_metadata_only
    verbint [int32 value]
    res_skip_data [string value]
    res_stat [string value]
action_properties:
    dbname [string value]
    prp_page_buffers [int32 value]
    prp_sweep_interval [int32 value]
    prp_shutdown_db [int32 value]
    prp_deny_new_transactions [int32 value]
    prp_deny_new_attachments [int32 value]
    prp_set_sql_dialect [int32 value]
    prp_access_mode [prp_am_readonly | prp_am_readwrite]
    prp_reserve_space [prp_res_use_full | prp_res]
    prp_write_mode [prp_wm_async | prp_wm_sync]
    prp_activate
    prp_db_online
    prp_force_shutdown [int32 value]
    prp_attachments_shutdown [int32 value]
    prp_transactions_shutdown [int32 value]
    prp_shutdown_mode [prp_sm_normal | prp_sm_multi | prp_sm_single | prp_sm_full]
    prp_online_mode [prp_sm_normal | prp_sm_multi | prp_sm_single | prp_sm_full]
    prp_nolinger
action_repair:
    dbname [string value]
    rpr_commit_trans [int32 value]
    rpr_rollback_trans [int32 value]
    rpr_recover_two_phase [int32 value]
    rpr_commit_trans_64 [int64 value]
    rpr_rollback_trans_64 [int64 value]
    rpr_recover_two_phase_64 [int64 value]
    rpr_check_db
    rpr_ignore_checksum
    rpr_kill_shadows
    rpr_mend_db
    rpr_validate_db
    rpr_full
    rpr_sweep_db
    rpr_list_limbo_trans
    rpr_icu
action_db_stats:
    dbname [string value]
    sts_record_versions
    sts_nocreation
    sts_table [string value]
    sts_data_pages
    sts_hdr_pages
    sts_idx_pages
    sts_sys_relations
    sts_encryption
action_get_fb_log
action_get_ib_log
action_display_user:
    dbname [string value]
    sec_username [string value]
    sql_role_name [string value]
action_display_user_adm:
    dbname [string value]
    sec_username [string value]
    sql_role_name [string value]
action_add_user:
    dbname [string value]
    sec_username [string value]
    sql_role_name [string value]
    sec_password [string value]
    sec_groupname [string value]
    sec_firstname [string value]
    sec_middlename [string value]
    sec_lastname [string value]
    sec_userid [int32 value]
    sec_groupid [int32 value]
    sec_admin [int32 value]
action_delete_user:
    dbname [string value]
    sec_username [string value]
    sql_role_name [string value]
action_modify_user:
    dbname [string value]
    sec_username [string value]
    sql_role_name [string value]
    sec_password [string value]
    sec_groupname [string value]
    sec_firstname [string value]
    sec_middlename [string value]
    sec_lastname [string value]
    sec_userid [int32 value]
    sec_groupid [int32 value]
    sec_admin [int32 value]
action_nbak:
    dbname [string value]
    nbk_file [string value]
    nbk_level [int32 value]
    nbk_no_triggers
    nbk_direct [string value]
action_nrest:
    dbname [string value]
    nbk_file [string value]
action_trace_start:
    trc_cfg [file name]
    trc_name [string value]
action_trace_suspend:
    trc_id [int32 value]
action_trace_resume:
    trc_id [int32 value]
action_trace_stop:
    trc_id [int32 value]
action_trace_list
action_set_mapping:
    dbname [string value]
    sql_role_name [string value]
action_drop_mapping:
    dbname [string value]
    sql_role_name [string value]
action_validate:
    dbname [string value]
    val_tab_incl [string value]
    val_tab_excl [string value]
    val_idx_incl [string value]
    val_idx_excl [string value]
    val_lock_timeout [int32 value]            
        </pre><p>
        </p></section><section class="section" id="d0e15101"><div class="titlepage"><div><div><h2 class="title" style="clear: both">Параметры подключения к службе</h2></div></div></div><div class="table" id="d0e15104"><div class="table-title">Таблица 13.1. Параметры подключения к службе</div><div class="table-contents"><table style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; "><colgroup><col class="c1"/><col class="c2"/></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">Опция</th><th style="border-bottom: 1px solid ; ">Описание</th></tr></thead><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
                            <p><code class="code">user [string value]</code></p>
                            <p><code class="code">user_name [string value]</code></p>
                        </td><td style="border-bottom: 1px solid ; "><p>Имя пользователя</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
                            <p><code class="code">role [string value]</code></p>
                            <p><code class="code">sql_role_name [string value]</code></p>
                        </td><td style="border-bottom: 1px solid ; "><p>Имя роли</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
                            <p><code class="code">password [string value]</code></p>
                        </td><td style="border-bottom: 1px solid ; "><p>Пароль пользователя</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
                            <p><code class="code">fetch_password [file name]</code></p>
                        </td><td style="border-bottom: 1px solid ; "><p>Извлечение пароля из файла</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
                            <p><code class="code">trusted_auth</code></p>
                        </td><td style="border-bottom: 1px solid ; "><p>Использование доверительной аутентификации</p></td></tr><tr><td style="border-right: 1px solid ; ">
                            <p><code class="code">expected_db [string value]</code></p>
                        </td><td><p>Указание не стандартной базы данных безопасности. Подробное
                                описание параметра см. ниже.</p></td></tr></tbody></table></div></div><br class="table-break"/><section class="section" id="d0e15185"><div class="titlepage"><div><div><h3 class="title">Использование служб с базой данных безопасности не по умолчанию</h3></div></div></div><p>Если вы хотите использовать API служб для доступа к базе данных, которая настроена
                на использование базы данных безопасности не по умолчанию, то при подключении к
                диспетчеру служб следует использовать элемент SPB <code class="code">isc_spb_expected_db</code>.
                Значением этого элемента является база данных, к которой ожидается доступ.</p><p>Если необходим доступ к службам из старых программ с использованием нестандартной
                базы данных безопасности, то существует обходной путь: установка переменной среды
                    <code class="envar">FB_EXPECTED_DB</code>, которая будет автоматически добавлена ​​в
                SPB.</p><p>Пример. Представьте, что у нас есть следующие строки в
                    <code class="filename">database.conf</code>:
                </p><pre class="programlisting">
employee = $(dir_sampledb)/employee.fdb
{
  SecurityDatabase = employee
}                
            </pre><p>
                то есть база данных employee настроена как база данных безопасности для себя. </p><p>Для доступа к нему с помощью <span class="application">fbsvcmgr</span> необходимо
                использовать следующую командную строку:
                </p><pre class="synopsis">
fbsvcmgr host:service_mgr -user sysdba -password xxx -expected_db employee 
  -action_db_stats -dbname employee -sts_data_pages                
            </pre><p>
            </p><p>Или можно заранее установить переменную окружения <code class="envar">FB_EXPECTED_DB</code>:
                </p><pre class="synopsis">
export FB_EXPECTED_DB=employee
fbsvcmgr host:service_mgr -user sysdba -password xxx -action_db_stats 
  -dbname employee -sts_data_pages               
            </pre><p>
            </p><p>Естественно здесь может быть использовано любое другое действие.</p></section></section><section class="section" id="d0e15224"><div class="titlepage"><div><div><h2 class="title" style="clear: both">Информационные запросы</h2></div></div></div><p>Как было сказано ранее, используя <span class="application">fbsvcmgr</span>, вы можете
            получить несколько информационных элементов за одно обращения, то есть следующие опции
            можно комбинировать в одной командной строке. Ответы для каждого информационного
            элемента буду получены в порядке их указания. </p><div class="table" id="d0e15232"><div class="table-title">Таблица 13.2. Опции информационных запросов</div><div class="table-contents"><table style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; "><colgroup><col class="c1"/><col class="c2"/></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">Опция</th><th style="border-bottom: 1px solid ; ">Описание</th></tr></thead><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
                            <p><code class="code">info_server_version</code></p>
                        </td><td style="border-bottom: 1px solid ; "><p>Выводит версию сервера</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
                            <p><code class="code">info_implementation</code></p>
                        </td><td style="border-bottom: 1px solid ; "><p>Выводит реализацию</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
                            <p><code class="code">info_user_dbpath</code></p>
                        </td><td style="border-bottom: 1px solid ; "><p>Выводит путь к базе данных безопасности</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
                            <p><code class="code">info_get_env</code></p>
                        </td><td style="border-bottom: 1px solid ; "><p>Выводит путь к корневой директории сервера</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
                            <p><code class="code">info_get_env_lock</code></p>
                        </td><td style="border-bottom: 1px solid ; "><p>Выводит путь к директории блокировок</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
                            <p><code class="code">info_get_env_msg</code></p>
                        </td><td style="border-bottom: 1px solid ; "><p>Выводит путь к директории в которой расположен файл сообщений
                                firebird.msg</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
                            <p><code class="code">info_svr_db_info</code></p>
                        </td><td style="border-bottom: 1px solid ; "><p>Выводит информацию о количестве подключений, количестве
                                открытых баз данных и полные пути к этим базам
                            данных.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
                            <p><code class="code">info_version</code></p>
                        </td><td style="border-bottom: 1px solid ; "><p>Выводит версию диспетчера служб</p></td></tr><tr><td style="border-right: 1px solid ; ">
                            <p><code class="code">info_capabilities</code></p>
                        </td><td><p>Выводит информацию о параметрах совместимости</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="example" id="d0e15335"><div class="example-title">Пример 13.1. Получение информации о версии сервера и реализации</div><div class="example-contents"><p>
                </p><pre class="synopsis">
fbsvcmgr localhost/3053:service_mgr -user sysdba -password masterkey -info_svr_db_info
</pre><p>
                </p><pre class="screen">
Databases:
   Number of attachments: 3
   Number of databases: 2
   Database in use: f:\fbdata\3.0\horses.fdb
   Database in use: f:\fbdata\3.0\test.fdb                    
                </pre><p>
            </p></div></div><br class="example-break"/><div class="example" id="d0e15346"><div class="example-title">Пример 13.2. Получение информации о версии сервера и реализации</div><div class="example-contents"><p>
                </p><pre class="synopsis">
fbsvcmgr service_mgr -user sysdba -password masterkey -info_server_version 
  -info_implementation
</pre><p>
                </p><pre class="screen">
Server version: WI-V3.0.6.33254 Firebird 3.0
Server implementation: Firebird/Windows/AMD/Intel/x64                 
                </pre><p>
            </p></div></div><br class="example-break"/></section><section class="section" id="d0e15357"><div class="titlepage"><div><div><h2 class="title" style="clear: both">Сервисные действия</h2></div></div></div><section class="section" id="d0e15360"><div class="titlepage"><div><div><h3 class="title">Резервная копия (gbak)</h3></div></div></div><p/></section><section class="section" id="d0e15364"><div class="titlepage"><div><div><h3 class="title">Восстановление (gbak)</h3></div></div></div><p/></section><section class="section" id="d0e15368"><div class="titlepage"><div><div><h3 class="title">Установка свойств базы данных action_properties (gfix)</h3></div></div></div><p/></section><section class="section" id="d0e15372"><div class="titlepage"><div><div><h3 class="title">Валидация, ремонт базы данных, sweep (gfix)</h3></div></div></div><p/></section><section class="section" id="d0e15376"><div class="titlepage"><div><div><h3 class="title">Статистика базы данных (gstat)</h3></div></div></div><p/></section><section class="section" id="d0e15380"><div class="titlepage"><div><div><h3 class="title">Управление пользователями (gsec)</h3></div></div></div><p/></section><section class="section" id="d0e15384"><div class="titlepage"><div><div><h3 class="title">Резервная копия (nbackup)</h3></div></div></div><p/></section><section class="section" id="d0e15388"><div class="titlepage"><div><div><h3 class="title">Восстановление (nbackup)</h3></div></div></div><p/></section><section class="section" id="d0e15392"><div class="titlepage"><div><div><h3 class="title">Управление трассировкой</h3></div></div></div><p/></section><section class="section" id="d0e15396"><div class="titlepage"><div><div><h3 class="title">Настройка отображения администраторов на RDB$ADMIN</h3></div></div></div><p/></section><section class="section" id="d0e15400"><div class="titlepage"><div><div><h3 class="title">Онлайн валидация базы данных</h3></div></div></div><p/></section></section></section></div><div class="part" id="tasks"><div class="titlepage"><div><div><h1 class="title">Часть III. Практические задачи</h1></div></div></div><section class="chapter" id="d0e15407"><div class="titlepage"><div><div><h2 class="title">Глава 14. Типичные проблемы с установкой</h2></div></div></div><p/><section class="section" id="d0e15411"><div class="titlepage"><div><div><h2 class="title" style="clear: both">На Windows</h2></div></div></div><p/></section><section class="section" id="d0e15415"><div class="titlepage"><div><div><h2 class="title" style="clear: both">На Linux</h2></div></div></div><p/></section></section><section class="chapter" id="d0e15419"><div class="titlepage"><div><div><h2 class="title">Глава 15. Разрешение проблем с сетевыми настройками между клиентом и сервером
                Firebird</h2></div></div></div><p/></section><section xml:lang="ru" class="chapter" id="hardware"><div class="titlepage"><div><div><h2 class="title">Глава 16. Конфигурирование и подбор аппаратного обеспечения</h2></div></div></div><section class="section" id="hardware-theory"><div class="titlepage"><div><div><h2 class="title" style="clear: both">Немного теории</h2></div></div></div><p>Чтобы понять, какое аппаратное обеспечение лучше всего подойдет для вашей БД Firebird,
            мы должны понять, как Firebird использует его компоненты: CPU, RAM, HDD/SSD, и как эти
            компоненты взаимодействуют с ОС (например, с файловым кэшем).</p><section class="section" id="hardware-theory-modules"><div class="titlepage"><div><div><h3 class="title">Функциональные модули сервера</h3></div></div></div><p>Прежде всего, мы рассмотрим функциональные компоненты Firebird, в чем нам поможет
                следующий рисунок: </p><div class="figure" id="d0e15437"><div class="figure-contents"><div class="mediaobject"><table style="border: 0; width: 680px; cellpadding: 0; cellspacing: 0;"><tr><td><img src="images/01-memory.png" width="680" alt="Firebird modules"/></td></tr></table></div></div><div class="figure-title">Рисунок 16.1. Firebird modules</div></div><p><br class="figure-break"/>
            </p><p>Firebird включает в себя следующие основные функциональные компоненты: </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Объекты метаданных — это представления таблиц, индексов, триггеров,
                            хранимых процедур и других объектов БД. Объекты метаданных располагаются
                            в адресном пространстве процесса Firebird (это может быть fbserver,
                            fb_inet_server или firebird.exe).</p></li><li class="listitem"><p>Кэш страничных буферов содержит страницы базы данных, прочитанные с
                            диска, и располагается в адресном пространстве процесса сервера.
                            Механизм кэширования страниц достаточно сложный, поэтому ограничимся
                            утверждением, что Firebird кэширует наиболее часто используемые страницы
                            базы данных.</p></li><li class="listitem"><p>При выполнении сортировок Firebird выполняет ее в памяти (в адресном
                            пространстве процесса сервера), пока размер используемой памяти для всех
                            выполняемых одновременно сортировок не достигнет предела, установленного
                            параметром TempCacheLimit (firebird.conf). При превышении этого лимита
                            создается временный файл (с соответствующим флагом операционной системы)
                            в папке временных файлов, и в нем выполняется сортировка. В случае, если
                            в системе есть свободная память (RAM), то файл сортировки будет
                            кэширован на уровне ОС и сортировка будет производиться в памяти.</p></li><li class="listitem"><p>Глобальные временные таблицы (GTT) создаются как временные файлы ОС.
                            При наличии свободной памяти у ОС операции с GTT выполняются в
                            RAM.</p></li></ol></div></section><section class="section" id="hardware-theory-hardware_operations"><div class="titlepage"><div><div><h3 class="title">Базовые операции с hardware</h3></div></div></div><p>Давайте рассмотрим взаимодействие функциональных модулей Firebird с компонентами
                hardware в контексте операций, которые выполняются при работе с базами
                данных.</p><p>При старте Firebird процесс сервера занимает в RAM минимальный объем (несколько
                мегабайт), и не производит никаких интенсивных операций с CPU или RAM.</p><p>При соединении с БД сервер начинает читать её метаданные и создавать
                соответствующие объекты в памяти, отчего размер процесса увеличивается
                пропорционально количеству используемых таблиц, индексов, триггеров и других
                метаданных. Использование памяти увеличивается, но CPU практически не задействован
                на этом этапе.</p><p>Когда клиент начинает выполнять SQL-запросы (включая хранимые процедуры), сервер
                выполняет соответствующие операции, обращающиеся к hardware. Среди этих операций мы
                можем выделить следующие базовые операции, взаимодействующие с компонентами
                hardware: </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>чтение страниц базы данных с диска;</p></li><li class="listitem"><p>запись страниц БД на диск;</p></li><li class="listitem"><p>чтение страниц базы данных из кэша;</p></li><li class="listitem"><p>запись страниц БД в кэш;</p></li><li class="listitem"><p>чтение и запись страниц данных в глобальные временные таблицы (Global
                            Temporary Tables);</p></li><li class="listitem"><p>обработка SQL запроса (например, JOINs );</p></li><li class="listitem"><p>сортировка записей в результирующем наборе данных (resultset).</p></li></ul></div><p>Для выполнения каждой из этой операции требуется определенный набор системных
                ресурсов. В таблице ниже представлено потребление ресурсов, выраженное в условных
                единицах интенсивности (1 означает небольшую интенсивность, 10 – максимальную): </p><div class="table" id="d0e15497"><div class="table-title">Таблица 16.1. Оценка затрат на различные операции</div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col style="text-align: left; "/><col style="text-align: left; "/><col style="text-align: left; "/><col style="text-align: left; "/><col style="text-align: left; "/><col style="text-align: left; "/><col style="text-align: left; "/><col style="text-align: left; "/><col style="text-align: left; "/></colgroup><thead><tr valign="middle"><th style="text-align: center; vertical-align: middle; border-right: 1px solid ; border-bottom: 1px solid ; "> </th><th style="text-align: center; vertical-align: middle; border-right: 1px solid ; border-bottom: 1px solid ; ">Read page from disk</th><th style="text-align: center; vertical-align: middle; border-right: 1px solid ; border-bottom: 1px solid ; ">Write page to disk</th><th style="text-align: center; vertical-align: middle; border-right: 1px solid ; border-bottom: 1px solid ; ">Read page from page buffers cache</th><th style="text-align: center; vertical-align: middle; border-right: 1px solid ; border-bottom: 1px solid ; ">Write page to page buffers cache</th><th style="text-align: center; vertical-align: middle; border-right: 1px solid ; border-bottom: 1px solid ; ">Read from GTT</th><th style="text-align: center; vertical-align: middle; border-right: 1px solid ; border-bottom: 1px solid ; ">Write to GTT</th><th style="text-align: center; vertical-align: middle; border-right: 1px solid ; border-bottom: 1px solid ; ">Сортировка записей</th><th style="text-align: center; vertical-align: middle; border-bottom: 1px solid ; ">Обработка SQL</th></tr></thead><tbody><tr valign="middle"><td style="text-align: left; vertical-align: middle; border-right: 1px solid ; border-bottom: 1px solid ; ">CPU</td><td style="text-align: left; vertical-align: middle; border-right: 1px solid ; border-bottom: 1px solid ; ">1</td><td style="text-align: left; vertical-align: middle; border-right: 1px solid ; border-bottom: 1px solid ; ">1</td><td style="text-align: left; vertical-align: middle; border-right: 1px solid ; border-bottom: 1px solid ; ">1</td><td style="text-align: left; vertical-align: middle; border-right: 1px solid ; border-bottom: 1px solid ; ">1</td><td style="text-align: left; vertical-align: middle; border-right: 1px solid ; border-bottom: 1px solid ; ">1</td><td style="text-align: left; vertical-align: middle; border-right: 1px solid ; border-bottom: 1px solid ; ">1</td><td style="text-align: left; vertical-align: middle; border-right: 1px solid ; border-bottom: 1px solid ; ">5</td><td style="text-align: left; vertical-align: middle; border-bottom: 1px solid ; ">10</td></tr><tr><td style="text-align: left; border-right: 1px solid ; border-bottom: 1px solid ; ">RAM</td><td style="text-align: left; border-right: 1px solid ; border-bottom: 1px solid ; ">5</td><td style="text-align: left; border-right: 1px solid ; border-bottom: 1px solid ; ">5</td><td style="text-align: left; border-right: 1px solid ; border-bottom: 1px solid ; ">5</td><td style="text-align: left; border-right: 1px solid ; border-bottom: 1px solid ; ">5</td><td style="text-align: left; border-right: 1px solid ; border-bottom: 1px solid ; ">5</td><td style="text-align: left; border-right: 1px solid ; border-bottom: 1px solid ; ">5</td><td style="text-align: left; border-right: 1px solid ; border-bottom: 1px solid ; ">5</td><td style="text-align: left; border-bottom: 1px solid ; ">2</td></tr><tr><td style="text-align: left; border-right: 1px solid ; ">Disk IO</td><td style="text-align: left; border-right: 1px solid ; ">10</td><td style="text-align: left; border-right: 1px solid ; ">10</td><td style="text-align: left; border-right: 1px solid ; ">1</td><td style="text-align: left; border-right: 1px solid ; ">1</td><td style="text-align: left; border-right: 1px solid ; ">1</td><td style="text-align: left; border-right: 1px solid ; ">1</td><td style="text-align: left; border-right: 1px solid ; ">1</td><td style="text-align: left; ">1</td></tr></tbody></table></div></div><p><br class="table-break"/>
            </p><p>Как видите, что наиболее тяжелыми операциями являются те, которые включают работу
                с диском, так как дисковая подсистема, несмотря на прогресс последних лет, связанный
                с SSD, все равно является наиболее медленным компонентом hardware. </p><div class="note"><h3 class="title">Примечание</h3><p>Отсюда вытекает одно из направлений оптимизации производительности, в
                        полной мере относящееся к hardware – максимально переносить все операции
                        чтения-записи в RAM. Сразу отметим, что подход «давайте сделаем страничный
                        кэш побольше» не работает. Мы подробно рассмотрим этот вопрос в разделе
                        «RAM».</p></div><p>
            </p></section><section class="section" id="d0e15595"><div class="titlepage"><div><div><h3 class="title">Параллельность выполнения операций</h3></div></div></div><p>Обычно требует подобрать hardware для сервера, который будет обслуживать большое
                количество клиентов, поэтому важно понимать, как реализована параллельность
                выполнения операций.</p><p>С точки зрения компонентов аппаратного обеспечения можно говорить о параллельности
                использования CPU, диска и RAM. Современные CPU имеют несколько ядер, которые могут
                параллельно выполнять наборы инструкций, поэтому сервер СУБД распределяет операции
                между ядрами, то есть, можно сделать простой вывод – чем больше ядер у CPU, тем
                больше клиентов сможет работать на этом сервере.</p><p>С точки зрения дисковой подсистемы все не так однозначно. Традиционные жесткие
                диски (HDD) при считывании информации физически перемещают головку по магнитным
                дорожкам с некоторой конечной скоростью. База данных может быть достаточно большой,
                например, размером в 3 терабайта, и если клиентские SQL запросы будут параллельно
                обращаться к данным, расположенным в разных областях файла, то головка диска будет
                метаться между разными областями диска, серьезно затормаживая процессы
                чтения-вывода. При этом значительно вырастет очередь диска, а остальные ресурсы
                (CPU, RAM) будут простаивать. Разумеется, кэш дисковой подсистемы (кэш диска или
                RAID-контроллера) в какой-то мере компенсирует такое замедление, но
                недостаточно.</p><p>SSD диски, в отличие от традиционных HDD, в значительно меньшей мере страдают от
                деградации производительности при параллельном доступе к данным. Особенно заметно
                преимущество SSD при параллельной записи данных – наши тесты показывали 7-кратное
                преимущество SSD над SATA (<a class="link" href="http://ib-aid.com/en/articles/firebird-performance-degradation-tests-myths-and-truth/" target="_top">http://ib-aid.com/en/articles/firebird-performance-degradation-tests-myths-and-truth/</a>
                ). Однако, у SSD есть ряд моментов, которые надо обязательно учитывать при
                эксплуатации (см. раздел «Выбор дисковой подсистемы»), чтобы избежать падения
                скорости работы, преждевременной поломки диска и потери данных.</p><p>Операции с RAM на современном компьютере выполняются очень быстро, практически
                ограничены только пропускной способностью шины данных, и поэтому не являются узким
                местом даже при множестве параллельных SQL-запросов.</p></section><section class="section" id="d0e15611"><div class="titlepage"><div><div><h3 class="title">Потоки данных</h3></div></div></div><p>При выполнении SQL-запросов Firebird читает и записывает большое количество
                данных, перемещает их между функциональными модулями и соответствующими компонентами
                hardware. Нам необходимо изучить пути, по которым происходит обмен данными, чтобы
                идентифицировать возможные узкие места, в этом нам поможет рисунок ниже: </p><div class="figure" id="d0e15616"><div class="figure-contents"><div class="mediaobject"><table style="border: 0; width: 680px; cellpadding: 0; cellspacing: 0;"><tr><td><img src="images/02-data-flows.png" width="680" alt="Data flows between RAM and persistent storage"/></td></tr></table></div></div><div class="figure-title">Рисунок 16.2. Data flows between RAM and persistent storage</div></div><p><br class="figure-break"/>
            </p><p>Очевидно, что основные затраты времени возникают при перемещении данных из
                постоянного хранилища в RAM и назад. При этом возникает два потока данных –
                чтение/запись страниц данных файла базы данных и чтение/запись файлов сортировок.
                Так как файлов сортировок может быть несколько и они могут быть достаточно большими,
                то они могут существенно нагружать дисковую подсистему, поэтому желательно развести
                эти потоки ввода-вывода по разным дискам.</p></section><section class="section" id="d0e15628"><div class="titlepage"><div><div><h3 class="title">Резервное копирование</h3></div></div></div><p>Firebird предлагает 2 способа резервного копирования – верифицированный backup с
                помощью утилиты gbak, и неверифицированный инкрементальный backup c помощью утилиты
                nbackup.</p><p>Бэкап с помощью gbak является верифицированным, т.к. при его создании происходит
                чтение каждой записи в каждой таблице БД, и таким образом проверяется целостность
                информации в БД, а nbackup при создании бэкапа переносит страницы данных целиком, не
                проверяет целостность данных, и соответственно, является неверифицированным. </p><div class="tip"><h3 class="title">Подсказка</h3><p>Мы рекомендуем использовать комбинацию средств резервного копирования –
                        частые запуски nbackup (например, каждый час, день и неделю) и ежедневный
                        ночной верифицируемый backup с помощью gbak.</p></div><p>
            </p><p>При резервном копировании любым способом происходит чтение файла базы данных
                (всего или части), и запись резервной копии (полной или частичной). Операции записи
                при создании резервной копии идут последовательно, это означает, что обычные
                недорогие жесткие диски с интерфейсом SATA (HDD SATA) хорошо подойдут для хранения
                резервных копий, так как скорость последовательной записи у них довольно
                велика.</p></section></section><section class="section" id="d0e15641"><div class="titlepage"><div><div><h2 class="title" style="clear: both">Выбор подходящего железа</h2></div></div></div><p>Теперь, когда мы представляем, как Firebird взаимодействует с аппаратным обеспечением,
            необходимо подробно рассмотреть факторы, влияющие на выбор конкретного компонента и его
            характеристики.</p><p>В ряде случаев на выбор компонентов hardware сильно влияют реальные статистические
            данные конкретной БД, поэтому мы будем использовать инструменты из HQbird
            (профессионального дистрибутива Firebird для предприятий от IBSurgeon) для получения
            этих характеристик. Вы можете скачать триальную версию HQbird на сайте <a class="link" href="http://ib-aid.com/en/hqbird/" target="_top">http://ib-aid.com/en/hqbird/</a>.</p><section class="section" id="d0e15651"><div class="titlepage"><div><div><h3 class="title">CPU</h3></div></div></div><p>Для выбора CPU необходимо учитывать 3 вещи:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Какие запросы преобладают в приложении</p></li><li class="listitem"><p>Количество активных соединений с БД в среднем и в моменты пиковой
                            нагрузки</p></li><li class="listitem"><p>Версию и архитектуру Firebird</p></li></ol></div><section class="section" id="d0e15666"><div class="titlepage"><div><div><h4 class="title">Какие запросы преобладают в приложении?</h4></div></div></div><p>Firebird всегда исполняет один запрос на одном ядре, поэтому сложные или плохо
                    оптимизированные запросы могут занимать до 100% одного ядра, заставляя остальные
                    запросы переместиться на менее загруженные ядра, и чем больше ядер, тем меньше
                    шанс, что все процессорные мощности будут заняты, а пользователи увидят
                    замедление работы приложения.</p><p>Если приложение в основном исполняет простые короткие SQL запросы, все запросы
                    хорошо отлажены, и не используется генерация запросов на лету (ad hoc)
                    (например, для отчетов), то CPU не будет являться узким местом
                    производительности, и можно выбрать младшую модель с меньшим количеством
                    ядер.</p><p>Если приложение содержит генератор отчетов или большое количество медленных
                    запросов, возвращающих большое количество данных, то необходим процессор с
                    большим количеством ядер.</p></section><section class="section" id="d0e15675"><div class="titlepage"><div><div><h4 class="title">Количество активных соединений с БД в среднем и в моменты пиковой
                    нагрузки</h4></div></div></div><p>Количество соединений (активных пользователей) также влияет на выбор CPU. К
                    сожалению, часто даже разработчики приложений не представляют, сколько в
                    точности соединений, запросов и транзакций выполняется в данный конкретный
                    момент. Для уточнения этой информации мы рекомендуем воспользоваться
                    инструментом MON$ Logger из HQbird, и снять несколько снэпшотов в моменты
                    рабочей нагрузки, на которых будет четко видно, сколько в действительности
                    установлено соединений. </p><div class="figure" id="d0e15680"><div class="figure-contents"><div class="mediaobject"><table style="border: 0; width: 680px; cellpadding: 0; cellspacing: 0;"><tr><td><img src="images/03-number-of-attachments.png" width="680" alt="MON$Logger: number of attachments"/></td></tr></table></div></div><div class="figure-title">Рисунок 16.3. MON$Logger: number of attachments</div></div><p><br class="figure-break"/>
                </p><p>Например, в данном примере видно, что число соединений составляет 296.
                    Очевидно, что использование 4-х ядерного процессора в данном случае будет
                    слишком оптимистичным, а вот 24-ядерный вариант вполне подойдет. Также
                    желательно подсчитать число одновременно активных запросов, так как соединения
                    могут простаивать, не выполняя никаких SQL запросов. </p><div class="tip"><h3 class="title">Подсказка</h3><p>Для грубой оценки необходимого количества ядер в CPU можно
                            пользоваться правилом от 10 до 30 соединений на 1 ядро. 10
                            пользователей/ядро – приложение с преобладанием сложных и медленных
                            запросов, 30 соединений/ядро – приложение с преобладанием простых,
                            хорошо отлаженных запросов. Для более точной оценки можно посмотреть на
                            закладке Statements число активных запросов (состояние Active) и всех
                            остальных (IDLE И др.) </p></div><p>
                </p></section><section class="section" id="d0e15696"><div class="titlepage"><div><div><h4 class="title">Версия и архитектура Firebird</h4></div></div></div><p>Если Вы используете версию Firebird 2.5, то следует иметь в виду, что для
                    распараллеливания обработки на несколько ядер следует использовать архитектуры
                    Classic или SuperClassic. Архитектура SuperServer в версии 2.5 может
                    использовать только одно ядро на одну БД, поэтому ее не следует применять в
                    высоконагруженных системах.</p><p>В версии Firebird 3.0 и SuperServer, и Classic, и SuperClassic используют
                    возможности многоядерных CPU. Наибольшую производительность показывает Firebird
                    3.0 SuperServer.</p></section></section><section class="section" id="d0e15703"><div class="titlepage"><div><div><h3 class="title">RAM</h3></div></div></div><p>При выборе RAM следует уделить внимание 2 моментам:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Модули памяти должны быть с коррекцией ошибок (ECC RAM)</p></li><li class="listitem"><p>Правильно рассчитать объем RAM</p></li></ol></div><section class="section" id="d0e15715"><div class="titlepage"><div><div><h4 class="title">ECC RAM</h4></div></div></div><p>ECC RAM значительно снижает количество ошибок при работе с памятью и
                    настоятельно рекомендуется для использования в промышленных системах.</p></section><section class="section" id="d0e15720"><div class="titlepage"><div><div><h4 class="title">Расчет необходимого объема RAM</h4></div></div></div><p>Для расчета памяти нам придется немного углубиться в особенности различных
                    архитектур Firebird.</p><p>Firebird 2.5 архитектуры Classicи Firebird 3.0 Classic запускают отдельный
                    процесс для обслуживания каждого соединение, SuperClassic запускает отдельный
                    поток для каждого соединения, но практически с той же структурой потребления
                    памяти – каждое соединение имеет свой независимый страничный кэш.</p><p>Firebird SuperServer запускает один процесс с единым страничным кэшем для всех
                    соединений.</p><p>Таким образом, потребление памяти складывается из следующих основных параметров:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Количество соединений</p></li><li class="listitem"><p>Размер страницы базы данных</p></li><li class="listitem"><p>Размер объектов метаданных (пропорционален количеству таблиц,
                                триггеров, хранимых процедур и др., не регулируется, определяется по
                                фактическому использованию)</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Для Classic и SuperClassic – на соединение</p></li><li class="listitem"><p>Для SuperServer – на экземпляр открытой базы
                                            данных</p></li></ul></div></li><li class="listitem"><p>Размер страничного кэша (определяется параметрами в заголовке БД
                                или в firebird.conf или в свойствах конкретного соединения)</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Для Classic и SuperClassic – на соединение</p></li><li class="listitem"><p>Для SuperServer – на экземпляр открытой базы
                                            данных</p></li></ul></div></li><li class="listitem"><p>Размер кэша для сортировок (определяется параметром в
                                    firebird.conf<span class="italic">) </span>Обратите
                                внимание, что память для сортировок выделяется по мере
                                необходимости, а не сразу же.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Для Classic – на соединение</p></li><li class="listitem"><p>Для Super Serverи SuperClassic – на процесс (т.е., кэш
                                            сортировок единый)</p></li></ul></div></li><li class="listitem"><p>Для Classic/SuperClassic – размер таблицы блокировок (так как
                                обычно он небольшой, то его выведем из расчетов).</p></li></ol></div><p>Компанией IBSurgeon в ряде экспериментов получен ряд оптимальных значений
                    количества страниц в страничном кэше Firebird:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Classic/SuperClassic – от 256 до 2000 страниц</p></li><li class="listitem"><p>SuperServer 2.5 – 10000 страниц</p></li><li class="listitem"><p>SuperServer 3.0 – 100000 страниц</p></li></ul></div><p>На основании этих экспериментов были созданы оптимизированные конфигурационные
                    файлы Firebird для серверов с 4-6Гб памяти, вы можете скачать их отсюда: <a class="link" href="http://ib-aid.com/ru/optimized-firebird-configuration/" target="_top">http://ib-aid.com/ru/optimized-firebird-configuration/</a></p><section class="section" id="d0e15790"><div class="titlepage"><div><div><h5 class="title">Формулы расчета необходимого объема RAM</h5></div></div></div><p>Ниже представлены формулы приблизительного расчета необходимого объема
                        памяти для Firebird. Реальное значение потребления памяти может отличаться,
                        так как в этом расчете не учитывается объем памяти под метаданные, под
                        битовые маски индексов, и т.д., что может увеличить расход памяти, но
                        одновременно предполагается, что память под сортировки будет использована
                        полностью во всех соединениях, чего обычно не происходит.</p><p>Когда база данных уже находится в эксплуатации, можно просто посмотреть
                        средний размер памяти, используемый процессом Firebird (с помощью
                        TaskManager или ProcessExplorer).</p><p><span class="formalpara-title">Расчет для Classic: </span>
                            </p><pre class="programlisting"> 
<em class="replaceable"><code>Кол-во соединений</code></em> * ((<em class="replaceable"><code>Кол-во страниц кэша</code></em> * <em class="replaceable"><code>Размер страницы</code></em>) + <em class="replaceable"><code>Размер кэша для сортировок</code></em>)
                        </pre><p>
                        </p><p>Пример для Classic: пусть мы ожидаем 100 активных пользователей, размер
                        страницы БД мы установили в 8Кб, а количество страниц в страничном кэше
                        установили в 256, размер кэша для сортировок увеличили с 8Мб (значение по
                        умолчанию для Classic и SuperClassic) до 64Мб:
                        </p><pre class="programlisting"> 
100*((256*8кб)+64 Мб) = 6600 Мб
                </pre><p>
                    </p><p><span class="formalpara-title">Расчет для SuperClassic: </span>
                            </p><pre class="programlisting"> 
<em class="replaceable"><code>Кол-во соединений</code></em> * (<em class="replaceable"><code>Кол-во страниц кэша</code></em> * <em class="replaceable"><code>Размер страницы</code></em>) + <em class="replaceable"><code>Размер кэша для сортировок</code></em>
                        </pre><p>
                        </p><p>Пример для SuperClassic: 100 пользователей, размер страницы БД 8Кб,
                        количество страниц в страничном кэше 256, размер кэша для сортировок 1024 Мб
                        </p><pre class="programlisting"> 
100*(256*8Кб) + 1024 Мб = 2024 Мб
                </pre><p>
                    </p><p><span class="formalpara-title">Расчет для SuperServer: </span>
                            </p><pre class="programlisting"> 
<em class="replaceable"><code>Кол-во страниц кэша</code></em> * <em class="replaceable"><code>Размер страницы</code></em> + <em class="replaceable"><code>Размер кэша для сортировок</code></em>
                        </pre><p>
                        </p><p>Пример для SuperServer (Firebird 2.5): 1БД, 100 пользователей, размер
                        страницы БД 8кб, количество страниц в страничном кэше 10000, размер кэша для
                        сортировок 1024 Мб:
                        </p><pre class="programlisting"> 
(10000*8Кб) + 1024 = 1102 Мб
                </pre><p>
                    </p><p>Пример для SuperServer (Firebird 3.0): 1 БД, 100 пользователей, размер
                        страницы БД 8кб, количество страниц в страничном кэше 100000, размер кэша
                        для сортировок 1024 Мб:
                        </p><pre class="programlisting"> 
(100000*8Кб) + 1024 = 1805 Мб
                </pre><p>
                    </p></section><section class="section" id="d0e15874"><div class="titlepage"><div><div><h5 class="title">Излишняя память</h5></div></div></div><p>Часто Firebird упрекают в неэффективном использовании памяти, когда
                        работающий процесс сервера потребляет небольшое количество RAM, а остающаяся
                        память якобы не используется.</p><p>На самом деле это неверное суждение, происходящее, в основном, из-за
                        непонимания работы механизма кэширования Firebird и несовершенства
                        инструментов мониторинга операционных систем. </p><p>Прежде всего, необходимо четко представлять, что Firebird активно
                        использует файловый кэш операционной системы. Когда страница загружается в
                        страничный кэш Firebird, она проходит через файловый кэш ОС. Когда Firebird
                        выгружает страницу из своего страничного кэша, операционная система при
                        наличии свободной памяти продолжает держать этот кусок базы данных в RAM. </p><div class="figure" id="d0e15883"><div class="figure-contents"><div class="mediaobject"><img src="images/04-cache-levels.png" alt="Cache levels: Firebird, OS and storage"/></div></div><div class="figure-title">Рисунок 16.4. Cache levels: Firebird, OS and storage</div></div><p><br class="figure-break"/>
                    </p><p>Однако, при поверхностном взгляде, операционная система не показывает
                        занятую под файловую кэш память как используемую. Например, вот типичная
                        ситуация распределения памяти при работающем сервер Firebird, как ее
                        показывает TaskManager: </p><div class="figure" id="d0e15895"><div class="figure-contents"><div class="mediaobject"><table style="border: 0; width: 680px; cellpadding: 0; cellspacing: 0;"><tr><td><img src="images/05-taskmanager.png" width="680" alt="TaskManager does not show file cache usage"/></td></tr></table></div></div><div class="figure-title">Рисунок 16.5. TaskManager does not show file cache usage</div></div><p><br class="figure-break"/>
                    </p><p>Выглядит так, как будто используется только 6.3Гб из 16Гб.</p><p>Однако, если использовать инструмент RAMMap (из набора утилит SysInternals
                        от Microsoft), то картина выглядит более логичной: </p><div class="figure" id="d0e15909"><div class="figure-contents"><div class="mediaobject"><table style="border: 0; width: 680px; cellpadding: 0; cellspacing: 0;"><tr><td><img src="images/06-rammap.png" width="680" alt="RAMMap shows details about memory usage: mapped files are cached databases"/></td></tr></table></div></div><div class="figure-title">Рисунок 16.6. RAMMap shows details about memory usage: mapped files are cached
                                databases</div></div><p><br class="figure-break"/>
                    </p><p>Файлы баз данных (dbw350_fb252x64.fdb и dbw250_fb252x64.fdb) закэшированы
                        ОС, и занимают всю память, декларированную TaskManager как свободную: </p><div class="figure" id="d0e15921"><div class="figure-contents"><div class="mediaobject"><table style="border: 0; width: 680px; cellpadding: 0; cellspacing: 0;"><tr><td><img src="images/07-rampam-detail.png" width="680" alt="RAMMap: details about file cache usage"/></td></tr></table></div></div><div class="figure-title">Рисунок 16.7. RAMMap: details about file cache usage</div></div><p><br class="figure-break"/>
                    </p><p>Отсюда вывод — операционная система эффективно использует всю доступную
                        память для кэширования базы данных, вплоть до полной загрузки БД в
                        память.</p></section></section></section><section class="section" id="d0e15933"><div class="titlepage"><div><div><h3 class="title">Дисковая подсистема</h3></div></div></div><p>Правильная конфигурация дисковой подсистемы является очень важной частью выбора и
                конфигурирования нardware для Firebird, так как ошибки на этом этапе дорого
                обходятся и тяжело исправляются.</p><section class="section" id="d0e15938"><div class="titlepage"><div><div><h4 class="title">Отдельные диски для всего</h4></div></div></div><p>Чтобы уменьшить конкуренцию за дисковый ввод-вывод между операциями с файлом
                    БД, сортировками и резервными копиями, а также уменьшить шанс одновременной
                    потери и БД и резервных копий, рекомендуется иметь 3 разных диска (или
                    raid-массива): для БД, для временных файлов и для создания и хранения
                    бэкапов.</p><p>Когда мы говорим «отдельные диски», это означает, что физически потоки данных
                    должны идти через разные каналы ввода-вывода. Если создать 3 логических диска на
                    одном физическом диске, никакого улучшения производительности не произойдет.
                    Однако, если 3 логических диска будут организованы на устройстве хранения данных
                    (СХД), оснащенном многоканальными контроллерами, то производительность, скорее
                    всего, возрастет, так как устройство может распределять потоки данных между
                    контроллерами.</p><p>Иногда сообщают о том, что выделение отдельного диска для хранения файлов ОС и
                    swap-файла ОС приводит к увеличению производительности.</p></section><section class="section" id="d0e15947"><div class="titlepage"><div><div><h4 class="title">SSD для базы данных</h4></div></div></div><p>Для работы с базой данных лучше всего использовать SSD-диски, так как они
                    обеспечивают отличное масштабирование при параллельном вводе-выводе. Обязательно
                    следует использовать диски промышленного класса, с увеличенным числом циклов
                    перезаписи, иначе велик риск потери данных из-за поломки SSD.</p><p>Некоторое время назад SSD-диски страдали от повышенного износа в случае, если
                    на диске оставалось небольшое количество (менее 30%) свободного места. Упрощенно
                    излагая, каждое изменение на SSD диске пишется в новую свободную ячейку, поэтому
                    недостаток свободного места приводил к повышенному износу ячеек, которые
                    остались свободными, и сокращению срока жизни диска.</p><p>Производители современных контроллеров SSD декларируют, что эта проблема была
                    решена с помощью превентивного перемещения статичных данных, и теперь износ
                    ячеек идет более или менее равномерно. Однако, точные спецификации и алгоритмы
                    работы SSD закрыты производителями, поэтому мы все равно рекомендуем оставлять
                    до 30% места на SSD-дисках свободным, а ожидаемый срок жизни занижать и
                    планировать замену дисков не реже чем 1 раз в 3 года.</p><div class="informalexample"><p>Например, если размер Вашей БД в данный момент составляет 100Гб, рост БД
                        идет по 1Гб в месяц, то нельзя приобретать SSD минимального размера (120Гб),
                        а лучше выбрать следующий в линейке — 250Гб. В тоже время, покупка 512Gb SSD
                        будет пустой тратой денег, т.к. через 3 года диск будет желательно
                        заменить.</p></div><p>Наилучшим выбором является использование SSD эксклюзивно для работы с базой
                    данных, так как любые операции ввода-вывода сокращают срок службы дисков.</p></section><section class="section" id="d0e15961"><div class="titlepage"><div><div><h4 class="title">Диск для временных файлов</h4></div></div></div><p>Так как временные файлы на диске возникают только при отсутствии достаточного
                    количества RAM, то конечно, лучше всего вообще избегать их появления на диске.
                    Оценку количества и размера временных файлов в production системе можно провести
                    лишь путем мониторинга папки с временными файлами. Такой мониторинг осуществляет
                        <span class="application">FBDataGuard</span> из дистрибутива HQbird. Узнав,
                    сколько временных файлов сортировок и когда создается на диске, можно
                    соответствующим образом нарастить RAM и изменить параметры
                        <code class="filename">firebird.conf</code>.</p><p>В любом случае, Firebird требует указания папки, где будут хранится временные
                    файлы. Обычно его оставляют по умолчанию, т.е. используется папка ОС для
                    временных файлов. В случае, если свободной RAM достаточно, это достаточно
                    хороший выбор.</p><p>Однако, есть еще один важный момент в размещении временных файлов на диске –
                    это создание индексов при восстановлении верифицированного бэкапа (созданного
                    утилитой <span class="application">gbak</span>). При создании индекса создается
                    временный файл, который содержит все ключи этого индекса. Если база данных
                    достаточно велика, то размер индекса для какой-нибудь большой таблицы может быть
                    также значительным. Например, в БД размером 1 Тб индекс для самой большой
                    таблицы в 3.2 миллиардов записей в базе данных имеет размер 29 Гб, а при
                    создании такого индекса потребовалось 180 гигабайт свободного места: </p><div class="figure" id="d0e15979"><div class="figure-contents"><div class="mediaobject"><table style="border: 0; width: 680px; cellpadding: 0; cellspacing: 0;"><tr><td><img src="images/08-ibanalyst.png" width="680" alt="IBAnalyst: tables and indexes"/></td></tr></table></div></div><div class="figure-title">Рисунок 16.8. IBAnalyst: tables and indexes</div></div><p><br class="figure-break"/>
                </p><p>Чтобы предупредить исчерпание свободного места на системном диске, в
                    Firebird.conf указывают второй диск в качестве дополнительного резервного места:
                    </p><pre class="programlisting"> 
TempDirectories = C:\temp; H:\Temp
                </pre><p>
                </p><p>Если на первом диске пространство кончится, Firebird продолжит использовать
                    для временных файлов второй диск, и так далее.</p></section><section class="section" id="d0e15996"><div class="titlepage"><div><div><h4 class="title">HDD for backups</h4></div></div></div><p>Для создания и хранения бэкапов подойдут обычные HDD диски с интерфейсом SATA
                    или nSAS. Они обеспечивают быструю линейную запись и чтение файлов бэкапа, и
                    достаточно дешевы, чтобы не экономить на их размере, и хранить несколько
                    резервных копий.</p><p>Для создания и хранения бэкапов подойдут обычные HDD диски с интерфейсом SATA
                    или nSAS. Они обеспечивают быструю линейную запись и чтение файлов бэкапа, и
                    достаточно дешевы, чтобы не экономить на их размере, и хранить несколько
                    резервных копий.</p><p>Если же удалять предыдущий бэкап до окончания процесса создания нового,
                    возможна ситуация, что в результате сбоя копирования новый бэкап не будет
                    создан, старый уже удален, а база данных также повреждена, например, в
                    результате сбоя диска.</p><p>Если Вы используете рекомендованный выше способ организации резервного
                    копирования в виде комбинации инкрементального бэкапа в 3 уровнях и
                    верифицированного бэкапа один раз в сутки, хранением только 1 последней копии,
                    то формула расчета минимального необходимого места для бэкапа следующая:
                    </p><pre class="programlisting"> 
<em class="replaceable"><code>Размер_БД</code></em> * 3 + 0.2 * <em class="replaceable"><code>Размер_БД</code></em>
                </pre><p>
                </p><p><span class="formalpara-title">Пример расчета места, необходимого для бэкапа. </span>Пусть у нас есть БД в 100Гб, для которой мы храним 3 уровня
                        инкрементального бэкапа неделя-день-час (по 1 копии) и 1 копию ежедневного
                        верифицировованного бэкапа. Тогда резервные копии будут занимать следующее
                        место: </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Nbackup_level_0_weekly - 100Гб</p></li><li class="listitem"><p>Nbackup_level_1_daily – 5Гб (приблизительная оценка)</p></li><li class="listitem"><p>Nbackup_level_2_hourly – 200 Мб (приблизительная
                                    оценка)</p></li><li class="listitem"><p>Daily verified backup – 100Гб (приблизительная оценка)</p></li><li class="listitem"><p>Плюс нужен резерв в 110Гб для создания следующей копии
                                    бэкапа.</p></li></ul></div><p> Итого – 316Гб. </p><div class="important"><h3 class="title">Важно</h3><p>Размер инкрементного файла уровня 1 и выше зависит от количества страниц,
                        которые были изменены с момента предыдущего выполнения nbackup. Определить
                        размер этих файлов можно только экспериментально, т.к. объем изменений в БД
                        зависит от приложений. </p></div><div class="note"><h3 class="title">Примечание</h3><p>Разумеется, интеллектуальные средства резервного копирования (FBDataGuard
                        из HQbird), отследят недостаток места для бэкапов, предотвратят старт
                        неудачного бэкапа и вышлют соответствующее сообщение администратору.</p></div></section><section class="section" id="d0e16044"><div class="titlepage"><div><div><h4 class="title">HDD для базы данных</h4></div></div></div><p>Может случиться так, что SSD окажется слишком дорогим решением, или размер БД
                    слишком велик, и необходимо обойтись более дешевыми альтернативами.</p><p>В этом случае следует использовать HDD с интерфейсом SAS, при невозможности —
                    диски SATA с интерфейсом nSAS, и совсем бюджетный вариант — обычные диски
                    SATA.</p><p>Для ускорения работы жестких дисков (а также, надежности – см. ниже) следует
                    объединять их в RAID10. RAID10 – это комбинация зеркалирования (RAID1) и stripe
                    (RAID0). Хороший и правильно настроенный RAID контроллер с большим кэшем
                    является неплохой альтернативой SSD.</p></section><section class="section" id="d0e16053"><div class="titlepage"><div><div><h4 class="title">Надежность и RAID</h4></div></div></div><p>Разумеется, во всех упомянутых выше вариантах (за исключением диска,
                    выделенного эксклюзивно для временных файлов) следует увеличивать надежность
                    дисковой подсистемы путем объединения дисков в RAID. </p><p>
                    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Для SSD дисков следует обязательно использовать RAID1 – т.е. 2
                                «зеркальных» диска, на которые одновременно пишутся изменения, что
                                значительно уменьшит шанс полной потери данных. RAID 10 из SSD
                                скорее всего будет избыточным, т.к. шина RAID будет ограничивать
                                пропускную способность. Например, интерфейс 6 Гбит/с имеет
                                пропускную способность в 600 мегабайт в секунду, а современные
                                одиночные SSD уже достигли такой скорости. Таким образом, для RAID
                                10 мы получим тот же самый лимит в 600 мб/с. Разве что с PCI Express
                                3.0 можно организовывать RAID 10 из SSD, т.к. пропускная способность
                                этой шины уже 16 гигабит в секунду и выше. </p></li><li class="listitem"><p>Для HDD дисков, используемых для бэкапов, достаточно использовать
                                RAID1, который обеспечит надежное хранение бэкапов и приемлемую
                                скорость записи и чтения.</p></li><li class="listitem"><p>HDD диски, используемые для БД, необходимо объединять в RAID10
                                (минимум 4 диска), который обеспечит оптимальное сочетание
                                стоимости, надежности и производительности. Некоторые пользователи
                                используют также RAID5, жертвуя производительностью взамен
                                увеличенного пространства.</p></li></ul></div><p>
                </p></section><section class="section" id="d0e16071"><div class="titlepage"><div><div><h4 class="title">Настройка RAID</h4></div></div></div><p>Прежде всего, необходимо проверить наличие и заряд батареи резервного питания
                    (Backup Battery Unit, BBU) в RAID. При отсутствии данной батареи большинство
                    RAID переходят в режим безопасной записи (полностью отключено кэширование
                    записи), который обеспечивает меньшую скорость IO, чем обычный SATA диск!</p><div class="note"><h3 class="title">Примечание</h3><p>Именно с этим фактом связано большинство горестных писем в техподдержку от
                        пользователей, которые приобрели дорогой сервер и обнаружили, что он
                        работает медленнее, чем десктопный компьютер. К сожалению, часть вендоров по
                        умолчанию не снабжает свои RAID батареями, поэтому это первое, что
                        необходимо проверить и, при необходимости, исправить.</p></div><p>Затем необходимо провести настройку кэширования чтения и записи. Часто по
                    умолчанию кэш полностью выключен, а если мы хотим добиться приличной скорости от
                    RAID, то кэш необходимо включить.</p><p>Кроме включения кэша, необходимо проверить режим его работы, это может быть
                    write through и write back. Быстрый способ работы с кэшем – write back, в этом
                    случае изменения пишутся в кэш контроллера, и через некоторое время –
                    непосредственно на диск. </p><p>Проверка наличия батареи, кэша и режима работы RAID может быть осуществлена в
                    фирменных утилитах, которые производители поставляют вместе с RAID.</p><p>Современные RAID-контроллеры также имеют возможности тонкой настройки кэша —
                    его можно ориентировать на чтение или на запись. Обычно по умолчанию стоит
                    50%/50% на чтение-запись.</p><p>Чтобы определить, в каком отношении стоит настраивать кэш, можно вновь
                    воспользоваться инструментом MON$ Logger из продвинутого дистрибутива HQbird.
                    Она показывает отношение числа операций чтения к операциям записи (в
                    агрегированном виде с момента первого соединения к серверу): </p><div class="figure" id="d0e16089"><div class="figure-contents"><div class="mediaobject"><table style="border: 0; width: 680px; cellpadding: 0; cellspacing: 0;"><tr><td><img src="images/09-hqbird_monlogger.png" width="680" alt="HQbird MON$logger: reads/write ratio"/></td></tr></table></div></div><div class="figure-title">Рисунок 16.9. HQbird MON$logger: reads/write ratio</div></div><p><br class="figure-break"/>
                </p><p>Как видите, в данном примере операций чтения гораздо больше, чем операций
                    записи, поэтому имеет смысл настроить RAID контроллер на 80% чтений и 20%
                    записи.</p></section><section class="section" id="d0e16101"><div class="titlepage"><div><div><h4 class="title">СХД</h4></div></div></div><p>В последние годы получили распространение интегрированные системы хранения
                    данных (СХД), которые включают в себя массив дисков с гибкими возможностями
                    конфигурации (все типы RAID) и продвинутым кэшированием. Обычно СХД имеют
                    несколько контроллеров ввода-вывода, что позволяет обслуживать несколько
                    серверов одновременно, а также работать достаточно быстро. </p><p>Многие организации приобретают СХД и используют их для работы с базами данных
                    Firebird. При условии правильной настройки от СХД можно добиться очень хорошей
                    производительности. Основные моменты, которые нужно учитывать при использовании СХД:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Наличие нескольких высокопроизводительных контроллеров дисков,
                                обеспечивающих многоканальный обмен данными</p></li><li class="listitem"><p>Наличие батарей резервного питания (BBU), если они предусмотрены
                                конструкцией.</p></li><li class="listitem"><p>Диски для баз данных должны быть организованы в RAID10.</p></li><li class="listitem"><p>Кэш должен быть включен, режим записи установлен в write
                                back.</p></li><li class="listitem"><p>Если к СХД подключены несколько компьютеров, то каждый из них
                                обслуживается своим контроллером. </p></li><li class="listitem"><p>Установлены свежие драйвера для СХД. В нашей практике были случаи,
                                когда более новые драйвера обеспечивали 30% прирост скорости.</p></li><li class="listitem"><p>Если на СХД созданы несколько логических дисков (для БД, бэкапов,
                                ОС), то они разделены по каналам ввода вывода. Попытка использовать
                                один канал для всех дисков сразу приведет к снижению
                                производительности.</p></li><li class="listitem"><p>Аналогично, если СХД будут использовать сразу несколько серверов и
                                БД, производительность может уменьшиться из-за превышения полосы
                                пропускания (bandwidth) контроллеров ввода-вывода.</p></li><li class="listitem"><p>Часто используются комбинированные схемы, когда ОС и временные
                                файлы находятся на локальных дисках, а база данных и бэкапы на
                                СХД.</p></li></ol></div><p>Часто СХД используются в схеме «2 сервера – 1 СХД», с целью построения
                    отказоустойчивого кластера. Надо отметить, что такой кластер поможет победить
                    только проблемы, связанные непосредственно с поломкой hardware одного из
                    серверов, чтобы быстро переключиться на второй сервер. Если проблема возникнет с
                    СХД или с самой базой данных, то такое решение будет бесполезно.</p><p>Для построения реального отказоустойчивого решения необходимо использовать
                    решения с репликацией данных между экземплярами баз данных. Такие решения
                    доступны для Firebird 2.5 и 3.0.Вы можете обратиться на support@ib-aid.com,
                    чтобы узнать больше о решениях высокой доступности для Firebird.</p></section></section></section><section class="section" id="d0e16140"><div class="titlepage"><div><div><h2 class="title" style="clear: both">Краткие выводы и рекомендации</h2></div></div></div><p>Давайте коротко суммируем выводы и рекомендации по hardware для Firebird.</p><p>
            </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Необходимо использовать многоядерные CPU для обслуживания большого
                        количества пользователей</p></li><li class="listitem"><p>Оперативная память RAM – обязательное минимальное количество
                        рассчитывается из количества пользователей и параметров БД, количество сверх
                        того будет эффективно использоваться операционной системой для кэширования
                        файла БД.</p></li><li class="listitem"><p>Использовать отдельные диски для БД, temp-файлов и бэкапов</p></li><li class="listitem"><p>Для размещения БД лучше использовать SSD диски.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Резервировать от 30% свободного места на SSD дисках.</p></li><li class="listitem"><p>Желательно эксклюзивно использовать диск под БД.</p></li><li class="listitem"><p>Использовать SSD промышленного класса (с большим количеством
                                    циклов перезаписи).</p></li></ul></div></li><li class="listitem"><p>Обязательно использовать RAID.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Для SSD – RAID 1, для HDD – RAID10, для HDD под бэкапы –
                                    RAID1.</p></li><li class="listitem"><p>Обязательно проверять наличие и заряд батареи RAID</p></li><li class="listitem"><p>Обязательно проверять настройку write back/through (нужно
                                    ставить write back).</p></li><li class="listitem"><p>Ряд контроллеров имеет настройку размера кэша RAID, например,
                                    75% для чтения, 25% для записи, или 50/50, и т.д. Необходимо
                                    ставить Mon$logger, ПО для управления параметрами RAID, смотреть
                                    соотношение чтения и записи, и менять настройки RAID. </p></li><li class="listitem"><p>В использовании СХД есть свои плюсы и минусы, чтобы получить
                                    эффект от ее использования, необходимо правильно настраивать
                                    СХД.</p></li></ul></div></li><li class="listitem"><p>Для построения отказоустойчивого решения необходимо использовать решения с
                        репликацией, работающие на нескольких серверах.</p></li></ol></div><p>
        </p></section></section><section class="chapter" id="d0e16193"><div class="titlepage"><div><div><h2 class="title">Глава 17. Использование инструментов резервного копирования</h2></div></div></div><p/><section class="section" id="d0e16197"><div class="titlepage"><div><div><h2 class="title" style="clear: both">gbak</h2></div></div></div><p/></section><section class="section" id="d0e16201"><div class="titlepage"><div><div><h2 class="title" style="clear: both">nbackup</h2></div></div></div><p/></section></section><section class="chapter" id="d0e16205"><div class="titlepage"><div><div><h2 class="title">Глава 18. Использование инструмента валидации и починки БД gfix</h2></div></div></div><p/></section><section class="chapter" id="d0e16209"><div class="titlepage"><div><div><h2 class="title">Глава 19. Безопасность</h2></div></div></div><p/><section class="section" id="d0e16213"><div class="titlepage"><div><div><h2 class="title" style="clear: both">Плагины аутентификации и их использование</h2></div></div></div><p/></section><section class="section" id="d0e16217"><div class="titlepage"><div><div><h2 class="title" style="clear: both">Плагины шифрования и их использование</h2></div></div></div><p/></section></section><section xml:lang="ru" class="chapter" id="mon-tools"><div class="titlepage"><div><div><h2 class="title">Глава 20. Использование инструментов мониторинга Firebird</h2></div></div></div><p/><section class="section" id="d0e16226"><div class="titlepage"><div><div><h2 class="title" style="clear: both">Использование fb_lock_print</h2></div></div></div><p>Утилита <span class="application">fb_lock_print</span> служит для получения информации о
            состоянии лок-менеджера ФБ. Информация может быть выведена как в виде заголовка
            лок-таблицы, так и в виде развернутых данных о видах ресурсов, на которые установлены
            блокировки, владельцах этих блокировок и тех соединениях, кто ждёт высвобождения
            ресурсов (если такие есть).</p><p>Операция получения заголовка лок-таблицы выполняется очень быстро, без затрат
            ресурсов. Получение развернутой информации может потребовать (при сильной нагрузке)
            десятков секунд, в течение которых работа с базой будет приостановлена. Лог вывода при
            этом может достигать десятков и даже сотен мегабайт.</p><p>Утилита должна запускаться на том же сервере, где работает база (т.е. возможности
            удаленно получить содержимое лок-таблицы на сегодня нет).</p><p>Вызов может проводиться как для получения информации по конкретной базе данных (ключ
            "-d"), так и для получения информации о лок-таблице по имени её файла (ключ
            "-f").</p><p>При использовании ключа "-d", допускается указывать как файл, так и алиас базы.</p><p>Если над базой активно проводятся операции записи, то для получения консистентного
            состояния лок-таблицы настоятельно рекомендуется указывать дополнительно ключ "-c". Этот
            ключ приведёт к блокировке лок-таблицы, затем будет создана её копию, после чего
            лок-таблица разблокируется и анализ будет уже идти по данным из созданной копии.</p><p>В противном случае возможно зацикливание <span class="application">fb_lock_print</span> и
            получение бесконечного растущего лога. Кроме того, возможен вывод значений, совершенно
            невозможных с точки зрения здравого смысла, например:</p><pre class="screen">
Free requests (-1297897313): forward: 1052750528, backward: 997957440            
        </pre><p>Лок-таблица для базы создается в момент установки первого соединения с этой базой.
            Вызов <span class="application">fb_lock_print</span> с указанием базы, к которой нет
            подключений, приведёт к выводу:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>в поток STDOUT — сообщения "Unable to access lock table";</p></li><li class="listitem"><p>в поток STDERR — сообщения, текст которого зависит от операционной системы: </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>Linux: "shmem_data-&gt;sh_mem_length_mapped is 0"</p></li><li class="listitem"><p>Windows: "File for memory mapping is empty".</p></li></ul></div></li></ul></div><p>Код возврата (bash: $?; batch: errorlevel) при указании команде
                <span class="application">fb_lock_print</span> несуществующего файла БД или при указании
            базы, к которой нет подключений, всегда одинаковый и равен нулю.</p><section class="section" id="d0e16275"><div class="titlepage"><div><div><h3 class="title">Структура заголовка лок-таблицы</h3></div></div></div><p>При указании только имени базы (возможно, с ключом "-c"), выводится ЗАГОЛОВОК
                лок-таблицы.</p><p>Примеры вызова, возвращающие только заголовок лок-таблицы:</p><pre class="synopsis">
/opt/firebird/bin/fb_lock_print -c 
    -d employee 1&gt;/tmp/lkp_employee.log 2&gt;/tmp/lkp_employee.err
    
/opt/firebird/bin/fb_lock_print -f 
    /tmp/firebird/fb_lock_00fd0000000000009400220000000000 1&gt;/tmp/lkp.log 2&gt;
    /tmp/lkp.err                
            </pre><div class="note"><h3 class="title">Примечание</h3><p>Некоторые строки в командах перенесены на другую строку.</p></div><p>Пример заголовка (с нумерацией строк):</p><pre class="synopsis">
/opt/firebird/bin/fb_lock_print -c -d employee | cat -n                
            </pre><pre class="screen">LOCK_HEADER BLOCK
         Version: 146, Creation timestamp: 2017-12-07 11:42:46
         Active owner:      0, Length: 5242880, Used: 235688
         Enqs:   1195, Converts:     26, Rejects:     30, Blocks:     15
         Deadlock scans:      3, Deadlocks:      2, Scan interval:  33
         Acquires:   2150, Acquire blocks:     14, Spin count:   0
         Mutex wait: 0.7%
         Hash slots: 20011, Hash lengths (min/avg/max):    0/   0/   4
         Remove node:      0, Insert queue:      0, Insert prior:      0
         Owners (3):     forward: 172960, backward: 208096
         Free owners (2):        forward: 226648, backward: 217480
         Free locks (17):        forward: 174344, backward: 233744
         Free requests (236):    forward: 235544, backward: 224360</pre><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>LOCK_HEADER BLOCK</p></li><li class="listitem"><p><code class="code">Version: 146, Creation timestamp: 2017-12-07 11:42:46</code></p><p>Номер версии лок-таблицы и штамп времени, когда к базе был установлен
                        первое подключение.</p></li><li class="listitem"><p><code class="code">Active owner: 0, Length: 5242880, Used: 235688</code></p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Active owner — номер соединения с сервером, который в данный
                                момент занимает лок-таблицу. При запуске fb_lock_print с ключом "-c"
                                это значение всегда равно нулю.</p></li><li class="listitem"><p>Length — общий объём памяти, выделенный под лок-таблицу, см
                                параметр LockMemSize в firebird.conf (databases.conf). </p><p>Существует эмпирическое правило для выбора этого значения: </p><div class="equation" id="d0e16316"><div class="equation-title">Формула 20.1. </div><div class="equation-contents"><span class="mathphrase">LockMemSize_bytes = db_cache_pages *
                                        count_of_connections * 100</span></div></div><p><br class="equation-break"/>, где </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle; "><li class="listitem"><p>db_cache_pages — размер страничного кеша Firebird;</p></li><li class="listitem"><p>count_of_connections — ожидаемое максимальное количество
                                        подключений.</p></li></ul></div><p>Однако, правильнее выполнять мониторинг параметра Used лок-таблицы
                                в течении дня и устанавливать LockMemSize в значение, большее чем
                                зафиксированный максимум used в полтора-два раза.</p></li><li class="listitem"><p>Used — Объём памяти, используемый в момент получения снимка. Не
                                уменьшается, пока существует хотя бы 1 коннект. Когда Used будет
                                больше значения (Length - LockMemSize), произойдёт увеличение
                                размера лок-таблицы на число, указанное в параметре LockMemSize
                                файла конфигурации <code class="filename">firebird.conf</code>
                                    (<code class="filename">databases.conf</code>).</p></li></ul></div></li><li class="listitem"><p><code class="code">Enqs: 1195, Converts: 26, Rejects: 30, Blocks: 15</code></p><div class="itemizedlist"><p>Строка со счетчиками операций:</p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Enqs — запросы на установку новой блокировки;</p></li><li class="listitem"><p>Converts — изменения статуса блокировки (например, понижение её с
                                монопольной до shared)</p></li><li class="listitem"><p>Rejects — отказы в получении блокировки</p></li><li class="listitem"><p>Blocks — число ожиданий высвобождения ресурсов, на которые другими
                                соединениями были ранее установлены блокировки с уровнями,
                                несовместимыми с теми, которые запрашивают ожидающие соединения;
                                например, подключение, запрашивающий страницу на чтение, будет
                                ожидать её высвобождения, если на неё установлена блокировка для
                                записи другим соединением.</p></li></ul></div></li><li class="listitem"><p><code class="code">Deadlock scans: 3, Deadlocks: 2, Scan interval: 33</code></p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Deadlock scans — число длительных ожиданий (возможно,
                                продолжающихся и сейчас) установки блокировок на ресурсы. Под
                                "длительными" понимаются ожидания, превосходящие значение
                                    <em class="parameter"><code>DeadLockTimeout</code></em> секунд, указанное в
                                конфигурации
                                    <code class="filename">firebird.conf</code>/<code class="filename">databases.conf</code>.</p><p>Это общее число неудачных попыток установить блокировку на
                                какой-либо ресурс в рамках либо WAIT-транзакций, либо транзакций,
                                запущенных с <code class="code">LOCK TIMEOUT
                                    &lt;<em class="replaceable"><code>n</code></em>&gt;</code>, где число
                                    <em class="replaceable"><code>n</code></em> больше, чем параметр конфигурации
                                    <em class="parameter"><code>DeadLockTimeout</code></em>. Равно сумме таких
                                попыток по всем соединениям (т.е. 10 соединений могли ждать только 1
                                раз, но также могли ждать и 5 соединений 2 раза; какой именно был
                                сценарий — определить невозможно).</p><p>Накапливается с момента первого подключения к базе, меняется
                                только в рамках WAIT-транзакций.</p><p>Высокое значение может говорить о частых попытках вставок записей
                                с одинаковыми ключами в уникальный индекс или о конфликтах, при
                                которых транзакции_1 нужен ресурс транзакции_2, и наоборот (эта
                                ситуация называется "deadlock").</p><p>Также, это значение может оказаться высоким при групповом удалении
                                подключений с использованием <span class="database">mon$attachments</span>.</p></li><li class="listitem"><p>Deadlocks — накопленное количество длительных ожиданий из
                                множества, определенного в Deadlock scans, завершившихся
                                ошибками.</p></li><li class="listitem"><p>Scan interval — Значение параметра ожидания
                                    <em class="parameter"><code>DeadLockTimeout</code></em>, заданного в
                                    <code class="filename">firebird.conf</code>/<code class="filename">databases.conf</code>.</p></li></ul></div></li><li class="listitem"><p><code class="code">Acquires: 2150, Acquire blocks: 14, Spin count: 0</code></p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Acquires — общее количество обращений к лок-таблице с момента
                                старта ФБ.</p><p>В случае, когда соединение висит в ожидании ресурса (например, в
                                WAIT-транзакции), этот счетчик увеличивается на 1 каждые
                                    <em class="parameter"><code>DeadLockTimeout</code></em> секунд.</p><p>Может служить индикатором того, насколько интенсивно операция
                                обращается к лок-менеджеру. Например, каждое новое соединение,
                                устанавливаемое к базе утилитой ISQL, требует 86 обращений (первое —
                                более 120). Каждое новое соединение, выполняемое с помощью
                                Python-драйвера, требует 78 обращений. Таким образом, даже операция
                                установки соединения с базой данных требует доступа к лок-таблице и,
                                следовательно, влияет на количество соединений, которые ждут доступа
                                к ней (см следующую секцию, "mutex wait, %").</p></li><li class="listitem"><p>Acquire blocks — число обращений, которые привели к ожиданию на
                                мьютексе (лок-таблица была занята).</p></li><li class="listitem"><p>Spin count — значение <em class="parameter"><code>LockAcquireSpins</code></em> из
                                файла конфигурации
                                    (<code class="filename">firebird.conf</code>/<code class="filename">databases.conf</code>).</p></li></ul></div></li><li class="listitem"><p><code class="code">Mutex wait, %</code></p><p>Перед обновлением лок-таблицы процесс устанавливает на неё блокировку,
                        называемую мьютексом. mutex wait,% — это процент от общего числа процессов,
                        что вынуждены были ждать доступа к лок-таблице ввиду её обновления каким-то
                        одним из соединений. Значение получается в момент получения снимка
                        лок-таблицы и может меняться в любую сторону. Вычисляется по формуле: </p><div class="equation" id="d0e16448"><div class="equation-title">Формула 20.2. </div><div class="equation-contents"><span class="mathphrase">mutex wait = acquire blocks / acquires * 100%</span></div></div><p><br class="equation-break"/></p><p>В обычных производственных базах под нагрузкой может достигать
                        25-35%.</p><p>Большее значение может быть объяснено либо слишком длинными цепочками (см.
                        ниже, Hash Lenghts; в этом случае надо увеличивать значение параметра
                            <em class="parameter"><code>LockHashSlots</code></em>), либо чрезмерно высокой нагрузкой
                        на сервер от приложения.</p><div class="note"><h3 class="title">Примечание</h3><p>В архитектуре SuperServer нет страничных блокировок, лок-таблица
                            используется редко, поэтому значение параметра mutex wait очень часто
                            близко к нулю.</p></div></li><li class="listitem"><p><code class="code">Hash slots: 20011, Hash lengths (min/avg/max): 0/ 0/ 4</code></p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Hash slots — это количество "кустов" в хеш-таблице, по которым
                                распределяются данные о ресурсах и установленных блокировках. Чем
                                больше это число, тем меньше длина цепочек, которые возникают при
                                коллизиях хеш-значений. Максимально допустимое значение этого
                                параметра равно 65521 (значения больше этого порога игнорируются и
                                используется всё равно именно этот порог: 65521).</p><p>Значение по умолчанию (8191) можно считать подходящим для работы
                                100 пользователей и умалчиваемом размере страничного кеша
                                (256).</p><p>Значение берётся из конфигурационного файла
                                    (<code class="filename">firebird.conf</code>/<code class="filename">databases.conf</code>),
                                параметр <em class="parameter"><code>LockHashSlots</code></em>. Рекомендуется
                                назначать этот параметр равным простому числу. </p></li><li class="listitem"><p>Hash lengths (min/avg/max) — минимальное, среднее арифметическое и
                                максимальное значение длины цепочек в лок-таблице, вычисленные в
                                момент получения снимка.</p><p>Вычисляются каждый раз как результат просмотра содержимого всех
                                слотов, потому меняются при каждом запросе вывода лок-таблицы, в том
                                числе в сторону уменьшения (т.е. никакого накопления "с начала
                                работы" по ним нет).</p><p>Среднее арифметическое учитывает все слоты таблицы, в том числе —
                                с нулевыми значениями длин цепочек (т.е. пустые).</p><p>Если в нескольких снимках подряд любое из значений достигает
                                лимитов:
                                </p><pre class="literallayout">
min &gt;= 5, avg &gt;= 8...10, max &gt;= 13...15                                        
                                    </pre><p>
                                то следует увеличить параметры <em class="parameter"><code>LockHashSlots</code></em>
                                и <em class="parameter"><code>LockMemSize</code></em>. </p><p>Эффект от новых значений будет достигнут только при отсоединении
                                всех соединений от всех баз, которые работают на сервере.</p></li></ul></div></li><li class="listitem"><p/></li><li class="listitem"><p><code class="code">Owners (3) ...</code> — количество соединений, которые существуют в
                        момент получения снимка.</p></li><li class="listitem"><p><code class="code">Free owners (2) ...</code> — разность между максимальным количеством
                        соединений, которые были в базе данных с момента старта Firebird, и текущим
                        их числом. Другими словами, Free Owners — это число соединений, которые
                        прекратили свою работу и отсоединились от базы.</p></li></ol></div></section><section class="section" id="d0e16514"><div class="titlepage"><div><div><h3 class="title">Детализация лок-таблицы</h3></div></div></div><section class="section" id="d0e16517"><div class="titlepage"><div><div><h4 class="title">Представление ресурсов как блокировок различных видов</h4></div></div></div><p>Ресурсы, которые на момент получения снимка лок-таблицы находились в
                    использовании (или запрашивались для использования), представлены в виде блоков
                    записей, начинающихся с фразы <code class="code">LOCK BLOCK
                            <em class="replaceable"><code>&lt;nnnnnn&gt;</code></em></code>. Эти блоки записей дают
                    информацию о виде блокировок и их состоянии. Таким образом, ресурсы (то, за что
                    часто идёт борьба) представлены в лок-таблице опосредовано, через
                    блокировки.</p><p>В СУБД Firebird определены следующие виды блокировок (см.
                        <code class="filename">src/jrd/lck.h</code>): </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><code class="code">LCK_database</code> — Root of lock tree</p><p>Монопольная блокировка базы. В архитектуре Classic Server
                            предоставляется первому процессу, выполнившему соединение. Второе
                            подключение, пытающееся установить соединение, "видит" монопольную
                            блокировку, уже выданную первому, и посылает ему сигнал о необходимости
                            понизить уровень блокировки с exclusive до shared. В итоге, обе
                            блокировки на базу приходят к уровню "разделяемое чтение". В архитектуре
                            Superserver база устанавливает монопольную блокировку сама на
                            себя.</p></li><li class="listitem"><p><code class="code">LCK_relation</code> — Individual relation lock</p><p>Блокировка на таблицу (как объект БД) при чтении или записи данных в
                            неё.</p><p>При любых операциях таблицы блокируются в разделяемом режиме и это не
                            влияет на параллельный доступ. Исключения, накладывающие более высокие
                            уровни блокировки: </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>создание индекса</p></li><li class="listitem"><p>онлайн-валидация</p></li><li class="listitem"><p>операции в транзакции уровня изоляции consistency (aka
                                        SNAPSHOT TABLE STABILITY), либо при явном задании блокировок
                                        таблиц в транзакции (фраза RESERVING в SET
                                        TRANSACTION)</p></li></ul></div><p>Также эксклюзивная блокировка <code class="code">LCK_relation</code> со специальным
                            ключом -1 берется при генерации нового ID для создаваемой
                            таблицы.</p></li><li class="listitem"><p><code class="code">LCK_bdb</code> — Individual buffer block</p><p>Блокировка любой физической страницы, независимо от её типа (таблица
                            или индекс или что-то другое).</p></li><li class="listitem"><p><code class="code">LCK_tra</code> — Individual transaction lock</p><p>Эксклюзивная блокировка транзакции тем, кто ее стартовал. Остальные
                            могут пытаться брать разделяемую блокировку для определения состояния
                            (активности) транзакции, либо ждать на такой блокировке до окончания
                            текущей транзакции (в режиме WAIT).</p></li><li class="listitem"><p><code class="code">LCK_rel_exist</code> — Relation existence lock</p><p>Блокировка-защита существования таблицы; в Key записан ID таблицы
                            (rdb$relations.rdb$relation_id).</p></li><li class="listitem"><p><code class="code">LCK_idx_exist</code> — Index existence lock</p><p>Блокировка-защита существования индекса; в "Key" записаны: старшие два
                            байта — ID таблицы, младшие — ID индекса.</p></li><li class="listitem"><p><code class="code">LCK_attachment</code> — Attachment lock</p><p>Монопольная блокировка, устанавливаемая процессом, соединившимся с
                            базой, на объект его собственного соединения. Через эту блокировку
                            происходит уведомление соединения о его принудительном
                            завершении.</p></li><li class="listitem"><p><code class="code">LCK_shadow</code> — Lock to synchronize addition of
                            shadows</p><p>Блокировка для синхронизации добавления теневых копий к базе.</p></li><li class="listitem"><p><code class="code">LCK_sweep</code> — Sweep lock for single sweeper</p><p>Блокировка для гарантии существования только одного
                            sweep-процесса.</p></li><li class="listitem"><p><code class="code">LCK_expression</code> — Expression index caching
                            mechanism</p><p>Блокировка-защита неизменности выражения для вычисляемого
                            индекса.</p></li><li class="listitem"><p><code class="code">LCK_prc_exist</code> — Procedure existence lock</p><p>Блокировка-защита существования хранимой процедуры. Применяется только
                            процедур. Для функций <code class="code">LCK_fun_exist</code>. Для триггеров такой
                            защиты нет.</p></li><li class="listitem"><p><code class="code">LCK_update_shadow</code> — shadow update sync lock</p><p>Блокировка для сериализации обновлений теневой копии (обновляться
                            должна только одним процессом).</p></li><li class="listitem"><p><code class="code">LCK_backup_alloc</code> — Lock for page allocation table in
                            backup spare file</p><p>nbackup: блокировка, синхронизирующая доступ к таблице соответствия
                            страниц внутри дельта-файла.</p></li><li class="listitem"><p><code class="code">LCK_backup_database</code> — Lock to protect writing to database
                            file</p><p>nbackup: блокировка физического состояния базы данных
                            (normal/stalled/merge). Управляет направлением чтения/записи между
                            файлом БД и дельта-файлом.</p></li><li class="listitem"><p><code class="code">LCK_backup_end</code> — Lock to protect end_backup
                            consistency</p><p>nbackup: блокировка для обеспечения слияния дельты в основной файл в
                            единственном процессе.</p></li><li class="listitem"><p><code class="code">LCK_rel_partners</code> — Relation partners lock</p><p>Блокировка-защита существования ограничения ссылочной целостности
                            (ссылки по внешнему ключу) между таблицами.</p></li><li class="listitem"><p><code class="code">LCK_page_space</code> — Page space ID lock</p><p>Блокировка для уникальной идентификации пространства страниц для
                            GTT.</p></li><li class="listitem"><p><code class="code">LCK_dsql_cache</code> — DSQL cache lock</p><p>Блокировка актуальности состояния объектов кеша метаданных.</p><p>В движке существует два кеша метаданных: на уровне парсера и на уровне
                            ядра. Блокировки <code class="code">LCK_dsql_cache</code> используются, чтобы
                            инвалидировать объекты в кеше первого уровня.</p></li><li class="listitem"><p><code class="code">LCK_monitor</code> — Lock to dump the monitoring data</p><p>Блокировка актуальности состояния данных мониторинга для
                            соединения.</p></li><li class="listitem"><p><code class="code">LCK_tt_exist</code> — TextType existence lock</p><p>Блокировка-защита существования collate (правила сопоставления
                            символов для упорядоченного вывода текста).</p></li><li class="listitem"><p><code class="code">LCK_cancel</code> — Cancellation lock</p><p>Блокировка для уведомления об отмене текущей операции.</p></li><li class="listitem"><p><code class="code">LCK_btr_dont_gc</code> — Prevent removal of btree page from
                            index</p><p>Блокировка-защита от удаления страницы в индексе, расположенной слева
                            от вставляемой новой страницы.</p></li><li class="listitem"><p><code class="code">LCK_shared_counter</code> — Databasewide shared counter</p><p>Блокировка, синхронизирующая генерацию уникальных идентификаторов для
                            запросов (а также для соединений и транзакций в read-only БД).</p></li><li class="listitem"><p><code class="code">LCK_tra_pc</code> — Precommitted transaction lock</p><p>Блокировка-признак precommitted транзакции (для них не создается
                                <code class="code">LCK_tra</code> блокировка), используется для проверки
                            состояния транзакции.</p></li><li class="listitem"><p><code class="code">LCK_rel_gc</code> — Allow garbage collection for relation</p><p>Блокировка, разрешающая/запрещающая сборку мусора в определенной
                            таблице (и ее индексах).</p></li><li class="listitem"><p><code class="code">LCK_fun_exist</code> — Function existence lock</p><p>Блокировка-защита существования UDF и PSQL-функции.</p></li><li class="listitem"><p><code class="code">LCK_rel_rescan</code> — Relation forced rescan lock</p><p>Блокировка состояния метаданных таблицы, используется для обновления
                            информации в кеше метаданных (после ALTER TABLE).</p></li><li class="listitem"><p><code class="code">LCK_crypt</code> — Crypt lock for single crypt thread</p><p>Блокировка для обеспечения работы потока шифрования в единственном
                            экземпляре.</p></li><li class="listitem"><p><code class="code">LCK_crypt_status</code> — Notifies about changed database
                            encryption status</p><p>Блокировка текущего состояния шифрования БД (зашифрована или
                            нет).</p></li><li class="listitem"><p><code class="code">LCK_record_gc</code> — Recordlevel GC lock</p><p>Блокировка, разрешающая/запрещающая сборку мусора для конкретной
                            записи.</p></li></ol></div><p>Числовые индексы 1...30, приведенные в этом списке, используются в отображении
                    типа блокировки как <span class="quote">«<span class="quote">номер серии</span>»</span> (см ниже, подстрока
                        <span class="quote">«<span class="quote">Series:</span>»</span>). Эти индексы следует использовать для определения
                    того, какой вид блокировки выведен.</p></section><section class="section" id="d0e16779"><div class="titlepage"><div><div><h4 class="title">Особенности при работе в архитектуре SuperServer. Латчи (latches)</h4></div></div></div><p>В архитектуре SuperServer отсутствует блокировка LCK_bdb (<span class="quote">«<span class="quote">Individual
                        buffer block</span>»</span>), поэтому использование лок-таблицы для поиска очередей
                    на доступ к страницам базы результата не даст. Вместо блокировок страниц в
                    SuperServer используются так называемые <span class="quote">«<span class="quote">страничные латчи</span>»</span> —
                    легковесные механизмы сериализации.</p><p>Латчи (latches) более эффективные, но при этом работают в рамках текущего
                    процесса, имеют только два состояния (exclusive/shared), не умеют посылать
                    сигналы другим процессам, не умеют находить и обрабатывать состояния взаимных
                    блокировок (deadlock-состояния). Обычные блокировки (в отличие от латчей)
                    работают через лок-менеджер. Они <span class="quote">«<span class="quote">сложные</span>»</span> по реализации, находятся
                    в разделяемой памяти, умеют сигнализировать другим процессам, имеют 6 возможных
                    состояний, умеют диагностировать состояния взаимных блокировки. </p><p>Доступ ко всем общим ресурсам, которые требуют рассылки сигналов,
                    сериализуется в архитектуре SuperServer так же как в Classic/Superclassic —
                    через обычные блокировки (например, это блокировки метаданных).</p></section><section class="section" id="d0e16797"><div class="titlepage"><div><div><h4 class="title">Данные о владельцах блокировок (OWNER BLOCK)</h4></div></div></div><p>Вывод информации о владельцах блокировок осуществляется указанием ключа
                        <code class="code">-o</code>.</p><p>Информация о владельцах блокировок собрана в блоки, начинающиеся с фразы
                        <code class="code">OWNER BLOCK &lt;<em class="replaceable"><code>nnnnnn</code></em>&gt;</code>.</p><p>Ниже приведен пример вызова <span class="application">fb_lock_print</span>, при
                    котором выводится информация о владельце единственной блокировки, существующей в
                    базе. Это происходит при установке к БД единственного подключения: </p><pre class="synopsis">
# /opt/firebird/bin/fb_lock_print -c -d employee -o | cat -n                    
                </pre><pre class="screen">
 1  LOCK_HEADER BLOCK
            ...
10          Owners (1):     forward: 172960, backward: 172960
            ...
14
15  OWNER BLOCK 172960
16          Owner id: 13494787244039, Type: 1
17          Process id:   3142 (Alive), Thread id:   3144
18          Flags: 0x00
19          Requests (80):  forward: 173144, backward: 186040
20          Blocks: *empty*
21          Pending: *empty*
22
                        
                    </pre><p>В строке 16 <code class="code">Owner id: 13494787244039, Type: 1</code> — содержится
                    указание на тип владельца блокировки.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Type = 1 — это сама база данных (LCK_database), она устанавливает
                            монопольную блокировку на саму себя при установке первого соединения.
                            Второе соединение выдаст сигнал первому о необходимости понижения уровня
                            блокировки, и она будет понижена до shared read.</p></li><li class="listitem"><p>Type = 2 — указывается, когда собственником блокировки является
                            некоторое соединение с базой данных.</p></li></ul></div><p>В строке 17 <code class="code">Process id: 3142 (Alive), Thread id: 3144</code> — указан ID
                    отдельного процесса Firebird, созданного при подключении к базе (при работе в
                    архитектуре Classic server). Этот ID (3142) легко найти в списке
                    firebird-процессов:</p><pre class="synopsis">
# ps aux | grep firebird$                    
                </pre><pre class="screen">
firebird 1635 0.0  0.0 136464  2360 ?   Sl  Dec07  0:00 /opt/firebird/bin/firebird
firebird 3142 0.0  0.1 571768 11792 ?   Sl  20:09  0:00 /opt/firebird/bin/firebird                        
                    </pre><p>В строке 18 <code class="code"> Flags: 0x00</code> указан флаг состояния владельца ресурса.
                    Значение 0x00 означает отсутствие каких-либо сведений о состоянии владельца. В
                    Firebird используются следующие флаги состояний владельцев
                        (<code class="filename">src/lock/lock_proto.h</code>): </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="code">OWN_scanned = 1</code> — владелец был проверен на
                                причастность к deadlock ("Owner has been deadlock scanned");</p></li><li class="listitem"><p><code class="code">OWN_wakeup = 2</code> — к владельцу был послан сигнал
                                отпустить блокировку ("Owner has been awoken"; Borrie: "Owner has
                                been poked to release a lock");</p></li><li class="listitem"><p><code class="code">OWN_signaled = 4</code> — сигнал считается доставленным
                                владельцу ("Signal is thought to be delivered").</p></li></ul></div><p>В строке 19 <code class="code">Requests (80) ...</code> — указаны запросы владельца на
                    блокировки (как осуществлённые, так и ожидающие).</p><p>В строке 20 <code class="code">Blocks: *empty*</code> — указаны сведения о том, сколько
                    других процессов ждёт свобождения ресурсов, занятых текущим владельцем (то есть
                    сколько других процессов блокирует текущий владелец).</p><p>В строке 21 <code class="code">Pending: *empty*</code> — указаны сведения о том, сколько
                    ресурсов занято другими процессами, но нужно текущему владельцу (т.е. сколько он
                    запросил блокировок и ждёт их предоставления).</p></section><section class="section" id="d0e16882"><div class="titlepage"><div><div><h4 class="title">Данные о блокировках (LOCK BLOCK)</h4></div></div></div><p>Блокировки в лок-таблице есть визуальное представление тех ресурсов, с
                    которыми оперируют процессы (соединения).</p><p>Вывод информации о блокировках осуществляется указанием ключа
                    <code class="code">-l</code>.</p><p> Каждый набор строк с этой информацией начинается с фразы <code class="code">LOCK BLOCK
                        &lt;nnnnnn&gt;</code> Пример: </p><pre class="screen">
                    
LOCK BLOCK 173216
        Series: 1, State: 6, Size: 0, Length: 0, Data: 0
        Key: &lt;none&gt; Flags: 0x00, Pending request count:      0
        Hash que (4):   forward: 173352, backward:    412
        Requests (1):   forward: 173144, backward: 173144
                Request 173144, Owner: 172960, State: 6 (6), Flags: 0x00    
                
                </pre><p>
                </p><p>Количество информации, выводимой при использовании ключа <code class="code">-l</code>,
                    почти всегда оказывается слишком избыточным для анализа. Чтобы ограничить вывод
                    лок-таблицы только теми ресурсами, которые являются <span class="quote">«<span class="quote">предметом
                        спора</span>»</span>, т.е. на которых возникли ожидания, следует использовать ключ
                        <code class="code">-n</code> как дополнение к ключу <code class="code">-l</code>, т.е. запускать
                    утилиту так:</p><pre class="synopsis">
fb_lock_print -n -l -c -d my_database                    
                </pre></section><section class="section" id="d0e16916"><div class="titlepage"><div><div><h4 class="title">Быстрая диагностика наличия очередей к ресурсам</h4></div></div></div><p>О том, есть ли очереди вообще, можно быстро выяснить, введя команду:
                    </p><pre class="synopsis">
fb_lock_print -c -n -l -d my_database                        
                    </pre><p>
                    и отфильтровав её вывод по условию вхождения строки "Pending request
                    count:".</p><p>Наличие строк в выводе будет говорить о том, что существуют ожидания каких-то
                    ресурсов. Последняя лексема в каждой строке (положительное число) — это
                    количество процессов, которые ждут некоторый ресурс.</p><p>Пример вызова для POSIX:
                    </p><pre class="synopsis">
/opt/firebird/bin/fb_lock_print -c -n -l -d our_production_alias | grep -i 
  "Pending request count:"                        
                    </pre><p>
                </p><p>Пример вызова для Windows:
                    </p><pre class="synopsis">
"c:\Program Files\Firebird\Firebird 3\fb_lock_print.exe" -c -n -l -d 
  our_production_alias | findstr /c:"Pending request count:"                        
                    </pre><p>
                </p><p>Пример вывода на системе, работающей под сильной нагрузкой:</p><pre class="screen">
Key: 0001:000157, Flags: 0x00, Pending request count:	1
Key: 0001:001449, Flags: 0x00, Pending request count:	26
Key: 0001:097628, Flags: 0x00, Pending request count:	1
Key: 0001:235183, Flags: 0x00, Pending request count:	1
Key: 0001:238747, Flags: 0x00, Pending request count:	15                    
                </pre><p>Если сумма ожидающих соединений превышает 10% от общего числа соединений
                    (которые легко находятся в заголовке лок-таблицы поиском строки "Owners ()", то
                    это говорит о проблемах с конкурентным доступом к ресурсам базы. При превышении
                    50% проблемы можно считать уже критическими.</p><p>Однако, в вышеприведенном фрагменте нет никакой информации о том, какие именно
                    ресурсы удерживаются и являются причиной ожиданий. Эти команды даны только для
                        <span class="quote">«<span class="quote">быстрой диагностики</span>»</span> производительности системы.</p></section><section class="section" id="d0e16947"><div class="titlepage"><div><div><h4 class="title">Углубленная диагностика очередей к ресурсам</h4></div></div></div><p>Блоки с информацией о ресурсах (LOCK BLOCK) позволяют определить ТИП ОБЪЕКТА
                    базы данных, являющийся <span class="quote">«<span class="quote">предметом спора</span>»</span> процессов.</p><p>Чаще всего это страница, хранящая счетчики генераторов, либо относящаяся к
                    данным таблицы (Data Pages, DP), указателям страниц (Pointer Pages, PP) или
                    индексу (корневая страница или страница промежуточного и/или листового уровня
                    Index Page). </p><p>Могут также возникать ожидания на странице TransactionInventory Page (TIP),
                    ожидания ввиду сброса данных мониторингу и ожидания на заголовке БД.</p><p>Данные об очередях к ресурсам получаются командой:</p><pre class="synopsis">
    fb_lock_print -c -n -l -d our_production_alias                    
                    </pre><p>Всё, что находится в выводе этой команды после заголовка лок-таблицы, является
                    информацией о ресурсах, к которым возникли очереди. Далее эти блоки называются
                    "лок-блоками" (LOCK BLOCK).</p><p>Рассмотрим следующий пример лок-блока (строки специально пронумерованы; в
                    реальности нумерация строк отсутствует):</p><pre class="screen">LOCK BLOCK 603456
    Series: 3, Parent:  21000, State: 6, size: 8 length: 8 data: 0
    Key: 0001:002017, Flags: 0x00, Pending request count:      1
    Hash que (7):    forward:  90616, backward: 659760
    Requests (2):    forward: 846960, backward: 474024
       Request 846960, Owner: 514112, State: 6 (6), Flags: 0x01
       Request 474024, Owner: 528992, State: 0 (6), Flags: 0x02</pre><p>В строке 2: <code class="code">Series: 3, Parent: 21000, State: 6, size: 8 length: 8 data:
                        0</code> — нас должно интересовать только число, записанное после "Series".
                    В данном примере это число равно 3. Согласно списку видов блокировок в Firebird
                    (смотри выше), этот индекс соответствует ожиданию доступа к странице базы
                    данных: (<span class="quote">«<span class="quote">3 LCK_bdb Individual buffer block</span>»</span>). Это может быть
                    страница, относящаяся к любому объекту: таблице, индексу, генераторам, TIP и
                    прочее.</p><p>Что бы понять, к какому именно объекту относятся страничные ожидания,
                    анализируем строку 3. В начале строки 3: <code class="code">Key: 0001:002017</code> —
                    записаны номер страничного пространства (<span class="quote">«<span class="quote">0001</span>»</span>) и после двоеточия
                    — номер страницы в нём (<span class="quote">«<span class="quote">002017</span>»</span>). Номер страничного пространства
                    для файла БД всегда равен <span class="quote">«<span class="quote">0001</span>»</span>. Другие значения могут быть только
                    для GTT, но по ним конкуренции не бывает.</p><p>Номер страницы — всегда четырёхбайтовый и записан десятичном виде.</p><div class="important"><h3 class="title">Важно</h3><p>Для других видов ресурсов, имеющих 8-байтные ID, визуальное представление
                        этих ID отличается от приведенного и требует дополнительного объяснения.
                        (см. следующий раздел).</p></div><p>Значение флагов (<code class="code">Flags: 0x00</code>) можно игнорировать.</p><p>Значение после фразы "Pending request count" есть количество процессов,
                    ожидающих блокировку на данный ресурс.</p><div class="note"><h3 class="title">Примечание</h3><p>В архитектуре SuperServer отсутствует блокировка <code class="code">LCK_bdb</code>
                            (<span class="quote">«<span class="quote">Individual buffer block</span>»</span>). По этой причине диагностика
                        узких мест в помощью <span class="application">fb_lock_print</span> в этой
                        архитектуре не применима, если целью поиска являются ожидания на страничных
                        блокировках.</p></div></section><section class="section" id="d0e17015"><div class="titlepage"><div><div><h4 class="title">Кодировка 8-байтных значений идентификаторов ресурсов</h4></div></div></div><p>Все ресурсы за исключением страниц базы, хранятся в лок-таблице как 8 байтовые
                    числа. <span class="application">fb_lock_print</span> получает их в виде двоичной
                    строки, т.е. они представлены в системе счисления с основанием 256.</p><p>Все символы с кодами от 0 до 64 считаются
                        <span class="quote">«<span class="quote">потенциально-проблемными</span>»</span> для печати и вместо них печатаются
                    их ascii-коды в угловых скобках. Например, если число содержит в своём
                    представлении символ <code class="code">ascii_char(14)</code>, то вместо него
                        <span class="application">fb_lock_print</span> выведет на печать: &lt;14&gt;.
                    Символы с кодами 65 и выше печатаются <span class="quote">«<span class="quote">как они есть</span>»</span>. Само число
                    (ID ресурса) выводится в перевернутом виде: от младших байтов к старшим.</p><p>Вот пример того, как могут быть показаны ресурсы <code class="code">LCK_attachment</code>
                    (монопольные блокировки подключениями своих attach-объектов, тип равный
                    7):</p><pre class="screen">

LOCK BLOCK 1177744
        Series: 7, State: 6, Size: 8, Length: 8, Data: 0
        Key: O&lt;14&gt;&lt;7&gt;&lt;3&gt;&lt;0&gt;&lt;0&gt;&lt;0&gt;&lt;0&gt;, Flags: 0x00, Pending request count: 0
        ...

LOCK BLOCK 909776
        Series: 7, State: 6, Size: 8, Length: 8, Data: 0
        Key: K&lt;14&gt;&lt;7&gt;&lt;3&gt;&lt;0&gt;&lt;0&gt;&lt;0&gt;&lt;0&gt;, Flags: 0x00, Pending request count: 0
        ...

LOCK BLOCK 372768
        Series: 7, State: 6, Size: 8, Length: 8, Data: 0
        Key: &lt;64&gt;&lt;14&gt;&lt;7&gt;&lt;3&gt;&lt;0&gt;&lt;0&gt;&lt;0&gt;&lt;0&gt;, Flags: 0x00, Pending request count: 0
        ...

LOCK BLOCK 424760
        Series: 7, State: 6, Size: 8, Length: 8, Data: 0
        Key: C&lt;14&gt;&lt;7&gt;&lt;3&gt;&lt;0&gt;&lt;0&gt;&lt;0&gt;&lt;0&gt;, Flags: 0x00, Pending request count: 0
        ...
                  
                </pre><p>В этом примере (в последнем блоке) <code class="code">Key:
                        C&lt;14&gt;&lt;0&gt;...&lt;0&gt;</code> — это число, равное: </p><div class="equation" id="d0e17049"><div class="equation-title">Формула 20.3. </div><div class="equation-contents"><span class="mathphrase"> ascii_char('C') * (256**0) + 14 * (256**1) + 7 * (256**2) + 3 *
                            (256**3) = 50794051 </span></div></div><p><br class="equation-break"/>
                </p><p>Таким образом этот лок-блок относится к подключению с connection_id = 50794051
                    (отсчет позиций ведется слева направо, крайний левый символ считается позицией
                    номер 0, крайний правый — позицией номер 7).</p></section><section class="section" id="d0e17055"><div class="titlepage"><div><div><h4 class="title">Поиск объекта БД, к которому принадлежит страница с заданным номером</h4></div></div></div><p>При исследовании проблем производительности приложений необходимо выявить
                    конфликты процессов за установку блокировок на страницы: чем больше возникает
                    конфликтов из-за какого-либо ресурса, тем заметнее задержки в выполнении даже
                    тривиальных запросов к базе, достигающие иногда десятков секунд при почти
                    нулевых значениях счетчиков статистики.</p><p>Особое внимание надо уделить конфликтам за страницы таблиц (DP и PP), индексов
                    и генераторов.</p><p>Чтобы получить сведения о том, к какому объекту относится страница с известным
                    номером ("002017"), необходим вызов API-функции
                    <code class="code">isc_database_info()</code>. В большинстве компонентов доступа к базам
                    Firebird (Delphi, Python, JayBird) есть возможность вызова этой функции и
                    представлена соответствующая документация.</p><p>Функция заполняет данными предварительно создаваемый (клиентской стороной, то
                    есть драйвером доступа к БД) буфер, передаваемый этой функции как
                    аргумент.</p><p>В первом байте этого буфера записано число — идентификатор типа
                    страницы:</p><div class="orderedlist"><ol class="orderedlist compact" type="1"><li class="listitem"><p>заголовок БД, <span class="quote">«<span class="quote">DB header</span>»</span>;</p></li><li class="listitem"><p>страница-оглавление использования остальных страниц,
                                <span class="quote">«<span class="quote">PIP</span>»</span>;</p></li><li class="listitem"><p>страница-оглавление состояний транзакций, <span class="quote">«<span class="quote">TIP</span>»</span>;</p></li><li class="listitem"><p>страница-оглавление использования страниц для хранения данных таблицы,
                                <span class="quote">«<span class="quote">Pointer Page</span>»</span>;</p></li><li class="listitem"><p>страница с данными некоторой таблицы <span class="quote">«<span class="quote">Data Page</span>»</span>;</p></li><li class="listitem"><p>корневая страница индекса некоторой таблицы, <span class="quote">«<span class="quote">Index
                            Root</span>»</span>;</p></li><li class="listitem"><p>страница индекса (промежуточного или листового уровня), <span class="quote">«<span class="quote">B-Tree
                                Page</span>»</span>;</p></li><li class="listitem"><p>страница для хранения двоичного объекта, <span class="quote">«<span class="quote">Blob</span>»</span>;</p></li><li class="listitem"><p>страница счетчиков последовательностей (генераторов),
                                <span class="quote">«<span class="quote">Generators Page</span>»</span>;</p></li><li class="listitem"><p>страница с номером последовательного изменения базы,
                                <span class="quote">«<span class="quote">SCN</span>»</span> (новый тип, введён в Firebird 3.0).</p></li></ol></div><p>По типу страницы можно определить идентификатор таблицы или индекса, либо
                    принадлежность этой страницы к какому-либо классу (Generators Page, Pointer
                    Page). Эти позволит сделать вывод о том, какой именно ресурс является узким
                    местом вашего приложения.</p><p>Следует помнить, однако, что за период от момента получения номера проблемной
                    страницы &lt;P&gt; и до момента возврата из функции
                        <code class="code">isc_database_info()</code> в базе могут быть изменения, затрагивающие
                    именно эту страницу &lt;P&gt;. В таком случае, сведения от
                        <code class="code">isc_database_info()</code> о принадлежности страницы некоторому
                    объекту (таблице, индексу и так далее) могут оказаться неверными. Это не
                    относится к страницам DB Header и Generators Page. Также маловероятно, что будет
                    часто меняться страница, относящаяся к типу Index Root.</p><p>Дальнейшее объяснение работы этой функции выходит за рамки данной
                    документации.</p></section><section class="section" id="d0e17144"><div class="titlepage"><div><div><h4 class="title">Дополнительные замечания по ожиданиям страничных блокировок</h4></div></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Страничные блокировки НЕ отключаются при работе транзакции с уровнем
                            изолированности SNAPSHOT TABLE STABILITY.</p></li><li class="listitem"><p>Страничные блокировки НЕ отключаются при работе с GTT, даже когда она
                            объявлена как ON COMMIT DELETE ROWS.</p></li><li class="listitem"><p>Массовый старт транзакций (например, при одновременном входе сотен
                            пользователей утром) может приводить к ожиданиям DB header (страницы с
                            номером 0).</p></li><li class="listitem"><p>Ожидания на страницах является обычной ситуацией, если очередь
                            составляет менее 1% от общего количества соединений. Причина в том, что
                            любая недавно прочитанная страница держит read-лок (т.к. блокировки
                            кешируются). Если далее к ней подходит процесс от писателя (например,
                            INSERT выделяет новую страницу в базе и требует отметить ее в PIP), то
                            ему требуется write-lock. Он будет ждать. Получит он его очень быстро,
                            но не мгновенно — пока будет отправлен сигнал читателю, пока тот
                            отпустит блокировку, пока просигналит обратно. Весь этот (небольшой)
                            период писатель будет в очереди pending request. И так с любой
                            страницей, не только PIP. Грубо говоря, наличие <span class="bold"><strong>одного</strong></span> писателя в pending-очереди является проблемным,
                            только если он там висит достаточно долгое время (больше секунды,
                            например). Иначе это просто штатная ситуация.</p></li></ol></div><div class="tip"><h3 class="title">Подсказка</h3><p>Если соединений всего одно, то страничные блокировки не используются. Это
                        следует учитывать, когда необходимо выполнить какие-то операции массовой
                        обработки данных. Если есть возможность сделать это в единственном
                        соединении — следует делать именно так.</p></div></section><section class="section" id="d0e17166"><div class="titlepage"><div><div><h4 class="title">Поиск ID процессов, удерживающих ресурсы</h4></div></div></div><p>Для получения значений PID всех соединений, задействованных в ожидании (т.е.
                    тех, кто ждёт и того, кого ждут), следует рассмотреть строки, начиная с
                    6-й:</p><pre class="screen">       Request 846960, Owner: 514112, State: 6 (6), Flags: 0x01
       Request 474024, Owner: 528992, State: 0 (6), Flags: 0x02 </pre><p>В этих строках показаны данные по запросам (requests), которые имеются к
                    данному ресурсу. В первой строке (в примере — строка 6) указан всегда тот, кто
                    владеет ресурсом. Для него всегда в части строки <span class="quote">«<span class="quote">State:
                            <em class="replaceable"><code>N</code></em> (<em class="replaceable"><code>K</code></em>)</span>»</span>
                    записано одно и то же число, то есть N = K. После этой строки (в примере —
                    начиная со строки 7) в списке идут те, которые ждут ресурс (они как раз и
                    считаются как <span class="quote">«<span class="quote">pending</span>»</span>). У них N не равно K (и обычно N меньше K).
                    Кроме того, у них взведен второй бит в значении <span class="quote">«<span class="quote">Flags</span>»</span>.</p><p>Если из каждой строки извлечь значения Owner, то полученное число является ID
                    владельца, к которому относится данная строка. В частности, для 6-й строки мы
                    получим ID владельца блокировки 514112 — того, кого ждут остальные.</p><p>Далее, в выводе <span class="application">fb_lock_print</span> необходимо найти
                    набор строк с OWNER BLOCK, равным этому числу (514112).</p><p>Наконец, в найденном блоке строк для владельца с id=514112 нужно найти строку
                    с "Process id" и извлечь из неё число. Это число (6863) будет PID процесса,
                    который удерживает ресурс.</p><pre class="screen">
OWNER BLOCK 514112
    Owner id: ..., Type: 1
    Process id:   6863 (Alive), Thread id:   6871
    Flags: 0x00                    
                </pre><div class="note"><h3 class="title">Примечание</h3><p>В архитектуре Super* ID процесса всегда одинаковый и различаться могут
                        только значения thread:</p><pre class="screen">
    OWNER BLOCK 58283128
            Owner id: 14289360384590, type: 1, pending:      0
            Process id:   3327 (Alive), thread id: 140146837899008
            ...

    OWNER BLOCK 30347000
            Owner id: 14289360384593, type: 1, pending:      0
            Process id:   3327 (Alive), thread id: 140146837899008
            ...

    OWNER BLOCK 45735184
            Owner id: 14289360385472, type: 1, pending:      0
            Process id:   3327 (Alive), thread id: 140146578904832
            ...

    OWNER BLOCK 2200744
            Owner id: 14289360385781, type: 1, pending:      0
            Process id:   3327 (Alive), thread id: 140136695990016
            ...                        
                    </pre><p>При этом, потоки, существующие внутри процесса сервера, не выделяются
                        подключениям к базе навечно, а используется общий пул. Значение после фразы
                            <span class="quote">«<span class="quote">thread: id:</span>»</span> — ID потока, который последним обслуживал это
                        подключение.</p></div></section><section class="section" id="d0e17211"><div class="titlepage"><div><div><h4 class="title">Поиск ID подключения к БД, удерживающего ресурсы</h4></div></div></div><p>Чтобы выяснить идентификатор подключения, который удерживает страницу,
                    необходимо вызвать <span class="application">fb_lock_print</span> с ключами
                        <code class="code">-o</code>, <code class="code">-l</code>, но БЕЗ ключа <code class="code">-n</code>, то есть
                    потребовать вывода всех блоков, а не только pending. </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>в LOCK BLOCK'e ресурса, который сейчас занят, находим ID владельца,
                            который получил ранее блокировку на этот ресурс (в предыдущем примере —
                                <span class="quote">«<span class="quote">Owner: 514112</span>»</span>). Для ФБ, работающего в архитектуре
                            SuperClassic, ID владельца всегда будет одинаковым. Для архитектуры
                            Classic это будет PID процесса, созданного для работы данного
                            подключения к базе.</p></li><li class="listitem"><p>найти в логе такой LOCK BLOCK с типом <span class="quote">«<span class="quote">Series: 7</span>»</span>, у
                            которого в строке, задающей request, будет этот же Owner (514112), а
                            также выполнено требование: в строке <span class="quote">«<span class="quote">State:
                                    <em class="replaceable"><code>N</code></em>
                                (<em class="replaceable"><code>K</code></em>)</span>»</span> оба значения N и K —
                            одинаковые числа:</p><pre class="screen">
LOCK BLOCK 174056
      Series: 7, State: 6, Size: 8, Length: 8, Data: 0
      Key: 000000035, Flags: 0x00, Pending request count:      0
      Hash que (3):   forward: 174200, backward:  21972
      Requests (1):   forward: 173984, backward: 173984
      Request 173984, Owner: 514112, State: 6 (6), Flags: 0x00                                
                            </pre></li><li class="listitem"><p>строка с <code class="code">Key: 000000035, Flags: 0x00, ...</code> — показывает в
                            Key-поле идентификатор подключения. Идентификатор подключения выводятся
                            в десятичном виде, с ведущими нулями. В данном примере идентификатор
                            подключения — десятичное число 35.</p></li></ol></div></section><section class="section" id="d0e17258"><div class="titlepage"><div><div><h4 class="title">Поиск транзакции, удерживающей ресурсы</h4></div></div></div><p>Чтобы выяснить номер транзакции, которая удерживает ресурс (например, она
                    позволяет вставить значение в уникальный индекс, так как сама вставила его
                    только что, но не подтвердилась и не отменилась), следует вызвать лок-таблицу с
                    ключами <code class="code">-o</code>, <code class="code">-l</code>, но БЕЗ ключа <code class="code">-n</code>, то есть
                    потребовать вывода всех блоков, а не только pending.</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>в LOCK BLOCK'e ресурса, который сейчас занят, находим ID владельца,
                            который получил ранее блокировку на этот ресурс (пусть это будет
                                <span class="quote">«<span class="quote">Owner: 186312</span>»</span>).</p></li><li class="listitem"><p>найти в логе такой LOCK BLOCK с типом <span class="quote">«<span class="quote">Series: 4</span>»</span>, у
                            которого в строке, задающей request, будет этот же Owner (186312), а
                            также выполнено требование: в строке <span class="quote">«<span class="quote">State:
                                    <em class="replaceable"><code>N</code></em>
                                (<em class="replaceable"><code>K</code></em>)</span>»</span> оба значения N и K —
                            одинаковые числа.</p><pre class="screen">
LOCK BLOCK 199312
        Series: 4, State: 6, Size: 8, Length: 8, Data: 183
        Key: 000000192, Flags: 0x00, Pending request count:      2
        Hash que (1):        forward: 137180, backward: 137180
        Requests (3):        forward: 198592, backward: 219736
                  Request 198592, Owner: 186312, State: 6 (6), Flags: 0x00 &lt;&lt;&lt;
                  Request 208408, Owner: 208608, State: 0 (3), Flags: 0x22
                  Request 219736, Owner: 172960, State: 0 (3), Flags: 0x02                                
                            </pre></li><li class="listitem"><p>строка с <code class="code">Key: 000000192, Flags: 0x00</code> — показывает в
                            key-поле значение номера транзакции, записанное в десятичном виде, с
                            ведущими нулями, которая удерживает ресурс, ожидаемый двумя другими
                            процессами (208608 и 172960).</p></li></ol></div><div class="tip"><h3 class="title">Подсказка</h3><p>Вызов утилиты <span class="application">fb_lock_print</span> БЕЗ указания
                        ограничить вывод только pending-блоками (т.е. без ключа <code class="code">-n</code>)
                        приводит к большому размеру лога. Если нужно найти в это логе строки,
                        относящиеся к pending-блокировкам, воспользуйтесь следующей командой:</p><div class="itemizedlist"><ul style="list-style-type: disc; " class="itemizedlist"><li class="listitem"><p>В POSIX
                                </p><pre class="synopsis">
/opt/firebird/bin/fb_lock_print -c -l -d our_production_alias | 
  grep -i "Pending request count:" | grep -v -E "count:[[:space:]]+0$"                                    
                                </pre><p>
                            </p></li><li class="listitem"><p>В Windows
                                </p><pre class="synopsis">
"c:\Program Files\Firebird\Firebird 3\fb_lock_print.exe" -c -l -d 
  our_production_alias | findstr /c:"Pending request count:" | 
  findstr /v /e /c:" 0" /c:"	0"                                        
                                    </pre><p>
                            </p><p>Ключ /c:"..." употребляется дважды; во втором его вхождении внутри
                                двойных кавычек перед 0 указан символ табуляции.</p></li></ul></div></div></section></section><section class="section" id="d0e17326"><div class="titlepage"><div><div><h3 class="title">Журналирование изменений счетчиков</h3></div></div></div><section class="section" id="d0e17329"><div class="titlepage"><div><div><h4 class="title">Описание интерактивного режима</h4></div></div></div><p>Утилита <span class="application">fb_lock_print</span> допускает возможность запуска
                    в режиме, называемом <span class="quote">«<span class="quote">интерактивный</span>»</span>, при котором собирается
                    информация в течение задаваемого периода. Можно задать значение интервала
                    опросов, общий период (длительность) наблюдения, а также ту группу сведений,
                    которая сейчас интересна.</p><p>Чтобы запустить <span class="application">fb_lock_print</span> в таком режиме,
                    необходимо:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>указать ключ <code class="code">-i*</code>, где вместо символа <span class="quote">«<span class="quote">*</span>»</span>
                            должна быть проставлена одна из следующих букв:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>a — для логирования запросов мьютексов (блокировок самой
                                    лок-таблицы), количества блокирующих состояний и т.д.</p></li><li class="listitem"><p>o — для логирования количеств операций, относящихся к
                                    блокировкам (запросы на установку, преобразования, понижения
                                    уровней и т.д.)</p></li><li class="listitem"><p>t — для логирования операций, связанных с наиболее важными
                                    видами ресурсов</p></li><li class="listitem"><p>w — для логированик количеств ожиданий, таймаутов,
                                    deadlock-проверок и т.д.</p></li></ul></div></li><li class="listitem"><p>указать после <code class="code">-i*</code> еще два аргумента, являющихся целыми
                            числами:</p><div class="orderedlist"><table style="border: 0; " class="orderedlist"><colgroup><col style="text-align: left; vertical-align: top; "/><col/></colgroup><tbody><tr><td>2.1.</td><td><p>интервал опроса лок-таблицы, секунд;</p></td></tr><tr><td>2.2.</td><td><p>общее количество секунд, в течение которых следует делать
                                    опросы, по истечение которого — завершить цикл.</p></td></tr></tbody></table></div></li><li class="listitem"><p>НЕ указывать ключ <code class="code">-c</code>, т.е. запускать сбор сведений в
                            режиме, допускающем изменение лок-таблицы. Интерактивный режим
                                (<code class="code">fb_lock_print -i ...</code>) работает только с глобальными
                            счетчиками, а не со списками объектов, поэтому в бесконечный цикл он
                            войти не может;</p></li></ol></div><p>При выводе данных утилита автоматически добавляет слева столбец с текущим
                    временем сервера. Точность — целые секунды.</p><p>Можно указывать сразу несколько ключей-модификаторов <code class="code">-i</code>,
                    например: <code class="code">-iat</code>. По умолчанию используются все 4 модификатора, то
                    есть запуск с ключом <code class="code">-i</code> будет равносилен указанию:
                        <code class="code">-iaotw</code>.</p></section><section class="section" id="d0e17406"><div class="titlepage"><div><div><h4 class="title">Примеры запуска и вывода</h4></div></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><code class="code">-ia</code>: логирование запросов мьютексов (блокировок самой
                            лок-таблицы), количества блокирующих состояний и так далее </p><pre class="synopsis">
/opt/firebird/bin/fb_lock_print -d some_test_db -ia 1 9999                            
                         </pre><pre class="screen">
11:49:27 acquire/s acqwait/s  %acqwait acqrtry/s rtrysuc/s 
11:49:28     56126     14201        25     13273         0 
11:49:29     54821     14343        26     13315         0 
11:49:30     57860     15409        26     14298         0 
11:49:31     50043     14316        28     13101         0 
11:49:32     52248     11569        22     10725         0 
11:49:33     67745     19721        29     18262         0 
...                                    
                                </pre><p>Обозначения столбцов (все числа являются средними значениями за 1
                            секунду):</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>acquire/s — попытки заблокировать лок-таблицу;</p></li><li class="listitem"><p>acqwait/s — попытки установить блокировки на лок-таблицу,
                                    отправленные в ожидание;</p></li><li class="listitem"><p>%acqwait — процент попыток установить блокировки на
                                    лок-таблицу, отправленных в ожидание (т.е. mutex wait);</p></li><li class="listitem"><p>acqrtry/s — попытки установить блокироку на лок-таблицу,
                                    происходившие после spin-ожидания (см. выше описание Spin count
                                    - значение LockAcquireSpins из файла конфигурации)</p></li><li class="listitem"><p>rtrysuc/s — успешные попытки установки блокировки на
                                    лок-таблицу, когда блокировка была взята до исчерпания заданного
                                    лимита попыток (число успешных spin-циклов), в секунду</p></li></ul></div></li><li class="listitem"><p><code class="code">-io</code>: логирования количеств операций, относящихся к
                            блокировкам (установка/преобразование/понижение):</p><pre class="synopsis">
/opt/firebird/bin/fb_lock_print -d some_test_db -io 1 9999                                    
                                </pre><pre class="screen">
11:49:15 enqueue/s convert/s downgrd/s dequeue/s readata/s wrtdata/s qrydata/s 
11:49:25     26219       519      5327      9677         9         1         0 
11:49:26     30784      1087      5981     12281        13         3         0 
11:49:27     19895       325      4587      6964         7         0         0 
11:49:28     25142       446      4538      9940        10         0         0 
11:49:29     25867       400      4797      8972        12         0         0 
11:49:30     24779       293      5601      9955        12         4         0 
...                                    
                                </pre><p>Обозначения столбцов (все числа являются средними значениями за 1
                            секунду):</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>enqueue/s — запросы на установку блокировок (см. заголовок
                                    лок-таблицы, фразу <span class="quote">«<span class="quote">Enqs: NN</span>»</span>)</p></li><li class="listitem"><p>convert/s — изменения статуса блокировки (см заголовок
                                    лок-таблицы, фразу <span class="quote">«<span class="quote">Converts: N</span>»</span>)</p></li><li class="listitem"><p>downgrd/s — понижения уровня блокировки</p></li><li class="listitem"><p>dequeue/s — освобождения блокировок</p></li><li class="listitem"><p>readata/s — операции чтения данных, ассоциированных с
                                    блокировкой</p></li><li class="listitem"><p>wrtdata/s — операции записи данных, ассоциированных с
                                    блокировкой</p></li><li class="listitem"><p>qrydata/s — операции поиска данных, ассоциированных с
                                    блокировкой</p></li></ul></div></li><li class="listitem"><p><code class="code">-it</code>: логирование операций, связанных с наиболее важными
                            видами ресурсов:</p><pre class="synopsis">
/opt/firebird/bin/fb_lock_print -d some_test_db -it 1 9999                                
                            </pre><pre class="screen">
11:49:45   dblop/s  rellop/s pagelop/s tranlop/s relxlop/s idxxlop/s misclop/s 
11:49:46         0       155     24165      1003         0        28     24826 
11:49:47         0        90     21585       457         0        19     15965 
11:49:48         0        43     18171      1535         0         8     15023 
11:49:49         0       116     24290       363         0        34     18248 
...                                    
                                </pre><p>Обозначения столбцов (все числа являются средними значениями за 1
                            секунду):</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>dblop/s — блокировка на базу данных (LCK_database)</p></li><li class="listitem"><p>rellop/s — блокировки на таблицы (relllop = RELation Lock
                                    OPeration)</p></li><li class="listitem"><p>pagelop/s — блокировки страницы БД (LCK_bdb)</p></li><li class="listitem"><p>tranlop/s — блокировки объекта транзакций тем, кто её
                                    стартовал (LCK_tra)</p></li><li class="listitem"><p>relxlop/s — блокировки для защиты существования таблицы
                                    (LCK_rel_exist)</p></li><li class="listitem"><p>idxxlop/s — блокировки для защиты существования индекса
                                    (LCK_idx_exist)</p></li><li class="listitem"><p>misclop/s — прочие виды блокировок</p></li></ul></div></li><li class="listitem"><p><code class="code">-iw</code>: логирование количеств ожиданий, таймаутов,
                            deadlock-проверок и так далее:</p><pre class="synopsis">
/opt/firebird/bin/fb_lock_print -d some_test_db -iw 1 9999                                
                            </pre><pre class="screen">
11:49:55    wait/s  reject/s timeout/s blckast/s  wakeup/s dlkscan/s deadlck/s 
11:49:56      5291       325         0      5686      7381         0         0 
11:49:57      2714       171         0      2939      3947         0         0 
11:49:58      4544       556         0      4912      6323         0         0 
11:49:59      4942      1393         0      5292      6708         0         0 
11:50:00      3841       248         0      4128      5678         0         0 
...                                    
                                </pre><p>Обозначения столбцов (все числа являются средними значениями за 1
                            секунду):</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>wait/s — ожиданий на получение блокировки</p></li><li class="listitem"><p>reject/s — отказы (см заголовок лок-таблицы, фразу "Rejects:
                                    N")</p></li><li class="listitem"><p>timeout/s — отказов в получении блокировки в связи с
                                    таймаутом</p></li><li class="listitem"><p>blckast/s — факты блокировка кем-либо ресурсов (см заголовок
                                    лок-таблицы, фразу <span class="quote">«<span class="quote">Blocks: N</span>»</span>)</p></li><li class="listitem"><p>wakeup/s — сигналы, доставленных владельцам, которые
                                    блокировали ресурсы</p></li><li class="listitem"><p>dlkscan/s — изменения в значении Deadlock scans</p></li><li class="listitem"><p>deadlck/s — изменения в значении Deadlocks</p></li></ul></div></li></ol></div><p>В конце работы этот режим выводит на отдельной строке среднее арифметическое
                    по каждому числовому столбцу. Пример:</p><pre class="synopsis">
/opt/firebird/bin/fb_lock_print -d some_test_db -io 1 9999                    
                </pre><pre class="screen">
11:49:15 enqueue/s convert/s downgrd/s dequeue/s readata/s wrtdata/s qrydata/s 
11:49:16     31145       615      5999     10962         8         2         0 
11:49:17     24769       660      3839      8437         6         1         0 
...
Average:     27236       479      5738     10151         8         1         0                         
                    </pre></section></section></section><section class="section" id="using-trace"><div class="titlepage"><div><div><h2 class="title" style="clear: both">Использование Firebird Trace API</h2></div></div></div><section class="section" id="d0e17555"><div class="titlepage"><div><div><h3 class="title">Трассировка. Вводная информация. Зачем это нужно?</h3></div></div></div><p>Под трассировкой активности, происходящей в базе под управлением в СУБД Firebird,
                понимается регистрация событий, которые происходят ввиду создания подключений,
                старта и завершения транзакций, явных действий пользователей или некоторых системных
                процессов (на сегодня это процесс sweep).</p><p>Трассировка является незаменимым средством при поиске узких мест приложения,
                оценке ресурсов, затрачиваемых при выполнении запросов, выяснении частоты каких-либо
                действий, а также для целей безопасности (накопление сведений об отклонённых
                попытках регистрации в БД).</p><p>Трассировка показывает статистику в максимально детализированном виде (в отличие
                от статистике доступной например в ISQL). В статистике не учитываются затраты на
                подготовку запроса и передачу данных по сети, что делает её <span class="quote">«<span class="quote">чище</span>»</span>, чем
                данные, которые показывает ISQL.</p><p>Трассировка оказывает очень незначительное влияние на производительность. Даже при
                интенсивной записи в журнал, речь обычно идет не более чем о 2-3% падения скорости
                выполняемых запросов. Это совершенно не так при выполнении запросов к таблицам
                мониторинга, которые могут привести сильно нагруженную систему в состояние ступора. </p><p>Трассировку можно достаточно гибко настроить. В отличие от мониторинга,
                заставляющего все подключения сбрасывать всю информацию, независимо от того, что
                записано в запросе к mon$-таблицам, трассировка позволяет регистрировать только те
                виды событий, которые нам интересны (например, только ошибки времени выполнения, или
                только факты регистрации пользователей). Кроме того, трассировка позволяет указать
                минимальный порог длительности выполнявшихся запросов, и всё, что длилось меньше,
                регистрироваться не будет. Трассировка позволяет применять фильтры на выражения, по
                принципу включаемости и исключения, что дает возможность отследить только те
                запросы, которые отвечают известным нам шаблонам.</p><p>Трассировка <span class="quote">«<span class="quote">скрытна</span>»</span>: пользовательское подключение не может
                выяснить, отслеживается ли его активность или нет. Также, у пользователей (даже
                SYSDBA) в Firebird нет средств для предотвращения трассировки их подключений
                администратором. Однако, SYSDBA может увидеть все запущенные пользовательские сессии
                трассировки, и остановить их.</p><p>Наконец, на одной машине можно запускать несколько сеансов трассировки и они будут
                работать независимо, со своими настройками и направлением вывода в разные
                журналы.</p><p>Всё это делает трассировку одним из самых полезных инструментов администратора и
                разработчика БД.</p></section><section class="section" id="d0e17580"><div class="titlepage"><div><div><h3 class="title">Виды отслеживаемой активности. Пользовательский трассировка и системный
                аудит</h3></div></div></div><p>Отслеживание активности может происходить двумя способами:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Запуском консольного приложения с возможностью его остановки в любое
                        время. Этот вариант работы называется <span class="quote">«<span class="quote">пользовательский
                            трассировка</span>»</span>. Аварийное завершение работы машины, на которой
                        запущен такая трассировка, либо потеря связи с сервером (при удаленном
                        запуске) приведет к прекращению работы трассировки. Пользовательский
                        трассировка запускается Firebird-утилитами
                            <span class="application">fbsvcmrg</span> или
                            <span class="application">fbtracemgr</span> (вторая является
                            <span class="quote">«<span class="quote">обёрткой</span>»</span> над первой и предназначена для более краткого
                        формата запуска).</p></li><li class="listitem"><p>Изменением конфигурации Firebird так, чтобы трассировка стартовал
                        автоматически при каждом запуске СУБД. Такой вариант работы называется
                            <span class="quote">«<span class="quote">системный аудит</span>»</span>. Отслеживание запускается независимо от
                        пользователей, и его функционирование зависит только от работоспособности
                        машины сервера.</p></li></ol></div><p>Функционально оба варианта одинаковы, но предназначение у них разное.</p><p>Пользовательский трассировка требуется чаще. Она позволяет быстро запустить
                трассировку, дать ей поработать и остановить её для проведения анализа и принятия
                решений. Обычно анализ журнала трассировки занимает не более одного дня.</p><p>Системный аудит предназначен для "сквозной регистрации" всех интересующих событий
                и, как правило, он запускается на длительный срок. Системный аудит нельзя остановить
                иначе, кроме как отключив всех пользователей от БД. Возможное применение системного
                аудита — непрерывное отслеживание попыток регистрации путем подбора паролей, либо
                отслеживание активности, которая приводит к возбуждению каких-то заранее известных
                исключений в режиме выполнения.</p><p>Существует также отличие в реализации пользовательского трассировки и системного
                аудита, которое надо учитывать. Процесс записи журнала пользовательской трассировки
                — это асинхронный процесс. Если диск не успевает справиться с большим потоком
                информации от пользовательской трассировки, то ожидания готовности диска не будет,
                работа трассировки при этом не остановится. Системный аудит, наоборот, требует
                синхронную запись на диск, при которой возможны ожидания готовности диска к приему
                очередной порции данных.</p><div class="important"><h3 class="title">Важно</h3><p>Системный аудит может привести к созданию журнала с очень большим размером
                    (десятки гигабайт), поэтому необходимо обязательно убедиться, что на
                    соответствующем диске достаточно места для такого журнала.</p></div><p>Остановка пользовательского трассировки может быть выполнена либо интерактивно, то
                есть нажатием сочетания клавиш Ctrl-C, либо вводом команды
                    <span class="application">fbsvcmgr</span> (или <span class="application">fbtracemgr</span>)
                с передачей ей специального аргумента: <code class="code">action_trace_stop trc_id
                    &lt;N&gt;</code> — что приведет к остановке трассировки без интерактивного
                вмешательства пользователя.</p><p>Управление пользовательской трассировкой можно проводить как на самом сервере, где
                работает экземпляр Firebird, так и с другой машины, на которой установлен Firebird.
                При этом следует указывать IP-адрес удаленного сервера, порт прослушивания (3050 или
                другой), имя менеджера сервисов ('service_mgr') и команду, которую он должен
                выполнить (для запуска это <code class="code">action_trace_start</code>). Примеры команд
                управления пользовательской трассировкой будут показаны ниже.</p><p>Остановка системного аудита, работающего независимо от какой-либо из клиентских
                машин, возможно только через рестарт процесса Firebird (с изменением файла
                    <code class="filename">firebird.conf</code>, которое предотвратит новый старт
                аудита).</p></section><section class="section" id="d0e17639"><div class="titlepage"><div><div><h3 class="title">Блочное представление информации</h3></div></div></div><p>События выводятся в виде простого текста, и каждое из них начинается с указания
                штампа даты-времени, за которым в скобках следует служебная информация, после чего —
                мнемоническое обозначение самого события:</p><pre class="screen">
    2017-12-04T13:16:47.8760 (25101:0x7f5e13868890) EXECUTE_STATEMENT_FINISH            
        </pre><p>Реальная точность значений времени сервера — до миллисекунд.</p><p>Все отслеживаемые события, за исключением сообщений о старте/финише сессий
                трассировки, имеют заголовочную информацию позволяющую идентифицировать, что за
                событие произошло, успешно ли оно завершилось (если речь идет об итоге чего-либо),
                какое приложение работало при этом, в какой именно базе данных это произошло, какие
                были ID у соединения и транзакции и другое.</p><p>Таким образом, значительная часть информации в логе трассировки выглядит в каждом
                блоке одинаково. Например, в следующем фрагменте трассировки:</p><pre class="screen">2017-12-04T13:16:47.8760 (25101:0x7f5e13868890) EXECUTE_STATEMENT_FINISH
        production (ATT_41396268, JOHN:MANAGER, WIN1251, TCPv4:172.16.6.31)
        C:\App\stock_info.exe:1628
                (TRA_393161255, READ_COMMITTED | REC_VERSION | WAIT | READ_ONLY)

Statement 499122858:
-------------------------------------------------------------------------------
select ...
from ...


2017-12-04T13:16:47.9950 (25101:0x7f5e1386c390) EXECUTE_STATEMENT_FINISH
        production (ATT_41396249, MARY:ACCOUNTANT, WIN1251, TCPv4:172.16.6.31)
        C:\App\finance_garant:1604
                (TRA_393161257, READ_COMMITTED | REC_VERSION | WAIT | READ_ONLY)

Statement 499122478:
-------------------------------------------------------------------------------
select ...
from ...            
</pre><p>Видно, что строки, с номерами 1...4 и 12...15 имеют одинаковую структуру и
                содержат одинаковые теги для событий ('EXECUTE_STATEMENT_FINISH'), имени базы или её
                алиаса ('production'), ID подключения ('ATT_nnnnnnn'), и так далее.</p><p>Недостаток у такого представления информации только один: избыточность. Но он
                перевешивается простотой визуального анализа журнала (лога): всё сосредоточено
                рядом, чаще всего нет необходимости в пролистывании лога вверх для получения
                дополнительных сведений.</p><p>Кроме того: если каждое событие начинается одинаковым набором строк, то несложно
                написать скрипт для такой обработки трассировки, при котором все сведения о каждом
                событии (заголовок, текст SQL-запроса, статистика) будут рассматриваться как
                неделимые БЛОКИ. Это позволит затем переупорядочивать блоки и выводить информацию
                    <span class="quote">«<span class="quote">поблочно</span>»</span>, в нужном нам виде, например — в порядке убывания
                длительности выполнения операторов. Это позволит сразу получать перечень
                    <span class="quote">«<span class="quote">узких мест</span>»</span> в производительности приложения.</p></section><section class="section" id="d0e17666"><div class="titlepage"><div><div><h3 class="title">Краткое описание работы. Типичный сценарий работы DBA</h3></div></div></div><p>Чтобы запустить трассировку, нужно сначала подготовить текстовый файл
                конфигурации, аналогичный <code class="filename">firebird.conf</code> (он также содержит пары
                вида: <span class="quote">«<span class="quote">параметр = значение</span>»</span>).</p><p>Конфигурационный файл допускает указывать параметры для ФИЛЬТРАЦИИ таких
                категорий, как виды событий, длительность выполнения, печать плана, печать
                статистики, перечень кодов ошибок, перечень регулярных выражений — шаблонов для
                проверки на соответствие выполняемым SQL-выражениям, и другое.</p><p>Фильтрация видов событий выполняется просто: нужно присвоить соответствующему
                параметру значение true.</p><p>Фильтрация длительности выполнения запросов выполняется назначением минимального
                порога длительности (в миллисекундах). Все запросы, длящиеся выше этого значения
                    (<span class="quote">«<span class="quote">медленные</span>»</span>), будут рассматриваться на возможность их включения в
                лог трассировки. Все остальные запросы (<span class="quote">«<span class="quote">быстрые</span>»</span>) будут
                отбрасываться.</p><p>Фильтрация кодов ошибок и отслеживаемых шаблонов выполняемых выражений выполняется
                по принципу проверки одному и/или двум задаваемым регулярным выражениям.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Включающий фильтр. Работает по принципу допускаются только те, что
                        соответствуют регулярному выражению;</p></li><li class="listitem"><p>Исключающий фильтр. Работает по принципу допускаются все, за исключением
                        тех, что соответствуют регулярному выражению.</p></li></ul></div><p>Более подробно виды фильтрации будут рассмотрены далее в примерах.</p><p>Типичный сценарий работы с трассировки — следующий:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Создается текстовый файл конфигурации для пользовательской
                        трассировки:</p><div class="orderedlist"><table style="border: 0; " class="orderedlist"><colgroup><col style="text-align: left; vertical-align: top; "/><col/></colgroup><tbody><tr><td>1.1.</td><td><p>Проверяется шаблон заголовочной строки (<code class="code">database =
                                    ...</code>). Этот шаблон должен удовлетворять правилам SIMILAR
                                TO (см. далее).</p></td></tr><tr><td>1.2.</td><td><p>Особое внимание в нем уделяется параметру
                                    <em class="parameter"><code>time_threshold</code></em>, который оказывает самое
                                сильное влияние на размер лога трассировки.</p></td></tr><tr><td>1.3.</td><td><p>Включается параметр регистрации завершения SQL-выражений:
                                    <code class="code">log_statement_finish = true</code>.</p></td></tr><tr><td>1.4.</td><td><p>Включается параметр показа табличной статистики: <code class="code">print_perf
                                    = true</code>.</p></td></tr><tr><td>1.5.</td><td><p>Включается параметр показа плана выполнения: <code class="code">print_plan =
                                    true</code> (или <code class="code">explain_plan = true</code>).</p></td></tr></tbody></table></div></li><li class="listitem"><p>Запускается пользовательская трассировка с обязательным перенаправлением
                        его вывода в лог. Длительность работы — например, 5 минут.</p></li><li class="listitem"><p>По окончании работы трассировки останавливается.</p></li><li class="listitem"><p>Проводится анализ лога трассировки на предмет наличия в нём SQL-выражений,
                        который выполнялись дольше всего. Если имеется скрипт/программа для
                            <span class="quote">«<span class="quote">блочного преобразования</span>»</span> текста лога трассировки, то её
                        результатом должен быть тот же самый трассировки, но в нем самыми первыми
                        должны быть SQL-запросы с максимальной длительностью.</p></li></ol></div></section><section class="section" id="d0e17752"><div class="titlepage"><div><div><h3 class="title">Пользовательская трассировка и аудит: настройка, запуск и остановка</h3></div></div></div><p>До запуска трассировку надо настроить посредством редактирования текстового файла
                со строками вида "параметр = значение". Если запускается пользовательская
                трассировка, то имя этого файла затем передается в строку-команду как значение
                одного из ключей. Если же запускается системный аудит, то имя этого файла
                прописывается в <code class="filename">firebird.conf</code> в качестве значения параметра
                    <em class="parameter"><code>AuditTraceConfigFile</code></em>.</p><p>Создаваемый файл конфигурации должен содержать параметр <code class="code">enabled =
                    true</code>, чтобы трассировка или аудит смог начать выводить сообщения. В
                противном случае, все параметры файла конфигурации считаются выключенными и никаких
                сообщений в логе трассировки не будет. Этот параметр (<code class="code">enabled = true |
                    false</code>) полезен, когда нужно временно запретить трассировке активность, но
                отменить его запуск нежелательно. По умолчанию параметр установлен в false, т.е. все
                прочие параметры будут считаться выключенными и трассировка при запуске не выдаст
                ничего. </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Запуск пользовательского трассировке происходит так (путь к каталогу
                        Firebird — в нотации POSIX):</p><pre class="screen">

/opt/firebird/bin/fbsvcmgr localhost/3050:service_mgr action_trace_start 
  trc_cfg &lt;подготовленная_trace_конфигурация.conf&gt;
                        
                    </pre><p>В этот момент на консоль или в лог будет выдано сообщение о том, какой
                        номер присвоен только что запущенной сессии трассировки. Этот номер важен,
                        если далее планируется корректная остановка именно <span class="quote">«<span class="quote">нашей</span>»</span>
                        сессии. Номер сессии трассировки можно получить и с помощью отдельной
                        команды, это делается так:</p><pre class="screen">
/opt/firebird/bin/fbsvcmgr localhost/3050:service_mgr action_trace_list                        
                    </pre><p>Однако, эту команду следует вводить как можно быстрее после предыдущей,
                        чтобы уменьшить шансы получения <span class="quote">«<span class="quote">чужого</span>»</span> номера. Когда
                        трассировку надо остановить, следует использовать команду:</p><pre class="screen">
/opt/firebird/bin/fbsvcmgr localhost/3050:service_mgr action_trace_stop trc_id <em class="replaceable"><code>&lt;N&gt;</code></em>                        
                    </pre><p>— где <em class="replaceable"><code>&lt;N&gt;</code></em>; есть номер
                            <span class="quote">«<span class="quote">нашей</span>»</span> trace-сессии, полученный ранее. </p></li><li class="listitem"><p>Запуск системного аудита, как отмечалось выше, происходит автоматически
                        при рестарте Firebird. Его нельзя запустить <span class="quote">«<span class="quote">вручную</span>»</span>.
                        Аналогично, для остановки аудита требуется остановить Firebird и сделать
                        пустым (или закомментировать) значение параметра
                            <em class="parameter"><code>AuditTraceConfigFile</code></em> в
                            <code class="filename">firebird.conf</code> (см. также здесь:<a class="link" href="https://www.firebirdsql.org/file/documentation/release_notes/html/ru/rlsnotes25.html#rnfb25-fbconf-audit" target="_top">AuditTraceConfigFile</a>).</p></li></ol></div><div class="note"><h3 class="title">Примечание</h3><p>Администратор может запустить любое количество пользовательских сессий
                    трассировки, с любыми конфигурационными файлами. Более того, запустить
                    трассировку в Firebird 3.0 может любой пользователь, но видеть он будет только
                    активность своей учетной записи.</p></div></section><section class="section" id="d0e17820"><div class="titlepage"><div><div><h3 class="title">Структура конфигурации. Проверка имен на соответствие шаблонам</h3></div></div></div><div class="orderedlist"><p>Наиболее важным в конфигурации трассировки является параметр-заголовок
                        <span class="quote">«<span class="quote">database</span>»</span>, строковое значение которого задает ДВЕ группы
                    шаблонов:</p><ol class="orderedlist" type="1"><li class="listitem"><p>шаблоны каталогов и имен файлов баз, далее назовем эту группу G1 и</p></li><li class="listitem"><p>шаблоны алиасов БД для подключения, далее назовем эту группу G2.</p></li></ol></div><p>Решение о том, отражать ли активность в некоторой базе (или её алиасе) с именем X,
                принимается прежде всего по результату проверки на соответствие имени X хотя бы
                одному шаблону из этих двух групп: G1 или G2. Соответствие проверяется по тем же
                принципам, которые используются в работе SQL-оператора SIMILAR TO, но при этом не
                учитывается регистр символов.</p><p>В конфигурационном файле трассировки может быть произвольное количество
                database-секций.</p><p>При выполнении подключения к какой-то базе файл перечитывается каждый раз заново,
                с первой строки и до тех пор, пока имя базы данных или её псевдоним не будут
                соответствовать какому-либо из шаблонов. Пройденная проверка шаблона означает, что
                начинают применяться ТОЛЬКО те параметры, что указаны в секции внутри фигурных
                скобок.</p><p>Все секции, расположенные ниже той, где прошла проверка шаблона, для данного файла
                БД/алиаса уже не действуют.</p><p>Самая последняя секция из указываемых в файле конфигурации может не иметь шаблона
                и выглядеть так:</p><pre class="programlisting">
database = 
{
    <em class="replaceable"><code>&lt;params&gt;</code></em> ...
}                
            </pre><p>Эта секция служит для применения её параметров ко всем файлам БД/алиасам, по
                которым еще не было найдено соответствий шаблонам, указанным в файле конфигурации
                ВЫШЕ данной строки.</p><p>Объяснить структуру файла будет проще на следующем примере.</p><pre class="programlisting">

# P1 — шаблон проверки имён тех БД/алиасов, отслеживание активности 
# в которых нас не интересует
database = &lt;P1&gt; 
{ 
   enabled = false 
}

# P2 — шаблон для тех БД/алиасов, в которых нас интересуют только 
# события отклоненных попыток регистрации
database = &lt;P2&gt; 
{
   enabled = true
   log_connections = true
   log_errors = true
}

database = &lt;P3&gt; 
# P3 - шаблон только для тех БД алиасов, в которых нам интересно выполнение 
# выражений над таблицей "some_very_huge_table",
# причём длительность выполнения должна быть не менее 5000 мс.
{
    enabled = true
    time_threshold = 5000
    log_statement_finish = true
    include_filter = "%((from|join)[[:WHITESPACE:]]+some_very_huge_table)%"
}

database =
# Нет шаблонов после знака "=". Это означает: все прочие имена файлов 
# БД/алиасов, которые не попали на соответствие в шаблонах,
# указанных выше этой строки: P1, P2 и P3.
{
    enabled = true
    time_threshold = 1000
    log_statement_finish = true
    log_procedure_finish = true
    log_function_finish = true
    exclude_filter = "%(execute[[:WHITESPACE:]]+block[[:WHITESPACE:]]+as)%"
}
             
            </pre><p>Работающий пример с конкретными шаблонами: </p><pre class="programlisting">

# Запрещаем регистрацию любой активности, которая происходит 
# в базе учетных записей пользователей и паролей
database = (%[\\/](security3).fdb|(security.db))
{
    enabled = false
}

# Разрешаем регистрацию ошибок — и только их — в базе с секретными сведениями.
# Прочих разрешений (например, показ выполняемых SQL-выражений) — нет:
database = (%[\\/](top_secret).fdb|(secret_alias))
{
    enabled = true
    log_initfini = false
    log_errors = true
}

# Для базы, работающей под интенсивной нагрузкой, разрешаем 
# регистрацию SQL-выражений любой длительности, но только тех,
# которые относятся к таблицам мониторинга.
database = (%[\\/](heavy_production).fdb|(heavy_prod_alias))
{
    enabled = true
    log_initfini = false
    log_errors = false
    time_threshold = 0
    log_statement_finish = true
    include_filter = "%((from|join)[[:WHITESPACE:]]+mon$)%"
}


# Для всех остальных файлов БД/алиасов: разрешаем регистрацию 
# выполняемых SQL-выражений любой длительности.
# Важно: специальные требования для security3, top_secret и 
# heavy_production, размещённые в database-секциях выше этой строки, 
# остаются в силе. Эта секция определяет требования для всех 
# ДРУГИХ файлов баз и алиасов:
database =
{
    enabled = true
    log_initfini = false
    log_errors = false

    time_threshold = 0
    log_statement_finish = true
}

                </pre><p>
            </p><div class="orderedlist"><p>Рекомендации:</p><ol class="orderedlist" type="1"><li class="listitem"><p>Всегда размещайте секции с шаблонами <span class="quote">«<span class="quote">большей конкретики</span>»</span>
                        выше секций, где указаны <span class="quote">«<span class="quote">общие шаблоны</span>»</span>. Если по некоторой
                        базе нужно заблокировать показ чего-либо в трассировке, добавьте секцию с
                        шаблоном, которому отвечают имя и алиас этой базы, в начало файла.</p></li><li class="listitem"><p>Подключения к базе как к файлу с точки зрения трассировки НЕ идентичны
                        подключениям к этой же базе по её алиасу. Поэтому, если вам нужна
                        регистрация всех видов подключений (по имени файла БД и по алиасу),
                        указывайте в database-секции всегда ДВА шаблона. Первым должен быть указан
                        шаблон с именем файла, затем должен следовать разделитель (символ
                        вертикальной черты, без кавычек) и после него надо указать шаблон со всеми
                        возможными алиасами, по которым к данной базе могут выполняться подключения.
                        Если шаблон состоит из нескольких возможных фраз, объединяйте их в круглые
                        скобки:</p><pre class="programlisting">
( %[\\/](heavy_production).fdb | (heavy_prod_alias|alias_for_heavy_prod|prod_alias_heavy) )
                        </pre></li><li class="listitem"><p>Для предварительной проверки того, будет ли работать шаблон, создайте
                        подключение к базе и выполните выражение:</p><pre class="programlisting">

SQL&gt; set list on;
SQL&gt; select 1 from rdb$database where '&lt;expr&gt;' SIMILAR TO '&lt;pattern&gt;';
                                
                            </pre><p>Например, чтобы проверить, будет ли отслеживаться любой допустимый запрос
                        к таблицам мониторинга при использовании шаблона:</p><pre class="programlisting">
  
include_filter = "%((from|join)[[:WHITESPACE:]]+mon$)%"

                        </pre><p>— можно сделать следующую проверку:</p><pre class="programlisting">
  
SQL&gt; select 1 from rdb$database where '
CON&gt; select
CON&gt; mon$server_pid
CON&gt; from
CON&gt;    mon$attachments
CON&gt; where mon$attachments_id = current_connection
CON&gt; '
CON&gt; similar to
CON&gt; '%((from|join)[[:WHITESPACE:]]+mon$)%';

                        </pre><pre class="screen">
    CONSTANT
============
           1                                
                            </pre></li><li class="listitem"><p>Шаблоны для include/exclude фильтров лучше всегда указывать в двойных
                        кавычках, даже если они примитивные (select|insert|delete). Шаблоны для имен
                        файлов БД/алиасов указываются без двойных кавычек</p></li></ol></div></section><section class="section" id="d0e17896"><div class="titlepage"><div><div><h3 class="title">Виды отслеживаемых событий</h3></div></div></div><div class="orderedlist"><p>Трассировка позволяет:</p><ol class="orderedlist" type="1"><li class="listitem"><p>Отследить события, относящиеся к работе приложений c базой данных
                        (старт/завершение транзакций, исполняемых SQL-выражений и др.);</p></li><li class="listitem"><p>Установить дополнительные параметры для событий, относящихся к БД
                        (минимальное время длительности, include/exclude-фильтры и др.);</p></li><li class="listitem"><p>Установить параметры для работы собственно трассировки (имя лога для
                        системного аудита, размер для переименования лога, и др.);</p></li><li class="listitem"><p>Отследить события, относящиеся к сервисам Firebird (администрирование
                        пользователей, управление сессиями трассировки, резервного копирования и
                        прочее).</p></li></ol></div><p>В списке параметров, которые приводятся ниже, все значения считаются логического
                типа (true | false), если не оговорено другое. </p><section class="section" id="d0e17916"><div class="titlepage"><div><div><h4 class="title">Основные параметры для событий, относящихся к работе c базой данных</h4></div></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Подключение к базе данных. Регулируется параметром конфигурации
                                <em class="parameter"><code>log_connections</code></em>.</p></li><li class="listitem"><p>Старт транзакции, завершение транзакции (фиксация или отмена).
                            Параметр: <em class="parameter"><code>log_transactions</code></em>.</p></li><li class="listitem"><div class="orderedlist"><p>Выполнение SQL-запросов:</p><table style="border: 0; " class="orderedlist"><colgroup><col style="text-align: left; vertical-align: top; "/><col/></colgroup><tbody><tr><td>3.1.</td><td><p>Подготока запроса к выполнению. Параметр:
                                        <em class="parameter"><code>log_statement_prepare</code></em>.</p></td></tr><tr><td>3.2.</td><td><p>Старт запроса (запуск его на выполнение). Параметр:
                                        <em class="parameter"><code>log_statement_start</code></em>.</p></td></tr><tr><td>3.3.</td><td><p>Окончание выполнения выражения. Для выборок — переход за
                                    последнюю запись, для DML — завершение выполнения. Параметр:
                                        <em class="parameter"><code>log_statement_finish</code></em>.</p></td></tr><tr><td>3.4.</td><td><p>Высвобождение ресурсов, занимавшихся курсором, выполнявшим
                                    запрос. Параметр:
                                    <em class="parameter"><code>log_statement_free</code></em>.</p></td></tr></tbody></table></div></li><li class="listitem"><div class="orderedlist"><p>Выполнение процедурных модулей:</p><table style="border: 0; " class="orderedlist"><colgroup><col style="text-align: left; vertical-align: top; "/><col/></colgroup><tbody><tr><td>4.1.</td><td><p>Старт выполнения хранимой процедуры (созданной как отдельная
                                    или в составе пакета). Параметр:
                                        <em class="parameter"><code>log_procedure_start</code></em>.</p></td></tr><tr><td>4.2.</td><td><p>Окончание выполнения хранимой процедуры. Параметр:
                                        <em class="parameter"><code>log_procedure_finish</code></em>.</p></td></tr><tr><td>4.3.</td><td><p>Старт выполнения PSQL-функции (созданной как отдельная или в
                                    составе пакета). Параметр:
                                        <em class="parameter"><code>log_function_start</code></em>.</p></td></tr><tr><td>4.4.</td><td><p>Окончание выполнения PSQL-функции. Параметр:
                                        <em class="parameter"><code>log_function_finish</code></em>.</p></td></tr><tr><td>4.5.</td><td><p>Старт выполнения триггера (любого уровня: для каждой записи
                                    или ан события уровня БД). Параметр:
                                        <em class="parameter"><code>log_trigger_start</code></em>.</p></td></tr><tr><td>4.6.</td><td><p>Окончание выполнения триггера. Параметр:
                                        <em class="parameter"><code>log_trigger_finish</code></em>.</p></td></tr></tbody></table></div></li><li class="listitem"><div class="orderedlist"><p>Предупреждения и ошибки, происходящие при компиляции или на этапе
                                выполнения выражений</p><table style="border: 0; " class="orderedlist"><colgroup><col style="text-align: left; vertical-align: top; "/><col/></colgroup><tbody><tr><td>5.1.</td><td><p>Предупреждения. Параметр:
                                    <em class="parameter"><code>log_warnings</code></em>.</p><p>Пример предупреждения, который часто появляется при работе с
                                    базами 1-го диалекта:
                                    </p><pre class="screen">
SQL warning code = 301 / DATE data type is now called TIMESTAMP                      
                                                </pre><p>
                                </p></td></tr><tr><td>5.2.</td><td><p>Регистрация ошибок (разрешение на это). Параметр:
                                        <em class="parameter"><code>log_errors</code></em>.</p></td></tr></tbody></table></div></li><li class="listitem"><p>Изменение контекстных переменных. Регистрируются все обращения к
                            функции RDB$SET_CONTEXT(). Параметр:
                            <em class="parameter"><code>log_context</code></em>.</p></li><li class="listitem"><p>Компиляция в BLR-код и выполнение BLR-кода (BLR — Binary Language
                            Representation — двоичное представление PSQL-инструкций). Для краткого
                            информирования о фактах успешной компиляции кода (COMPILE_BLR), а также
                            о выполнении команд ISQL, обращающихся к словарю базы (EXECUTE_BLR; в
                            основном, это SHOW-команды), служит параметр
                                <em class="parameter"><code>log_blr_requests</code></em>.</p><p>Для развернутого показа того, какой именно BLR-код выполняется,
                            применяется параметр <em class="parameter"><code>print_blr</code></em>. Указание
                                <code class="code">print_blr = true</code> требует, чтобы также был указан
                                <code class="code">log_blr_requests = true</code> (иначе ничего регистрироваться
                            не будет).</p></li></ol></div></section><section class="section" id="d0e18044"><div class="titlepage"><div><div><h4 class="title">Дополнительные параметры для событий, относящихся к работе с базой
                    данных</h4></div></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Минимальная длительность выполнения SQL-выражения, процедуры или
                            функции, необходимое для того, чтобы их завершение отразилось в логе
                            трейса.</p><p>Параметр: <em class="parameter"><code>time_threshold</code></em>, числовой. Измерение:
                            миллисекунды. </p><p>Значение по умолчанию: 100.</p><div class="tip"><h3 class="title">РЕКОМЕНДАЦИЯ</h3><p>Никогда не удаляйте строку с этим параметром. Может оказаться так,
                                что вы не увидите в трассировки никакой активности, но на самом деле
                                она там будет. Это произойдёт в случае, когда все выполняемые
                                выражения и процедуры длятся менее 100 мс — умалчиваемого лимита для
                                параметра <em class="parameter"><code>time_threshold</code></em>. Удаление этой
                                строки затруднит поиск причины, по которой в трассировки нет показа
                                активности приложений.</p></div></li><li class="listitem"><p>Фильтрация выполняемых SQL-выражений через include/exclude списки
                            шаблонов.</p><p>Списки работают по принципу: </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>регистрировать только тех выражения, которые содержат хотя
                                        бы один из шаблонов из include-списка;</p></li><li class="listitem"><p>запретить регистрацию тех выражений, которые содержат хотя
                                        бы один из шаблонов из exclude-списка.</p></li></ul></div><p>Параметры: <em class="parameter"><code>include_filter</code></em> и
                                <em class="parameter"><code>exclude_filter</code></em>. Значения: см. примеры далее в
                            тексте.</p><p>Эти параметры работают только при условии, что хотя бы один из
                            следующих параметров равен true:
                                <em class="parameter"><code>log_statement_prepare</code></em>,
                                <em class="parameter"><code>log_statement_start</code></em>,
                                <em class="parameter"><code>log_statement_finish</code></em>,
                                <em class="parameter"><code>log_statement_free</code></em>.</p></li><li class="listitem"><p>Фильтрация ошибок через include/exclude-списки кодов ошибок или их
                            мнемонических обозначений.</p><p>Списки работают по принципу: </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>регистрировать только тех ошибки, которые принадлежат
                                        include-списку;</p></li><li class="listitem"><p>запретить регистрацию тех ошибок, которые принадлежат
                                        exclude-списку.</p></li></ul></div><p>Параметры: <em class="parameter"><code>include_gds_codes</code></em> и
                                <em class="parameter"><code>exclude_gds_codes</code></em>. Значения: см. примеры
                            далее в тексте. Эти параметры работают только при условии, что
                                <code class="code">log_errors = true</code>.</p></li><li class="listitem"><p>Печать плана выполнения SQL-запроса: </p><div class="orderedlist"><table style="border: 0; " class="orderedlist"><colgroup><col style="text-align: left; vertical-align: top; "/><col/></colgroup><tbody><tr><td>4.1.</td><td><p>В кратком ("традиционном") виде:
                                        </p><pre class="programlisting">
PLAN (RDB$DATABASE NATURAL)                                                    
                                                </pre><p>
                                    </p><p>Параметр: <em class="parameter"><code>print_plan</code></em>.</p></td></tr><tr><td>4.2.</td><td><p>В развернутом виде (доступно начиная с Firebird 3.0):
                                        </p><pre class="programlisting">
Select Expression
    -&gt; Table "RDB$DATABASE" Full Scan                                                  
                                                </pre><p>
                                    </p><p>Параметр: <em class="parameter"><code>explain_plan</code></em>.</p><p>Работает только при условии, что <code class="code">print_plan =
                                            true</code>. При указании обоих параметров в true будет
                                        выводиться только развернутый план.</p></td></tr></tbody></table></div><p>Эти параметры работают только при условии, что хотя бы один из
                            следующих параметров равен true:
                                <em class="parameter"><code>log_statement_prepare</code></em>,
                                <em class="parameter"><code>log_statement_start</code></em>,
                                <em class="parameter"><code>log_statement_finish</code></em>,
                                <em class="parameter"><code>log_statement_free</code></em>.</p></li><li class="listitem"><p>Печать статистики выполнения SQL-запросов и PSQL-модулей.</p><p>При заказе этой статистики в логе будут выведены длительность
                            выполнения и значения счетчиков fetches, reads, writes, marks. Для
                            SQL-выражений будут показаны сводные данные по операциям, которые
                            выполнялись над таблицами: общее количество чтений, модификаций записей
                            и др.</p><p>Параметр: <em class="parameter"><code>print_perf</code></em>.</p><p>Статистика выводится только для того вида события, по которому задан
                            параметр регистрации, то есть:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>если задан <em class="parameter"><code>log_statement_finish</code></em>, то
                                        будет выводиться статистика по выполнявшимся
                                        SQL-выражениям;</p></li><li class="listitem"><p>если задан <em class="parameter"><code>log_procedure_finish</code></em>, то
                                        будет выводиться статистика по выполнявшимся хранимым
                                        процедурам и так далее.</p></li></ul></div></li><li class="listitem"><p>Ограничение длины текста регистрируемых событий: </p><div class="orderedlist"><table style="border: 0; " class="orderedlist"><colgroup><col style="text-align: left; vertical-align: top; "/><col/></colgroup><tbody><tr><td>6.1.</td><td><p>Максимальная длина выполняемого SQL-выражения. Параметр:
                                            <em class="parameter"><code>max_sql_length</code></em>, значение по
                                        умолчанию: 300.</p></td></tr><tr><td>6.2.</td><td><p>Максимальная длина отдельного аргумента, который
                                        передается SQL-выражению. Параметр:
                                            <em class="parameter"><code>max_arg_length</code></em>, значение по
                                        умолчанию: 80.</p></td></tr><tr><td>6.3.</td><td><p>Максимальное количество аргументов, которые будут показаны
                                        в трейсе (ниже последнего будет выведено "..."). Параметр:
                                            <em class="parameter"><code>max_arg_count</code></em>, значение по
                                        умолчанию: 10.</p></td></tr><tr><td>6.4.</td><td><p>Максимальная длина выводимого BLR-запроса. Параметр:
                                            <em class="parameter"><code>max_blr_length</code></em>, значение по
                                        умолчанию: 500.</p></td></tr><tr><td>6.5.</td><td><p>Максимальная длина выводимой dyn-request
                                        инструкции.</p><p>Под термином 'DYN' понимается язык, ранее (в эпоху
                                        InterBase) называвшийся GDEF. От него отказались еще в IB
                                        4.0, но затем он был снова возвращен в открытой версии
                                        Interbase 6.0 (уже под именем DYN). И хотя этот язык
                                        манипулирования метаданными не разрешен к использованию в
                                        Firebird 3.0, возможность отслеживания инструкций на нем до
                                        сих пор оставлена (только в системном аудите).</p><p>Параметр: <em class="parameter"><code>max_dyn_length</code></em>, значение
                                        по умолчанию: 500.</p></td></tr></tbody></table></div></li><li class="listitem"><p>Ограничение показа активности, выполняемой только одним
                            подключением.</p><p>Параметр: <em class="parameter"><code>connection_id</code></em>, числовой. Значение по
                            умолчанию: 0 — означает регистрацию активности от всех
                            подключений.</p></li></ol></div></section><section class="section" id="d0e18239"><div class="titlepage"><div><div><h4 class="title">Дополнительные параметры для системного аудита</h4></div></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Системный аудит, запускаемый автоматически при старте Firebird, должен
                            "знать" имя конфигурационного файла, который необходимо прочитать перед
                            началом работы.</p><p>Имя этого файла назначается в конфигурационном файле СЕРВЕРА,
                                <code class="filename">firebird.conf</code>, параметром
                                <em class="parameter"><code>AuditTraceConfigFile</code></em>. </p><div class="important"><h3 class="title">Важно</h3><p>Отсутствие значения у этого параметра (или помещение его под
                                комментарий) означает выключение системного аудита. Это произойдет
                                при рестарте Firebird.</p></div></li><li class="listitem"><p>В файле конфигурации трассировки существует параметр
                                <em class="parameter"><code>log_filename</code></em>, значение которого должно быть
                            именем файла, в который будет проводиться запись лога аудита. Это имя
                            будет далее использоваться в механизме переименований логов при их
                            заполнении до лимита, указанного параметром
                                <em class="parameter"><code>max_log_size</code></em>. См. следующий пункт.</p></li><li class="listitem"><p>В файле конфигурации трассировки существует параметр
                                <em class="parameter"><code>max_log_size</code></em>, значение которого измеряется в
                            мегабайтах. Он служит для цели автоматического переименования логов с
                            целью недопущения бесконечного роста только лишь одного файла
                                (<span class="quote">«<span class="quote">текущего</span>»</span> журнала).</p><p>Его значение — это максимальный размер лога системного аудита, по
                            достижении которого запись в текущий (заполненный) лог останавливается,
                            лог переименовывается, а затем запись новых сообщений продолжается в
                            НОВЫЙ файл с именем, указанный в параметре
                                <em class="parameter"><code>AuditTraceConfigFile</code></em>.</p><p>По умолчанию значение равно 0, что подразумевает отсутствие
                            переименований файлов и запись всего аудита только в один файл.</p><div class="important"><h3 class="title">Важно</h3><div class="itemizedlist"><ul style="list-style-type: disc; " class="itemizedlist"><li class="listitem"><p>этот параметр относится только к системному аудиту.
                                        Пользовательская трассировка всегда пишется только в тот
                                        файл, который был указан в командной строке запуска.</p></li><li class="listitem"><p>круговой ротации логов аудита (т.е. использования их по
                                        "револьверному принципу") в готовом виде нет. Это является
                                        задачей администратора сервера Firebird.</p></li></ul></div></div></li></ol></div></section><section class="section" id="d0e18292"><div class="titlepage"><div><div><h4 class="title">События, относящиеся к сервисам Firebird</h4></div></div></div><p>Многие действия можно выполнять, вызывая функции из набора, называемого
                    сервисами Firebird. Например управление сессиями трассировки, резервное
                    копирование, сбор статистики и прочее.</p><p>Эти функции доступны как через API, так и через вызов утилиты командной строки
                    fbsvcmgr.</p><p>Трассировка позволяет отследить активность вызовов функций, относящихся к
                    сервисам Firebird. Кроме того, делать это можно с указанием include/exclude
                    фильтров, перечисляя только те функции, которые интересуют.</p><div class="orderedlist"><p>Допускается отслеживание следующих сервисных функций:</p><ol class="orderedlist" type="1"><li class="listitem"><div class="orderedlist"><p>Работа с базами данных:</p><table style="border: 0; " class="orderedlist compact"><colgroup><col style="text-align: left; vertical-align: top; "/><col/></colgroup><tbody><tr><td>1.1.</td><td><p>Backup Database</p></td></tr><tr><td>1.2.</td><td><p>Restore Database</p></td></tr><tr><td>1.3.</td><td><p>Repair Database</p></td></tr><tr><td>1.4.</td><td><p>Incremental Backup Database</p></td></tr><tr><td>1.5.</td><td><p>Incremental Restore Database</p></td></tr></tbody></table></div></li><li class="listitem"><div class="orderedlist"><p>Администрирование пользователей</p><table style="border: 0; " class="orderedlist compact"><colgroup><col style="text-align: left; vertical-align: top; "/><col/></colgroup><tbody><tr><td>2.1.</td><td><p>Add User</p></td></tr><tr><td>2.2.</td><td><p>Delete User</p></td></tr><tr><td>2.3.</td><td><p>Modify User</p></td></tr><tr><td>2.4.</td><td><p>Display User</p></td></tr><tr><td>2.5.</td><td><p>Set Domain Admins Mapping to RDB$ADMIN</p></td></tr><tr><td>2.6.</td><td><p>Drop Domain Admins Mapping to RDB$ADMIN</p></td></tr></tbody></table></div></li><li class="listitem"><div class="orderedlist"><p>Показ свойств и статистики по БД. Получение содержимого
                                    <code class="filename">firebird.log</code></p><table style="border: 0; " class="orderedlist compact"><colgroup><col style="text-align: left; vertical-align: top; "/><col/></colgroup><tbody><tr><td>3.1.</td><td><p>Database Properties</p></td></tr><tr><td>3.2.</td><td><p>Database Stats</p></td></tr><tr><td>3.3.</td><td><p>Get Log File</p></td></tr></tbody></table></div></li><li class="listitem"><div class="orderedlist"><p>Управление сессиями пользовательского трассировки: </p><table style="border: 0; " class="orderedlist compact"><colgroup><col style="text-align: left; vertical-align: top; "/><col/></colgroup><tbody><tr><td>4.1.</td><td><p>Start Trace Session</p></td></tr><tr><td>4.2.</td><td><p>Stop Trace Session</p></td></tr><tr><td>4.3.</td><td><p>Suspend Trace Session</p></td></tr><tr><td>4.4.</td><td><p>Resume Trace Session</p></td></tr><tr><td>4.5.</td><td><p>List Trace Sessions</p></td></tr></tbody></table></div></li></ol></div><p>Секция в конфигурации трассировки, объявляющая слежение за вызовами сервисов
                    Firebird, может содержать следующие параметры:</p><pre class="programlisting">

services 
{
    # Разрешается ли применение этой секции
    enabled = false

    # Имя файла, используемого как журнал операций при работе системного аудита:
    #log_filename = name

    # Максимальный размер журнала (в мегабайтах), используемый системным аудитом 
    # как порог для начала переименования лога и перевода дальнейшей записи 
    # в новый (пустой) файл, задаваемый параметром &lt;log_filename&gt;:
    #max_log_size = 0

    # Services filters.
    #
    # Only services whose names fall under given regular expression are 
    # reported in the log.

    # Фильтрация имен сервисов, которые могут попадать в лог (НЕ чувствиительна 
    # к регистру символов):
    #
    # 1. Включающая фильтрация (сохранять только те сервисы, которые присутствуют 
    #    в списке шаблонов include_filter).
    #    Внимание: при включенном параметре log_services в лог будут попадать 
    #    события подключения и отключения от сервиса, даже если имя функции не 
    #    отвечает шаблону include_filter. Пример разершения регистрации только 
    #    двух вызовов: "%((backup database)|(restore database))%"
    #include_filter

    # 2. Искючающая фильтрация (Не регистрировать вызовы тех сервисов, которые 
    # присутствуют в списке шаблонов exclude_filter):
    #exclude_filter 

    # Регистрировать ли события подключения к сервисной функции, её старта и 
    # отключения от сервиса
    log_services = false

    # Регистрировать ли запросы, идущие от сервиса
    log_service_query = true

    # Регистрировать ли ошибки, происходящие при обращении к сервисной 
    # функции Firebird
    log_errors = true

    # Регистрировать ли предупреждения
    #log_warnings = false

    # Filters for errors and warnings GDS codes.
    # Comma separated list of GDS codes values and\or names.
    # For example: deadlock, req_sync, 335544321

    # Include filter. If empty, trace all errors\warnings events.
    # Else trace event if any code from list is found in status-vector.

    # Фильтрация ошибок, возникающих при вызове сервисных функций:
    #    Включающая фильтрация: регистрировать только те ошибки, чьи числовые 
    #    коды или мнемонические имена принадлежат
    #    к указанному списку:
    #include_gds_codes

    #    Исключающая фильтрация: НЕ регистрировать те ошибки, чьи числовые 
    #    коды или мнемонические имена принадлежат
    #    к указанному списку:
    #exclude_gds_codes

}
                    
                </pre></section><section class="section" id="d0e18383"><div class="titlepage"><div><div><h4 class="title">Контроль состояния пользовательской трассировки</h4></div></div></div><p><span class="formalpara-title">Расположение: </span><code class="filename">firebird.conf</code>.</p><p><span class="formalpara-title">Параметр: </span><em class="parameter"><code>MaxUserTraceLogSize</code></em>.</p><p><span class="formalpara-title">Значение по умолчанию: </span>10</p><p><span class="formalpara-title">Единица измерения: </span>Мб, мегабайт.</p><p>Задает максимальный суммарный размер временных файлов, создаваемых сессией
                    пользовательской трассировки Services API.</p><p>Этот параметр ограничивает объём информации трассировки, которая может
                    храниться на сервере до того, как она будет прочитана клиентом.</p><p>Пользовательский трассировка пишет свои данные асинхронно, не дожидаясь ответа
                    от клиента о готовности приему очередного сообщения. Для реализации этого при
                    работе трейса создаются временные файлы для хранения текста, который еще не был
                    прочитан. Клиент может читать данные медленнее, чем их генерирует сервер,
                    поэтому необходимо контролировать их общий размер. Если этот общий размер
                    превысит некоторый порог, пользовательская сессия трассировка будет
                    приостановлена с выводом сообщения:
                    </p><pre class="screen">
--- Session &lt;NN&gt; is suspended as its log is full ---            
                    </pre><p>
                </p><p>После того, как клиентское приложение закончит читать последний из файлов,
                    трассировка автоматически возобновится.</p><div class="important"><h3 class="title">Важно</h3><p>Активность в базе данных происходившая в период паузы трассировки ввиду
                        "медлительности" клиента, НЕ будет зафиксирована.</p><p>Это значит, что на практике параметр
                            <em class="parameter"><code>MaxUserTraceLogSize</code></em> должен иметь значение,
                        исключающее приостановку трассировки. Для наблюдения за размером временных
                        файлов трассировки нужно сначала получить информацию о том, где содержится
                        лок-таблица. Поскольку эти файлы всегда создаются в том же каталоге:</p><pre class="screen">
# /opt/firebird/bin/fbsvcmgr localhost:service_mgr user sysdba 
password masterkey info_get_env_lock

Path to lock files: /tmp/firebird/
                    </pre><p>Затем (в Linux) можно воспользоваться командой watch:</p><pre class="screen">
watch -n 1 "ls -l /tmp/firebird/fb*_trace* | awk '{print \$9,\$5}' ; 
ls -l /tmp/firebird/fb*_trace* | wc -l"                            
                        </pre><p>Пример её вывода:</p><pre class="screen">
Every 1.0s: ls -l /tmp/firebird/fb*_trace* | awk '{print $9,$5}' ; 
ls -l /tmp/firebird/fb*_trace* | wc -l  Thu Dec 14 10:51:25 2017    

/tmp/firebird/fb12_trace 4192
/tmp/firebird/fb_trace.{6F356FF8-5D63-4AC5-4E88-4959A27A6ED5} 88
/tmp/firebird/fb_trace.{6F356FF8-5D63-4AC5-4E88-4959A27A6ED5}.0000151 1048576
/tmp/firebird/fb_trace.{6F356FF8-5D63-4AC5-4E88-4959A27A6ED5}.0000152 1048576
/tmp/firebird/fb_trace.{6F356FF8-5D63-4AC5-4E88-4959A27A6ED5}.0000153 1048576
/tmp/firebird/fb_trace.{6F356FF8-5D63-4AC5-4E88-4959A27A6ED5}.0000154 461276
/tmp/firebird/fb_trace_iPi4m3 1443
7
                    </pre><p>Предельный размер каждого файла равен 1 Мб. Если количество этих файлов
                        часто приближается к значению параметра
                            <em class="parameter"><code>MaxUserTraceLogSize</code></em>, следует увеличить
                        его.</p></div><p>Дополнительно про параметр <em class="parameter"><code>MaxUserTraceLogSize</code></em> можно
                    прочитать <a class="link" href="https://www.firebirdsql.org/file/documentation/release_notes/html/ru/rlsnotes25.html#rnfb25-fbconf-maxtrace" target="_top">здесь</a>.</p></section></section><section class="section" id="d0e18452"><div class="titlepage"><div><div><h3 class="title">Примеры полезных конфигураций</h3></div></div></div><div class="informalexample"><p>Запретить отслеживание базы учетных записей пользователей, разрешить
                    наблюдение за возникающими ошибками в базе 'foo', которая может иметь расширения
                        <code class="filename">.fdb</code> или <code class="filename">.gdb</code> и находиться в любом
                    каталоге:</p><pre class="programlisting">
database = (%[\\/](security3).fdb|(security.db))
{
    enabled = false
}

database = ( %[\\/](foo)(.fdb|.gdb) )
{
    enabled = true
    log_initfini = false
    log_errors = true
    time_threshold = 0
}                    
                </pre><div class="tip"><h3 class="title">Подсказка</h3><p>Для проверки того, будет ли работать шаблон в секции database, можно
                        ввести на выполнение следующее выражение с SIMILAR TO
                        </p><pre class="programlisting">
select 1 from rdb$database 
where _utf8 'c:\temp\data\fOO.Gdb' collate unicode_ci similar 
      to _utf8 '%[\\/](foo)(.fdb|.gdb)' collate unicode_ci;                        
                    </pre><p>
                    </p><p>Результат его выполнения будет не пустым, следовательно шаблон —
                        корректный.</p></div></div><div class="informalexample"><p>Разрешить отслеживание активности во всех базах, расположенных в каталоге
                        <code class="filename">c:\data\fb3x\</code>, и его подкаталогах. Отслеживать только
                    SQL-выражения, длительность выполнения которых 1000 мс и выше.</p><pre class="programlisting">
database = ( 'c:\data\fb3x([\\][^\]+)+.fdb' )
{
    enabled = true
    log_initfini = false
    time_threshold = 1000
    log_statements = true
}                        
                    </pre></div><div class="informalexample"><p>Отслеживать только запросы к таблицам мониторинга (во всех базах и
                    алиасах).</p><pre class="programlisting">
database =
{
    enabled = true
    log_initfini = false
    log_errors = false
    time_threshold = 0
    log_statement_finish = true
    include_filter = "%((from|join)[[:WHITESPACE:]]+mon$)%"
}                        
                    </pre></div><div class="informalexample"><p>Накопление сведений по ошибкам отдельных видов, возникавшим при работе
                    приложений при подключении их к базе 'foo.fdb' или к двум возможным её алиасам
                    'bar' и 'gee'.</p><pre class="programlisting">
database = ( %[\\/](foo).fdb | (bar|gee) )
{
    enabled = true
    log_initfini = false
    log_errors = true
    include_gds_code
    time_threshold = 0

    # Разрешаем регистрацию:
    # всех видов переполнения (арифметических, строковых)
    # нарушения уникального ключа
    # нарушения первичного ключа

    # Запись через перечисление мнемоник исключений:
    include_gds_codes = arith_except,unique_key_violation,no_dup

    # То же самое, через "комбинированную" запись мнемоник и числовых кодов ошибок:
    #include_gds_codes = arith_except,unique_key_violation,335544349

    # Запрещаем регистрацию:
    # исключения, вызванного прерыванием операции (клиентом или администратором БД)
    # любого пользовательского исключения,
    # вызванного попыткой курсора прочесть запись после достижения 
    # конца выборки (фактически ошибкой не является)

    # Запись через перечисление мнемоник исключений:
    exclude_gds_codes = cancelled,user_exc,req_sync

    # То же самое, через запись числовых кодов: 
    # exclude_gds_codes = 335544794,335544517,335544364
}                        
                    </pre></div><section class="section" id="d0e18492"><div class="titlepage"><div><div><h4 class="title">Отслеживание вызова сервисов</h4></div></div></div><p>Следующий конфигурационный файл позволит вам отслеживать запуски резервного
                    копирования.</p><pre class="programlisting">
services 
{
    enabled = true
    log_initfini = false
    include_filter = "%(backup database)%"
    log_services = true
}                    
                </pre><p>Например, при вводе следующей команды:</p><pre class="programlisting">
C:\FB\30SS\fbsvcmgr.exe localhost:service_mgr user sysdba password masterkey 
action_backup dbname c:\temp\test.fdb bkp_file c:\temp\test.fbk                        
                    </pre><p>Журнал трассировки будет содержать следующее:</p><pre class="screen">
2017-12-15T14:23:55.1150 (3972:0000000002B30040) ATTACH_SERVICE
        service_mgr, (Service 00000000022EB140, SYSDBA, TCPv6:::1/57162, 
        C:\FB\30SS\fbsvcmgr.exe:7152)

2017-12-15T14:23:55.1150 (3972:0000000002B30040) START_SERVICE
        service_mgr, (Service 00000000022EB140, SYSDBA, TCPv6:::1/57162, 
        C:\FB\30SS\fbsvcmgr.exe:7152)
        "Backup Database"
        C:\FBTESTING\qa\fbt-repo\tmp\e30.fdb 
        C:\FBTESTING\qa\fbt-repo\tmp\e30-tmp2.fbk

2017-12-15T14:23:55.8920 (3972:0000000002B30040) DETACH_SERVICE
        service_mgr, (Service 00000000022EB140, SYSDBA, TCPv6:::1/57162, 
        C:\FB\30SS\fbsvcmgr.exe:7152)                    
                </pre><div class="note"><h3 class="title">Примечание</h3><p>Некоторые строки в выводе трассировки перенесены поскольку они не
                        помещаются на экран.</p></div></section></section><section class="section" id="d0e18510"><div class="titlepage"><div><div><h3 class="title">Структура заголовка выводимого блока информации</h3></div></div></div><p>Под заголовком блока в следующем примере понимается текст, расположенный на
                строках 1...4:</p><pre class="programlisting">
2017-12-15T21:17:18.3590 (2424:01EF2620) EXECUTE_STATEMENT_FINISH
    e30 (ATT_63, SYSDBA:NONE, NONE, TCPv4:192.168.1.57/1449)
    C:\MIX\firebird\fb30\isql.exe:3924
        (TRA_67, READ_COMMITTED | NO_REC_VERSION | WAIT | READ_WRITE)

Statement 20:
-------------------------------------------------------------------------------
SELECT CURRENT_USER, CURRENT_ROLE FROM RDB$DATABASE
...                
            </pre><p>Этот текст является одинаковым для любого события, зарегистрированного для
                отслеживаемого подключения.</p><p>В строке 1 всегда указывается штамп даты и времени, к которому относится
                зарегистрированное событие. Затем в круглых скобках указывается служебная информация
                трассировки, после чего — вид события. Если к событию применимо понятие
                "успех"/"неудача", то при успехе пишется только само событие, а при неудаче слева от
                него пишется слово 'FAILED '.</p><p>В строке 2 указывается либо полное имя файла базы, либо алиас — то, что было
                указано клиентом при подключении. Далее с круглых скобках указаны: ID подключения
                ("ATT_nnnnn"), имя пользователя и его роль (через двоеточие), набор символов
                подключения (client charset), затем протокол и, если это TCPv4 или TCPv6, то далее
                через двоеточие указаны адрес и порт. Для локального протокола будет указано
                &lt;internal&gt;.</p><p>В строке 3 указано полное имя клиентского приложения, выполнившего подключение, и
                порт. Для подключений, выполненных с помощью драйвера, который не требует наличия на
                клиентской машине библиотеки fbclient, может отсутствовать строка с именем
                приложения (<span class="application">isql.exe</span>). На сегодня таким является
                JDBC-драйвер JayBird. Кроме того, строка с информацией о приложении может
                отсутствовать, если это приложение использует очень старую версию библиотеки
                fbclient (до версии 2.1.0).</p><p>В строке 4 указывается ID транзакции ("TRA_nnnnn"), уровень изолированности
                транзакции, режим WAIT/NO_WAIT и режим чтения/записи.</p><div class="note"><h3 class="title">Примечание</h3><p>При отсутствии информации о клиентском процессе строка номер 4 становится
                    строкой номер 3 (то есть пропуска в виде пустой строки не возникнет).</p></div></section><section class="section" id="d0e18533"><div class="titlepage"><div><div><h3 class="title">Кодировка non-ascii информации</h3></div></div></div><p>Текст, в котором есть non-ascii строки, отображается в трассировки всегда в
                кодировке UTF8, если сборка Firebird датирована 19.07.2017 (3.0.3.32758) или более
                поздняя. Для более ранних сборок существовала особенность: строковые параметры к
                вызываемым хранимым процедурам передавались в кодировке того подключения, которое
                выполняло соответствующий вызов. Лог трассировки для таких сборок, при просмотре его
                на машине с локалью UTF8, будет содержать нечитабельные строковые параметры к
                процедурам, если эти параметры содержат кириллицу и клиентские приложения объявляли
                кодировку подключения WIN1251.</p><p>Чтобы выполнить перекодировку, воспользуйтесь инструментами операционной системы
                или сторонних производителей.</p><p>Пример преобразования в POSIX (для случая, когда вызывавший процесс указывал при
                подключении к базе кодировку WIN-1251, а фрагмент трассировки сохранен в файле
                    <code class="filename">/tmp/non-ascii-sample.txt</code>):</p><pre class="programlisting">
cat /tmp/non-ascii-sample.txt | iconv -f WINDOWS-1251 -t UTF-8                    
                </pre></section></section><section class="section" id="d0e18547"><div class="titlepage"><div><div><h2 class="title" style="clear: both">Использование таблиц мониторинга MON$</h2></div></div></div><p>Запросы к таблицам мониторинга могут оказать большую помощь при обследовании работы БД
            под нагрузкой. В частности, можно быстро получить информацию о транзакции, являющейся
            OAT (и с какого времени она запущена), о запросах, которые выполняются выбранной
            транзакцией, о суммарном количестве операций чтения и записи, о статистике операций по
            конкретным таблицам, о накоплении версий записей, и многое другое.</p><p>Все эти действия можно быстро выполнять и анализировать такими средствами, как
                <span class="application">Mon$logger</span> от компании IBSurgeon.</p><p>Информация о предназначении таблиц мониторинга и их полях (метаданных) изложена
                <span class="quote">«<span class="quote">Руководстве по SQL-языку СУБД Firebird 3.0</span>»</span> (приложение
                <span class="quote">«<span class="quote">Е</span>»</span>). </p><p>Следует постоянно иметь в виду, что частый сбор информации с помощью таблиц
            мониторинга в сильно нагруженной среде может негативно отразиться на производительности
            системы, если этот сбор запрашивается SYSDBA или тем пользователем, под чьей учетной
            записью в данный момент имеется большое количество подключений. </p><p>Причина этого в том, что любой запрос к таблицам мониторинга рассылает сигнал всем
            подключениям с требованием сообщить информацию о своем состоянии (это делает даже такой
            запрос, как <code class="code">select mon$database_name from from
            mon$database</code>). Более того, это требование о передаче информации остается
            актуальным для подключений даже тогда, когда тот, кто выдал такой запрос, отключился от
            базы данных (или его подключение было удалено администратором).</p><p>Кроме того, пока длится сбор информации мониторинга (а это может происходить в течение
            30-60 секунд на нагруженных системах), к базе данных невозможно установить новое
            подключение: клиентский процесс, создающий подключение к базе, обязан сделать запись в
            те же структуры данных, в которые сейчас пишется информация мониторинга, то есть он
            вынужден будет ждать окончания этой записи.</p><p>В версии Firebird 3.0 есть улучшение: если к таблицам мониторинга обращается обычный
            пользователь (не SYSDBA), то подключения от всех остальных пользователей будут
            игнорировать его запрос (ранее этот запрос не игнорировался, несмотря на то, что такой
            пользователь всё равно не мог видеть чужой активности). Тем не менее, предостережение
            остается актуальным, так как большинство запросов к мониторингу на практике выполняются
            от имени SYSDBA.</p><p>Одним из мест, где НЕ должно быть никаких обращений к таблицам мониторинга без
            дополнительных строгих ограничений, являются триггеры уровня базы данных (database-level
            triggers), потому что они вызываются с наибольшей частотой по сравнению со всеми другими
            объектами БД. Если вам действительно нужно добавить в такой триггер обращение к
            mon$-таблице, обязательно добавьте ограничение на имя пользователя/роли, под которой
            должен выполняться этот код.</p><p>Далее представлены практические примеры использования этих таблиц и несколько
            предупреждений/советов по ним. Почти во всех примерах перед инструкцией обращения к
            таблицам мониторинга явно указан <code class="code">commit;</code>. Это сделано намеренно, чтобы
            акцентировать внимание на том, что мониторинг в Firebird работает в уровне
            изолированности SNAPSHOT. Новые данные видны мониторингу только после старта
            соответствующего запроса в новой транзакции.</p><section class="section" id="d0e18583"><div class="titlepage"><div><div><h3 class="title">Отключение пользователей от базы данных</h3></div></div></div><pre class="programlisting">
commit; 
delete from mon$attachments where mon$attachment_id &lt;&gt; current_connection;                    
                </pre><p>или просто</p><pre class="programlisting">
commit; 
delete from mon$attachments;                    
                </pre><div class="note"><h3 class="title">Примечание</h3><p> Можно не опасаться, что будет удалено собственное подключение: этого не
                    происходит, хотя при включенной опции <code class="code">SET COUNT ON</code> (в ISQL)
                    результат может ввести в заблуждение:</p><pre class="programlisting">
set count on;
set list on;
select * from mon$attachments where mon$attachment_id = current_connection;                  
                </pre><pre class="screen">
MON$ATTACHMENT_ID               15
MON$SERVER_PID                  8384
...

Records affected: 1                        
                    </pre><pre class="programlisting">
delete from mon$attachments where mon$attachment_id = current_connection;                  
                </pre><pre class="screen">
Records affected: 1                        
                    </pre><p>Вроде бы удалили своё подключение. Проверяем.</p><pre class="programlisting">
commit; 
select * from mon$attachments where mon$attachment_id = current_connection;                  
                </pre><pre class="screen">
MON$ATTACHMENT_ID               15
MON$SERVER_PID                  8384
...

Records affected: 1                        
                    </pre><p>Также при использовании <code class="code">delete from mon$attachments</code> можно не
                    опасаться удалить системные коннекты (в архитектуре SuperServer): подключения от
                    Cache Writer и Garbage Collect имеют значение <code class="code">mon$system_flag = 1</code>,
                    что предохраняет их от любых воздействий через mon$attachments.</p></div><div class="warning"><h3 class="title">Предупреждение</h3><div class="itemizedlist"><ul style="list-style-type: disc; " class="itemizedlist"><li class="listitem"><p>Возврат управления сеансу, который вызвал отключение всех подключений,
                            происходит до того, как на самом деле эти подключения полностью завершат
                            работу по отмене своих незафиксированных изменений. Отмены не
                            показываются в трассировке, поэтому можно сделать ошибочный вывод о том,
                            что раз управление вернулось в скрипт, выполнивший <code class="code">delete from
                                mon$attachments ...</code>, то далее можно начинать какие-то
                            операции, предполагающие монопольный доступ к БД.</p><p>Для гарантированно монопольного доступа к базе лучше перевести её в
                            полный offline-режим (<code class="code">gfix -shut full</code>). При выполнении
                            команды <code class="code">gfix -shut full</code> управление точно НЕ возвращается
                            тому, кто её ввёл, до тех пор, пока в базе не завершится вся активность,
                            в том числе и внутренние действия Firebird по отмене изменений.</p></li><li class="listitem"><p>Сигнал соединению о необходимости прекратить работу может быть принят
                            к исполнению с задержкой, если соединение находится в ожидании данных от
                            удаленного сервера (то есть запустили <code class="code">execute statement on
                                external</code>) и имеются проблемы в сетевой передаче данных от
                            этого сервера. Кроме того, соединение может вообще не принимать в расчет
                            этот сигнал, если занят интенсивными вычислениями при работе с
                            оператором SIMILAR TO (до момента окончания работы этого
                            оператора).</p></li><li class="listitem"><p>Триггеры для событий базы данных DISCONNECT и ROLLBACK не будут
                            вызваны при отключении через таблицы <code class="code">DELETE FROM
                                MON$ATTACHMENTS</code> (смотри также документацию <span class="quote">«<span class="quote">Руководство
                                по SQL-языку Firebird</span>»</span>, раздел <span class="quote">«<span class="quote">Триггеры на событие
                                базы данных</span>»</span>/<span class="quote">«<span class="quote">предостережения</span>»</span>). Транзакция
                            будет переведена в состояние <span class="quote">«<span class="quote">Dead</span>»</span>.</p><p>Причина такого поведения в том, что указание от ДБА удалить соединение
                            — это форсмажор с точки зрения сервера, и этот форсмажор диктует
                            немедленное прекращение всякой активности в данном соединении (в отличие
                            от потери связи с клиентом, что является обычной, не аварийной
                            ситуацией, при которой сервер <span class="quote">«<span class="quote">без суеты</span>»</span> откатывает
                            текущую работу и закрывает соединение, вызывая все соответствующие
                            триггеры).</p></li><li class="listitem"><p>Если команда разрыва соединения пришлась на момент времени, когда
                            соединение начало выполнять команду COMMIT (но еще не закончил её, так
                            как транзакция сделала очень много изменений и фиксация НЕ мгновенна),
                            то сначала будет завершён COMMIT, и только после этого произойдёт разрыв
                            соединения.</p></li></ul></div></div></section><section class="section" id="d0e18668"><div class="titlepage"><div><div><h3 class="title">Отключение от БД подключений, которые могут привести к застреванию счетчика
                OAT</h3></div></div></div><div class="itemizedlist"><p>Соединения, в которых стартовали и до сих пор активны транзакции, отвечающие
                    следующим условиям:</p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>являются пишущими;</p></li><li class="listitem"><p>стартовали с уровнем изолированности, отличным от READ COMMITTED
                        RECORD_VERSION;</p></li><li class="listitem"><p>имеют возраст свыше некоторого порога (например, 120 минут);</p></li><li class="listitem"><p>не меняли ничего в базе данных с момента своего старта.</p></li></ul></div><p>Такие соединения можно рассматривать в качестве кандидатов на отключение от базы,
                если имеется риск застревания OAT. Можно дополнительно поставить защитный фильтр на
                имена процессов, которые не должны отключаться от базы ни при каких обстоятельствах,
                а также добавить список IP-адресов, подключения от которых также нельзя
                затрагивать.</p><p>Следующий запрос возвращает информацию из mon$attachments, которая отвечает
                указанным критериям. В CTE-частях 'm' и 'p' приведены данные по именам процессов и
                IP-адреса (для примера), которые учитываются в защитной фильтрации.</p><pre class="programlisting">

with
m as (
    select 'gfix' as special_process from rdb$database union all
    select 'gstat' from rdb$database union all
    --select 'isql' from rdb$database union all
    select 'fbsvcmgr' from rdb$database
),
p as (
    select '127.0.0.1' as special_address from rdb$database union all
    select '192.168.15.1'  from rdb$database union all
    select '192.168.17.1'  from rdb$database union all
    select '192.168.1.5' from rdb$database
),
u as ( 
    select 120 as max_time_to_live
    from rdb$database
)

select a.*
from mon$attachments a
where 
    a.mon$attachment_id &lt;&gt; current_connection
and exists(
    select 1 
    from mon$transactions t
    join mon$io_stats i on t.mon$stat_id = i.mon$stat_id
    cross join u
    where 
        a.mon$attachment_id = t.mon$attachment_id
        and t.mon$read_only = 0
        and t.mon$isolation_mode &lt;&gt; 2
        and datediff(minute from t.mon$timestamp to cast('now' as timestamp)) 
            &gt;= u.max_time_to_live
        and i.mon$page_marks = 0            
)
and not exists(
    select * 
    from m 
    where lower(trim(a.mon$remote_process)) similar to 
          '%[\\/]*' || lower(trim(m.special_process)) || '(.exe){0,1}'
)
and not exists(
    select * 
    from p 
    where a.mon$remote_address similar to p.special_address || '/[[:DIGIT:]]{4,5}'
)
;
                
            </pre><p>Результат этого запроса можно обрабатывать как курсор (например, чтобы
                протоколировать сведения об отключаемых соединениях для последующего
                анализа):</p><pre class="programlisting">

for 
    select a.mon$attachment_id 
    from mon$attachments where ... /* см. вышеприведенный запрос */
    into v_old_attachment_id
do
begin
    insert into deleted_log( attach_id ) values( :v_old_attachment_id );
    delete from mon$attachments where mon$attachment_id = :v_old_attachment_id;
end
                
            </pre><p>Так же несложно переделать его под одно delete-выражение, и удалять соединения без
                каких-либо дополнительных действий:</p><pre class="programlisting">

delete
from mon$attachments a
where 
  exists(
    select 1 
      from mon$transactions t
      join mon$io_stats i on t.mon$stat_id = i.mon$stat_id
      where 
        a.mon$attachment_id = t.mon$attachment_id
        and t.mon$read_only = 0
        and t.mon$isolation_mode &lt;&gt; 2
        and datediff(second from t.mon$timestamp to cast('now' as timestamp)) &gt;= 1
        and i.mon$page_marks = 0          
)
  and not exists(
    select * 
    from
    (
      select 'gfix' as special_process from rdb$database union all
      select 'gstat' from rdb$database union all
      --select 'isql' from rdb$database union all
      select 'fbsvcmgr' from rdb$database
    ) m
    where lower(trim(a.mon$remote_process)) similar to 
            '%[\\/]*' || lower(trim(m.special_process)) || '(.exe){0,1}'
)
and not exists(
  select * 
  from 
  (
    select '127.0.0.1' as special_address from rdb$database union all
    select '192.168.15.1'  from rdb$database union all
    select '192.168.17.1'  from rdb$database union all
    select '192.168.1.5' from rdb$database
  ) p
  where a.mon$remote_address similar to p.special_address || '/[[:DIGIT:]]{4,5}'
)
;
 
                </pre><div class="note"><h3 class="title">Примечание</h3><p>Удаление подключения работает все контекста транзакции, то есть сразу в момент
                    удаления записи. Отменить его нельзя, ROLLBACK здесь не работает.</p></div><section class="simplesect" id="d0e18703"><div class="titlepage"><div><div><h4 class="title">Замечание о mon$stat_id</h4></div></div></div><p>Соединение таблиц mon$transactions и mon$io_stats выполняется по полю
                    mon$stat_id, которое в документации называется <span class="quote">«<span class="quote">Идентификатор
                        статистики</span>»</span>. Это поле хранит ID <span class="emphasis"><em>вида</em></span> собираемой
                    информации в рамках текущего снимка и при создании нового mon$-снимка в это поле
                    прописываются новые значения.</p><p>НЕЛЬЗЯ рассчитывать на то, что после старта нового снимка поле mon$stat_id
                    сохранит прежние значения.</p><p>Ниже показан пример для случая, когда выполнен одиночное подключение к FB 3.+
                    и нас интересует информация из mon$io_stats для КОННЕКТОВ (три строки выводятся
                    по тому, что при работе ФБ в архитектуре SuperServer помимо обычного подключению
                    от пользователя присутствуют два системных соединения — от Cache Writer и
                    Garbage Collector):</p><pre class="screen">

[root@test-nnkk tmp]# /opt/firebird/bin/isql localhost:/var/tmp/tmptest.fdb
Database: localhost:/var/tmp/tmptest.fdb, User: SYSDBA

SQL&gt; commit; 
SQL&gt; select * from mon$io_stats where mon$stat_group = 1 
CON&gt; order by mon$stat_group, mon$stat_id;

MON$STAT_ID           8
MON$STAT_GROUP        1
MON$PAGE_READS       42
MON$PAGE_WRITES       5
MON$PAGE_FETCHES    393
MON$PAGE_MARKS        9

MON$STAT_ID          19
MON$STAT_GROUP        1
MON$PAGE_READS        0
MON$PAGE_WRITES       0
MON$PAGE_FETCHES      2
MON$PAGE_MARKS        1

MON$STAT_ID          20
MON$STAT_GROUP        1
MON$PAGE_READS        0
MON$PAGE_WRITES       0
MON$PAGE_FETCHES      2
MON$PAGE_MARKS        1

SQL&gt; commit;
SQL&gt; select * from mon$io_stats where mon$stat_group = 1 
CON&gt; order by mon$stat_group, mon$stat_id;

MON$STAT_ID           8
MON$STAT_GROUP        1
MON$PAGE_READS        0
MON$PAGE_WRITES       0
MON$PAGE_FETCHES      2
MON$PAGE_MARKS        1

MON$STAT_ID           9
MON$STAT_GROUP        1
MON$PAGE_READS        0
MON$PAGE_WRITES       0
MON$PAGE_FETCHES      2
MON$PAGE_MARKS        1

MON$STAT_ID          10
MON$STAT_GROUP        1
MON$PAGE_READS       42
MON$PAGE_WRITES       7
MON$PAGE_FETCHES    399
MON$PAGE_MARKS       13
               
                </pre><p>Таким образом, счетчикам в mon$io_stats, которые относятся к ПОДКЛЮЧЕНИЯМ,
                    соответствуют свои <span class="quote">«<span class="quote">личные</span>»</span> mon$stat_id (и все они представлены
                    фильтром <code class="code">where mon$stat_group = 1</code>). Аналогично, счетчики в
                    mon$io_stats, относящиеся к ТРАНЗАКЦИЯМ, также представлены своими mon$stat_id и
                    для них будет <code class="code">mon$stat_group = 2</code>. И наконец, для операторов в
                    mon$io_stats будет третья группа записей, также каждая — со своим индивидуальным
                    значением в mon$stat_id и для этих записей фильтрация должна проводиться по
                    условию <code class="code">where mon$stat_group = 3</code>.</p><p>Это же поле (mon$stat_id) используется для нумерации статистик в таблицах
                    mon$memory_usage и mon$recod_stats. Соединение таблиц mon$attachments,
                    mon$transactions и mon$statements с таблицами mon$io_stats, mon$memory_usage и
                    mon$recod_stats выполнять следует именно по mon$stat_id.</p></section></section><section class="section" id="d0e18736"><div class="titlepage"><div><div><h3 class="title">Построение стека вызовов</h3></div></div></div><p>Таблица <span class="database">mon$call_stack</span> позволяет получить стек
                вызовов к заданной <span class="quote">«<span class="quote">программной точке</span>»</span> внутри ХП, функции или триггера.
                Стек вызовов получается рекурсивным запросом, каждый модуль и <span class="quote">«<span class="quote">точка
                    вызова</span>»</span> в нём (строка и столбец) будут представлены в таком запросе как
                отдельная запись.</p><p>Записи далее можно упорядочить и применить к ним оператор сцепления строк (||),
                чтобы стек вызовов был показан в виде: <code class="code">proc_01(row, col) =&gt; proc_02(row, col)
                    =&gt; ...</code>, где row, col — позиции внутри тел модулей, где идут вызовы
                нижележащих ХП или PSQL-функций.</p><p>Ниже показан пример, в котором создаются два пакета (каждый содержит по одной ХП)
                и три обычные (standalone) хранимые процедуры. Процедура пакета pkg_01 вызывает
                процедуру пакета pkg_02, которая вызывает standalone-процедуру sp_03. Эта ХП (sp_03)
                вызывает sp_04 и, наконец, так вызывает sp_05. Если в процедуре sp_05 нужно понять,
                откуда пришёл её вызов, то она может вызвать специальную PSQL-функцию
                fn_get_stack(), которая возвращает строку — стек-вызовов. Эту строку мы пишем в
                контекстную переменную уровня сессии (или транзакции — это без разницы). По
                окончании работы процедур обращаемся к этой контекстной переменной и получаем стек
                вызовов самой глубокой ХП — sp_05.</p><p>Текст примера:</p><pre class="programlisting">

create or alter procedure sp_05 as begin end;
create or alter procedure sp_04 as begin end;
create or alter procedure sp_03 as begin end;
create or alter package pkg_01 as begin end;
create or alter package pkg_02 as begin end;
commit;

set term ^;
create or alter function fn_get_stack returns varchar(255)
as
  declare v_call_stack varchar(255);
  declare v_line varchar(255);
begin
  v_call_stack='';

  for
    with recursive
    r as (
        select 1 call_level
            ,c.mon$statement_id as stt_id
            ,c.mon$call_id as call_id
            ,c.mon$object_name as obj_name
            ,c.mon$object_type as obj_type
            ,c.mon$source_line as src_row
            ,c.mon$source_column as src_col
        from mon$call_stack c
        where c.mon$caller_id is null

        UNION ALL

        select r.call_level+1
            ,c.mon$statement_id
            ,c.mon$call_id
            ,c.mon$object_name
            ,c.mon$object_type
            ,c.mon$source_line
            ,c.mon$source_column
        from mon$call_stack c
        join r
            on c.mon$caller_id = r.call_id
    )
    ,b as(
        select h.call_level
                       ,h.obj_name
                       ,h.obj_type
                       ,h.src_row
                       ,h.src_col
                       ,count(*)over() cnt
        from r h
        join mon$statements s
            on s.mon$statement_id = h.stt_id
        where s.mon$attachment_id = current_connection
    )
    select obj_name, obj_type, src_row, src_col, call_level
    from b
    where call_level &lt; cnt -- &lt;&lt;&lt; do NOT include THIS sp name in call_stack
    order by call_level -- ::: NB :::
    as cursor c
  do
  begin
    v_line = trim(c.obj_name)||'('||c.src_row||':'||c.src_col||') =&gt; ';
    if ( char_length(v_call_stack) + char_length(v_line) &gt;= 255 ) then
      exit;

    if ( v_call_stack NOT containing v_line ) then 
      v_call_stack = v_call_stack || v_line;
  end
  
  if ( v_call_stack &gt; '' ) then
    v_call_stack = substring( v_call_stack from 1 for char_length(v_call_stack)-5 );
  return v_call_stack;
end
^ -- fn_get_stack
commit 
^

create or alter procedure sp_05 
as 
begin
  rdb$set_context('USER_SESSION', 'DEBUG_INFO', fn_get_stack() );
end
^

create or alter procedure sp_04 
as 
begin
  execute procedure sp_05;
end
^

create or alter procedure sp_03 as 
begin
  execute procedure sp_04;
end
^

create or alter package pkg_02 as 
begin 
  procedure pkg02_sp;
end
^

recreate package body pkg_02 as
begin
  procedure pkg02_sp as
  begin
    execute procedure sp_03;
  end
end
^

create or alter package pkg_01 as 
begin 
  procedure pkg01_sp;
end
^

recreate package body pkg_01 as
begin
  procedure pkg01_sp as
  begin
    execute procedure pkg_02.pkg02_sp;
  end
end
^

set term ;^
commit;


set list on;
execute procedure pkg_01.pkg01_sp;

select rdb$get_context('USER_SESSION', 'DEBUG_INFO' ) as debug_info 
from rdb$database;
                
            </pre><p>Если сохранить этот код в отдельном скрипте и запустить его, подключившись к
                пустой базе, то на консоли появится следующее:</p><pre class="screen">
PKG01_SP(5:9) =&gt; PKG02_SP(5:11) =&gt; SP_03(3:11) =&gt; SP_04(3:8) =&gt; SP_05(3:5)         
            </pre><section class="section" id="d0e18765"><div class="titlepage"><div><div><h4 class="title">Замечания о стеке вызовов</h4></div></div></div><p>На момент написания этого текста существует несколько ограничений,
                    препятствующих получению стека вызова.</p><section class="simplesect" id="d0e18770"><div class="titlepage"><div><div><h5 class="title">Замечание 1</h5></div></div></div><p>Нельзя получить стек вызовов, если процедура вызывается из триггера,
                        который создается неявно СУБД для таблицы, являющейся дочерней в связке
                        PK/FK, и при этом ограничение внешнего ключа объявлено с модификатором ON
                        DELETE CASCADE. Скопируйте следующий код в отдельный скрипт и запустите его
                        на пустой базе:</p><pre class="programlisting">

SET TERM !;

CREATE OR ALTER PROCEDURE dbg_get_stack
AS
BEGIN
END!

CREATE OR ALTER PROCEDURE p_01
AS
BEGIN
END!

CREATE OR ALTER PROCEDURE p_02
AS
BEGIN
END!

CREATE OR ALTER PROCEDURE p_03
AS
BEGIN
END!

CREATE OR ALTER PROCEDURE p_04
AS
BEGIN
END!

CREATE OR ALTER PROCEDURE p_00
AS
BEGIN
END!

SET TERM;!

COMMIT;

------------------------------------------------------------------------
RECREATE TABLE dbg_detl (id INT PRIMARY KEY, pid INT);
RECREATE TABLE dbg_main (id INT PRIMARY KEY);
COMMIT;

ALTER TABLE dbg_detl
ADD CONSTRAINT dbg_detl_fk
    FOREIGN KEY (pid)
    REFERENCES dbg_main (id)
    ON DELETE CASCADE;
COMMIT;
------------------------------------------------------------------------

RECREATE TABLE dbg_stack(
  whoami VARCHAR(31),
  call_level INT,
  statement_id INT,
  call_id INT,
  object_name CHAR(31),
  object_type SMALLINT,
  source_line INT,
  source_column INT,
  trn_id INT DEFAULT CURRENT_TRANSACTION);

COMMIT;

SET TERM !;
CREATE OR ALTER PROCEDURE dbg_get_stack (
      a_whoami VARCHAR(31))
AS
  DECLARE call_level INT;
  DECLARE mon$statement_id TYPE OF COLUMN mon$call_stack.mon$statement_id;
  DECLARE mon$call_id TYPE OF COLUMN mon$call_stack.mon$call_id;
  DECLARE mon$object_name TYPE OF COLUMN mon$call_stack.mon$object_name;
  DECLARE mon$object_type TYPE OF COLUMN mon$call_stack.mon$object_type;
  DECLARE mon$source_line TYPE OF COLUMN mon$call_stack.mon$source_line;
  DECLARE mon$source_column TYPE OF COLUMN mon$call_stack.mon$source_column;
  DECLARE v_stt VARCHAR(4096); -- use dyn SQL for watching in trace!
BEGIN
  v_stt = 'with recursive'
       || ' r as ('
       || '    select 1 call_level,'
       || '         c.mon$statement_id,'
       || '         c.mon$call_id,'
       || '         c.mon$object_name,'
       || '         c.mon$object_type,'
       || '         c.mon$source_line,'
       || '         c.mon$source_column'
       || '    from mon$call_stack c'
       || '    where c.mon$caller_id is null'
       || '    UNION ALL'
       || '    select h.call_level+1,'
       || '           c.mon$statement_id,'
       || '           c.mon$call_id,'
       || '           c.mon$object_name,'
       || '           c.mon$object_type,'
       || '           c.mon$source_line,'
       || '           c.mon$source_column'
       || '    from mon$call_stack c'
       || '      join r h'
       || '        on c.mon$caller_id = h.mon$call_id'
       || ')'
       || ' select'
       || '    r.call_level'
       || '   ,r.mon$statement_id'
       || '   ,r.mon$call_id'
       || '   ,r.mon$object_name'
       || '   ,r.mon$object_type'
       || '   ,r.mon$source_line'
       || '   ,r.mon$source_column'
       || ' from r';
  FOR EXECUTE STATEMENT(v_stt)
      WITH AUTONOMOUS TRANSACTION -- ::: NB :::
      INTO
          :call_level,
          :mon$statement_id,
          :mon$call_id,
          :mon$object_name,
          :mon$object_type,
          :mon$source_line,
          :mon$source_column
  DO
  BEGIN
    INSERT INTO dbg_stack (
      whoami,
      call_level,
      statement_id,
      call_id,
      object_name,
      object_type,
      source_line,
      source_column
      --,trn_id
    )
    VALUES (
      :a_whoami,
      :call_level,
      :mon$statement_id,
      :mon$call_id,
      :mon$object_name,
      :mon$object_type,
      :mon$source_line,
      :mon$source_column
      --,current_transaction
    );
  END
END!
SET TERM;!
COMMIT;

---------------------------------
SET TERM !;
CREATE OR ALTER PROCEDURE p_04
AS
  DECLARE n INT;
BEGIN
  -- dummy row 1
  -- dummy row 2
  -- dummy row 3
  -- dummy row 4
  EXECUTE PROCEDURE dbg_get_stack('p_04');
END!

CREATE OR ALTER PROCEDURE p_03
AS
  DECLARE n INT;
BEGIN
  -- dummy row 1
  -- dummy row 2
  -- dummy row 3
  EXECUTE PROCEDURE p_04;
END!

CREATE OR ALTER   PROCEDURE p_02
AS
  DECLARE n INT;
BEGIN
  -- dummy row 1
  -- dummy row 2
  EXECUTE PROCEDURE p_03;
END!

CREATE OR ALTER   PROCEDURE p_01
  AS
DECLARE n INT;
BEGIN
  -- dummy row 1
  EXECUTE PROCEDURE p_02;
END!

---------------------
CREATE OR ALTER TRIGGER dbg_detl_bud
FOR dbg_detl ACTIVE BEFORE UPDATE OR DELETE
AS
BEGIN
  EXECUTE PROCEDURE p_01;
END
!

SET TERM;!

COMMIT;

INSERT INTO dbg_main (id)
VALUES (1);

INSERT INTO dbg_detl (id, pid)
VALUES (1, 1);

INSERT INTO dbg_detl (id, pid)
VALUES (2, 1);

COMMIT;

SET width whoami 15;
SET width object_name 20;

SET LIST ON;
SELECT
  '-----  Case-1: explicit delete records from DETAIL table -----' AS " "
FROM rdb$database;

SET LIST off;

SELECT
    CURRENT_TRANSACTION
FROM rdb$database;

DELETE FROM dbg_detl;

SELECT
    whoami,
    call_level,
    object_name,
    source_line,
    source_column,
    trn_id
FROM dbg_stack;

ROLLBACK;

SET LIST ON;
SELECT
  '-----  Case-2: delete in MAIN table, cascade in DETAIL -----' AS " "
FROM rdb$database;

SET LIST off;

SELECT
    CURRENT_TRANSACTION
FROM rdb$database;

DELETE FROM dbg_main;

SELECT
    whoami,
    call_level,
    object_name,
    source_line,
    source_column,
    trn_id
FROM dbg_stack;

ROLLBACK;

SELECT
    *
FROM dbg_stack;
                        
                    </pre><p>Этот скрипт выдаст на консоль примерно следующее:</p><pre class="screen">      -----  Case-1: explicit delete records from DETAIL table -----

  CURRENT_TRANSACTION
=====================
                 1252

WHOAMI    CALL_LEVEL OBJECT_NAME         SOURCE_LINE SOURCE_COLUMN    TRN_ID
======== =========== ================== ============ ============= =========
p_04               1 DBG_DETL_BUD                  4             3      1252
p_04               2 P_01                          5             5      1252
p_04               3 P_02                          6             9      1252
p_04               4 P_03                          7            13      1252
p_04               5 P_04                          8            17      1252
p_04               6 DBG_GET_STACK                47             5      1252
p_04               1 DBG_DETL_BUD                  4             3      1252
p_04               2 P_01                          5             5      1252
p_04               3 P_02                          6             9      1252
p_04               4 P_03                          7            13      1252
p_04               5 P_04                          8            17      1252
p_04               6 DBG_GET_STACK                47             5      1252


      -----  Case-2: delete in MAIN table, cascade in DETAIL -----

  CURRENT_TRANSACTION
=====================
                 1256
</pre><p>Здесь видно, что при удалении записей явным образом (<code class="code">Case-1</code>)
                        стек вызовов будет получен, а когда такое же удаление вызывается неявно
                        каскадным триггером, то стек вызовов процедуры p_01 пуст (после строк
                        25...27 ничего нет).</p></section><section class="simplesect" id="d0e18786"><div class="titlepage"><div><div><h5 class="title">Замечание 2</h5></div></div></div><p>Если вызывать некоторый модуль динамически (через механизм execute
                        statement, далее — ES), то имена всех программных единиц, расположенных выше
                        этого ES, МОГУТ быть "не видимыми" в mon$call_stack. Это значит, что
                        "потолком" для определения стека вызовов будет не процедура верхнего уровня,
                        а та программная единица, в которой находится ES. Чтобы определить, будут ли
                        видны ХП, находящиеся в стеке вызовов выше ES, следует найти места в коде,
                        где к ним есть явное обращение (без ES). Если такие места есть и исследуемая
                        ХП хотя бы 1 раз вызывалась из этих точек (то есть без ES), и после этого НЕ
                        было переподключения к текущей базе, то далее в этой ХП будет виден полный
                        стек, независимо от того, как она сейчас вызвана.</p><pre class="programlisting">

set term ^;
create or alter procedure p_05 as begin end^
create or alter procedure p_04 as begin end^
create or alter procedure p_03( a_use_dynamic_sql smallint) as begin end^
create or alter procedure p_02 as begin end^
create or alter procedure p_01 as begin end^

create or alter function fn_get_stack returns varchar(255)
as
  declare v_call_stack varchar(255);
  declare v_line varchar(255);
begin
  v_call_stack='';

  for
    with recursive
    r as (
        select 1 call_level
              ,c.mon$statement_id as stt_id
              ,c.mon$call_id as call_id
              ,c.mon$object_name as obj_name
              ,c.mon$object_type as obj_type
              ,c.mon$source_line as src_row
              ,c.mon$source_column as src_col
        from mon$call_stack c
        where c.mon$caller_id is null

        UNION ALL
        
        select r.call_level+1
              ,c.mon$statement_id
              ,c.mon$call_id
              ,c.mon$object_name
              ,c.mon$object_type
              ,c.mon$source_line
              ,c.mon$source_column
        from mon$call_stack c
        join r
            on c.mon$caller_id = r.call_id
    )
    ,b as(
        select h.call_level
              ,h.obj_name
              ,h.obj_type
              ,h.src_row
              ,h.src_col
              ,count(*) over() cnt
        from r h
        join mon$statements s
            on s.mon$statement_id = h.stt_id
        where s.mon$attachment_id = current_connection
    )
    select obj_name, obj_type, src_row, src_col, call_level
    from b
    where call_level &lt; cnt -- &lt;&lt;&lt; do NOT include THIS sp name in call_stack
    order by call_level -- ::: NB :::
    as cursor c
  do
  begin
    v_line = trim(c.obj_name)||'('||c.src_row||':'||c.src_col||') =&gt; ';
    if ( char_length(v_call_stack) + char_length(v_line) &gt;= 255 )
      then exit;

    if ( v_call_stack NOT containing v_line ) then
     v_call_stack = v_call_stack || v_line;
  end
  if ( v_call_stack &gt; '' ) then
    v_call_stack = substring(v_call_stack from 1 for char_length(v_call_stack)-5);
  return v_call_stack;
end
^ -- fn_get_stack

set term ;^
commit;

recreate table dbg_stack(
   call_using_dyn_sql smallint
  ,call_stack varchar(255)
);
commit;
---------------------------------
set term ^;

create or alter procedure p_05( a_use_dynamic_sql smallint)
as
begin
  insert into dbg_stack(call_using_dyn_sql, call_stack)
  values( :a_use_dynamic_sql, fn_get_stack() );
end
^

create or alter procedure p_04( a_use_dynamic_sql smallint)
as
begin
  execute procedure p_05( a_use_dynamic_sql );
end
^

create or alter procedure p_02( a_use_dynamic_sql smallint)
as
begin
  execute procedure p_03( a_use_dynamic_sql );
end
^

create or alter procedure p_01( a_use_dynamic_sql smallint)
as
begin
  delete from dbg_stack;
  execute procedure p_02(a_use_dynamic_sql);
end
^

set term ;^
commit;


set list on;

---------------------------- _WITH_ usage of ES ------------------------------
set term ^;
create or alter procedure p_03( a_use_dynamic_sql smallint)
as
begin
  execute statement( 'execute procedure p_04 (?)') (a_use_dynamic_sql);
end
^
set term ;^
commit;

execute procedure p_01(1);
select * from dbg_stack;
commit;


--------------------------- WITHOUT usage of ES -----------------------------
set term ^;
create or alter procedure p_03( a_use_dynamic_sql smallint)
as
begin
  execute procedure p_04( a_use_dynamic_sql );
end
^
set term ;^
commit;

execute procedure p_01(0);
select * from dbg_stack;
                            
                        </pre><p>Выполнение этого скрипта приведет к появлению следующего результата: </p><pre class="screen">
CALL_USING_DYN_SQL 1 -- это выдал код, отмеченный выше тегом "_WITH_ usage of ES"
CALL_STACK         P_04(3:17)=&gt; P_05(3:13)

CALL_USING_DYN_SQL 0 -- это выдал код, отмеченный выше тегом "WITHOUT usage of ES"
CALL_STACK         P_01(4:13)=&gt; P_02(3:17)=&gt; P_03(3:21)=&gt; P_04(3:17)=&gt; P_05(3:13)
                    </pre><p>Если же поменять местами блоки кода, отмеченные как "_WITH_ usage of ES" и
                        "WITHOUT usage of ES", то вывод будет таким:</p><pre class="screen">
CALL_USING_DYN_SQL 0
CALL_STACK         P_01(4:13)=&gt; P_02(3:17)=&gt; P_03(3:21)=&gt; P_04(3:17)=&gt; P_05(3:13)

CALL_USING_DYN_SQL 1
CALL_STACK         P_01(4:13)=&gt; P_02(3:17)=&gt; P_03(3:21)=&gt; P_04(3:17)=&gt; P_05(3:13)                    </pre><p>Если же вставить строку переподключения к базе:</p><pre class="programlisting">

------------------------------ WITHOUT usage of ES -------------------------------
set term ^;
create or alter procedure p_03 (a_use_dynamic_sql smallint)  
as
begin
  execute procedure p_04 (a_use_dynamic_sql);
end
^
set term ;^
commit;

execute procedure p_01(0);
select * from dbg_stack;

------------------------------ _WITH_ usage of ES --------------------------------
set term ^;
create or alter procedure p_03( a_use_dynamic_sql smallint)  
as
begin
  execute statement ('execute procedure p_04(?)') (a_use_dynamic_sql);
end
^
set term ;^
commit;

connect 'localhost:employee' user SYSDBA password 'masterkey';

execute procedure p_01(1);
select * from dbg_stack;
commit;
                        
                    </pre><p>то результат для "_WITH_ usage of ES" станет таким же, как и в первом
                        случае, то есть <span class="quote">«<span class="quote">усеченным</span>»</span>:</p><pre class="screen">
CALL_USING_DYN_SQL  0
CALL_STACK          P_01(4:13)=&gt; P_02(3:17)=&gt; P_03(3:21)=&gt; P_04(3:17)=&gt; P_05(3:13)
    
CALL_USING_DYN_SQL  1
CALL_STACK          P_04(3:17)=&gt; P_05(3:13)                        
                    </pre></section></section></section><section class="section" id="d0e18812"><div class="titlepage"><div><div><h3 class="title">Статистика по таблицам (mon$record_stats)</h3></div></div></div><p>В Firebird 3 появились новые поля в таблице мониторинга mon$record_stats,
                позволяющие проводить анализ количества версий записей, встречавшихся при работе
                запроса, степень фрагментированности записей, а также количество конфликтов
                блокировок.</p><p>Таблица mon$record_stats содержит накопительные данные с момента первого
                подключения к БД, поэтому для практических целей большее значение имеют не столько
                числовые поля-счетчики этой таблицы, сколько их разности между двумя
                замерами.</p><p>Например, можно регистрировать в специальной GTT значения счетчиков из следующего
                SQL-выражения:</p><pre class="programlisting">

select
    ------------------------ mon$io_stats: -----------------------
    i.mon$page_reads
    ,i.mon$page_writes
    ,i.mon$page_fetches
    ,i.mon$page_marks
    ------------------------ mon$record_stats: -------------------
    ,r.mon$record_inserts
    ,r.mon$record_updates
    ,r.mon$record_deletes
    ,r.mon$record_backouts
    ,r.mon$record_purges
    ,r.mon$record_expunges
    ,r.mon$record_seq_reads
    ,r.mon$record_idx_reads
    ,r.mon$record_rpt_reads
    ,r.mon$backversion_reads
    ,r.mon$fragment_reads
    ,r.mon$record_locks
    ,r.mon$record_waits
    ,r.mon$record_conflicts
    ------------------------ mon$memory_usage: -----------------
    ,u.mon$memory_used
    ,u.mon$memory_allocated
    ,a.mon$stat_id
    ,a.mon$server_pid
from mon$attachments a
left join mon$memory_usage u on a.mon$stat_id=u.mon$stat_id     
left join mon$io_stats i on a.mon$stat_id=i.mon$stat_id     
left join mon$record_stats r on a.mon$stat_id=r.mon$stat_id     
where     
   a.mon$attachment_id = current_connection
;
                
            </pre><p>— и затем выполнять интересующий запрос и снова регистрировать показания из
                вышеприведенного выражения. </p><p>Разность между одноименными счетчиками даст возможность проанализировать
                эффективность рабочего запроса.</p><p>Счетчик mon$backversion_reads учитывает чтение цепочек версий записи. Следует
                обращать внимание на значение дроби:</p><pre class="programlisting">
mon$backversion_reads / (mon$record_seq_reads + 
                         mon$record_idx_reads + mon$record_rpt_reads) * 100
            </pre><p>Если это число более 20%, то имеется проблема с накоплением мусорных версий
                записей, либо мусор просто не успевает собираться. В идеале число чтений версий не
                должно превышать 10-20% над числом чтений записей.</p><p>Также, интересен счетчик mon$record_rpt_reads. Он показывает количество повторных
                чтений (из страничного кеша Firebird или из памяти) ранее прочитанной записи с
                известным dbkey. Этот счетчик будет увеличиваться при update/delete записей в
                before-триггерах, а также при изменении сортированных курсоров</p><pre class="programlisting">
{update | delete from}
&lt;<em class="replaceable"><code>table</code></em>&gt; 
...
order by &lt;<em class="replaceable"><code>expr</code></em>&gt;
                </pre><p>Значение счетчика mon$record_waits показывают количество ожиданий транзакциями,
                запущенными в режиме WAIT или LOCK_TIMEOUT, завершения конкурирующих транзакций,
                ранее изменивших те же самые записи.</p><p>Значение счетчика mon$record_locks — это число успешных блокировок записей
                выражениями вида SELECT ... WITH LOCK.</p><p>Счетчик mon$record_conflicts — число неудачных попыток обновления/удаления записи
                из-за наличия конкурирующих транзакций, ранее изменивших ту же самую запись. В таких
                ситуациях сообщается о конфликте обновления (UPDATE CONFLICT).</p></section><section class="section" id="d0e18849"><div class="titlepage"><div><div><h3 class="title">Поиск подключений, выполненных старыми версиями клиента</h3></div></div></div><p>Если в трассировке вы будете видеть заголовочные блоки, в которых нет информации о
                подключенном приложении:</p><pre class="screen">
2017-12-18T20:05:36.0660 (1664:00E724E8) START_TRANSACTION
     e30 (ATT_263, SYSDBA:NONE, NONE, TCPv4:127.0.0.1/1447)
          (TRA_1280, READ_COMMITTED | NO_REC_VERSION | WAIT | READ_WRITE)                    
                </pre><p>— проверьте, нет ли к базе подключений, выполненных с использованием клиентских
                библиотек до версии 2.0.7. Они не сообщали свою версию, поэтому в поле
                MON$CLIENT_VERSION для таких подключений остается <code class="literal">NULL</code>. Выполнить
                такую проверку просто:</p><pre class="programlisting">
set list on;

select mon$remote_address from mon$attachments 
where mon$remote_protocol is not null 
  and mon$client_version is null;                
            </pre><div class="note"><h3 class="title">Примечание</h3><p>JDBC-драйвер JayBird, используемый для подключения к Firebird java-приложений,
                    не требует наличия стандартной клиентской библиотеки fbclient. Этот драйвер
                    также не показывает имя подключившегося приложения, трассировка для него будет
                    выглядеть аналогично вышеприведенному фрагменту. Вы должны самостоятельно
                    убедиться в том, что по найденным IP-адресам действительно выполнялись
                    подключения с использованием старых версий fbclient-библиотек.</p></div></section><section class="section" id="d0e18866"><div class="titlepage"><div><div><h3 class="title">О причинах расхождений в статистике мониторинга и трассировки</h3></div></div></div><p>При включенных опциях <em class="parameter"><code>log_statement_finish</code></em> и
                    <em class="parameter"><code>print_perf</code></em> трассировка будет показывать для завершенного
                запроса (statement) статистику, вычисленную только для этого запроса, и больше ни
                для чего. Если перед и после запроса снять показания счетчиков мониторинга, а затем
                вычислить арифметические разности одноименных счетчиков, то почти всегда будет
                заметна, что эти разности (fetches, marks, reads, writes) превышают аналогичные
                значения в трассировке.</p><p>Причина этого в том, что мониторинг показывает статистику не для отдельного
                запроса (statement), а для всего подключения. Разности показаний счетчиков для
                подключения могут оказаться больше "трейсовых" аналогов как минимум для таблиц
                словаря (RDB$). Для пользовательских таблиц они чаще всего совпадают, но могут быть
                нюансы: хотя счетчики и для mon$table_stats и для трассировки одни и те же, но
                сниматься могут в немного разное время.</p><p>Рассмотрим пример (предполагается, что строка подключения здесь:
                'localhost:employee', user/password: SYSDBA/masterkey):</p><pre class="programlisting">
                
recreate table monlog(
         mult smallint
        ,page_reads bigint
        ,page_writes bigint
        ,page_fetches bigint
        ,page_marks bigint
        ,record_inserts bigint
        ,record_backouts bigint
        ,record_purges bigint
        ,record_expunges bigint
        ,record_seq_reads bigint
        ,record_idx_reads bigint
        ,record_rpt_reads bigint
        ,backversion_reads bigint
)
;

recreate view vmon as
    select
        ------------------------ mon$io_stats: -----------------------
         i.mon$page_reads
        ,i.mon$page_writes
        ,i.mon$page_fetches
        ,i.mon$page_marks
        ------------------------ mon$record_stats: -------------------
        ,r.mon$record_inserts
        ,r.mon$record_backouts
        ,r.mon$record_purges
        ,r.mon$record_expunges
        ,r.mon$record_seq_reads
        ,r.mon$record_idx_reads
        ,r.mon$record_rpt_reads
        ,r.mon$backversion_reads
    from mon$attachments a
    left join mon$io_stats i on a.mon$stat_id=i.mon$stat_id     
    left join mon$record_stats r on a.mon$stat_id=r.mon$stat_id     
    where     
        a.mon$attachment_id = current_connection
    ;

recreate table test1(s varchar(255) unique using index test1_s_unq);
recreate table test2(s varchar(255) unique using index test2_s_unq);
commit;

insert into test2(s) values( lpad('',255, 'QWERTY' ) );

set term ^;
execute block 
as
    declare n int = 1001;
    declare i int = 0;
begin
    while (i &lt; n) do
    begin
        insert into test1(s) 
        values (iif(:i &lt; :n-1, 
                    lpad('',255, uuid_to_char(gen_uuid())), 
                    lpad('',255, 'QWERTY')));
        i = i + 1;
    end
end
^
set term ;^
commit;

connect 'localhost:e30' user sysdba password 'masterkey';

set list on;

insert into monlog 
select -1, m.* from vmon m;
commit;

insert into test2 select * from test1;

insert into monlog 
select 1, m.* from vmon m;
commit;

select 
     sum( mult * page_reads ) diff_page_reads
    ,sum( mult * page_writes ) diff_page_writes
    ,sum( mult * page_fetches ) diff_page_fetches
    ,sum( mult * page_marks ) diff_page_marks
    ,sum( mult * record_inserts ) diff_record_inserts
    ,sum( mult * record_backouts ) diff_record_backouts
    ,sum( mult * record_purges ) diff_record_purges
    ,sum( mult * record_expunges ) diff_record_expunges
    ,sum( mult * record_seq_reads ) diff_record_seq_reads
    ,sum( mult * record_idx_reads ) diff_record_idx_reads
    ,sum( mult * record_rpt_reads ) diff_record_rpt_reads
    ,sum( mult * backversion_reads ) diff_backversion_reads
from monlog;           

            </pre><p>Запуск этого скрипта приведет к выводу следующих данных (текст исключения по PK/UK
                не показан):</p><pre class="screen">
    DIFF_PAGE_READS                 54
    DIFF_PAGE_WRITES                163
    DIFF_PAGE_FETCHES               16585
    DIFF_PAGE_MARKS                 5731
    DIFF_RECORD_INSERTS             1002
    DIFF_RECORD_BACKOUTS            1001
    DIFF_RECORD_PURGES              0
    DIFF_RECORD_EXPUNGES            0
    DIFF_RECORD_SEQ_READS           1001
    DIFF_RECORD_IDX_READS           23
    DIFF_RECORD_RPT_READS           0
    DIFF_BACKVERSION_READS          0                
            </pre><p>Вышеприведенные значения — это стоимость выполнения запроса <code class="code">insert into
                    test2 select * from test1;</code>, при котором в таблицу test2 вставилось 1000
                строк, а на 1001-й записи была попытка добавить дубль и все изменения (все
                добавленные строки) были отменены.</p><p>В трассировке этот же DML-оператор выдаст следующую статистику:</p><pre class="screen">
2017-12-18T21:01:33.5760 (1664:00E752E8) FAILED EXECUTE_STATEMENT_FINISH
...
insert into test2 select * from test1
0 records fetched
     152 ms, 43 read(s), 156 write(s), 16491 fetch(es), 5723 mark(s)

Table                       Natural   Index   Update   Insert   Delete   Backout
*********************************************************************************
RDB$INDICES                               1
RDB$RELATION_CONSTRAINTS                  1
TEST1                          1001
TEST2                                     1              1001               1001 
            </pre><p>Здесь видно, что отличие в количестве чтений из страничного кеша Firebird
                (fetches) составляет более 100 фетчей в пользу мониторинга. Также заметны
                относительные отличия в числе чтений из кеша операционной системы (reads): 54 vs 43,
                и записи в него (writes): 163 vs 156.</p><p>Одной из частых причин, когда показаниями мониторинга и трассировки расходятся
                достаточно сильно, является операция Backout — отмена действий запроса (statement)
                (например, из-за того что на поздней его стадии было обнаружено нарушение PK/UK, как
                в данном примере). Операция backout всегда будет регистрироваться в mon$-таблицах,
                но в счетчики с затратами отмененного запроса (в трассировке) эта операция не
                входит.</p></section><section class="section" id="d0e18900"><div class="titlepage"><div><div><h3 class="title">Мониторинг и выполнение запросов</h3></div></div></div><section class="section" id="d0e18903"><div class="titlepage"><div><div><h4 class="title">Фаза подготовки запросов</h4></div></div></div><p>Фаза подготовки (prepare) для некоторых запросов может оказаться весьма
                    значительной. Существуют запросы, для которых prepare-фаза может длится
                    несколько минут. До момента окончания prepare-фазы ни трассировка, ни
                    mon$-таблицы не будут показывать никакой активности того подключения, которое
                    запустило подготовку такого запроса. Лог трассировки будет пустым, а счетчики
                    табличной статистики застынут (mon$record_stats) на некотором значении и
                    меняться уже не будут. Запрос к mon$attachments покажет данные по этому
                    подключению, но запрос к mon$statements не покажет для него ни одной строки.
                    Запрос появится в mon$statements только после того, как начнет
                    выполняться.</p><p>Об активности подключения в таких случаях будет говорить только сильная
                    загрузка CPU (при условии, что работает только одно подключение, либо если
                    наблюдение идет за Firebird, который работает в архитектуре Classic Server и нам
                    известен mon$server_pid этого соединения).</p></section><section class="section" id="d0e18910"><div class="titlepage"><div><div><h4 class="title">Запросы с состоянием stalled</h4></div></div></div><p>Состояние <span class="quote">«<span class="quote">stalled</span>»</span> (<code class="code">mon$statements.mon$state = 2</code>)
                    означает, что в данный момент происходит перерыв между клиентскими выборками
                    записей из курсора (так называемыми фетчами). То есть запрос создал курсор, его
                    обработка еще не дошла до EOF, и в данный момент выборка курсором не делается
                    (клиент обрабатывает предыдущую порцию данных).</p><p>Состояние <span class="quote">«<span class="quote">stalled</span>»</span> легко увидеть, если в первом сеансе запустить
                    запрос, который будет передавать на клиента множество записей: </p><p><span class="formalpara-title">сеанс 1: </span>
                        </p><pre class="programlisting">                            
out nul; 
select f1.rdb$field_name 
from rdb$fields f1, rdb$fields f2, rdb$fields f3, rdb$fields f4;
</pre><p>
                    </p><p><span class="formalpara-title">сеанс 2: </span>
                        </p><pre class="programlisting">
set list on;
commit; 
select mon$state, mon$timestamp, mon$sql_text 
from mon$statements 
where mon$attachment_id &lt;&gt; current_connection;
</pre><p>
                    </p><p><span class="formalpara-title">вывод: </span>
                        </p><pre class="screen">
    MON$STATE                       2 // "stalled"
    MON$TIMESTAMP                   2017-12-19 20:30:52.9060
    MON$SQL_TEXT                    0:4
    
select f1.rdb$field_name 
from rdb$fields f1, rdb$fields f2, rdb$fields f3, rdb$fields f4    
                        </pre><p>
                    </p><p>Однако, если поменять запрос на такой, который будет делать всю обработку
                        <span class="quote">«<span class="quote">внутри себя</span>»</span> и выдавать клиенту только конечный
                    результат:</p><p><span class="formalpara-title">сеанс 1: </span>
                        </p><pre class="programlisting">                            
out nul; 
select count(*) 
from rdb$fields f1, rdb$fields f2, rdb$fields f3, rdb$fields f4;
</pre><p>
                    </p><p><span class="formalpara-title">вывод: </span>в сеансе_2 будет видно другое состояние запроса: 1, <span class="quote">«<span class="quote">Active</span>»</span>
                        </p><pre class="screen">
    MON$STATE                       1
    MON$TIMESTAMP                   2017-12-19 20:42:03.4060
    MON$SQL_TEXT                    0:4
    
select f1.rdb$field_name 
from rdb$fields f1, rdb$fields f2, rdb$fields f3, rdb$fields f4    
                        </pre><p>
                    </p></section></section><section class="section" id="d0e18974"><div class="titlepage"><div><div><h3 class="title">Мониторинг расхода памяти</h3></div></div></div><p>Таблица mon$memory_usage показывает всегда ТЕКУЩИЙ расход памяти. Счетчики в ней,
                в отличие от других таблиц — НЕ накопительные. В этом легко убедиться, если
                запустить два подключения к БД, и выполнить в одном из них внешнюю сортировку
                большого объема данных. Обращение к mon$memory_usage до и после выполнения внешней
                сортировки выдаст очень незначительную разницу в расходе памяти.</p><p>Например, если сформировать <span class="quote">«<span class="quote">широкую</span>»</span> таблицу в 1 млн строк:</p><pre class="programlisting">
create table t(
  id int primary key, 
  dts timestamp, 
  s varchar(16384)); 
commit;

insert into t 
select 
  row_number()over(), 
  dateadd(rand()*10000000 second to timestamp '01.01.2000 00:00:00'), 
  rpad('', 16384, uuid_to_char(gen_uuid())) 
from rdb$types, 
     rdb$types,
     (select 1 i from rdb$types rows 20) 
rows 1000000; 
commit;                    
                </pre><p>и затем выполнить мониторинг расхода памяти для запроса внешней сортировки:</p><pre class="programlisting">
out /dev/null; 
set stat on;
select id,s from t order by dts;
out; 
set stat on;                    
                </pre><p>то будет получен примерно такой результат:</p><pre class="programlisting">
commit; 
select 
  mon$stat_id as stat_id,
  mon$stat_group as stat_group, 
  mon$memory_used as memory_used, 
  mon$memory_allocated as memory_allocated 
from mon$memory_usage 
order by 2, 1;                    
                </pre><pre class="screen">
     STAT_ID STAT_GROUP           MEMORY_USED      MEMORY_ALLOCATED
============    ======= ===================== =====================
           1          0            2450608416            2453884856
           2          1                611392               1245184
           6          1                  9696                131072
           7          1                178240                262144
           3          2                  1112                 65536
           4          2                  8880                 65536
           5          3                 14056                 65536 
                </pre><pre class="programlisting">
out /dev/null; 
set stat on;
select id,s from t order by dts;                    
                </pre><pre class="screen">
Current memory = 2450920168
Delta memory = 296288
Max memory = 4591129832
...                    
                </pre><pre class="programlisting">
out; set stat off;                    
                </pre><pre class="programlisting">
commit; 
select 
  mon$stat_id as stat_id,
  mon$stat_group as stat_group, 
  mon$memory_used as memory_used, 
  mon$memory_allocated as memory_allocated 
from mon$memory_usage 
order by 2, 1;                    
                </pre><pre class="screen">
     STAT_ID STAT_GROUP           MEMORY_USED      MEMORY_ALLOCATED
============ ========== ===================== =====================
           1          0            2450865288            2454609392
           2          1                771320               1638400
           6          1                  9696                131072
           7          1                178240                262144
           3          2                  1112                 65536
           4          2                  8880                 65536
           5          3                 13784                 65536               
                </pre><p>Здесь видно, что никакого существенного изменения в расходе памяти нет. Причина в
                том, что счетчики mon$memory_used и mon$memory_allocated всегда показывают текущее
                потребление памяти. Чтобы увидеть расход, требовавшийся для выполнения запроса,
                нужно делать опрос mon$memory_usage именно в те моменты, когда этот запрос
                выполняется, то есть до его завершения.</p></section><section class="section" id="d0e19008"><div class="titlepage"><div><div><h3 class="title">Мониторинг и nbackup</h3></div></div></div><section class="section" id="d0e19011"><div class="titlepage"><div><div><h4 class="title">Снятие файловой копии базы</h4></div></div></div><p>При выполнении команды <code class="code">nbackup -b 0</code> следует учитывать, что
                        <span class="application">nbackup</span> выполняет очень кратковременное
                    подключение к базе для установки на неё блокировки, после чего отключается от
                    базы и начинает выполнять её копирование средствами операционной системы. Всё
                    это время <span class="application">nbackup</span> не будет виден в списке подключений
                    через mon$attachments. Вот пример того, что будет показано в трассировки для
                    команды старта <span class="application">nbackup</span> (разность отметок времени
                    установки подключения и отключения составляет всего 30 мс):</p><pre class="screen">                    
2017-12-19T16:03:58.6230 (9319:0x7ff627708f28) ATTACH_DATABASE
        /var/db/fb30/gfixtest30.fdb (ATT_44, SYSDBA:NONE, NONE, &lt;internal&gt;)
...
2017-12-19T16:03:58.6260 (9319:0x7ff627708f28) EXECUTE_STATEMENT_FINISH
...
ALTER DATABASE BEGIN BACKUP
...

2017-12-19T16:03:58.6260 (9319:0x7ff627708f28) DETACH_DATABASE
        /var/db/fb30/gfixtest30.fdb (ATT_44, SYSDBA:NONE, NONE, &lt;internal&gt;)                    
</pre><p>Следующее подключение от <span class="application">nbackup</span> будет также
                    кратковременным и служит для снятия флага блокировки с БД. Действия
                        <span class="application">nbackup</span> (его активность) в этом случае проще
                    увидеть в журнале трассировки, если задать фильтрацию вызовов сервисов по
                    строке: <span class="quote">«<span class="quote">Incremental Backup Database</span>»</span>.</p></section><section class="section" id="d0e19041"><div class="titlepage"><div><div><h4 class="title">Заливка .delta-файла обратно в базу</h4></div></div></div><p>Если файл базы был сначала заблокирован для снятия с него файловой копии без
                    отключения пользователей (<code class="code">nbackup -L</code>), а затем в этот файл начинает
                    записываться <code class="filename">.delta</code> (<code class="code">nbackup -N</code>), то
                    мониторинг будет возможен только для того сеанса, который в это время не делает
                    переподключение к базе, то есть уже имеет подключение. Запрос к <span class="database">mon$attachments</span> для процесса
                        <span class="application">nbackup</span> вернёт следующее:</p><pre class="screen">
MON$ATTACHMENT_ID               19
MON$SERVER_PID                  17846
MON$STATE                       0
MON$ATTACHMENT_NAME             /var/tmp/tmp.fdb
MON$USER                        SYSDBA
MON$ROLE                        NONE
MON$REMOTE_PROTOCOL             TCPv6
MON$REMOTE_ADDRESS              ::1/46656
MON$REMOTE_PID                  17880
MON$CHARACTER_SET_ID            0
MON$TIMESTAMP                   2017-12-19 17:01:58.3060
MON$GARBAGE_COLLECTION          1
MON$REMOTE_PROCESS              /opt/firebird/bin/nbackup
MON$STAT_ID                     11
MON$CLIENT_VERSION              LI-V3.0.3.32838 Firebird 3.0 HQbird
MON$REMOTE_VERSION              P15
MON$REMOTE_HOST                 test.company.ru
MON$REMOTE_OS_USER              test
MON$AUTH_METHOD                 Legacy_Auth
MON$SYSTEM_FLAG                 0                    
                </pre><p>Однако, все новые подключения к базе будет невозможно установить до тех пор,
                    пока длится <span class="quote">«<span class="quote">заливка</span>»</span> .delta-файла</p></section></section></section></section></div><div class="index" id="d0e19068"><div class="titlepage"><div><div><h1 class="title">Алфавитный указатель</h1></div></div></div><div xmlns:xlink="http://www.w3.org/1999/xlink" class="index"><div class="indexdiv"><h3>Символы</h3><dl><dt id="ientry-d0e2106">Параметр конфигурации</dt><dd><dl><dt>AllowEncryptedSecurityDatabase, <a class="indexterm" href="#config-param-AllowEncryptedSecurityDatabase">AllowEncryptedSecurityDatabase</a></dt><dd/><dt>AuditTraceConfigFile, <a class="indexterm" href="#config-param-AuditTraceConfigFile">AuditTraceConfigFile</a></dt><dd/><dt>AuthClient, <a class="indexterm" href="#config-param-Auth">AuthServer и AuthClient</a></dt><dd/><dt>AuthServer, <a class="indexterm" href="#config-param-Auth">AuthServer и AuthClient</a></dt><dd/><dt>BugcheckAbort, <a class="indexterm" href="#config-param-BugcheckAbort">BugcheckAbort</a></dt><dd/><dt>ConnectionTimeout, <a class="indexterm" href="#config-param-ConnectionTimeout">ConnectionTimeout</a></dt><dd/><dt>CpuAffinityMask, <a class="indexterm" href="#config-param-CpuAffinityMask">CpuAffinityMask</a></dt><dd/><dt>DatabaseAccess, <a class="indexterm" href="#config-param-DatabaseAccess">DatabaseAccess</a></dt><dd/><dt>DatabaseGrowthIncrement, <a class="indexterm" href="#config-param-DatabaseGrowthIncrement">DatabaseGrowthIncrement</a></dt><dd/><dt>DeadlockTimeout, <a class="indexterm" href="#config-param-DeadlockTimeout">DeadlockTimeout</a></dt><dd/><dt>DefaultDbCachePages, <a class="indexterm" href="#config-param-DefaultDbCachePages">DefaultDbCachePages</a></dt><dd/><dt>DummyPacketInterval, <a class="indexterm" href="#config-param-DummyPacketInterval">DummyPacketInterval</a></dt><dd/><dt>EventMemSize, <a class="indexterm" href="#config-param-EventMemSize">EventMemSize</a></dt><dd/><dt>ExternalFileAccess, <a class="indexterm" href="#config-param-ExternalFileAccess">ExternalFileAccess</a></dt><dd/><dt>FileSystemCacheSize, <a class="indexterm" href="#config-param-FileSystemCacheSize">FileSystemCacheSize</a></dt><dd/><dt>FileSystemCacheThreshold, <a class="indexterm" href="#config-param-FileSystemCacheThreshold">FileSystemCacheThreshold</a></dt><dd/><dt>GCPolicy, <a class="indexterm" href="#config-param-GCPolicy">GCPolicy</a></dt><dd/><dt>GuardianOption, <a class="indexterm" href="#config-param-GuardianOption">GuardianOption</a></dt><dd/><dt>IpcName, <a class="indexterm" href="#config-param-IpcName">IpcName</a></dt><dd/><dt>IPv6V6Only, <a class="indexterm" href="#config-param-IPv6V6Only">IPv6V6Only</a></dt><dd/><dt>KeyHolderPlugin, <a class="indexterm" href="#config-param-KeyHolderPlugin">KeyHolderPlugin</a></dt><dd/><dt>LockAcquireSpins, <a class="indexterm" href="#config-param-LockAcquireSpins">LockAcquireSpins</a></dt><dd/><dt>LockHashSlots, <a class="indexterm" href="#config-param-LockHashSlots">LockHashSlots</a></dt><dd/><dt>LockMemSize, <a class="indexterm" href="#config-param-LockMemSize">LockMemSize</a></dt><dd/><dt>MaxUnflushedWrites, <a class="indexterm" href="#config-param-MaxUnflushedWrites">MaxUnflushedWrites</a></dt><dd/><dt>MaxUnflushedWriteTime, <a class="indexterm" href="#config-param-MaxUnflushedWriteTime">MaxUnflushedWriteTime</a></dt><dd/><dt>MaxUserTraceLogSize, <a class="indexterm" href="#config-param-MaxUserTraceLogSize">MaxUserTraceLogSize</a></dt><dd/><dt>ProcessPriorityLevel, <a class="indexterm" href="#config-param-ProcessPriorityLevel">ProcessPriorityLevel</a></dt><dd/><dt>Providers, <a class="indexterm" href="#config-param-Providers">Providers</a></dt><dd/><dt>Redirection, <a class="indexterm" href="#config-param-Redirection">Redirection</a></dt><dd/><dt>RelaxedAliasChecking, <a class="indexterm" href="#config-param-RelaxedAliasChecking">RelaxedAliasChecking</a></dt><dd/><dt>RemoteAccess, <a class="indexterm" href="#config-param-RemoteAccess">RemoteAccess</a></dt><dd/><dt>RemoteAuxPort, <a class="indexterm" href="#config-param-RemoteAuxPort">RemoteAuxPort</a></dt><dd/><dt>RemoteBindAddress, <a class="indexterm" href="#config-param-RemoteBindAddress">RemoteBindAddress</a></dt><dd/><dt>RemoteFileOpenAbility, <a class="indexterm" href="#config-param-RemoteFileOpenAbility">RemoteFileOpenAbility</a></dt><dd/><dt>RemotePipeName, <a class="indexterm" href="#config-param-RemotePipeName">RemotePipeName</a></dt><dd/><dt>RemoteServiceName, <a class="indexterm" href="#config-param-RemoteServicePort">RemoteServicePort или RemoteServiceName</a></dt><dd/><dt>RemoteServicePort, <a class="indexterm" href="#config-param-RemoteServicePort">RemoteServicePort или RemoteServiceName</a></dt><dd/><dt>SecurityDatabase, <a class="indexterm" href="#config-param-SecurityDatabase">SecurityDatabase</a></dt><dd/><dt>ServerMode, <a class="indexterm" href="#config-param-ServerMode">ServerMode</a></dt><dd/><dt>TcpLoopbackFastPath, <a class="indexterm" href="#config-param-TcpLoopbackFastPath">TcpLoopbackFastPath</a></dt><dd/><dt>TcpNoNagle, <a class="indexterm" href="#config-param-TcpNoNagle">TcpNoNagle</a></dt><dd/><dt>TcpRemoteBufferSize, <a class="indexterm" href="#config-param-TcpRemoteBufferSize">TcpRemoteBufferSize</a></dt><dd/><dt>TempBlockSize, <a class="indexterm" href="#config-param-TempBlockSize">TempBlockSize</a></dt><dd/><dt>TempCacheLimit, <a class="indexterm" href="#config-param-TempCacheLimit">TempCacheLimit</a></dt><dd/><dt>TempDirectories, <a class="indexterm" href="#config-param-TempDirectories">TempDirectories</a></dt><dd/><dt>TracePlugin, <a class="indexterm" href="#config-param-TracePlugin">TracePlugin</a></dt><dd/><dt>UdfAccess, <a class="indexterm" href="#config-param-UdfAccess">UdfAccess</a></dt><dd/><dt>UserManager, <a class="indexterm" href="#config-param-UserManager">UserManager</a></dt><dd/><dt>WireCompression, <a class="indexterm" href="#config-param-WireCompression">WireCompression</a></dt><dd/><dt>WireCrypt, <a class="indexterm" href="#config-param-WireCrypt">WireCrypt</a></dt><dd/><dt>WireCryptPlugin, <a class="indexterm" href="#config-param-WireCryptPlugin">WireCryptPlugin</a></dt><dd/></dl></dd></dl></div><div class="indexdiv"><h3>G</h3><dl><dt id="ientry-d0e11465">GFIX, <a class="indexterm" href="#gfix">Утилита GFIX</a></dt><dd/><dt id="ientry-d0e14258">GSEC, <a class="indexterm" href="#gsec">Утилита GSEC</a></dt><dd/><dt id="ientry-d0e13219">GSTAT, <a class="indexterm" href="#gstat">Утилита GSTAT</a></dt><dd/></dl></div><div class="indexdiv"><h3>I</h3><dl><dt id="ientry-d0e4906">ISQL, <a class="indexterm" href="#isql">Утилита ISQL</a></dt><dd><dl><dt>ADD, <a class="indexterm" href="#isql-commands-add">ADD</a></dt><dd/><dt>BLOBDUMP, <a class="indexterm" href="#isql-commands-blobdump">BLOBDUMP</a></dt><dd/><dt>BLOBVIEW, <a class="indexterm" href="#isql-commands-blobview">BLOBVIEW</a></dt><dd/><dt>CONNECT, <a class="indexterm" href="#isql-connect">Соединение с базой данных</a></dt><dd/><dt>COPY, <a class="indexterm" href="#isql-commands-copy">COPY</a></dt><dd/><dt>CREATE DATABASE, <a class="indexterm" href="#isql-create_db">Создание базы данных</a></dt><dd/><dt>EDIT, <a class="indexterm" href="#isql-commands-edit">EDIT</a></dt><dd/><dt>EXIT, <a class="indexterm" href="#isql-end_session">Завершение сессии Isql</a>, <a class="indexterm" href="#isql-commands-exit">EXIT</a></dt><dd/><dt>HELP, <a class="indexterm" href="#isql-help">Получение справки</a>, <a class="indexterm" href="#isql-commands-help">HELP</a></dt><dd><dl><dt>HELP SET, <a class="indexterm" href="#isql-help">Получение справки</a></dt><dd/></dl></dd><dt>INPUT, <a class="indexterm" href="#isql-commands-input">INPUT</a></dt><dd/><dt>OUTPUT, <a class="indexterm" href="#isql-commands-output">OUTPUT</a></dt><dd/><dt>QUIT, <a class="indexterm" href="#isql-end_session">Завершение сессии Isql</a>, <a class="indexterm" href="#isql-commands-quit">QUIT</a></dt><dd/><dt>SET, <a class="indexterm" href="#isql-commands-set">SET</a>, <a class="indexterm" href="#isql-commands_set-set">SET</a></dt><dd/><dt>SET AUTODDL, <a class="indexterm" href="#isql-commands_set-set_autoddl">SET AUTODDL</a></dt><dd/><dt>SET BAIL, <a class="indexterm" href="#isql-commands_set-set_bail">SET BAIL</a></dt><dd/><dt>SET BLOB, <a class="indexterm" href="#isql-commands_set-set_blob">SET BLOB</a></dt><dd/><dt>SET BLOBdisplay, <a class="indexterm" href="#isql-commands_set-set_blob">SET BLOB</a></dt><dd/><dt>SET BULK_INSERT, <a class="indexterm" href="#isql-commands_set-set_bulk_insert">SET BULK_INSERT</a></dt><dd/><dt>SET COUNT, <a class="indexterm" href="#isql-commands_set-set_count">SET COUNT</a></dt><dd/><dt>SET ECHO, <a class="indexterm" href="#isql-commands_set-set_echo">SET ECHO</a></dt><dd/><dt>SET EXPLAIN, <a class="indexterm" href="#isql-commands_set-set_explain">SET EXPLAIN</a></dt><dd/><dt>SET HEADING, <a class="indexterm" href="#isql-commands_set-set_heading">SET HEADING</a></dt><dd/><dt>SET KEEP_TRAN_PARAMS, <a class="indexterm" href="#isql-commands_set-set_keep_tran">SET KEEP_TRAN_PARAMS</a></dt><dd/><dt>SET LIST, <a class="indexterm" href="#isql-commands_set-set_list">SET LIST</a></dt><dd/><dt>SET NAMES, <a class="indexterm" href="#isql-commands_set-set_names">SET NAMES</a></dt><dd/><dt>SET PLAN, <a class="indexterm" href="#isql-commands_set-set_plan">SET PLAN</a></dt><dd/><dt>SET PLANONLY, <a class="indexterm" href="#isql-commands_set-set_planonly">SET PLANONLY</a></dt><dd/><dt>SET SQL DIALECT, <a class="indexterm" href="#isql-commands_set-set_sqldialect">SET SQL DIALECT</a></dt><dd/><dt>SET SQLDA_DISPLAY, <a class="indexterm" href="#isql-commands_set-set_sqlda">SET SQLDA_DISPLAY</a></dt><dd/><dt>SET STATs, <a class="indexterm" href="#isql-commands_set-set_stats">SET STATs</a></dt><dd/><dt>SET TERM, <a class="indexterm" href="#isql-commands_set-set_term">SET TERM</a></dt><dd/><dt>SET TIME, <a class="indexterm" href="#isql-commands_set-set_time">SET TIME</a></dt><dd/><dt>SET WARNINGS, <a class="indexterm" href="#isql-commands_set-set_warnings">SET WARNINGS</a></dt><dd/><dt>SET WIDTH, <a class="indexterm" href="#isql-commands_set-set_width">SET WIDTH</a></dt><dd/><dt>SET WNG, <a class="indexterm" href="#isql-commands_set-set_warnings">SET WARNINGS</a></dt><dd/><dt>SHELL, <a class="indexterm" href="#isql-commands-shell">SHELL</a></dt><dd/><dt>SHOW CHECK, <a class="indexterm" href="#isql-commands_show-show_check">SHOW CHECK</a></dt><dd/><dt>SHOW COLLATE, <a class="indexterm" href="#isql-commands_show-show_collations">SHOW COLLATION</a></dt><dd/><dt>SHOW COLLATION, <a class="indexterm" href="#isql-commands_show-show_collations">SHOW COLLATION</a></dt><dd/><dt>SHOW COMMENTS, <a class="indexterm" href="#isql-commands_show-show_comments">SHOW COMMENTS</a></dt><dd/><dt>SHOW DATABASE, <a class="indexterm" href="#isql-commands_show-show_db">SHOW DATABASE</a></dt><dd/><dt>SHOW DB, <a class="indexterm" href="#isql-commands_show-show_db">SHOW DATABASE</a></dt><dd/><dt>SHOW DEPENDENCIES, <a class="indexterm" href="#isql-commands_show-show_dependencies">SHOW DEPENDENCIES</a></dt><dd/><dt>SHOW DEPENDENCY, <a class="indexterm" href="#isql-commands_show-show_dependencies">SHOW DEPENDENCIES</a></dt><dd/><dt>SHOW DOMAIN, <a class="indexterm" href="#isql-commands_show-show_domain">SHOW DOMAIN</a></dt><dd/><dt>SHOW EXCEPTION, <a class="indexterm" href="#isql-commands_show-show_exeption">SHOW EXCEPTION</a></dt><dd/><dt>SHOW FILTER, <a class="indexterm" href="#isql-commands_show-show_filter">SHOW FILTER</a></dt><dd/><dt>SHOW FUNCTION, <a class="indexterm" href="#isql-commands_show-show_function">SHOW FUNCTION</a></dt><dd/><dt>SHOW GENERATOR, <a class="indexterm" href="#isql-commands_show-show_generator">SHOW GENERATOR</a></dt><dd/><dt>SHOW GRANTS, <a class="indexterm" href="#isql-commands_show-show_grants">SHOW GRANTS</a></dt><dd/><dt>SHOW INDEX, <a class="indexterm" href="#isql-commands_show-show_indexes">SHOW INDEXES</a></dt><dd/><dt>SHOW MAPPING, <a class="indexterm" href="#isql-commands_show-show_mapping">SHOW MAPPING</a></dt><dd/><dt>SHOW PACKAGE, <a class="indexterm" href="#isql-commands_show-show_package">SHOW PACKAGE</a></dt><dd/><dt>SHOW PROCEDURE, <a class="indexterm" href="#isql-commands_show-show_procedure">SHOW PROCEDURE</a></dt><dd/><dt>SHOW ROLE, <a class="indexterm" href="#isql-commands_show-show_role">SHOW ROLE</a></dt><dd/><dt>SHOW SECCLASSES, <a class="indexterm" href="#isql-commands_show-show_secclasses">SHOW SECCLASSES</a></dt><dd/><dt>SHOW SEQUENCE, <a class="indexterm" href="#isql-commands_show-show_sequence">SHOW SEQUENCE</a></dt><dd/><dt>SHOW SQL DIALECT, <a class="indexterm" href="#isql-commands_show-show_sql_dialect">SHOW SQL DIALECT</a></dt><dd/><dt>SHOW SYSTEM, <a class="indexterm" href="#isql-commands_show-show_system">SHOW SYSTEM</a></dt><dd/><dt>SHOW TABLE, <a class="indexterm" href="#isql-commands_show-show_table">SHOW TABLE</a></dt><dd/><dt>SHOW TRIGGER, <a class="indexterm" href="#isql-commands_show-show_trigger">SHOW TRIGGER</a></dt><dd/><dt>SHOW USERS, <a class="indexterm" href="#isql-commands_show-show_users">SHOW USERS</a></dt><dd/><dt>SHOW VERSION, <a class="indexterm" href="#isql-commands_show-show_version">SHOW VERSION</a></dt><dd/><dt>SHOW VIEW, <a class="indexterm" href="#isql-commands_show-show_view">SHOW VIEW</a></dt><dd/></dl></dd></dl></div><div class="indexdiv"><h3>N</h3><dl><dt id="ientry-d0e9988">NBACKUP, <a class="indexterm" href="#nbackup">Утилита NBACKUP</a></dt><dd/></dl></div></div></div></div></body></html>